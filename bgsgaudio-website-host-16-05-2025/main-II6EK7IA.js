var Mre=Object.create;var nR=Object.defineProperty,kre=Object.defineProperties,Lre=Object.getOwnPropertyDescriptor,xre=Object.getOwnPropertyDescriptors,Ure=Object.getOwnPropertyNames,fE=Object.getOwnPropertySymbols,ej=Object.getPrototypeOf,rR=Object.prototype.hasOwnProperty,tj=Object.prototype.propertyIsEnumerable,Fre=Reflect.get;var tR=(i,s)=>(s=Symbol[i])?s:Symbol.for("Symbol."+i),Vre=i=>{throw TypeError(i)};var Z2=(i,s,a)=>s in i?nR(i,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[s]=a,Se=(i,s)=>{for(var a in s||={})rR.call(s,a)&&Z2(i,a,s[a]);if(fE)for(var a of fE(s))tj.call(s,a)&&Z2(i,a,s[a]);return i},At=(i,s)=>kre(i,xre(s));var nj=(i,s)=>{var a={};for(var u in i)rR.call(i,u)&&s.indexOf(u)<0&&(a[u]=i[u]);if(i!=null&&fE)for(var u of fE(i))s.indexOf(u)<0&&tj.call(i,u)&&(a[u]=i[u]);return a};var jre=(i,s)=>()=>(s||i((s={exports:{}}).exports,s),s.exports);var Bre=(i,s,a,u)=>{if(s&&typeof s=="object"||typeof s=="function")for(let p of Ure(s))!rR.call(i,p)&&p!==a&&nR(i,p,{get:()=>s[p],enumerable:!(u=Lre(s,p))||u.enumerable});return i};var Hre=(i,s,a)=>(a=i!=null?Mre(ej(i)):{},Bre(s||!i||!i.__esModule?nR(a,"default",{value:i,enumerable:!0}):a,i));var iR=(i,s,a)=>Fre(ej(i),a,s);var P=(i,s,a)=>new Promise((u,p)=>{var g=w=>{try{R(a.next(w))}catch(L){p(L)}},y=w=>{try{R(a.throw(w))}catch(L){p(L)}},R=w=>w.done?u(w.value):Promise.resolve(w.value).then(g,y);R((a=a.apply(i,s)).next())}),Gre=function(i,s){this[0]=i,this[1]=s};var ip=i=>{var s=i[tR("asyncIterator")],a=!1,u,p={};return s==null?(s=i[tR("iterator")](),u=g=>p[g]=y=>s[g](y)):(s=s.call(i),u=g=>p[g]=y=>{if(a){if(a=!1,g==="throw")throw y;return y}return a=!0,{done:!1,value:new Gre(new Promise(R=>{var w=s[g](y);w instanceof Object||Vre("Object expected"),R(w)}),1)}}),p[tR("iterator")]=()=>p,u("next"),"throw"in s?u("throw"):p.throw=g=>{throw g},"return"in s&&u("return"),p};var c4=jre((LA,xA)=>{"use strict";(function(i,s){typeof LA=="object"&&typeof xA<"u"?xA.exports=s():typeof define=="function"&&define.amd?define(s):(i=typeof globalThis<"u"?globalThis:i||self).AgoraRTC=s()})(LA,function(){"use strict";function i(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var s=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var u=function(e){try{return!!e()}catch{return!0}},p=!u(function(){var e=function(){}.bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),g=p,y=Function.prototype,R=y.call,w=g&&y.bind.bind(R,R),L=g?w:function(e){return function(){return R.apply(e,arguments)}},V=L({}.isPrototypeOf),q=function(e){return e&&e.Math===Math&&e},Z=q(typeof globalThis=="object"&&globalThis)||q(typeof window=="object"&&window)||q(typeof self=="object"&&self)||q(typeof s=="object"&&s)||q(typeof s=="object"&&s)||function(){return this}()||Function("return this")(),$=p,pe=Function.prototype,Ie=pe.apply,ct=pe.call,We=typeof Reflect=="object"&&Reflect.apply||($?ct.bind(Ie):function(){return ct.apply(Ie,arguments)}),er=L,Uo=er({}.toString),Kv=er("".slice),Fo=function(e){return Kv(Uo(e),8,-1)},x4=Fo,U4=L,Pl=function(e){if(x4(e)==="Function")return U4(e)},qv=typeof document=="object"&&document.all,Rn=qv===void 0&&qv!==void 0?function(e){return typeof e=="function"||e===qv}:function(e){return typeof e=="function"},Ef={},Tr=!u(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),F4=p,_f=Function.prototype.call,Pn=F4?_f.bind(_f):function(){return _f.apply(_f,arguments)},vf={},KA={}.propertyIsEnumerable,qA=Object.getOwnPropertyDescriptor,V4=qA&&!KA.call({1:2},1);vf.f=V4?function(e){var t=qA(this,e);return!!t&&t.enumerable}:KA;var Ys,yf,$s=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},j4=u,B4=Fo,zv=Object,H4=L("".split),Tf=j4(function(){return!zv("z").propertyIsEnumerable(0)})?function(e){return B4(e)==="String"?H4(e,""):zv(e)}:zv,ad=function(e){return e==null},G4=ad,W4=TypeError,Ka=function(e){if(G4(e))throw new W4("Can't call method on "+e);return e},K4=Tf,q4=Ka,Xs=function(e){return K4(q4(e))},z4=Rn,Sr=function(e){return typeof e=="object"?e!==null:z4(e)},ai={},Yv=ai,$v=Z,Y4=Rn,zA=function(e){return Y4(e)?e:void 0},hr=function(e,t){return arguments.length<2?zA(Yv[e])||zA($v[e]):Yv[e]&&Yv[e][t]||$v[e]&&$v[e][t]},YA=Z.navigator,$A=YA&&YA.userAgent,ms=$A?String($A):"",XA=Z,Xv=ms,JA=XA.process,QA=XA.Deno,ZA=JA&&JA.versions||QA&&QA.version,eD=ZA&&ZA.v8;eD&&(yf=(Ys=eD.split("."))[0]>0&&Ys[0]<4?1:+(Ys[0]+Ys[1])),!yf&&Xv&&(!(Ys=Xv.match(/Edge\/(\d+)/))||Ys[1]>=74)&&(Ys=Xv.match(/Chrome\/(\d+)/))&&(yf=+Ys[1]);var qa=yf,tD=qa,$4=u,X4=Z.String,cd=!!Object.getOwnPropertySymbols&&!$4(function(){var e=Symbol("symbol detection");return!X4(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&tD&&tD<41}),nD=cd&&!Symbol.sham&&typeof Symbol.iterator=="symbol",J4=hr,Q4=Rn,Z4=V,e5=Object,Ml=nD?function(e){return typeof e=="symbol"}:function(e){var t=J4("Symbol");return Q4(t)&&Z4(t.prototype,e5(e))},t5=String,dd=function(e){try{return t5(e)}catch{return"Object"}},n5=Rn,r5=dd,i5=TypeError,Hr=function(e){if(n5(e))return e;throw new i5(r5(e)+" is not a function")},o5=Hr,s5=ad,Sf=function(e,t){var n=e[t];return s5(n)?void 0:o5(n)},Jv=Pn,Qv=Rn,Zv=Sr,a5=TypeError,rD={exports:{}},c5=!0,iD=Z,d5=Object.defineProperty,u5=Z,l5=function(e,t){try{d5(iD,e,{value:t,configurable:!0,writable:!0})}catch{iD[e]=t}return t},oD="__core-js_shared__",sD=rD.exports=u5[oD]||l5(oD,{});(sD.versions||(sD.versions=[])).push({version:"3.39.0",mode:"pure",copyright:"\xA9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"});var ey=rD.exports,aD=ey,ud=function(e,t){return aD[e]||(aD[e]=t||{})},h5=Ka,p5=Object,Vo=function(e){return p5(h5(e))},f5=Vo,m5=L({}.hasOwnProperty),Mn=Object.hasOwn||function(e,t){return m5(f5(e),t)},g5=L,E5=0,_5=Math.random(),v5=g5(1 .toString),ty=function(e){return"Symbol("+(e===void 0?"":e)+")_"+v5(++E5+_5,36)},y5=ud,cD=Mn,T5=ty,S5=cd,C5=nD,ld=Z.Symbol,ny=y5("wks"),I5=C5?ld.for||ld:ld&&ld.withoutSetter||T5,en=function(e){return cD(ny,e)||(ny[e]=S5&&cD(ld,e)?ld[e]:I5("Symbol."+e)),ny[e]},R5=Pn,dD=Sr,uD=Ml,w5=Sf,b5=function(e,t){var n,r;if(t==="string"&&Qv(n=e.toString)&&!Zv(r=Jv(n,e))||Qv(n=e.valueOf)&&!Zv(r=Jv(n,e))||t!=="string"&&Qv(n=e.toString)&&!Zv(r=Jv(n,e)))return r;throw new a5("Can't convert object to primitive value")},A5=TypeError,D5=en("toPrimitive"),O5=function(e,t){if(!dD(e)||uD(e))return e;var n,r=w5(e,D5);if(r){if(t===void 0&&(t="default"),n=R5(r,e,t),!dD(n)||uD(n))return n;throw new A5("Can't convert object to primitive value")}return t===void 0&&(t="number"),b5(e,t)},N5=Ml,ry=function(e){var t=O5(e,"string");return N5(t)?t:t+""},lD=Sr,iy=Z.document,P5=lD(iy)&&lD(iy.createElement),oy=function(e){return P5?iy.createElement(e):{}},M5=oy,hD=!Tr&&!u(function(){return Object.defineProperty(M5("div"),"a",{get:function(){return 7}}).a!==7}),k5=Tr,L5=Pn,x5=vf,U5=$s,F5=Xs,V5=ry,j5=Mn,B5=hD,pD=Object.getOwnPropertyDescriptor;Ef.f=k5?pD:function(e,t){if(e=F5(e),t=V5(t),B5)try{return pD(e,t)}catch{}if(j5(e,t))return U5(!L5(x5.f,e,t),e[t])};var H5=u,G5=Rn,W5=/#|\.prototype\./,kl=function(e,t){var n=q5[K5(e)];return n===Y5||n!==z5&&(G5(t)?H5(t):!!t)},K5=kl.normalize=function(e){return String(e).replace(W5,".").toLowerCase()},q5=kl.data={},z5=kl.NATIVE="N",Y5=kl.POLYFILL="P",fD=kl,$5=Hr,X5=p,J5=Pl(Pl.bind),Js=function(e,t){return $5(e),t===void 0?e:X5?J5(e,t):function(){return e.apply(t,arguments)}},Mi={},mD=Tr&&u(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Q5=Sr,Z5=String,e8=TypeError,Pr=function(e){if(Q5(e))return e;throw new e8(Z5(e)+" is not an object")},t8=Tr,n8=hD,r8=mD,Cf=Pr,gD=ry,i8=TypeError,sy=Object.defineProperty,o8=Object.getOwnPropertyDescriptor,ay="enumerable",cy="configurable",dy="writable";Mi.f=t8?r8?function(e,t,n){if(Cf(e),t=gD(t),Cf(n),typeof e=="function"&&t==="prototype"&&"value"in n&&dy in n&&!n[dy]){var r=o8(e,t);r&&r[dy]&&(e[t]=n.value,n={configurable:cy in n?n[cy]:r[cy],enumerable:ay in n?n[ay]:r[ay],writable:!1})}return sy(e,t,n)}:sy:function(e,t,n){if(Cf(e),t=gD(t),Cf(n),n8)try{return sy(e,t,n)}catch{}if("get"in n||"set"in n)throw new i8("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var s8=Mi,a8=$s,za=Tr?function(e,t,n){return s8.f(e,t,a8(1,n))}:function(e,t,n){return e[t]=n,e},Ll=Z,c8=We,d8=Pl,u8=Rn,l8=Ef.f,h8=fD,hd=ai,p8=Js,pd=za,ED=Mn,f8=function(e){var t=function(n,r,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,o)}return c8(e,this,arguments)};return t.prototype=e.prototype,t},Je=function(e,t){var n,r,o,c,d,l,h,f,m,E=e.target,_=e.global,v=e.stat,A=e.proto,C=_?Ll:v?Ll[E]:Ll[E]&&Ll[E].prototype,I=_?hd:hd[E]||pd(hd,E,{})[E],O=I.prototype;for(c in t)r=!(n=h8(_?c:E+(v?".":"#")+c,e.forced))&&C&&ED(C,c),l=I[c],r&&(h=e.dontCallGetSet?(m=l8(C,c))&&m.value:C[c]),d=r&&h?h:t[c],(n||A||typeof l!=typeof d)&&(f=e.bind&&r?p8(d,Ll):e.wrap&&r?f8(d):A&&u8(d)?d8(d):d,(e.sham||d&&d.sham||l&&l.sham)&&pd(f,"sham",!0),pd(I,c,f),A&&(ED(hd,o=E+"Prototype")||pd(hd,o,{}),pd(hd[o],c,d),e.real&&O&&(n||!O[c])&&pd(O,c,d)))},m8=Math.ceil,g8=Math.floor,E8=Math.trunc||function(e){var t=+e;return(t>0?g8:m8)(t)},_8=E8,uy=function(e){var t=+e;return t!=t||t===0?0:_8(t)},v8=uy,y8=Math.max,T8=Math.min,ly=function(e,t){var n=v8(e);return n<0?y8(n+t,0):T8(n,t)},S8=uy,C8=Math.min,_D=function(e){var t=S8(e);return t>0?C8(t,9007199254740991):0},I8=_D,Qs=function(e){return I8(e.length)},R8=Xs,w8=ly,b8=Qs,vD=function(e){return function(t,n,r){var o=R8(t),c=b8(o);if(c===0)return!e&&-1;var d,l=w8(r,c);if(e&&n!=n){for(;c>l;)if((d=o[l++])!=d)return!0}else for(;c>l;l++)if((e||l in o)&&o[l]===n)return e||l||0;return!e&&-1}},hy={includes:vD(!0),indexOf:vD(!1)},A8=hy.includes;Je({target:"Array",proto:!0,forced:u(function(){return!Array(1).includes()})},{includes:function(e){return A8(this,e,arguments.length>1?arguments[1]:void 0)}});var D8=Z,O8=ai,ki=function(e,t){var n=O8[e+"Prototype"],r=n&&n[t];if(r)return r;var o=D8[e],c=o&&o.prototype;return c&&c[t]},N8=ki("Array","includes"),P8=Sr,M8=Fo,k8=en("match"),yD=function(e){var t;return P8(e)&&((t=e[k8])!==void 0?!!t:M8(e)==="RegExp")},L8=yD,x8=TypeError,TD={};TD[en("toStringTag")]="z";var py=String(TD)==="[object z]",U8=py,F8=Rn,If=Fo,V8=en("toStringTag"),j8=Object,B8=If(function(){return arguments}())==="Arguments",gs=U8?If:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(o,c){try{return o[c]}catch{}}(t=j8(e),V8))=="string"?n:B8?If(t):(r=If(t))==="Object"&&F8(t.callee)?"Arguments":r},H8=gs,G8=String,Gr=function(e){if(H8(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return G8(e)},W8=en("match"),K8=Je,q8=function(e){if(L8(e))throw new x8("The method doesn't accept regular expressions");return e},z8=Ka,SD=Gr,Y8=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[W8]=!1,"/./"[e](t)}catch{}}return!1},$8=L("".indexOf);K8({target:"String",proto:!0,forced:!Y8("includes")},{includes:function(e){return!!~$8(SD(z8(this)),SD(q8(e)),arguments.length>1?arguments[1]:void 0)}});var X8=ki("String","includes"),CD=V,J8=N8,Q8=X8,fy=Array.prototype,my=String.prototype,Z8=function(e){var t=e.includes;return e===fy||CD(fy,e)&&t===fy.includes?J8:typeof e=="string"||e===my||CD(my,e)&&t===my.includes?Q8:t},ne=a(Z8),e6=Hr,t6=Vo,n6=Tf,r6=Qs,ID=TypeError,RD="Reduce of empty array with no initial value",wD=function(e){return function(t,n,r,o){var c=t6(t),d=n6(c),l=r6(c);if(e6(n),l===0&&r<2)throw new ID(RD);var h=e?l-1:0,f=e?-1:1;if(r<2)for(;;){if(h in d){o=d[h],h+=f;break}if(h+=f,e?h<0:l<=h)throw new ID(RD)}for(;e?h>=0:l>h;h+=f)h in d&&(o=n(o,d[h],h,c));return o}},i6={left:wD(!1),right:wD(!0)},o6=u,Rf=function(e,t){var n=[][e];return!!n&&o6(function(){n.call(null,t||function(){return 1},1)})},xl=Z,s6=ms,a6=Fo,wf=function(e){return s6.slice(0,e.length)===e},gy=wf("Bun/")?"BUN":wf("Cloudflare-Workers")?"CLOUDFLARE":wf("Deno/")?"DENO":wf("Node.js/")?"NODE":xl.Bun&&typeof Bun.version=="string"?"BUN":xl.Deno&&typeof Deno.version=="object"?"DENO":a6(xl.process)==="process"?"NODE":xl.window&&xl.document?"BROWSER":"REST",bf=gy==="NODE",c6=i6.left;Je({target:"Array",proto:!0,forced:!bf&&qa>79&&qa<83||!Rf("reduce")},{reduce:function(e){var t=arguments.length;return c6(this,e,t,t>1?arguments[1]:void 0)}});var d6=ki("Array","reduce"),u6=V,l6=d6,Ey=Array.prototype,h6=function(e){var t=e.reduce;return e===Ey||u6(Ey,e)&&t===Ey.reduce?l6:t},bD=h6,co=a(bD),p6=Fo,Ul=Array.isArray||function(e){return p6(e)==="Array"},f6=Je,m6=Ul,g6=L([].reverse),AD=[1,2];f6({target:"Array",proto:!0,forced:String(AD)===String(AD.reverse())},{reverse:function(){return m6(this)&&(this.length=this.length),g6(this)}});var E6=ki("Array","reverse"),_6=V,v6=E6,_y=Array.prototype,y6=function(e){var t=e.reverse;return e===_y||_6(_y,e)&&t===_y.reverse?v6:t},DD=y6,OD=a(DD),T6=ty,ND=ud("keys"),Af=function(e){return ND[e]||(ND[e]=T6(e))},S6=!u(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),C6=Mn,I6=Rn,R6=Vo,w6=S6,PD=Af("IE_PROTO"),vy=Object,b6=vy.prototype,yy=w6?vy.getPrototypeOf:function(e){var t=R6(e);if(C6(t,PD))return t[PD];var n=t.constructor;return I6(n)&&t instanceof n?n.prototype:t instanceof vy?b6:null},A6=L,D6=Hr,O6=Sr,N6=function(e){return O6(e)||e===null},P6=String,M6=TypeError,k6=function(e,t,n){try{return A6(D6(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},L6=Sr,x6=Ka,U6=function(e){if(N6(e))return e;throw new M6("Can't set "+P6(e)+" as a prototype")},F6=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=k6(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(r,o){return x6(r),U6(o),L6(r)&&(t?e(r,o):r.__proto__=o),r}}():void 0),Df={},Of={},Ty=Mn,V6=Xs,j6=hy.indexOf,B6=Of,MD=L([].push),kD=function(e,t){var n,r=V6(e),o=0,c=[];for(n in r)!Ty(B6,n)&&Ty(r,n)&&MD(c,n);for(;t.length>o;)Ty(r,n=t[o++])&&(~j6(c,n)||MD(c,n));return c},Sy=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],H6=kD,G6=Sy.concat("length","prototype");Df.f=Object.getOwnPropertyNames||function(e){return H6(e,G6)};var Fl={};Fl.f=Object.getOwnPropertySymbols;var W6=hr,K6=Df,q6=Fl,z6=Pr,Y6=L([].concat),$6=W6("Reflect","ownKeys")||function(e){var t=K6.f(z6(e)),n=q6.f;return n?Y6(t,n(e)):t},LD=Mn,X6=$6,J6=Ef,Q6=Mi,Cy={},Z6=kD,eK=Sy,Nf=Object.keys||function(e){return Z6(e,eK)},tK=Tr,nK=mD,rK=Mi,iK=Pr,oK=Xs,sK=Nf;Cy.f=tK&&!nK?Object.defineProperties:function(e,t){iK(e);for(var n,r=oK(t),o=sK(t),c=o.length,d=0;c>d;)rK.f(e,n=o[d++],r[n]);return e};var Pf,xD=hr("document","documentElement"),aK=Pr,cK=Cy,UD=Sy,dK=Of,uK=xD,lK=oy,Iy="prototype",Ry="script",FD=Af("IE_PROTO"),wy=function(){},VD=function(e){return"<"+Ry+">"+e+"</"+Ry+">"},jD=function(e){e.write(VD("")),e.close();var t=e.parentWindow.Object;return e=null,t},Mf=function(){try{Pf=new ActiveXObject("htmlfile")}catch{}var e,t,n;Mf=typeof document<"u"?document.domain&&Pf?jD(Pf):(t=lK("iframe"),n="java"+Ry+":",t.style.display="none",uK.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(VD("document.F=Object")),e.close(),e.F):jD(Pf);for(var r=UD.length;r--;)delete Mf[Iy][UD[r]];return Mf()};dK[FD]=!0;var Vl=Object.create||function(e,t){var n;return e!==null?(wy[Iy]=aK(e),n=new wy,wy[Iy]=null,n[FD]=e):n=Mf(),t===void 0?n:cK.f(n,t)},hK=Sr,pK=za,BD=Error,fK=L("".replace),mK=String(new BD("zxcasd").stack),HD=/\n\s*at [^:]*:[^\n]*/,gK=HD.test(mK),EK=$s,_K=!u(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",EK(1,7)),e.stack!==7)}),vK=za,yK=function(e,t){if(gK&&typeof e=="string"&&!BD.prepareStackTrace)for(;t--;)e=fK(e,HD,"");return e},TK=_K,GD=Error.captureStackTrace,Ya={},SK=Ya,CK=en("iterator"),IK=Array.prototype,WD=function(e){return e!==void 0&&(SK.Array===e||IK[CK]===e)},RK=gs,KD=Sf,wK=ad,bK=Ya,AK=en("iterator"),kf=function(e){if(!wK(e))return KD(e,AK)||KD(e,"@@iterator")||bK[RK(e)]},DK=Pn,OK=Hr,NK=Pr,PK=dd,MK=kf,kK=TypeError,by=function(e,t){var n=arguments.length<2?MK(e):t;if(OK(n))return NK(DK(n,e));throw new kK(PK(e)+" is not iterable")},LK=Pn,qD=Pr,xK=Sf,zD=function(e,t,n){var r,o;qD(e);try{if(!(r=xK(e,"return"))){if(t==="throw")throw n;return n}r=LK(r,e)}catch(c){o=!0,r=c}if(t==="throw")throw n;if(o)throw r;return qD(r),n},UK=Js,FK=Pn,VK=Pr,jK=dd,BK=WD,HK=Qs,YD=V,GK=by,WK=kf,$D=zD,KK=TypeError,Lf=function(e,t){this.stopped=e,this.result=t},XD=Lf.prototype,jl=function(e,t,n){var r,o,c,d,l,h,f,m=n&&n.that,E=!(!n||!n.AS_ENTRIES),_=!(!n||!n.IS_RECORD),v=!(!n||!n.IS_ITERATOR),A=!(!n||!n.INTERRUPTED),C=UK(t,m),I=function(N){return r&&$D(r,"normal",N),new Lf(!0,N)},O=function(N){return E?(VK(N),A?C(N[0],N[1],I):C(N[0],N[1])):A?C(N,I):C(N)};if(_)r=e.iterator;else if(v)r=e;else{if(!(o=WK(e)))throw new KK(jK(e)+" is not iterable");if(BK(o)){for(c=0,d=HK(e);d>c;c++)if((l=O(e[c]))&&YD(XD,l))return l;return new Lf(!1)}r=GK(e,o)}for(h=_?e.next:r.next;!(f=FK(h,r)).done;){try{l=O(f.value)}catch(N){$D(r,"throw",N)}if(typeof l=="object"&&l&&YD(XD,l))return l}return new Lf(!1)},qK=Gr,zK=Je,YK=V,$K=yy,xf=F6,XK=function(e,t,n){for(var r=X6(t),o=Q6.f,c=J6.f,d=0;d<r.length;d++){var l=r[d];LD(e,l)||n&&LD(n,l)||o(e,l,c(t,l))}},JD=Vl,Ay=za,Dy=$s,JK=function(e,t){hK(t)&&"cause"in t&&pK(e,"cause",t.cause)},QK=function(e,t,n,r){TK&&(GD?GD(e,t):vK(e,"stack",yK(n,r)))},ZK=jl,eq=function(e,t){return e===void 0?arguments.length<2?"":t:qK(e)},tq=en("toStringTag"),Uf=Error,nq=[].push,fd=function(e,t){var n,r=YK(Oy,this);xf?n=xf(new Uf,r?$K(this):Oy):(n=r?this:JD(Oy),Ay(n,tq,"Error")),t!==void 0&&Ay(n,"message",eq(t)),QK(n,fd,n.stack,1),arguments.length>2&&JK(n,arguments[2]);var o=[];return ZK(e,nq,{that:o}),Ay(n,"errors",o),n};xf?xf(fd,Uf):XK(fd,Uf,{name:!0});var Oy=fd.prototype=JD(Uf.prototype,{constructor:Dy(1,fd),message:Dy(1,""),name:Dy(1,"AggregateError")});zK({global:!0,constructor:!0,arity:2},{AggregateError:fd});var Ff,Bl,Vf,rq=Rn,QD=Z.WeakMap,iq=rq(QD)&&/native code/.test(String(QD)),ZD=Z,oq=Sr,sq=za,Ny=Mn,Py=ey,aq=Af,cq=Of,e0="Object already initialized",My=ZD.TypeError,dq=ZD.WeakMap;if(iq||Py.state){var jo=Py.state||(Py.state=new dq);jo.get=jo.get,jo.has=jo.has,jo.set=jo.set,Ff=function(e,t){if(jo.has(e))throw new My(e0);return t.facade=e,jo.set(e,t),t},Bl=function(e){return jo.get(e)||{}},Vf=function(e){return jo.has(e)}}else{var md=aq("state");cq[md]=!0,Ff=function(e,t){if(Ny(e,md))throw new My(e0);return t.facade=e,sq(e,md,t),t},Bl=function(e){return Ny(e,md)?e[md]:{}},Vf=function(e){return Ny(e,md)}}var $a,t0,n0,Xa={set:Ff,get:Bl,has:Vf,enforce:function(e){return Vf(e)?Bl(e):Ff(e,{})},getterFor:function(e){return function(t){var n;if(!oq(t)||(n=Bl(t)).type!==e)throw new My("Incompatible receiver, "+e+" required");return n}}},ky=Tr,uq=Mn,r0=Function.prototype,lq=ky&&Object.getOwnPropertyDescriptor,Ly=uq(r0,"name"),i0={EXISTS:Ly,PROPER:Ly&&function(){}.name==="something",CONFIGURABLE:Ly&&(!ky||ky&&lq(r0,"name").configurable)},hq=za,Zs=function(e,t,n,r){return r&&r.enumerable?e[t]=n:hq(e,t,n),e},pq=u,fq=Rn,mq=Sr,gq=Vl,o0=yy,Eq=Zs,xy=en("iterator"),s0=!1;[].keys&&("next"in(n0=[].keys())?(t0=o0(o0(n0)))!==Object.prototype&&($a=t0):s0=!0);var _q=!mq($a)||pq(function(){var e={};return $a[xy].call(e)!==e});fq(($a=_q?{}:gq($a))[xy])||Eq($a,xy,function(){return this});var a0={IteratorPrototype:$a,BUGGY_SAFARI_ITERATORS:s0},vq=gs,yq=py?{}.toString:function(){return"[object "+vq(this)+"]"},Tq=py,Sq=Mi.f,Cq=za,Iq=Mn,Rq=yq,c0=en("toStringTag"),Es=function(e,t,n,r){var o=n?e:e&&e.prototype;o&&(Iq(o,c0)||Sq(o,c0,{configurable:!0,value:t}),r&&!Tq&&Cq(o,"toString",Rq))},wq=a0.IteratorPrototype,bq=Vl,Aq=$s,Dq=Es,Oq=Ya,Nq=function(){return this},Uy=function(e,t,n,r){var o=t+" Iterator";return e.prototype=bq(wq,{next:Aq(+!r,n)}),Dq(e,o,!1,!0),Oq[o]=Nq,e},Pq=Je,Mq=Pn,kq=i0,Lq=Uy,xq=yy,Uq=Es,d0=Zs,u0=Ya,Fq=a0,Vq=kq.PROPER,jf=Fq.BUGGY_SAFARI_ITERATORS,Fy=en("iterator"),l0="keys",Bf="values",h0="entries",jq=function(){return this},p0=function(e,t,n,r,o,c,d){Lq(n,t,r);var l,h,f,m=function(O){if(O===o&&C)return C;if(!jf&&O&&O in v)return v[O];switch(O){case l0:case Bf:case h0:return function(){return new n(this,O)}}return function(){return new n(this)}},E=t+" Iterator",_=!1,v=e.prototype,A=v[Fy]||v["@@iterator"]||o&&v[o],C=!jf&&A||m(o),I=t==="Array"&&v.entries||A;if(I&&(l=xq(I.call(new e)))!==Object.prototype&&l.next&&(Uq(l,E,!0,!0),u0[E]=jq),Vq&&o===Bf&&A&&A.name!==Bf&&(_=!0,C=function(){return Mq(A,this)}),o)if(h={values:m(Bf),keys:c?C:m(l0),entries:m(h0)},d)for(f in h)(jf||_||!(f in v))&&d0(v,f,h[f]);else Pq({target:t,proto:!0,forced:jf||_},h);return d&&v[Fy]!==C&&d0(v,Fy,C,{name:o}),u0[t]=C,h},Hf=function(e,t){return{value:e,done:t}},Bq=Xs,f0=Ya,m0=Xa;Mi.f;var Hq=p0,Gf=Hf,g0="Array Iterator",Gq=m0.set,Wq=m0.getterFor(g0);Hq(Array,"Array",function(e,t){Gq(this,{type:g0,target:Bq(e),index:0,kind:t})},function(){var e=Wq(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Gf(void 0,!0);switch(e.kind){case"keys":return Gf(n,!1);case"values":return Gf(t[n],!1)}return Gf([n,t[n]],!1)},"values"),f0.Arguments=f0.Array;var Kq=Mi,Wf=function(e,t,n){return Kq.f(e,t,n)},qq=hr,zq=Wf,Yq=Tr,E0=en("species"),$q=V,Xq=TypeError,Vy=function(e,t){if($q(t,e))return e;throw new Xq("Incorrect invocation")},Jq=Rn,jy=ey,Qq=L(Function.toString);Jq(jy.inspectSource)||(jy.inspectSource=function(e){return Qq(e)});var _0=jy.inspectSource,Zq=L,ez=u,v0=Rn,tz=gs,nz=_0,y0=function(){},T0=hr("Reflect","construct"),By=/^\s*(?:class|function)\b/,rz=Zq(By.exec),iz=!By.test(y0),Hl=function(e){if(!v0(e))return!1;try{return T0(y0,[],e),!0}catch{return!1}},S0=function(e){if(!v0(e))return!1;switch(tz(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return iz||!!rz(By,nz(e))}catch{return!0}};S0.sham=!0;var Gl,gd,C0,Hy,Kf=!T0||ez(function(){var e;return Hl(Hl.call)||!Hl(Object)||!Hl(function(){e=!0})||e})?S0:Hl,oz=Kf,sz=dd,az=TypeError,I0=Pr,cz=function(e){if(oz(e))return e;throw new az(sz(e)+" is not a constructor")},dz=ad,uz=en("species"),Gy=function(e,t){var n,r=I0(e).constructor;return r===void 0||dz(n=I0(r)[uz])?t:cz(n)},ea=L([].slice),lz=TypeError,Ja=function(e,t){if(e<t)throw new lz("Not enough arguments");return e},R0=/(?:ipad|iphone|ipod).*applewebkit/i.test(ms),ci=Z,hz=We,pz=Js,w0=Rn,fz=Mn,b0=u,A0=xD,mz=ea,D0=oy,gz=Ja,Ez=R0,_z=bf,Wy=ci.setImmediate,Ky=ci.clearImmediate,vz=ci.process,qy=ci.Dispatch,yz=ci.Function,O0=ci.MessageChannel,Tz=ci.String,zy=0,Wl={},N0="onreadystatechange";b0(function(){Gl=ci.location});var Yy=function(e){if(fz(Wl,e)){var t=Wl[e];delete Wl[e],t()}},$y=function(e){return function(){Yy(e)}},P0=function(e){Yy(e.data)},M0=function(e){ci.postMessage(Tz(e),Gl.protocol+"//"+Gl.host)};Wy&&Ky||(Wy=function(e){gz(arguments.length,1);var t=w0(e)?e:yz(e),n=mz(arguments,1);return Wl[++zy]=function(){hz(t,void 0,n)},gd(zy),zy},Ky=function(e){delete Wl[e]},_z?gd=function(e){vz.nextTick($y(e))}:qy&&qy.now?gd=function(e){qy.now($y(e))}:O0&&!Ez?(Hy=(C0=new O0).port2,C0.port1.onmessage=P0,gd=pz(Hy.postMessage,Hy)):ci.addEventListener&&w0(ci.postMessage)&&!ci.importScripts&&Gl&&Gl.protocol!=="file:"&&!b0(M0)?(gd=M0,ci.addEventListener("message",P0,!1)):gd=N0 in D0("script")?function(e){A0.appendChild(D0("script"))[N0]=function(){A0.removeChild(this),Yy(e)}}:function(e){setTimeout($y(e),0)});var qf={set:Wy,clear:Ky},k0=Z,Sz=Tr,Cz=Object.getOwnPropertyDescriptor,L0=function(e){if(!Sz)return k0[e];var t=Cz(k0,e);return t&&t.value},x0=function(){this.head=null,this.tail=null};x0.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Ed,Xy,Jy,Qy,U0,F0=x0,Iz=/ipad|iphone|ipod/i.test(ms)&&typeof Pebble<"u",Rz=/web0s(?!.*chrome)/i.test(ms),_d=Z,wz=L0,V0=Js,Zy=qf.set,bz=F0,Az=R0,Dz=Iz,Oz=Rz,eT=bf,j0=_d.MutationObserver||_d.WebKitMutationObserver,B0=_d.document,H0=_d.process,zf=_d.Promise,tT=wz("queueMicrotask");if(!tT){var Yf=new bz,$f=function(){var e,t;for(eT&&(e=H0.domain)&&e.exit();t=Yf.get();)try{t()}catch(n){throw Yf.head&&Ed(),n}e&&e.enter()};Az||eT||Oz||!j0||!B0?!Dz&&zf&&zf.resolve?((Qy=zf.resolve(void 0)).constructor=zf,U0=V0(Qy.then,Qy),Ed=function(){U0($f)}):eT?Ed=function(){H0.nextTick($f)}:(Zy=V0(Zy,_d),Ed=function(){Zy($f)}):(Xy=!0,Jy=B0.createTextNode(""),new j0($f).observe(Jy,{characterData:!0}),Ed=function(){Jy.data=Xy=!Xy}),tT=function(e){Yf.head||Ed(),Yf.add(e)}}var G0=tT,vd=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Qa=Z.Promise,Nz=Z,Kl=Qa,Pz=Rn,Mz=fD,kz=_0,Lz=en,W0=gy,nT=qa,K0=Kl&&Kl.prototype,xz=Lz("species"),q0=!1,z0=Pz(Nz.PromiseRejectionEvent),Uz=Mz("Promise",function(){var e=kz(Kl),t=e!==String(Kl);if(!t&&nT===66||!K0.catch||!K0.finally)return!0;if(!nT||nT<51||!/native code/.test(e)){var n=new Kl(function(o){o(1)}),r=function(o){o(function(){},function(){})};if((n.constructor={})[xz]=r,!(q0=n.then(function(){})instanceof r))return!0}return!(t||W0!=="BROWSER"&&W0!=="DENO"||z0)}),ql={CONSTRUCTOR:Uz,REJECTION_EVENT:z0,SUBCLASSING:q0},Bo={},Y0=Hr,Fz=TypeError,Vz=function(e){var t,n;this.promise=new e(function(r,o){if(t!==void 0||n!==void 0)throw new Fz("Bad Promise constructor");t=r,n=o}),this.resolve=Y0(t),this.reject=Y0(n)};Bo.f=function(e){return new Vz(e)};var rT,$0,jz=Je,Xf=bf,ta=Z,zl=Pn,Bz=Zs,Hz=Es,Gz=function(e){var t=qq(e);Yq&&t&&!t[E0]&&zq(t,E0,{configurable:!0,get:function(){return this}})},Wz=Hr,iT=Rn,Kz=Sr,qz=Vy,zz=Gy,X0=qf.set,oT=G0,Yz=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},$z=vd,Xz=F0,J0=Xa,sT=Qa,Q0=ql,Z0=Bo,Jf="Promise",eO=Q0.CONSTRUCTOR,Jz=Q0.REJECTION_EVENT,aT=J0.getterFor(Jf),Qz=J0.set,Zz=sT&&sT.prototype,Yl=sT,cT=Zz,tO=ta.TypeError,dT=ta.document,uT=ta.process,lT=Z0.f,eY=lT,tY=!!(dT&&dT.createEvent&&ta.dispatchEvent),nO="unhandledrejection",rO=function(e){var t;return!(!Kz(e)||!iT(t=e.then))&&t},iO=function(e,t){var n,r,o,c=t.value,d=t.state===1,l=d?e.ok:e.fail,h=e.resolve,f=e.reject,m=e.domain;try{l?(d||(t.rejection===2&&rY(t),t.rejection=1),l===!0?n=c:(m&&m.enter(),n=l(c),m&&(m.exit(),o=!0)),n===e.promise?f(new tO("Promise-chain cycle")):(r=rO(n))?zl(r,n,h,f):h(n)):f(c)}catch(E){m&&!o&&m.exit(),f(E)}},oO=function(e,t){e.notified||(e.notified=!0,oT(function(){for(var n,r=e.reactions;n=r.get();)iO(n,e);e.notified=!1,t&&!e.rejection&&nY(e)}))},sO=function(e,t,n){var r,o;tY?((r=dT.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),ta.dispatchEvent(r)):r={promise:t,reason:n},!Jz&&(o=ta["on"+e])?o(r):e===nO&&Yz("Unhandled promise rejection",n)},nY=function(e){zl(X0,ta,function(){var t,n=e.facade,r=e.value;if(aO(e)&&(t=$z(function(){Xf?uT.emit("unhandledRejection",r,n):sO(nO,n,r)}),e.rejection=Xf||aO(e)?2:1,t.error))throw t.value})},aO=function(e){return e.rejection!==1&&!e.parent},rY=function(e){zl(X0,ta,function(){var t=e.facade;Xf?uT.emit("rejectionHandled",t):sO("rejectionhandled",t,e.value)})},yd=function(e,t,n){return function(r){e(t,r,n)}},Td=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,oO(e,!0))},hT=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new tO("Promise can't be resolved itself");var r=rO(t);r?oT(function(){var o={done:!1};try{zl(r,t,yd(hT,o,e),yd(Td,o,e))}catch(c){Td(o,c,e)}}):(e.value=t,e.state=1,oO(e,!1))}catch(o){Td({done:!1},o,e)}}};eO&&(cT=(Yl=function(e){qz(this,cT),Wz(e),zl(rT,this);var t=aT(this);try{e(yd(hT,t),yd(Td,t))}catch(n){Td(t,n)}}).prototype,(rT=function(e){Qz(this,{type:Jf,done:!1,notified:!1,parent:!1,reactions:new Xz,rejection:!1,state:0,value:null})}).prototype=Bz(cT,"then",function(e,t){var n=aT(this),r=lT(zz(this,Yl));return n.parent=!0,r.ok=!iT(e)||e,r.fail=iT(t)&&t,r.domain=Xf?uT.domain:void 0,n.state===0?n.reactions.add(r):oT(function(){iO(r,n)}),r.promise}),$0=function(){var e=new rT,t=aT(e);this.promise=e,this.resolve=yd(hT,t),this.reject=yd(Td,t)},Z0.f=lT=function(e){return e===Yl||e===void 0?new $0(e):eY(e)}),jz({global:!0,constructor:!0,wrap:!0,forced:eO},{Promise:Yl}),Hz(Yl,Jf,!1,!0),Gz(Jf);var cO=en("iterator"),dO=!1;try{var iY=0,uO={next:function(){return{done:!!iY++}},return:function(){dO=!0}};uO[cO]=function(){return this},Array.from(uO,function(){throw 2})}catch{}var oY=Qa,sY=function(e,t){try{if(!t&&!dO)return!1}catch{return!1}var n=!1;try{var r={};r[cO]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},Qf=ql.CONSTRUCTOR||!sY(function(e){oY.all(e).then(void 0,function(){})}),aY=Pn,cY=Hr,dY=Bo,uY=vd,lY=jl;Je({target:"Promise",stat:!0,forced:Qf},{all:function(e){var t=this,n=dY.f(t),r=n.resolve,o=n.reject,c=uY(function(){var d=cY(t.resolve),l=[],h=0,f=1;lY(e,function(m){var E=h++,_=!1;f++,aY(d,t,m).then(function(v){_||(_=!0,l[E]=v,--f||r(l))},o)}),--f||r(l)});return c.error&&o(c.value),n.promise}});var hY=Je,pY=ql.CONSTRUCTOR;Qa&&Qa.prototype,hY({target:"Promise",proto:!0,forced:pY,real:!0},{catch:function(e){return this.then(void 0,e)}});var fY=Pn,mY=Hr,gY=Bo,EY=vd,_Y=jl;Je({target:"Promise",stat:!0,forced:Qf},{race:function(e){var t=this,n=gY.f(t),r=n.reject,o=EY(function(){var c=mY(t.resolve);_Y(e,function(d){fY(c,t,d).then(n.resolve,r)})});return o.error&&r(o.value),n.promise}});var vY=Bo;Je({target:"Promise",stat:!0,forced:ql.CONSTRUCTOR},{reject:function(e){var t=vY.f(this);return(0,t.reject)(e),t.promise}});var yY=Pr,TY=Sr,SY=Bo,lO=function(e,t){if(yY(e),TY(t)&&t.constructor===e)return t;var n=SY.f(e);return(0,n.resolve)(t),n.promise},CY=Je,IY=Qa,RY=ql.CONSTRUCTOR,wY=lO,bY=hr("Promise"),AY=!RY;CY({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return wY(AY&&this===bY?IY:this,e)}});var DY=Pn,OY=Hr,NY=Bo,PY=vd,MY=jl;Je({target:"Promise",stat:!0,forced:Qf},{allSettled:function(e){var t=this,n=NY.f(t),r=n.resolve,o=n.reject,c=PY(function(){var d=OY(t.resolve),l=[],h=0,f=1;MY(e,function(m){var E=h++,_=!1;f++,DY(d,t,m).then(function(v){_||(_=!0,l[E]={status:"fulfilled",value:v},--f||r(l))},function(v){_||(_=!0,l[E]={status:"rejected",reason:v},--f||r(l))})}),--f||r(l)});return c.error&&o(c.value),n.promise}});var kY=Pn,LY=Hr,xY=hr,UY=Bo,FY=vd,VY=jl,hO="No one promise resolved";Je({target:"Promise",stat:!0,forced:Qf},{any:function(e){var t=this,n=xY("AggregateError"),r=UY.f(t),o=r.resolve,c=r.reject,d=FY(function(){var l=LY(t.resolve),h=[],f=0,m=1,E=!1;VY(e,function(_){var v=f++,A=!1;m++,kY(l,t,_).then(function(C){A||E||(E=!0,o(C))},function(C){A||E||(A=!0,h[v]=C,--m||c(new n(h,hO)))})}),--m||c(new n(h,hO))});return d.error&&c(d.value),r.promise}});var jY=Je,BY=We,HY=ea,GY=Bo,WY=Hr,pO=vd,pT=Z.Promise,fO=!1;jY({target:"Promise",stat:!0,forced:!pT||!pT.try||pO(function(){pT.try(function(e){fO=e===8},8)}).error||!fO},{try:function(e){var t=arguments.length>1?HY(arguments,1):[],n=GY.f(this),r=pO(function(){return BY(WY(e),void 0,t)});return(r.error?n.reject:n.resolve)(r.value),n.promise}});var KY=Bo;Je({target:"Promise",stat:!0},{withResolvers:function(){var e=KY.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var qY=Je,fT=Qa,zY=u,YY=hr,$Y=Rn,XY=Gy,mO=lO,JY=fT&&fT.prototype;qY({target:"Promise",proto:!0,real:!0,forced:!!fT&&zY(function(){JY.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=XY(this,YY("Promise")),n=$Y(e);return this.then(n?function(r){return mO(t,e()).then(function(){return r})}:e,n?function(r){return mO(t,e()).then(function(){throw r})}:e)}});var mT=L,QY=uy,ZY=Gr,e$=Ka,t$=mT("".charAt),gO=mT("".charCodeAt),n$=mT("".slice),EO=function(e){return function(t,n){var r,o,c=ZY(e$(t)),d=QY(n),l=c.length;return d<0||d>=l?e?"":void 0:(r=gO(c,d))<55296||r>56319||d+1===l||(o=gO(c,d+1))<56320||o>57343?e?t$(c,d):r:e?n$(c,d,d+2):o-56320+(r-55296<<10)+65536}},gT={codeAt:EO(!1),charAt:EO(!0)},r$=gT.charAt,i$=Gr,_O=Xa,o$=p0,vO=Hf,yO="String Iterator",s$=_O.set,a$=_O.getterFor(yO);o$(String,"String",function(e){s$(this,{type:yO,string:i$(e),index:0})},function(){var e,t=a$(this),n=t.string,r=t.index;return r>=n.length?vO(void 0,!0):(e=r$(n,r),t.index+=e.length,vO(e,!1))});var c$=ai.Promise,d$={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},u$=Z,l$=Es,TO=Ya;for(var ET in d$)l$(u$[ET],ET),TO[ET]=TO.Array;var SO=c$,ie=a(SO),h$=ki("Array","values"),p$=gs,f$=Mn,m$=V,g$=h$,_T=Array.prototype,E$={DOMTokenList:!0,NodeList:!0},_$=function(e){var t=e.values;return e===_T||m$(_T,e)&&t===_T.values||f$(E$,p$(e))?g$:t},Wr=a(_$),v$=Je,y$=L,T$=ly,S$=RangeError,CO=String.fromCharCode,IO=String.fromCodePoint,C$=y$([].join);v$({target:"String",stat:!0,arity:1,forced:!!IO&&IO.length!==1},{fromCodePoint:function(e){for(var t,n=[],r=arguments.length,o=0;r>o;){if(t=+arguments[o++],T$(t,1114111)!==t)throw new S$(t+" is not a valid code point");n[o]=t<65536?CO(t):CO(55296+((t-=65536)>>10),t%1024+56320)}return C$(n,"")}});var I$=u,R$=c5,w$=en("iterator"),Zf=!I$(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(o,c){t.delete("b"),r+=c+o}),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&R$||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[w$]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("https://a#\u0431").hash!=="#%D0%B1"||r!=="a1c3"||new URL("https://x",void 0).host!=="x"}),b$=Zs,RO=ea,A$=Math.floor,vT=function(e,t){var n=e.length;if(n<8)for(var r,o,c=1;c<n;){for(o=c,r=e[c];o&&t(e[o-1],r)>0;)e[o]=e[--o];o!==c++&&(e[o]=r)}else for(var d=A$(n/2),l=vT(RO(e,0,d),t),h=vT(RO(e,d),t),f=l.length,m=h.length,E=0,_=0;E<f||_<m;)e[E+_]=E<f&&_<m?t(l[E],h[_])<=0?l[E++]:h[_++]:E<f?l[E++]:h[_++];return e},wO=vT,yT=Je,bO=Z,TT=L0,D$=hr,em=Pn,uo=L,$l=Tr,AO=Zf,DO=Zs,O$=Wf,N$=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:b$(e,r,t[r],n);return e},P$=Es,M$=Uy,ST=Xa,OO=Vy,CT=Rn,k$=Mn,L$=Js,x$=gs,U$=Pr,NO=Sr,Mr=Gr,F$=Vl,PO=$s,MO=by,V$=kf,tm=Hf,Sd=Ja,j$=wO,B$=en("iterator"),Cd="URLSearchParams",kO=Cd+"Iterator",LO=ST.set,Li=ST.getterFor(Cd),H$=ST.getterFor(kO),xO=TT("fetch"),nm=TT("Request"),Xl=TT("Headers"),IT=nm&&nm.prototype,UO=Xl&&Xl.prototype,G$=bO.TypeError,W$=bO.encodeURIComponent,K$=String.fromCharCode,q$=D$("String","fromCodePoint"),z$=parseInt,rm=uo("".charAt),FO=uo([].join),na=uo([].push),VO=uo("".replace),Y$=uo([].shift),jO=uo([].splice),BO=uo("".split),HO=uo("".slice),$$=uo(/./.exec),X$=/\+/g,J$=/^[0-9a-f]+$/i,GO=function(e,t){var n=HO(e,t,t+2);return $$(J$,n)?z$(n,16):NaN},Q$=function(e){for(var t=0,n=128;n>0&&e&n;n>>=1)t++;return t},Z$=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},WO=function(e){for(var t=(e=VO(e,X$," ")).length,n="",r=0;r<t;){var o=rm(e,r);if(o==="%"){if(rm(e,r+1)==="%"||r+3>t){n+="%",r++;continue}var c=GO(e,r+1);if(c!=c){n+=o,r++;continue}r+=2;var d=Q$(c);if(d===0)o=K$(c);else{if(d===1||d>4){n+="\uFFFD",r++;continue}for(var l=[c],h=1;h<d&&!(++r+3>t||rm(e,r)!=="%");){var f=GO(e,r+1);if(f!=f){r+=3;break}if(f>191||f<128)break;na(l,f),r+=2,h++}if(l.length!==d){n+="\uFFFD";continue}var m=Z$(l);m===null?n+="\uFFFD":o=q$(m)}}n+=o,r++}return n},e9=/[!'()~]|%20/g,t9={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},n9=function(e){return t9[e]},KO=function(e){return VO(W$(e),e9,n9)},RT=M$(function(e,t){LO(this,{type:kO,target:Li(e).entries,index:0,kind:t})},Cd,function(){var e=H$(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,tm(void 0,!0);var r=t[n];switch(e.kind){case"keys":return tm(r.key,!1);case"values":return tm(r.value,!1)}return tm([r.key,r.value],!1)},!0),qO=function(e){this.entries=[],this.url=null,e!==void 0&&(NO(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?rm(e,0)==="?"?HO(e,1):e:Mr(e)))};qO.prototype={type:Cd,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,o,c,d,l,h=this.entries,f=V$(e);if(f)for(n=(t=MO(e,f)).next;!(r=em(n,t)).done;){if(c=(o=MO(U$(r.value))).next,(d=em(c,o)).done||(l=em(c,o)).done||!em(c,o).done)throw new G$("Expected sequence with length 2");na(h,{key:Mr(d.value),value:Mr(l.value)})}else for(var m in e)k$(e,m)&&na(h,{key:m,value:Mr(e[m])})},parseQuery:function(e){if(e)for(var t,n,r=this.entries,o=BO(e,"&"),c=0;c<o.length;)(t=o[c++]).length&&(n=BO(t,"="),na(r,{key:WO(Y$(n)),value:WO(FO(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],na(n,KO(e.key)+"="+KO(e.value));return FO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var im=function(){OO(this,Id);var e=LO(this,new qO(arguments.length>0?arguments[0]:void 0));$l||(this.size=e.entries.length)},Id=im.prototype;if(N$(Id,{append:function(e,t){var n=Li(this);Sd(arguments.length,2),na(n.entries,{key:Mr(e),value:Mr(t)}),$l||this.length++,n.updateURL()},delete:function(e){for(var t=Li(this),n=Sd(arguments.length,1),r=t.entries,o=Mr(e),c=n<2?void 0:arguments[1],d=c===void 0?c:Mr(c),l=0;l<r.length;){var h=r[l];if(h.key!==o||d!==void 0&&h.value!==d)l++;else if(jO(r,l,1),d!==void 0)break}$l||(this.size=r.length),t.updateURL()},get:function(e){var t=Li(this).entries;Sd(arguments.length,1);for(var n=Mr(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=Li(this).entries;Sd(arguments.length,1);for(var n=Mr(e),r=[],o=0;o<t.length;o++)t[o].key===n&&na(r,t[o].value);return r},has:function(e){for(var t=Li(this).entries,n=Sd(arguments.length,1),r=Mr(e),o=n<2?void 0:arguments[1],c=o===void 0?o:Mr(o),d=0;d<t.length;){var l=t[d++];if(l.key===r&&(c===void 0||l.value===c))return!0}return!1},set:function(e,t){var n=Li(this);Sd(arguments.length,1);for(var r,o=n.entries,c=!1,d=Mr(e),l=Mr(t),h=0;h<o.length;h++)(r=o[h]).key===d&&(c?jO(o,h--,1):(c=!0,r.value=l));c||na(o,{key:d,value:l}),$l||(this.size=o.length),n.updateURL()},sort:function(){var e=Li(this);j$(e.entries,function(t,n){return t.key>n.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=Li(this).entries,r=L$(e,arguments.length>1?arguments[1]:void 0),o=0;o<n.length;)r((t=n[o++]).value,t.key,this)},keys:function(){return new RT(this,"keys")},values:function(){return new RT(this,"values")},entries:function(){return new RT(this,"entries")}},{enumerable:!0}),DO(Id,B$,Id.entries,{name:"entries"}),DO(Id,"toString",function(){return Li(this).serialize()},{enumerable:!0}),$l&&O$(Id,"size",{get:function(){return Li(this).entries.length},configurable:!0,enumerable:!0}),P$(im,Cd),yT({global:!0,constructor:!0,forced:!AO},{URLSearchParams:im}),!AO&&CT(Xl)){var r9=uo(UO.has),i9=uo(UO.set),zO=function(e){if(NO(e)){var t,n=e.body;if(x$(n)===Cd)return t=e.headers?new Xl(e.headers):new Xl,r9(t,"content-type")||i9(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),F$(e,{body:PO(0,Mr(n)),headers:PO(0,t)})}return e};if(CT(xO)&&yT({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return xO(e,arguments.length>1?zO(arguments[1]):{})}}),CT(nm)){var wT=function(e){return OO(this,IT),new nm(e,arguments.length>1?zO(arguments[1]):{})};IT.constructor=wT,wT.prototype=IT,yT({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:wT})}}var xi,o9={URLSearchParams:im,getState:Li},s9=ai.URLSearchParams,YO=Tr,a9=L,c9=Pn,d9=u,bT=Nf,u9=Fl,l9=vf,h9=Vo,p9=Tf,Rd=Object.assign,$O=Object.defineProperty,f9=a9([].concat),m9=!Rd||d9(function(){if(YO&&Rd({b:1},Rd($O({},"a",{enumerable:!0,get:function(){$O(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(o){t[o]=o}),Rd({},e)[n]!==7||bT(Rd({},t)).join("")!==r})?function(e,t){for(var n=h9(e),r=arguments.length,o=1,c=u9.f,d=l9.f;r>o;)for(var l,h=p9(arguments[o++]),f=c?f9(bT(h),c(h)):bT(h),m=f.length,E=0;m>E;)l=f[E++],YO&&!c9(d,h,l)||(n[l]=h[l]);return n}:Rd,g9=Pr,E9=zD,_9=Tr,v9=Mi,y9=$s,AT=function(e,t,n){_9?v9.f(e,t,y9(0,n)):e[t]=n},T9=Js,S9=Pn,C9=Vo,I9=function(e,t,n,r){try{return r?t(g9(n)[0],n[1]):t(n)}catch(o){E9(e,"throw",o)}},R9=WD,w9=Kf,b9=Qs,XO=AT,A9=by,D9=kf,JO=Array,Za=L,DT=2147483647,O9=/[^\0-\u007E]/,QO=/[.\u3002\uFF0E\uFF61]/g,ZO="Overflow: input needs wider integers to process",eN=RangeError,N9=Za(QO.exec),wd=Math.floor,OT=String.fromCharCode,tN=Za("".charCodeAt),nN=Za([].join),ra=Za([].push),P9=Za("".replace),M9=Za("".split),k9=Za("".toLowerCase),rN=function(e){return e+22+75*(e<26)},L9=function(e,t,n){var r=0;for(e=n?wd(e/700):e>>1,e+=wd(e/t);e>455;)e=wd(e/35),r+=36;return wd(r+36*e/(e+38))},x9=function(e){var t=[];e=function(O){for(var N=[],x=0,B=O.length;x<B;){var j=tN(O,x++);if(j>=55296&&j<=56319&&x<B){var F=tN(O,x++);(64512&F)==56320?ra(N,((1023&j)<<10)+(1023&F)+65536):(ra(N,j),x--)}else ra(N,j)}return N}(e);var n,r,o=e.length,c=128,d=0,l=72;for(n=0;n<e.length;n++)(r=e[n])<128&&ra(t,OT(r));var h=t.length,f=h;for(h&&ra(t,"-");f<o;){var m=DT;for(n=0;n<e.length;n++)(r=e[n])>=c&&r<m&&(m=r);var E=f+1;if(m-c>wd((DT-d)/E))throw new eN(ZO);for(d+=(m-c)*E,c=m,n=0;n<e.length;n++){if((r=e[n])<c&&++d>DT)throw new eN(ZO);if(r===c){for(var _=d,v=36;;){var A=v<=l?1:v>=l+26?26:v-l;if(_<A)break;var C=_-A,I=36-A;ra(t,OT(rN(A+C%I))),_=wd(C/I),v+=36}ra(t,OT(rN(_))),l=L9(d,E,f===h),d=0,f++}}d++,c++}return nN(t,"")},U9=Je,NT=Tr,F9=Zf,PT=Z,iN=Js,Ui=L,om=Zs,Fi=Wf,V9=Vy,MT=Mn,kT=m9,bd=function(e){var t=C9(e),n=w9(this),r=arguments.length,o=r>1?arguments[1]:void 0,c=o!==void 0;c&&(o=T9(o,r>2?arguments[2]:void 0));var d,l,h,f,m,E,_=D9(t),v=0;if(!_||this===JO&&R9(_))for(d=b9(t),l=n?new this(d):JO(d);d>v;v++)E=c?o(t[v],v):t[v],XO(l,v,E);else for(l=n?new this:[],m=(f=A9(t,_)).next;!(h=S9(m,f)).done;v++)E=c?I9(f,o,[h.value,v],!0):h.value,XO(l,v,E);return l.length=v,l},lo=ea,j9=gT.codeAt,B9=function(e){var t,n,r=[],o=M9(P9(k9(e),QO,"."),".");for(t=0;t<o.length;t++)n=o[t],ra(r,N9(O9,n)?"xn--"+x9(n):n);return nN(r,".")},_s=Gr,H9=Es,G9=Ja,oN=o9,sN=Xa,W9=sN.set,sm=sN.getterFor("URL"),K9=oN.URLSearchParams,q9=oN.getState,Jl=PT.URL,LT=PT.TypeError,am=PT.parseInt,z9=Math.floor,aN=Math.pow,Vi=Ui("".charAt),ho=Ui(/./.exec),Ql=Ui([].join),Y9=Ui(1 .toString),$9=Ui([].pop),Ad=Ui([].push),xT=Ui("".replace),X9=Ui([].shift),J9=Ui("".split),Zl=Ui("".slice),cm=Ui("".toLowerCase),Q9=Ui([].unshift),UT="Invalid scheme",ec="Invalid host",cN="Invalid port",dN=/[a-z]/i,Z9=/[\d+-.a-z]/i,FT=/\d/,e7=/^0x/i,t7=/^[0-7]+$/,n7=/^\d+$/,uN=/^[\da-f]+$/i,r7=/[\0\t\n\r #%/:<>?@[\\\]^|]/,i7=/[\0\t\n\r #/:<>?@[\\\]^|]/,o7=/^[\u0000-\u0020]+/,s7=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,a7=/[\t\n\r]/g,eh=function(e){var t,n,r,o;if(typeof e=="number"){for(t=[],n=0;n<4;n++)Q9(t,e%256),e=z9(e/256);return Ql(t,".")}if(typeof e=="object"){for(t="",r=function(c){for(var d=null,l=1,h=null,f=0,m=0;m<8;m++)c[m]!==0?(f>l&&(d=h,l=f),h=null,f=0):(h===null&&(h=m),++f);return f>l?h:d}(e),n=0;n<8;n++)o&&e[n]===0||(o&&(o=!1),r===n?(t+=n?":":"::",o=!0):(t+=Y9(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},dm={},lN=kT({},dm,{" ":1,'"':1,"<":1,">":1,"`":1}),hN=kT({},lN,{"#":1,"?":1,"{":1,"}":1}),VT=kT({},hN,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ia=function(e,t){var n=j9(e,0);return n>32&&n<127&&!MT(t,e)?e:encodeURIComponent(e)},um={ftp:21,file:null,http:80,https:443,ws:80,wss:443},th=function(e,t){var n;return e.length===2&&ho(dN,Vi(e,0))&&((n=Vi(e,1))===":"||!t&&n==="|")},pN=function(e){var t;return e.length>1&&th(Zl(e,0,2))&&(e.length===2||(t=Vi(e,2))==="/"||t==="\\"||t==="?"||t==="#")},c7=function(e){return e==="."||cm(e)==="%2e"},jT={},fN={},BT={},mN={},gN={},HT={},EN={},_N={},lm={},hm={},GT={},WT={},KT={},qT={},vN={},zT={},Dd={},Ho={},yN={},tc={},vs={},YT=function(e,t,n){var r,o,c,d=_s(e);if(t){if(o=this.parse(d))throw new LT(o);this.searchParams=null}else{if(n!==void 0&&(r=new YT(n,!0)),o=this.parse(d,null,r))throw new LT(o);(c=q9(new K9)).bindURL(this),this.searchParams=c}};YT.prototype={type:"URL",parse:function(e,t,n){var r,o,c,d,l,h=this,f=t||jT,m=0,E="",_=!1,v=!1,A=!1;for(e=_s(e),t||(h.scheme="",h.username="",h.password="",h.host=null,h.port=null,h.path=[],h.query=null,h.fragment=null,h.cannotBeABaseURL=!1,e=xT(e,o7,""),e=xT(e,s7,"$1")),e=xT(e,a7,""),r=bd(e);m<=r.length;){switch(o=r[m],f){case jT:if(!o||!ho(dN,o)){if(t)return UT;f=BT;continue}E+=cm(o),f=fN;break;case fN:if(o&&(ho(Z9,o)||o==="+"||o==="-"||o==="."))E+=cm(o);else{if(o!==":"){if(t)return UT;E="",f=BT,m=0;continue}if(t&&(h.isSpecial()!==MT(um,E)||E==="file"&&(h.includesCredentials()||h.port!==null)||h.scheme==="file"&&!h.host))return;if(h.scheme=E,t)return void(h.isSpecial()&&um[h.scheme]===h.port&&(h.port=null));E="",h.scheme==="file"?f=qT:h.isSpecial()&&n&&n.scheme===h.scheme?f=mN:h.isSpecial()?f=_N:r[m+1]==="/"?(f=gN,m++):(h.cannotBeABaseURL=!0,Ad(h.path,""),f=yN)}break;case BT:if(!n||n.cannotBeABaseURL&&o!=="#")return UT;if(n.cannotBeABaseURL&&o==="#"){h.scheme=n.scheme,h.path=lo(n.path),h.query=n.query,h.fragment="",h.cannotBeABaseURL=!0,f=vs;break}f=n.scheme==="file"?qT:HT;continue;case mN:if(o!=="/"||r[m+1]!=="/"){f=HT;continue}f=lm,m++;break;case gN:if(o==="/"){f=hm;break}f=Ho;continue;case HT:if(h.scheme=n.scheme,o===xi)h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=lo(n.path),h.query=n.query;else if(o==="/"||o==="\\"&&h.isSpecial())f=EN;else if(o==="?")h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=lo(n.path),h.query="",f=tc;else{if(o!=="#"){h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=lo(n.path),h.path.length--,f=Ho;continue}h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,h.path=lo(n.path),h.query=n.query,h.fragment="",f=vs}break;case EN:if(!h.isSpecial()||o!=="/"&&o!=="\\"){if(o!=="/"){h.username=n.username,h.password=n.password,h.host=n.host,h.port=n.port,f=Ho;continue}f=hm}else f=lm;break;case _N:if(f=lm,o!=="/"||Vi(E,m+1)!=="/")continue;m++;break;case lm:if(o!=="/"&&o!=="\\"){f=hm;continue}break;case hm:if(o==="@"){_&&(E="%40"+E),_=!0,c=bd(E);for(var C=0;C<c.length;C++){var I=c[C];if(I!==":"||A){var O=ia(I,VT);A?h.password+=O:h.username+=O}else A=!0}E=""}else if(o===xi||o==="/"||o==="?"||o==="#"||o==="\\"&&h.isSpecial()){if(_&&E==="")return"Invalid authority";m-=bd(E).length+1,E="",f=GT}else E+=o;break;case GT:case WT:if(t&&h.scheme==="file"){f=zT;continue}if(o!==":"||v){if(o===xi||o==="/"||o==="?"||o==="#"||o==="\\"&&h.isSpecial()){if(h.isSpecial()&&E==="")return ec;if(t&&E===""&&(h.includesCredentials()||h.port!==null))return;if(d=h.parseHost(E))return d;if(E="",f=Dd,t)return;continue}o==="["?v=!0:o==="]"&&(v=!1),E+=o}else{if(E==="")return ec;if(d=h.parseHost(E))return d;if(E="",f=KT,t===WT)return}break;case KT:if(!ho(FT,o)){if(o===xi||o==="/"||o==="?"||o==="#"||o==="\\"&&h.isSpecial()||t){if(E!==""){var N=am(E,10);if(N>65535)return cN;h.port=h.isSpecial()&&N===um[h.scheme]?null:N,E=""}if(t)return;f=Dd;continue}return cN}E+=o;break;case qT:if(h.scheme="file",o==="/"||o==="\\")f=vN;else{if(!n||n.scheme!=="file"){f=Ho;continue}switch(o){case xi:h.host=n.host,h.path=lo(n.path),h.query=n.query;break;case"?":h.host=n.host,h.path=lo(n.path),h.query="",f=tc;break;case"#":h.host=n.host,h.path=lo(n.path),h.query=n.query,h.fragment="",f=vs;break;default:pN(Ql(lo(r,m),""))||(h.host=n.host,h.path=lo(n.path),h.shortenPath()),f=Ho;continue}}break;case vN:if(o==="/"||o==="\\"){f=zT;break}n&&n.scheme==="file"&&!pN(Ql(lo(r,m),""))&&(th(n.path[0],!0)?Ad(h.path,n.path[0]):h.host=n.host),f=Ho;continue;case zT:if(o===xi||o==="/"||o==="\\"||o==="?"||o==="#"){if(!t&&th(E))f=Ho;else if(E===""){if(h.host="",t)return;f=Dd}else{if(d=h.parseHost(E))return d;if(h.host==="localhost"&&(h.host=""),t)return;E="",f=Dd}continue}E+=o;break;case Dd:if(h.isSpecial()){if(f=Ho,o!=="/"&&o!=="\\")continue}else if(t||o!=="?")if(t||o!=="#"){if(o!==xi&&(f=Ho,o!=="/"))continue}else h.fragment="",f=vs;else h.query="",f=tc;break;case Ho:if(o===xi||o==="/"||o==="\\"&&h.isSpecial()||!t&&(o==="?"||o==="#")){if((l=cm(l=E))===".."||l==="%2e."||l===".%2e"||l==="%2e%2e"?(h.shortenPath(),o==="/"||o==="\\"&&h.isSpecial()||Ad(h.path,"")):c7(E)?o==="/"||o==="\\"&&h.isSpecial()||Ad(h.path,""):(h.scheme==="file"&&!h.path.length&&th(E)&&(h.host&&(h.host=""),E=Vi(E,0)+":"),Ad(h.path,E)),E="",h.scheme==="file"&&(o===xi||o==="?"||o==="#"))for(;h.path.length>1&&h.path[0]==="";)X9(h.path);o==="?"?(h.query="",f=tc):o==="#"&&(h.fragment="",f=vs)}else E+=ia(o,hN);break;case yN:o==="?"?(h.query="",f=tc):o==="#"?(h.fragment="",f=vs):o!==xi&&(h.path[0]+=ia(o,dm));break;case tc:t||o!=="#"?o!==xi&&(o==="'"&&h.isSpecial()?h.query+="%27":h.query+=o==="#"?"%23":ia(o,dm)):(h.fragment="",f=vs);break;case vs:o!==xi&&(h.fragment+=ia(o,lN))}m++}},parseHost:function(e){var t,n,r;if(Vi(e,0)==="["){if(Vi(e,e.length-1)!=="]"||(t=function(o){var c,d,l,h,f,m,E,_=[0,0,0,0,0,0,0,0],v=0,A=null,C=0,I=function(){return Vi(o,C)};if(I()===":"){if(Vi(o,1)!==":")return;C+=2,A=++v}for(;I();){if(v===8)return;if(I()!==":"){for(c=d=0;d<4&&ho(uN,I());)c=16*c+am(I(),16),C++,d++;if(I()==="."){if(d===0||(C-=d,v>6))return;for(l=0;I();){if(h=null,l>0){if(!(I()==="."&&l<4))return;C++}if(!ho(FT,I()))return;for(;ho(FT,I());){if(f=am(I(),10),h===null)h=f;else{if(h===0)return;h=10*h+f}if(h>255)return;C++}_[v]=256*_[v]+h,++l!=2&&l!==4||v++}if(l!==4)return;break}if(I()===":"){if(C++,!I())return}else if(I())return;_[v++]=c}else{if(A!==null)return;C++,A=++v}}if(A!==null)for(m=v-A,v=7;v!==0&&m>0;)E=_[v],_[v--]=_[A+m-1],_[A+--m]=E;else if(v!==8)return;return _}(Zl(e,1,-1)),!t))return ec;this.host=t}else if(this.isSpecial()){if(e=B9(e),ho(r7,e)||(t=function(o){var c,d,l,h,f,m,E,_=J9(o,".");if(_.length&&_[_.length-1]===""&&_.length--,(c=_.length)>4)return o;for(d=[],l=0;l<c;l++){if((h=_[l])==="")return o;if(f=10,h.length>1&&Vi(h,0)==="0"&&(f=ho(e7,h)?16:8,h=Zl(h,f===8?1:2)),h==="")m=0;else{if(!ho(f===10?n7:f===8?t7:uN,h))return o;m=am(h,f)}Ad(d,m)}for(l=0;l<c;l++)if(m=d[l],l===c-1){if(m>=aN(256,5-c))return null}else if(m>255)return null;for(E=$9(d),l=0;l<d.length;l++)E+=d[l]*aN(256,3-l);return E}(e),t===null))return ec;this.host=t}else{if(ho(i7,e))return ec;for(t="",n=bd(e),r=0;r<n.length;r++)t+=ia(n[r],dm);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return MT(um,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&th(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,o=e.host,c=e.port,d=e.path,l=e.query,h=e.fragment,f=t+":";return o!==null?(f+="//",e.includesCredentials()&&(f+=n+(r?":"+r:"")+"@"),f+=eh(o),c!==null&&(f+=":"+c)):t==="file"&&(f+="//"),f+=e.cannotBeABaseURL?d[0]:d.length?"/"+Ql(d,"/"):"",l!==null&&(f+="?"+l),h!==null&&(f+="#"+h),f},setHref:function(e){var t=this.parse(e);if(t)throw new LT(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Od(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+eh(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(_s(e)+":",jT)},getUsername:function(){return this.username},setUsername:function(e){var t=bd(_s(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=ia(t[n],VT)}},getPassword:function(){return this.password},setPassword:function(e){var t=bd(_s(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=ia(t[n],VT)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?eh(e):eh(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,GT)},getHostname:function(){var e=this.host;return e===null?"":eh(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,WT)},getPort:function(){var e=this.port;return e===null?"":_s(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=_s(e))===""?this.port=null:this.parse(e,KT))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Ql(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Dd))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=_s(e))===""?this.query=null:(Vi(e,0)==="?"&&(e=Zl(e,1)),this.query="",this.parse(e,tc)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=_s(e))!==""?(Vi(e,0)==="#"&&(e=Zl(e,1)),this.fragment="",this.parse(e,vs)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Od=function(e){var t=V9(this,kr),n=G9(arguments.length,1)>1?arguments[1]:void 0,r=W9(t,new YT(e,!1,n));NT||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},kr=Od.prototype,ji=function(e,t){return{get:function(){return sm(this)[e]()},set:t&&function(n){return sm(this)[t](n)},configurable:!0,enumerable:!0}};if(NT&&(Fi(kr,"href",ji("serialize","setHref")),Fi(kr,"origin",ji("getOrigin")),Fi(kr,"protocol",ji("getProtocol","setProtocol")),Fi(kr,"username",ji("getUsername","setUsername")),Fi(kr,"password",ji("getPassword","setPassword")),Fi(kr,"host",ji("getHost","setHost")),Fi(kr,"hostname",ji("getHostname","setHostname")),Fi(kr,"port",ji("getPort","setPort")),Fi(kr,"pathname",ji("getPathname","setPathname")),Fi(kr,"search",ji("getSearch","setSearch")),Fi(kr,"searchParams",ji("getSearchParams")),Fi(kr,"hash",ji("getHash","setHash"))),om(kr,"toJSON",function(){return sm(this).serialize()},{enumerable:!0}),om(kr,"toString",function(){return sm(this).serialize()},{enumerable:!0}),Jl){var TN=Jl.createObjectURL,SN=Jl.revokeObjectURL;TN&&om(Od,"createObjectURL",iN(TN,Jl)),SN&&om(Od,"revokeObjectURL",iN(SN,Jl))}H9(Od,"URL"),U9({global:!0,constructor:!0,forced:!F9,sham:!NT},{URL:Od});var d7=Je,CN=u,u7=Ja,IN=Gr,l7=Zf,$T=hr("URL"),h7=l7&&CN(function(){$T.canParse()}),p7=CN(function(){return $T.canParse.length!==1});d7({target:"URL",stat:!0,forced:!h7||p7},{canParse:function(e){var t=u7(arguments.length,1),n=IN(e),r=t<2||arguments[1]===void 0?void 0:IN(arguments[1]);try{return!!new $T(n,r)}catch{return!1}}});var f7=Je,m7=Ja,RN=Gr,g7=Zf,E7=hr("URL");f7({target:"URL",stat:!0,forced:!g7},{parse:function(e){var t=m7(arguments.length,1),n=RN(e),r=t<2||arguments[1]===void 0?void 0:RN(arguments[1]);try{return new E7(n,r)}catch{return null}}});var pm=a(ai.URL);let wN=!0,bN=!0;function fm(e,t,n){let r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function nc(e,t,n){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(d,l){if(d!==t)return o.apply(this,arguments);let h=f=>{let m=n(f);m&&(l.handleEvent?l.handleEvent(m):l(m))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(l,h),o.apply(this,[d,h])};let c=r.removeEventListener;r.removeEventListener=function(d,l){if(d!==t||!this._eventMap||!this._eventMap[t])return c.apply(this,arguments);if(!this._eventMap[t].has(l))return c.apply(this,arguments);let h=this._eventMap[t].get(l);return this._eventMap[t].delete(l),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,c.apply(this,[d,h])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(d){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),d&&this.addEventListener(t,this["_on"+t]=d)},enumerable:!0,configurable:!0})}function _7(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(wN=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function v7(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(bN=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function AN(){if(typeof window=="object"){if(wN)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function XT(e,t){bN&&console.warn(e+" is deprecated, please use "+t+" instead.")}function DN(e){return Object.prototype.toString.call(e)==="[object Object]"}function ON(e){var t;return DN(e)?co(t=Object.keys(e)).call(t,function(n,r){let o=DN(e[r]),c=o?ON(e[r]):e[r],d=o&&!Object.keys(c).length;return c===void 0||d?n:Object.assign(n,{[r]:c})},{}):e}function JT(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?JT(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(o=>{JT(e,e.get(o),n)})}))}function NN(e,t,n){let r=n?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;let c=[];return e.forEach(d=>{d.type==="track"&&d.trackIdentifier===t.id&&c.push(d)}),c.forEach(d=>{e.forEach(l=>{l.type===r&&l.trackId===d.id&&JT(e,l,o)})}),o}let PN=AN;function MN(e,t){let n=e&&e.navigator;if(!n.mediaDevices)return;let r=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;let l={};return Object.keys(d).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;let f=typeof d[h]=="object"?d[h]:{ideal:d[h]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);let m=function(E,_){return E?E+_.charAt(0).toUpperCase()+_.slice(1):_==="deviceId"?"sourceId":_};if(f.ideal!==void 0){l.optional=l.optional||[];let E={};typeof f.ideal=="number"?(E[m("min",h)]=f.ideal,l.optional.push(E),E={},E[m("max",h)]=f.ideal,l.optional.push(E)):(E[m("",h)]=f.ideal,l.optional.push(E))}f.exact!==void 0&&typeof f.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[m("",h)]=f.exact):["min","max"].forEach(E=>{f[E]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[m(E,h)]=f[E])})}),d.advanced&&(l.optional=(l.optional||[]).concat(d.advanced)),l},o=function(d,l){if(t.version>=61)return l(d);if((d=JSON.parse(JSON.stringify(d)))&&typeof d.audio=="object"){let h=function(f,m,E){m in f&&!(E in f)&&(f[E]=f[m],delete f[m])};h((d=JSON.parse(JSON.stringify(d))).audio,"autoGainControl","googAutoGainControl"),h(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=r(d.audio)}if(d&&typeof d.video=="object"){let h=d.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});let f=t.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||f)){let m;if(delete d.video.facingMode,h.exact==="environment"||h.ideal==="environment"?m=["back","rear"]:h.exact!=="user"&&h.ideal!=="user"||(m=["front"]),m)return n.mediaDevices.enumerateDevices().then(E=>{let _=(E=E.filter(v=>v.kind==="videoinput")).find(v=>m.some(A=>{var C;return ne(C=v.label.toLowerCase()).call(C,A)}));return!_&&E.length&&ne(m).call(m,"back")&&(_=E[E.length-1]),_&&(d.video.deviceId=h.exact?{exact:_.deviceId}:{ideal:_.deviceId}),d.video=r(d.video),PN("chrome: "+JSON.stringify(d)),l(d)})}d.video=r(d.video)}return PN("chrome: "+JSON.stringify(d)),l(d)},c=function(d){return t.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(d,l,h){o(d,f=>{n.webkitGetUserMedia(f,l,m=>{h&&h(c(m))})})}.bind(n),n.mediaDevices.getUserMedia){let d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return o(l,h=>d(h).then(f=>{if(h.audio&&!f.getAudioTracks().length||h.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return f},f=>ie.reject(c(f))))}}}function kN(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function LN(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===r.track.id):{track:r.track};let c=new Event("track");c.track=r.track,c.receiver=o,c.transceiver={receiver:o},c.streams=[n.stream],this.dispatchEvent(c)}),n.stream.getTracks().forEach(r=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===r.id):{track:r};let c=new Event("track");c.track=r,c.receiver=o,c.transceiver={receiver:o},c.streams=[n.stream],this.dispatchEvent(c)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else nc(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function xN(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(o,c){return{track:c,get dtmf(){return this._dtmf===void 0&&(c.kind==="audio"?this._dtmf=o.createDTMFSender(c):this._dtmf=null),this._dtmf},_pc:o}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,l){let h=o.apply(this,arguments);return h||(h=t(this,d),this._senders.push(h)),h};let c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){c.apply(this,arguments);let l=this._senders.indexOf(d);l!==-1&&this._senders.splice(l,1)}}let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(c=>{this._senders.push(t(this,c))})};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach(c=>{let d=this._senders.find(l=>l.track===c);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function UN(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[n,r,o]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);let c=function(l){let h={};return l.result().forEach(f=>{let m={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(E=>{m[E]=f.stat(E)}),h[m.id]=m}),h},d=function(l){return new Map(Object.keys(l).map(h=>[h,l[h]]))};if(arguments.length>=2){let l=function(h){r(d(c(h)))};return t.apply(this,[l,n])}return new ie((l,h)=>{t.apply(this,[function(f){l(d(c(f)))},h])}).then(r,o)}}function FN(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){let o=n.apply(this,[]);return o.forEach(c=>c._pc=this),o});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let o=r.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){let o=this;return this._pc.getStats().then(c=>NN(c,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r}),nc(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){let r=this;return this._pc.getStats().then(o=>NN(o,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let n=arguments[0],r,o,c;return this.getSenders().forEach(d=>{d.track===n&&(r?c=!0:r=d)}),this.getReceivers().forEach(d=>(d.track===n&&(o?c=!0:o=d),d.track===n)),c||r&&o?ie.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():ie.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function VN(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(c=>this._shimmedLocalStreams[c][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let l=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(l)===-1&&this._shimmedLocalStreams[d.id].push(l):this._shimmedLocalStreams[d.id]=[d,l],l};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._shimmedLocalStreams=this._shimmedLocalStreams||{},c.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});let d=this.getSenders();n.apply(this,arguments);let l=this.getSenders().filter(h=>d.indexOf(h)===-1);this._shimmedLocalStreams[c.id]=[c].concat(l)};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[c.id],r.apply(this,arguments)};let o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},c&&Object.keys(this._shimmedLocalStreams).forEach(d=>{let l=this._shimmedLocalStreams[d].indexOf(c);l!==-1&&this._shimmedLocalStreams[d].splice(l,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),o.apply(this,arguments)}}function jN(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return VN(e);let n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let h=n.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(f=>this._reverseStreams[f.id])};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(f=>{if(this.getSenders().find(E=>E.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){let f=new e.MediaStream(h.getTracks());this._streams[h.id]=f,this._reverseStreams[f.id]=h,h=f}r.apply(this,[h])};let o=e.RTCPeerConnection.prototype.removeStream;function c(h,f){let m=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(E=>{let _=h._reverseStreams[E],v=h._streams[_.id];m=m.replace(new RegExp(v.id,"g"),_.id)}),new RTCSessionDescription({type:f.type,sdp:m})}e.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},e.RTCPeerConnection.prototype.addTrack=function(h,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(v=>v===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let _=this._streams[f.id];if(_)_.addTrack(h),ie.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let v=new e.MediaStream([h]);this._streams[f.id]=v,this._reverseStreams[v.id]=f,this.addStream(v)}return this.getSenders().find(v=>v.track===h)},["createOffer","createAnswer"].forEach(function(h){let f=e.RTCPeerConnection.prototype[h],m={[h](){let E=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[_=>{let v=c(this,_);E[0].apply(null,[v])},_=>{E[1]&&E[1].apply(null,_)},arguments[2]]):f.apply(this,arguments).then(_=>c(this,_))}};e.RTCPeerConnection.prototype[h]=m[h]});let d=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(h,f){let m=f.sdp;return Object.keys(h._reverseStreams||[]).forEach(E=>{let _=h._reverseStreams[E],v=h._streams[_.id];m=m.replace(new RegExp(_.id,"g"),v.id)}),new RTCSessionDescription({type:f.type,sdp:m})}(this,arguments[0]),d.apply(this,arguments)):d.apply(this,arguments)};let l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let h=l.get.apply(this);return h.type===""?h:c(this,h)}}),e.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(E=>h.track===E)&&(f=this._streams[m])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function QT(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){let r=e.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=o[n]})}function BN(e,t){nc(e,"negotiationneeded",n=>{let r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var HN=Object.freeze({__proto__:null,fixNegotiationNeeded:BN,shimAddTrackRemoveTrack:jN,shimAddTrackRemoveTrackWithNative:VN,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{let o=n.video&&n.video.width,c=n.video&&n.video.height,d=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:d||3}},o&&(n.video.mandatory.maxWidth=o),c&&(n.video.mandatory.maxHeight=c),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:xN,shimGetStats:UN,shimGetUserMedia:MN,shimMediaStream:kN,shimOnTrack:LN,shimPeerConnection:QT,shimSenderReceiverGetStats:FN});function GN(e,t){let n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(o,c,d){XT("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(c,d)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){let o=function(d,l,h){l in d&&!(h in d)&&(d[h]=d[l],delete d[l])},c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(d){return typeof d=="object"&&typeof d.audio=="object"&&(d=JSON.parse(JSON.stringify(d)),o(d.audio,"autoGainControl","mozAutoGainControl"),o(d.audio,"noiseSuppression","mozNoiseSuppression")),c(d)},r&&r.prototype.getSettings){let d=r.prototype.getSettings;r.prototype.getSettings=function(){let l=d.apply(this,arguments);return o(l,"mozAutoGainControl","autoGainControl"),o(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){let d=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),o(l,"autoGainControl","mozAutoGainControl"),o(l,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[l])}}}}function WN(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ZT(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){let c=e.RTCPeerConnection.prototype[o],d={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),c.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=d[o]});let n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[o,c,d]=arguments;return r.apply(this,[o||null]).then(l=>{if(t.version<53&&!c)try{l.forEach(h=>{h.type=n[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;l.forEach((f,m)=>{l.set(m,Object.assign({},f,{type:n[f.type]||f.type}))})}return l}).then(c,d)}}function KN(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ie.resolve(new Map)}}function qN(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),nc(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function zN(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){XT("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&ne(r=t.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function YN(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function $N(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];let r=n.length>0;r&&n.forEach(c=>{if("rid"in c&&!/^[a-z0-9]{0,16}$/i.test(c.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in c&&!(parseFloat(c.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in c&&!(parseFloat(c.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let o=t.apply(this,arguments);if(r){let{sender:c}=o,d=c.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=n,c.sendEncodings=n,this.setParametersPromises.push(c.setParameters(d).then(()=>{delete c.sendEncodings}).catch(()=>{delete c.sendEncodings})))}return o})}function XN(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function JN(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ie.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function QN(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ie.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var ZN=Object.freeze({__proto__:null,shimAddTransceiver:$N,shimCreateAnswer:QN,shimCreateOffer:JN,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){let r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,ie.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:XN,shimGetUserMedia:GN,shimOnTrack:WN,shimPeerConnection:ZT,shimRTCDataChannel:YN,shimReceiverGetStats:qN,shimRemoveStream:zN,shimSenderGetStats:KN});function eP(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),ne(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(o=>t.call(this,o,n)),n.getVideoTracks().forEach(o=>t.call(this,o,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),c=1;c<r;c++)o[c-1]=arguments[c];return o&&o.forEach(d=>{var l;this._localStreams?ne(l=this._localStreams).call(l,d)||this._localStreams.push(d):this._localStreams=[d]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);let r=t.getTracks();this.getSenders().forEach(o=>{ne(r).call(r,o.track)&&this.removeTrack(o)})})}}function tP(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(o=>{var c;if(this._remoteStreams||(this._remoteStreams=[]),ne(c=this._remoteStreams).call(c,o))return;this._remoteStreams.push(o);let d=new Event("addstream");d.stream=o,this.dispatchEvent(d)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);let c=new Event("addstream");c.stream=o,n.dispatchEvent(c)})}),t.apply(n,arguments)}}}function nP(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,c=t.setRemoteDescription,d=t.addIceCandidate;t.createOffer=function(h,f){let m=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[m]);return f?(E.then(h,f),ie.resolve()):E},t.createAnswer=function(h,f){let m=arguments.length>=2?arguments[2]:arguments[0],E=r.apply(this,[m]);return f?(E.then(h,f),ie.resolve()):E};let l=function(h,f,m){let E=o.apply(this,[h]);return m?(E.then(f,m),ie.resolve()):E};t.setLocalDescription=l,l=function(h,f,m){let E=c.apply(this,[h]);return m?(E.then(f,m),ie.resolve()):E},t.setRemoteDescription=l,l=function(h,f,m){let E=d.apply(this,[h]);return m?(E.then(f,m),ie.resolve()):E},t.addIceCandidate=l}function rP(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=o=>r(iP(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(n,r,o){t.mediaDevices.getUserMedia(n).then(r,o)}.bind(t))}function iP(e){return e&&e.video!==void 0?Object.assign({},e,{video:ON(e.video)}):e}function oP(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){let o=[];for(let c=0;c<n.iceServers.length;c++){let d=n.iceServers[c];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(XT("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,o.push(d)):o.push(n.iceServers[c])}n.iceServers=o}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function sP(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function aP(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);let r=this.getTransceivers().find(c=>c.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);let o=this.getTransceivers().find(c=>c.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function cP(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var dP=Object.freeze({__proto__:null,shimAudioContext:cP,shimCallbacksAPI:nP,shimConstraints:iP,shimCreateOfferLegacy:aP,shimGetUserMedia:rP,shimLocalStreamsAPI:eP,shimRTCIceServerUrls:oP,shimRemoteStreamsAPI:tP,shimTrackEventTransceiver:sP}),uP=`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`,y7=Ka,T7=Gr,eS=uP,lP=L("".replace),S7=RegExp("^["+eS+"]+"),C7=RegExp("(^|[^"+eS+"])["+eS+"]+$"),tS=function(e){return function(t){var n=T7(y7(t));return 1&e&&(n=lP(n,S7,"")),2&e&&(n=lP(n,C7,"$1")),n}},I7={start:tS(1),end:tS(2),trim:tS(3)},R7=i0.PROPER,w7=u,hP=uP,b7=I7.trim;Je({target:"String",proto:!0,forced:function(e){return w7(function(){return!!hP[e]()||"\u200B\x85\u180E"[e]()!=="\u200B\x85\u180E"||R7&&hP[e].name!==e})}("trim")},{trim:function(){return b7(this)}});var A7=ki("String","trim"),D7=V,O7=A7,nS=String.prototype,N7=function(e){var t=e.trim;return typeof e=="string"||e===nS||D7(nS,e)&&t===nS.trim?O7:t},Hn=a(N7),pP={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},t.splitSections=function(n){return n.split(`
m=`).map((r,o)=>(o>0?"m="+r:r).trim()+`\r
`)},t.getDescription=function(n){let r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){let r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(o=>o.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");let o={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let c=8;c<r.length;c+=2)switch(r[c]){case"raddr":o.relatedAddress=r[c+1];break;case"rport":o.relatedPort=parseInt(r[c+1],10);break;case"tcptype":o.tcpType=r[c+1];break;case"ufrag":o.ufrag=r[c+1],o.usernameFragment=r[c+1];break;default:o[r[c]]===void 0&&(o[r[c]]=r[c+1])}return o},t.writeCandidate=function(n){let r=[];r.push(n.foundation);let o=n.component;o==="rtp"?r.push(1):o==="rtcp"?r.push(2):r.push(o),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);let c=n.type;return r.push("typ"),r.push(c),c!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let r=n.substring(9).split(" "),o={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),o.name=r[0],o.clockRate=parseInt(r[1],10),o.channels=r.length===3?parseInt(r[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);let o=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(n){let r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){let r={},o,c=n.substring(n.indexOf(" ")+1).split(";");for(let d=0;d<c.length;d++)o=c[d].trim().split("="),r[o[0].trim()]=o[1];return r},t.writeFmtp=function(n){let r="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){let c=[];Object.keys(n.parameters).forEach(d=>{n.parameters[d]!==void 0?c.push(d+"="+n.parameters[d]):c.push(d)}),r+="a=fmtp:"+o+" "+c.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){let r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(c=>{r+="a=rtcp-fb:"+o+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){let r=n.indexOf(" "),o={ssrc:parseInt(n.substring(7,r),10)},c=n.indexOf(":",r);return c>-1?(o.attribute=n.substring(r+1,c),o.value=n.substring(c+1)):o.attribute=n.substring(r+1),o},t.parseSsrcGroup=function(n){let r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(o=>parseInt(o,10))}},t.getMid=function(n){let r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},t.parseFingerprint=function(n){let r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let o="a=setup:"+r+`\r
`;return n.fingerprints.forEach(c=>{o+="a=fingerprint:"+c.algorithm+" "+c.value+`\r
`}),o},t.parseCryptoLine=function(n){let r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;let r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){let o=t.matchPrefix(n+r,"a=ice-ufrag:")[0],c=t.matchPrefix(n+r,"a=ice-pwd:")[0];return o&&c?{usernameFragment:o.substring(12),password:c.substring(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){let r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(n)[0].split(" ");r.profile=o[2];for(let d=3;d<o.length;d++){let l=o[d],h=t.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(h){let f=t.parseRtpMap(h),m=t.matchPrefix(n,"a=fmtp:"+l+" ");switch(f.parameters=m.length?t.parseFmtp(m[0]):{},f.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(t.parseRtcpFb),r.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(f.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach(d=>{r.headerExtensions.push(t.parseExtmap(d))});let c=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return r.codecs.forEach(d=>{c.forEach(l=>{d.rtcpFeedback.find(h=>h.type===l.type&&h.parameter===l.parameter)||d.rtcpFeedback.push(l)})}),r},t.writeRtpDescription=function(n,r){let o="";o+="m="+n+" ",o+=r.codecs.length>0?"9":"0",o+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",o+=r.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(d=>{o+=t.writeRtpMap(d),o+=t.writeFmtp(d),o+=t.writeRtcpFb(d)});let c=0;return r.codecs.forEach(d=>{d.maxptime>c&&(c=d.maxptime)}),c>0&&(o+="a=maxptime:"+c+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(d=>{o+=t.writeExtmap(d)}),o},t.parseRtpEncodingParameters=function(n){let r=[],o=t.parseRtpParameters(n),c=o.fecMechanisms.indexOf("RED")!==-1,d=o.fecMechanisms.indexOf("ULPFEC")!==-1,l=t.matchPrefix(n,"a=ssrc:").map(_=>t.parseSsrcMedia(_)).filter(_=>_.attribute==="cname"),h=l.length>0&&l[0].ssrc,f,m=t.matchPrefix(n,"a=ssrc-group:FID").map(_=>_.substring(17).split(" ").map(v=>parseInt(v,10)));m.length>0&&m[0].length>1&&m[0][0]===h&&(f=m[0][1]),o.codecs.forEach(_=>{if(_.name.toUpperCase()==="RTX"&&_.parameters.apt){let v={ssrc:h,codecPayloadType:parseInt(_.parameters.apt,10)};h&&f&&(v.rtx={ssrc:f}),r.push(v),c&&(v=JSON.parse(JSON.stringify(v)),v.fec={ssrc:h,mechanism:d?"red+ulpfec":"red"},r.push(v))}}),r.length===0&&h&&r.push({ssrc:h});let E=t.matchPrefix(n,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substring(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substring(5),10)*.95-16e3:void 0,r.forEach(_=>{_.maxBitrate=E})),r},t.parseRtcpParameters=function(n){let r={},o=t.matchPrefix(n,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];o&&(r.cname=o.value,r.ssrc=o.ssrc);let c=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=c.length>0,r.compound=c.length===0;let d=t.matchPrefix(n,"a=rtcp-mux");return r.mux=d.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r,o=t.matchPrefix(n,"a=msid:");if(o.length===1)return r=o[0].substring(7).split(" "),{stream:r[0],track:r[1]};let c=t.matchPrefix(n,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");return c.length>0?(r=c[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){let r=t.parseMLine(n),o=t.matchPrefix(n,"a=max-message-size:"),c;o.length>0&&(c=parseInt(o[0].substring(19),10)),isNaN(c)&&(c=65536);let d=t.matchPrefix(n,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substring(12),10),protocol:r.fmt,maxMessageSize:c};let l=t.matchPrefix(n,"a=sctpmap:");if(l.length>0){let h=l[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:c}}},t.writeSctpDescription=function(n,r){let o=[];return o=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&o.push("a=max-message-size:"+r.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,r,o){let c,d=r!==void 0?r:2;return c=n||t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+c+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){let o=t.splitLines(n);for(let c=0;c<o.length;c++)switch(o[c]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[c].substring(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){let r=t.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){let r=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;let r=t.splitLines(n);for(let o=0;o<r.length;o++)if(r[o].length<2||r[o].charAt(1)!=="=")return!1;return!0},e.exports=t})(pP);var fP=pP.exports,Nd=a(fP),P7=i({__proto__:null,default:Nd},[fP]);function mm(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){let r=new t(n),o=Nd.parseCandidate(n.candidate),c=Object.assign(r,o);return c.toJSON=function(){return{candidate:c.candidate,sdpMid:c.sdpMid,sdpMLineIndex:c.sdpMLineIndex,usernameFragment:c.usernameFragment}},c}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,nc(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function rS(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||nc(e,"icecandidate",t=>{if(t.candidate){let n=Nd.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function gm(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:r}=this.getConfiguration();r==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(r){if(!r||!r.sdp)return!1;let o=Nd.splitSections(r.sdp);return o.shift(),o.some(c=>{let d=Nd.parseMLine(c);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})}(arguments[0])){let r=function(h){let f=h.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(f===null||f.length<2)return-1;let m=parseInt(f[1],10);return m!=m?-1:m}(arguments[0]),o=function(h){let f=65536;return t.browser==="firefox"&&(f=t.version<57?h===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),f}(r),c=function(h,f){let m=65536;t.browser==="firefox"&&t.version===57&&(m=65535);let E=Nd.matchPrefix(h.sdp,"a=max-message-size:");return E.length>0?m=parseInt(E[0].substr(19),10):t.browser==="firefox"&&f!==-1&&(m=2147483637),m}(arguments[0],r),d;d=o===0&&c===0?Number.POSITIVE_INFINITY:o===0||c===0?Math.max(o,c):Math.min(o,c);let l={};Object.defineProperty(l,"maxMessageSize",{get:()=>d}),this._sctp=l}return n.apply(this,arguments)}}function Em(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,o){let c=r.send;r.send=function(){let d=arguments[0],l=d.length||d.size||d.byteLength;if(r.readyState==="open"&&o.sctp&&l>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return c.apply(r,arguments)}}let n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let r=n.apply(this,arguments);return t(r,this),r},nc(e,"datachannel",r=>(t(r.channel,r.target),r))}function iS(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{let r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{let c=o.target;if(c._lastConnectionState!==c.connectionState){c._lastConnectionState=c.connectionState;let d=new Event("connectionstatechange",o);c.dispatchEvent(d)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function oS(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let o=r.sdp.split(`
`).filter(c=>Hn(c).call(c)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return n.apply(this,arguments)}}function _m(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ie.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ie.resolve())})}function vm(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var M7=Object.freeze({__proto__:null,removeExtmapAllowMixed:oS,shimAddIceCandidateNullOrEmpty:_m,shimConnectionState:iS,shimMaxMessageSize:gm,shimParameterlessSetLocalDescription:vm,shimRTCIceCandidate:mm,shimRTCIceCandidateRelayProtocol:rS,shimSendThrowTypeError:Em});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=AN,r=function(c){let d={browser:null,version:null};if(c===void 0||!c.navigator)return d.browser="Not a browser.",d;let{navigator:l}=c;if(l.mozGetUserMedia)d.browser="firefox",d.version=fm(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||c.isSecureContext===!1&&c.webkitRTCPeerConnection)d.browser="chrome",d.version=fm(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!c.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return d.browser="Not a supported browser.",d;d.browser="safari",d.version=fm(l.userAgent,/AppleWebKit\/(\d+)\./,1),d.supportsUnifiedPlan=c.RTCRtpTransceiver&&"currentDirection"in c.RTCRtpTransceiver.prototype}return d}(e),o={browserDetails:r,commonShim:M7,extractVersion:fm,disableLog:_7,disableWarnings:v7,sdp:P7};switch(r.browser){case"chrome":if(!HN||!QT||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=HN,_m(e,r),vm(e),MN(e,r),kN(e),QT(e,r),LN(e),jN(e,r),xN(e),UN(e),FN(e),BN(e,r),mm(e),rS(e),iS(e),gm(e,r),Em(e),oS(e,r);break;case"firefox":if(!ZN||!ZT||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=ZN,_m(e,r),vm(e),GN(e,r),ZT(e,r),WN(e),zN(e),KN(e),qN(e),YN(e),$N(e),XN(e),JN(e),QN(e),mm(e),iS(e),gm(e,r),Em(e);break;case"safari":if(!dP||!t.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=dP,_m(e,r),vm(e),oP(e),aP(e),nP(e),eP(e),tP(e),sP(e),rP(e),cP(e),mm(e),rS(e),gm(e,r),Em(e),oS(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var mP=dd,k7=TypeError,gP=ms.match(/firefox\/(\d+)/i),L7=!!gP&&+gP[1],x7=/MSIE|Trident/.test(ms),EP=ms.match(/AppleWebKit\/(\d+)\./),U7=!!EP&&+EP[1],F7=Je,_P=L,V7=Hr,j7=Vo,vP=Qs,B7=function(e,t){if(!delete e[t])throw new k7("Cannot delete property "+mP(t)+" of "+mP(e))},yP=Gr,sS=u,H7=wO,G7=Rf,TP=L7,W7=x7,SP=qa,CP=U7,oa=[],IP=_P(oa.sort),K7=_P(oa.push),q7=sS(function(){oa.sort(void 0)}),z7=sS(function(){oa.sort(null)}),Y7=G7("sort"),RP=!sS(function(){if(SP)return SP<70;if(!(TP&&TP>3)){if(W7)return!0;if(CP)return CP<603;var e,t,n,r,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)oa.push({k:t+r,v:n})}for(oa.sort(function(c,d){return d.v-c.v}),r=0;r<oa.length;r++)t=oa[r].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return o!=="DGBEFHACIJK"}});F7({target:"Array",proto:!0,forced:q7||!z7||!Y7||!RP},{sort:function(e){e!==void 0&&V7(e);var t=j7(this);if(RP)return e===void 0?IP(t):IP(t,e);var n,r,o=[],c=vP(t);for(r=0;r<c;r++)r in t&&K7(o,t[r]);for(H7(o,function(d){return function(l,h){return h===void 0?-1:l===void 0?1:d!==void 0?+d(l,h)||0:yP(l)>yP(h)?1:-1}}(e)),n=vP(o),r=0;r<n;)t[r]=o[r++];for(;r<c;)B7(t,r++);return t}});var $7=ki("Array","sort"),X7=V,J7=$7,aS=Array.prototype,Q7=function(e){var t=e.sort;return e===aS||X7(aS,e)&&t===aS.sort?J7:t},nh=a(Q7),cS=Z;Je({global:!0,forced:cS.globalThis!==cS},{globalThis:cS});var wP=a(Z),dS={exports:{}};(function(e,t){(function(n,r){var o="function",c="undefined",d="object",l="string",h="major",f="model",m="name",E="type",_="vendor",v="version",A="architecture",C="console",I="mobile",O="tablet",N="smarttv",x="wearable",B="embedded",j="Amazon",F="Apple",W="ASUS",X="BlackBerry",oe="Browser",te="Chrome",Me="Firefox",ke="Google",ft="Huawei",Wt="LG",Vt="Microsoft",_r="Motorola",z="Opera",ee="Samsung",le="Sharp",Y="Sony",S="Xiaomi",k="Zebra",U="Facebook",Q="Chromium OS",Ce="Mac OS",at=function(on){for(var mn={},Tt=0;Tt<on.length;Tt++)mn[on[Tt].toUpperCase()]=on[Tt];return mn},fn=function(on,mn){return typeof on===l&&Dr(mn).indexOf(Dr(on))!==-1},Dr=function(on){return on.toLowerCase()},ks=function(on,mn){if(typeof on===l)return on=on.replace(/^\s\s*/,""),typeof mn===c?on:on.substring(0,350)},Pc=function(on,mn){for(var Tt,Ur,as,Kt,qe,Or,ba=0;ba<mn.length&&!qe;){var wo=mn[ba],Q2=mn[ba+1];for(Tt=Ur=0;Tt<wo.length&&!qe&&wo[Tt];)if(qe=wo[Tt++].exec(on))for(as=0;as<Q2.length;as++)Or=qe[++Ur],typeof(Kt=Q2[as])===d&&Kt.length>0?Kt.length===2?typeof Kt[1]==o?this[Kt[0]]=Kt[1].call(this,Or):this[Kt[0]]=Kt[1]:Kt.length===3?typeof Kt[1]!==o||Kt[1].exec&&Kt[1].test?this[Kt[0]]=Or?Or.replace(Kt[1],Kt[2]):r:this[Kt[0]]=Or?Kt[1].call(this,Or,Kt[2]):r:Kt.length===4&&(this[Kt[0]]=Or?Kt[3].call(this,Or.replace(Kt[1],Kt[2])):r):this[Kt]=Or||r;ba+=2}},rp=function(on,mn){for(var Tt in mn)if(typeof mn[Tt]===d&&mn[Tt].length>0){for(var Ur=0;Ur<mn[Tt].length;Ur++)if(fn(mn[Tt][Ur],on))return Tt==="?"?r:Tt}else if(fn(mn[Tt],on))return Tt==="?"?r:Tt;return on},hE={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},pE={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[v,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[v,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,v],[/opios[\/ ]+([\w\.]+)/i],[v,[m,z+" Mini"]],[/\bopr\/([\w\.]+)/i],[v,[m,z]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[m,v],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[v,[m,"UC"+oe]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[v,[m,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[v,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[v,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[v,[m,"IE"]],[/yabrowser\/([\w\.]+)/i],[v,[m,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+oe],v],[/\bfocus\/([\w\.]+)/i],[v,[m,Me+" Focus"]],[/\bopt\/([\w\.]+)/i],[v,[m,z+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[v,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[v,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[v,[m,z+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[v,[m,"MIUI "+oe]],[/fxios\/([-\w\.]+)/i],[v,[m,Me]],[/\bqihu|(qi?ho?o?|360)browser/i],[[m,"360 "+oe]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1 "+oe],v],[/(comodo_dragon)\/([\w\.]+)/i],[[m,/_/g," "],v],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[m,v],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,U],v],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[m,v],[/\bgsa\/([\w\.]+) .*safari\//i],[v,[m,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[v,[m,te+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,te+" WebView"],v],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[v,[m,"Android "+oe]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,v],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[v,[m,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[v,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[v,rp,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[m,v],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],v],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[v,[m,Me+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[m,v],[/(cobalt)\/([\w\.]+)/i],[m,[v,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[A,"amd64"]],[/(ia32(?=;))/i],[[A,Dr]],[/((?:i[346]|x)86)[;\)]/i],[[A,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[A,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[A,"armhf"]],[/windows (ce|mobile); ppc;/i],[[A,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[A,/ower/,"",Dr]],[/(sun4\w)[;\)]/i],[[A,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[A,Dr]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[_,ee],[E,O]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[f,[_,ee],[E,I]],[/\((ip(?:hone|od)[\w ]*);/i],[f,[_,F],[E,I]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[_,F],[E,O]],[/(macintosh);/i],[f,[_,F]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[_,le],[E,I]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[f,[_,ft],[E,O]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[_,ft],[E,I]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[f,/_/g," "],[_,S],[E,I]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[f,/_/g," "],[_,S],[E,O]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[_,"OPPO"],[E,I]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[_,"Vivo"],[E,I]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[f,[_,"Realme"],[E,I]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[_,_r],[E,I]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[_,_r],[E,O]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[_,Wt],[E,O]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[_,Wt],[E,I]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[f,[_,"Lenovo"],[E,O]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[f,/_/g," "],[_,"Nokia"],[E,I]],[/(pixel c)\b/i],[f,[_,ke],[E,O]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[_,ke],[E,I]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[_,Y],[E,I]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[_,Y],[E,O]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[_,"OnePlus"],[E,I]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[_,j],[E,O]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[_,j],[E,I]],[/(playbook);[-\w\),; ]+(rim)/i],[f,_,[E,O]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[_,X],[E,I]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[_,W],[E,O]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[_,W],[E,I]],[/(nexus 9)/i],[f,[_,"HTC"],[E,O]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[f,/_/g," "],[E,I]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[_,"Acer"],[E,O]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[_,"Meizu"],[E,I]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_,f,[E,I]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,f,[E,O]],[/(surface duo)/i],[f,[_,Vt],[E,O]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[_,"Fairphone"],[E,I]],[/(u304aa)/i],[f,[_,"AT&T"],[E,I]],[/\bsie-(\w*)/i],[f,[_,"Siemens"],[E,I]],[/\b(rct\w+) b/i],[f,[_,"RCA"],[E,O]],[/\b(venue[\d ]{2,7}) b/i],[f,[_,"Dell"],[E,O]],[/\b(q(?:mv|ta)\w+) b/i],[f,[_,"Verizon"],[E,O]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[f,[_,"Barnes & Noble"],[E,O]],[/\b(tm\d{3}\w+) b/i],[f,[_,"NuVision"],[E,O]],[/\b(k88) b/i],[f,[_,"ZTE"],[E,O]],[/\b(nx\d{3}j) b/i],[f,[_,"ZTE"],[E,I]],[/\b(gen\d{3}) b.+49h/i],[f,[_,"Swiss"],[E,I]],[/\b(zur\d{3}) b/i],[f,[_,"Swiss"],[E,O]],[/\b((zeki)?tb.*\b) b/i],[f,[_,"Zeki"],[E,O]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],f,[E,O]],[/\b(ns-?\w{0,9}) b/i],[f,[_,"Insignia"],[E,O]],[/\b((nxa|next)-?\w{0,9}) b/i],[f,[_,"NextBook"],[E,O]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],f,[E,I]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],f,[E,I]],[/\b(ph-1) /i],[f,[_,"Essential"],[E,I]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[f,[_,"Envizen"],[E,O]],[/\b(trio[-\w\. ]+) b/i],[f,[_,"MachSpeed"],[E,O]],[/\btu_(1491) b/i],[f,[_,"Rotor"],[E,O]],[/(shield[\w ]+) b/i],[f,[_,"Nvidia"],[E,O]],[/(sprint) (\w+)/i],[_,f,[E,I]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[_,Vt],[E,I]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[_,k],[E,O]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[_,k],[E,I]],[/smart-tv.+(samsung)/i],[_,[E,N]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[_,ee],[E,N]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,Wt],[E,N]],[/(apple) ?tv/i],[_,[f,F+" TV"],[E,N]],[/crkey/i],[[f,te+"cast"],[_,ke],[E,N]],[/droid.+aft(\w)( bui|\))/i],[f,[_,j],[E,N]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[_,le],[E,N]],[/(bravia[\w ]+)( bui|\))/i],[f,[_,Y],[E,N]],[/(mitv-\w{5}) bui/i],[f,[_,S],[E,N]],[/Hbbtv.*(technisat) (.*);/i],[_,f,[E,N]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,ks],[f,ks],[E,N]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,N]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,f,[E,C]],[/droid.+; (shield) bui/i],[f,[_,"Nvidia"],[E,C]],[/(playstation [345portablevi]+)/i],[f,[_,Y],[E,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[_,Vt],[E,C]],[/((pebble))app/i],[_,f,[E,x]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[_,F],[E,x]],[/droid.+; (glass) \d/i],[f,[_,ke],[E,x]],[/droid.+; (wt63?0{2,3})\)/i],[f,[_,k],[E,x]],[/(quest( 2| pro)?)/i],[f,[_,U],[E,x]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[E,B]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[f,[E,I]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[f,[E,O]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,O]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,I]],[/(android[-\w\. ]{0,9});.+buil/i],[f,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[v,[m,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[v,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[m,v],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[v,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,v],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[m,[v,rp,hE]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,"Windows"],[v,rp,hE]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[v,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,Ce],[v,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[v,m],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[m,v],[/\(bb(10);/i],[v,[m,X]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[v,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[v,[m,Me+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[v,[m,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[v,[m,"watchOS"]],[/crkey\/([\d\.]+)/i],[v,[m,te+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[m,Q],v],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,v],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],v],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[m,v]]},vi=function(on,mn){if(typeof on===d&&(mn=on,on=r),!(this instanceof vi))return new vi(on,mn).getResult();var Tt=typeof n!==c&&n.navigator?n.navigator:r,Ur=on||(Tt&&Tt.userAgent?Tt.userAgent:""),as=Tt&&Tt.userAgentData?Tt.userAgentData:r,Kt=mn?function(qe,Or){var ba={};for(var wo in qe)Or[wo]&&Or[wo].length%2==0?ba[wo]=Or[wo].concat(qe[wo]):ba[wo]=qe[wo];return ba}(pE,mn):pE;return this.getBrowser=function(){var qe={};return qe[m]=r,qe[v]=r,Pc.call(qe,Ur,Kt.browser),qe[h]=function(Or){return typeof Or===l?Or.replace(/[^\d\.]/g,"").split(".")[0]:r}(qe[v]),Tt&&Tt.brave&&typeof Tt.brave.isBrave==o&&(qe[m]="Brave"),qe},this.getCPU=function(){var qe={};return qe[A]=r,Pc.call(qe,Ur,Kt.cpu),qe},this.getDevice=function(){var qe={};return qe[_]=r,qe[f]=r,qe[E]=r,Pc.call(qe,Ur,Kt.device),!qe[E]&&as&&as.mobile&&(qe[E]=I),qe[f]=="Macintosh"&&Tt&&typeof Tt.standalone!==c&&Tt.maxTouchPoints&&Tt.maxTouchPoints>2&&(qe[f]="iPad",qe[E]=O),qe},this.getEngine=function(){var qe={};return qe[m]=r,qe[v]=r,Pc.call(qe,Ur,Kt.engine),qe},this.getOS=function(){var qe={};return qe[m]=r,qe[v]=r,Pc.call(qe,Ur,Kt.os),!qe[m]&&as&&as.platform!="Unknown"&&(qe[m]=as.platform.replace(/chrome os/i,Q).replace(/macos/i,Ce)),qe},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ur},this.setUA=function(qe){return Ur=typeof qe===l&&qe.length>350?ks(qe,350):qe,this},this.setUA(Ur),this};vi.VERSION="0.7.34",vi.BROWSER=at([m,v,h]),vi.CPU=at([A]),vi.DEVICE=at([f,_,E,C,I,N,O,x,B]),vi.ENGINE=vi.OS=at([m,v]),e.exports&&(t=e.exports=vi),t.UAParser=vi;var wa=typeof n!==c&&(n.jQuery||n.Zepto);if(wa&&!wa.ua){var Mc=new vi;wa.ua=Mc.getResult(),wa.ua.get=function(){return Mc.getUA()},wa.ua.set=function(on){Mc.setUA(on);var mn=Mc.getResult();for(var Tt in mn)wa.ua[Tt]=mn[Tt]}}})(typeof window=="object"?window:s)})(dS,dS.exports);var Z7=a(dS.exports),eX=gs,tX=Mn,nX=ad,rX=Ya,iX=en("iterator"),oX=Object,sX=function(e){if(nX(e))return!1;var t=oX(e);return t[iX]!==void 0||"@@iterator"in t||tX(rX,eX(t))},aX=a(sX),bP=qf.clear;Je({global:!0,bind:!0,enumerable:!0,forced:Z.clearImmediate!==bP},{clearImmediate:bP});var AP=Z,cX=We,dX=Rn,uX=gy,lX=ms,hX=ea,pX=Ja,fX=AP.Function,mX=/MSIE .\./.test(lX)||uX==="BUN"&&function(){var e=AP.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),gX=Je,DP=Z,OP=qf.set,EX=function(e,t){var n=t?2:1;return mX?function(r,o){var c=pX(arguments.length,1)>n,d=dX(r)?r:fX(r),l=c?hX(arguments,n):[],h=c?function(){cX(d,this,l)}:d;return t?e(h,o):e(h)}:e},NP=DP.setImmediate?EX(OP,!1):OP;gX({global:!0,bind:!0,enumerable:!0,forced:DP.setImmediate!==NP},{setImmediate:NP});var PP=a(ai.setImmediate),_X=Z,vX=G0,yX=Hr,TX=Ja,SX=Tr;Je({global:!0,enumerable:!0,dontCallGetSet:!0,forced:u(function(){return SX&&Object.getOwnPropertyDescriptor(_X,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){TX(arguments.length,1),vX(yX(e))}});var MP=a(ai.queueMicrotask);function kP(e,t){return function(){return e.apply(t,arguments)}}let{toString:CX}=Object.prototype,{getPrototypeOf:uS}=Object,ym=(lS=Object.create(null),e=>{let t=CX.call(e);return lS[t]||(lS[t]=t.slice(8,-1).toLowerCase())});var lS;let po=e=>(e=e.toLowerCase(),t=>ym(t)===e),Tm=e=>t=>typeof t===e,{isArray:Pd}=Array,rh=Tm("undefined"),LP=po("ArrayBuffer"),IX=Tm("string"),di=Tm("function"),xP=Tm("number"),Sm=e=>e!==null&&typeof e=="object",Cm=e=>{if(ym(e)!=="object")return!1;let t=uS(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||aX(e))},RX=po("Date"),wX=po("File"),bX=po("Blob"),AX=po("FileList"),DX=po("URLSearchParams"),[OX,NX,PX,MX]=["ReadableStream","Request","Response","Headers"].map(po);function ih(e,t){let n,r,{allOwnKeys:o=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Pd(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{let c=o?Object.getOwnPropertyNames(e):Object.keys(e),d=c.length,l;for(n=0;n<d;n++)l=c[n],t.call(null,e[l],l,e)}}function UP(e,t){t=t.toLowerCase();let n=Object.keys(e),r,o=n.length;for(;o-- >0;)if(r=n[o],t===r.toLowerCase())return r;return null}let rc=wP!==void 0?wP:typeof self<"u"?self:typeof window<"u"?window:global,FP=e=>!rh(e)&&e!==rc,kX=(hS=typeof Uint8Array<"u"&&uS(Uint8Array),e=>hS&&e instanceof hS);var hS;let LX=po("HTMLFormElement"),VP=(e=>{let{hasOwnProperty:t}=e;return(n,r)=>t.call(n,r)})(Object.prototype),xX=po("RegExp"),jP=(e,t)=>{let n=Object.getOwnPropertyDescriptors(e),r={};ih(n,(o,c)=>{let d;(d=t(o,c,e))!==!1&&(r[c]=d||o)}),Object.defineProperties(e,r)},pS="abcdefghijklmnopqrstuvwxyz",BP="0123456789",HP={DIGIT:BP,ALPHA:pS,ALPHA_DIGIT:pS+pS.toUpperCase()+BP},UX=po("AsyncFunction"),GP=(WP=typeof PP=="function",KP=di(rc.postMessage),WP?PP:KP?(fS="axios@".concat(Math.random()),Im=[],rc.addEventListener("message",e=>{let{source:t,data:n}=e;t===rc&&n===fS&&Im.length&&Im.shift()()},!1),e=>{Im.push(e),rc.postMessage(fS,"*")}):e=>setTimeout(e));var WP,KP,fS,Im;let FX=MP!==void 0?MP.bind(rc):typeof process<"u"&&process.nextTick||GP;var re={isArray:Pd,isArrayBuffer:LP,isBuffer:function(e){return e!==null&&!rh(e)&&e.constructor!==null&&!rh(e.constructor)&&di(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||di(e.append)&&((t=ym(e))==="formdata"||t==="object"&&di(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&LP(e.buffer),t},isString:IX,isNumber:xP,isBoolean:e=>e===!0||e===!1,isObject:Sm,isPlainObject:Cm,isReadableStream:OX,isRequest:NX,isResponse:PX,isHeaders:MX,isUndefined:rh,isDate:RX,isFile:wX,isBlob:bX,isRegExp:xX,isFunction:di,isStream:e=>Sm(e)&&di(e.pipe),isURLSearchParams:DX,isTypedArray:kX,isFileList:AX,forEach:ih,merge:function e(){let{caseless:t}=FP(this)&&this||{},n={},r=(o,c)=>{let d=t&&UP(n,c)||c;Cm(n[d])&&Cm(o)?n[d]=e(n[d],o):Cm(o)?n[d]=e({},o):Pd(o)?n[d]=o.slice():n[d]=o};for(let o=0,c=arguments.length;o<c;o++)arguments[o]&&ih(arguments[o],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return ih(t,(o,c)=>{n&&di(o)?e[c]=kP(o,n):e[c]=o},{allOwnKeys:r}),e},trim:e=>Hn(e)?Hn(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let o,c,d,l={};if(t=t||{},e==null)return t;do{for(o=Object.getOwnPropertyNames(e),c=o.length;c-- >0;)d=o[c],r&&!r(d,e,t)||l[d]||(t[d]=e[d],l[d]=!0);e=n!==!1&&uS(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:ym,kindOfTest:po,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;let r=e.indexOf(t,n);return r!==-1&&r===n},toArray:e=>{if(!e)return null;if(Pd(e))return e;let t=e.length;if(!xP(t))return null;let n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{let n=(e&&e[Symbol.iterator]).call(e),r;for(;(r=n.next())&&!r.done;){let o=r.value;t.call(e,o[0],o[1])}},matchAll:(e,t)=>{let n,r=[];for(;(n=e.exec(t))!==null;)r.push(n);return r},isHTMLForm:LX,hasOwnProperty:VP,hasOwnProp:VP,reduceDescriptors:jP,freezeMethods:e=>{jP(e,(t,n)=>{if(di(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;let r=e[n];di(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{let n={},r=o=>{o.forEach(c=>{n[c]=!0})};return Pd(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:UP,global:rc,isContextDefined:FP,ALPHABET:HP,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:HP.ALPHA_DIGIT,n="",{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&di(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{let t=new Array(10),n=(r,o)=>{if(Sm(r)){if(t.indexOf(r)>=0)return;if(!("toJSON"in r)){t[o]=r;let c=Pd(r)?[]:{};return ih(r,(d,l)=>{let h=n(d,o+1);!rh(h)&&(c[l]=h)}),t[o]=void 0,c}}return r};return n(e,0)},isAsyncFn:UX,isThenable:e=>e&&(Sm(e)||di(e))&&di(e.then)&&di(e.catch),setImmediate:GP,asap:FX};function ot(e,t,n,r,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),o&&(this.response=o,this.status=o.status?o.status:null)}re.inherits(ot,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:re.toJSONObject(this.config),code:this.code,status:this.status}}});let qP=ot.prototype,zP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{zP[e]={value:e}}),Object.defineProperties(ot,zP),Object.defineProperty(qP,"isAxiosError",{value:!0}),ot.from=(e,t,n,r,o,c)=>{let d=Object.create(qP);return re.toFlatObject(e,d,function(l){return l!==Error.prototype},l=>l!=="isAxiosError"),ot.call(d,e.message,t,n,r,o),d.cause=e,d.name=e.name,c&&Object.assign(d,c),d};function mS(e){return re.isPlainObject(e)||re.isArray(e)}function YP(e){return re.endsWith(e,"[]")?e.slice(0,-2):e}function $P(e,t,n){return e?e.concat(t).map(function(r,o){return r=YP(r),!n&&o?"["+r+"]":r}).join(n?".":""):t}let VX=re.toFlatObject(re,{},null,function(e){return/^is[A-Z]/.test(e)});function Rm(e,t,n){if(!re.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let r=(n=re.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_,v){return!re.isUndefined(v[_])})).metaTokens,o=n.visitor||f,c=n.dots,d=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&re.isSpecCompliantForm(t);if(!re.isFunction(o))throw new TypeError("visitor must be a function");function h(_){if(_===null)return"";if(re.isDate(_))return _.toISOString();if(!l&&re.isBlob(_))throw new ot("Blob is not supported. Use a Buffer instead.");return re.isArrayBuffer(_)||re.isTypedArray(_)?l&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function f(_,v,A){let C=_;if(_&&!A&&typeof _=="object"){if(re.endsWith(v,"{}"))v=r?v:v.slice(0,-2),_=JSON.stringify(_);else if(re.isArray(_)&&function(I){return re.isArray(I)&&!I.some(mS)}(_)||(re.isFileList(_)||re.endsWith(v,"[]"))&&(C=re.toArray(_)))return v=YP(v),C.forEach(function(I,O){!re.isUndefined(I)&&I!==null&&t.append(d===!0?$P([v],O,c):d===null?v:v+"[]",h(I))}),!1}return!!mS(_)||(t.append($P(A,v,c),h(_)),!1)}let m=[],E=Object.assign(VX,{defaultVisitor:f,convertValue:h,isVisitable:mS});if(!re.isObject(e))throw new TypeError("data must be an object");return function _(v,A){if(!re.isUndefined(v)){if(m.indexOf(v)!==-1)throw Error("Circular reference detected in "+A.join("."));m.push(v),re.forEach(v,function(C,I){(!(re.isUndefined(C)||C===null)&&o.call(t,C,re.isString(I)?Hn(I).call(I):I,A,E))===!0&&_(C,A?A.concat(I):[I])}),m.pop()}}(e),t}function XP(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return t[n]})}function gS(e,t){this._pairs=[],e&&Rm(e,this,t)}let JP=gS.prototype;function jX(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function QP(e,t,n){if(!t)return e;let r=n&&n.encode||jX;re.isFunction(n)&&(n={serialize:n});let o=n&&n.serialize,c;if(c=o?o(t,n):re.isURLSearchParams(t)?t.toString():new gS(t,n).toString(r),c){let d=e.indexOf("#");d!==-1&&(e=e.slice(0,d)),e+=(e.indexOf("?")===-1?"?":"&")+c}return e}JP.append=function(e,t){this._pairs.push([e,t])},JP.toString=function(e){let t=e?function(n){return e.call(this,n,XP)}:XP;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};var ZP=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){re.forEach(this.handlers,function(t){t!==null&&e(t)})}},eM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},tM={exports:{}},BX=Je,HX=Tr,nM=Mi.f;BX({target:"Object",stat:!0,forced:Object.defineProperty!==nM,sham:!HX},{defineProperty:nM});var rM=ai.Object,GX=tM.exports=function(e,t,n){return rM.defineProperty(e,t,n)};rM.defineProperty.sham&&(GX.sham=!0);var iM=a(tM.exports),WX=TypeError,oM=Ul,KX=Kf,qX=Sr,zX=en("species"),sM=Array,YX=function(e){var t;return oM(e)&&(t=e.constructor,(KX(t)&&(t===sM||oM(t.prototype))||qX(t)&&(t=t[zX])===null)&&(t=void 0)),t===void 0?sM:t},aM=function(e,t){return new(YX(e))(t===0?0:t)},$X=u,XX=qa,JX=en("species"),cM=function(e){return XX>=51||!$X(function(){var t=[];return(t.constructor={})[JX]=function(){return{foo:1}},t[e](Boolean).foo!==1})},QX=Je,ZX=u,eJ=Ul,tJ=Sr,nJ=Vo,rJ=Qs,dM=function(e){if(e>9007199254740991)throw WX("Maximum allowed index exceeded");return e},uM=AT,iJ=aM,oJ=cM,sJ=qa,lM=en("isConcatSpreadable"),aJ=sJ>=51||!ZX(function(){var e=[];return e[lM]=!1,e.concat()[0]!==e}),cJ=function(e){if(!tJ(e))return!1;var t=e[lM];return t!==void 0?!!t:eJ(e)};QX({target:"Array",proto:!0,arity:1,forced:!aJ||!oJ("concat")},{concat:function(e){var t,n,r,o,c,d=nJ(this),l=iJ(d,0),h=0;for(t=-1,r=arguments.length;t<r;t++)if(cJ(c=t===-1?d:arguments[t]))for(o=rJ(c),dM(h+o),n=0;n<o;n++,h++)n in c&&uM(l,h,c[n]);else dM(h+1),uM(l,h++,c);return l.length=h,l}});var hM={},dJ=Fo,uJ=Xs,pM=Df.f,lJ=ea,fM=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];hM.f=function(e){return fM&&dJ(e)==="Window"?function(t){try{return pM(t)}catch{return lJ(fM)}}(e):pM(uJ(e))};var Md={},hJ=en;Md.f=hJ;var mM=ai,pJ=Mn,fJ=Md,mJ=Mi.f,yn=function(e){var t=mM.Symbol||(mM.Symbol={});pJ(t,e)||mJ(t,e,{value:fJ.f(e)})},gJ=Pn,EJ=hr,_J=en,vJ=Zs,gM=function(){var e=EJ("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=_J("toPrimitive");t&&!t[r]&&vJ(t,r,function(o){return gJ(n,this)},{arity:1})},yJ=Js,TJ=Tf,SJ=Vo,CJ=Qs,IJ=aM,EM=L([].push),sa=function(e){var t=e===1,n=e===2,r=e===3,o=e===4,c=e===6,d=e===7,l=e===5||c;return function(h,f,m,E){for(var _,v,A=SJ(h),C=TJ(A),I=CJ(C),O=yJ(f,m),N=0,x=E||IJ,B=t?x(h,I):n||d?x(h,0):void 0;I>N;N++)if((l||N in C)&&(v=O(_=C[N],N,A),e))if(t)B[N]=v;else if(v)switch(e){case 3:return!0;case 5:return _;case 6:return N;case 2:EM(B,_)}else switch(e){case 4:return!1;case 7:EM(B,_)}return c?-1:r||o?o:B}},_M={forEach:sa(0),map:sa(1),filter:sa(2),some:sa(3),every:sa(4),find:sa(5),findIndex:sa(6),filterReject:sa(7)},wm=Je,oh=Z,ES=Pn,RJ=L,kd=Tr,Ld=cd,wJ=u,tr=Mn,bJ=V,_S=Pr,bm=Xs,vS=ry,AJ=Gr,yS=$s,xd=Vl,vM=Nf,DJ=Df,yM=hM,OJ=Fl,TM=Ef,SM=Mi,NJ=Cy,CM=vf,IM=Zs,PJ=Wf,TS=ud,RM=Of,wM=ty,MJ=en,kJ=Md,LJ=yn,xJ=gM,UJ=Es,bM=Xa,Am=_M.forEach,Kr=Af("hidden"),Dm="Symbol",sh="prototype",FJ=bM.set,AM=bM.getterFor(Dm),fo=Object[sh],ic=oh.Symbol,Om=ic&&ic[sh],VJ=oh.RangeError,jJ=oh.TypeError,SS=oh.QObject,DM=TM.f,oc=SM.f,OM=yM.f,BJ=CM.f,NM=RJ([].push),ys=TS("symbols"),ah=TS("op-symbols"),HJ=TS("wks"),CS=!SS||!SS[sh]||!SS[sh].findChild,PM=function(e,t,n){var r=DM(fo,t);r&&delete fo[t],oc(e,t,n),r&&e!==fo&&oc(fo,t,r)},IS=kd&&wJ(function(){return xd(oc({},"a",{get:function(){return oc(this,"a",{value:7}).a}})).a!==7})?PM:oc,RS=function(e,t){var n=ys[e]=xd(Om);return FJ(n,{type:Dm,tag:e,description:t}),kd||(n.description=t),n},Nm=function(e,t,n){e===fo&&Nm(ah,t,n),_S(e);var r=vS(t);return _S(n),tr(ys,r)?(n.enumerable?(tr(e,Kr)&&e[Kr][r]&&(e[Kr][r]=!1),n=xd(n,{enumerable:yS(0,!1)})):(tr(e,Kr)||oc(e,Kr,yS(1,xd(null))),e[Kr][r]=!0),IS(e,r,n)):oc(e,r,n)},wS=function(e,t){_S(e);var n=bm(t),r=vM(n).concat(xM(n));return Am(r,function(o){kd&&!ES(MM,n,o)||Nm(e,o,n[o])}),e},MM=function(e){var t=vS(e),n=ES(BJ,this,t);return!(this===fo&&tr(ys,t)&&!tr(ah,t))&&(!(n||!tr(this,t)||!tr(ys,t)||tr(this,Kr)&&this[Kr][t])||n)},kM=function(e,t){var n=bm(e),r=vS(t);if(n!==fo||!tr(ys,r)||tr(ah,r)){var o=DM(n,r);return!o||!tr(ys,r)||tr(n,Kr)&&n[Kr][r]||(o.enumerable=!0),o}},LM=function(e){var t=OM(bm(e)),n=[];return Am(t,function(r){tr(ys,r)||tr(RM,r)||NM(n,r)}),n},xM=function(e){var t=e===fo,n=OM(t?ah:bm(e)),r=[];return Am(n,function(o){!tr(ys,o)||t&&!tr(fo,o)||NM(r,ys[o])}),r};Ld||(ic=function(){if(bJ(Om,this))throw new jJ("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?AJ(arguments[0]):void 0,t=wM(e),n=function(r){var o=this===void 0?oh:this;o===fo&&ES(n,ah,r),tr(o,Kr)&&tr(o[Kr],t)&&(o[Kr][t]=!1);var c=yS(1,r);try{IS(o,t,c)}catch(d){if(!(d instanceof VJ))throw d;PM(o,t,c)}};return kd&&CS&&IS(fo,t,{configurable:!0,set:n}),RS(t,e)},IM(Om=ic[sh],"toString",function(){return AM(this).tag}),IM(ic,"withoutSetter",function(e){return RS(wM(e),e)}),CM.f=MM,SM.f=Nm,NJ.f=wS,TM.f=kM,DJ.f=yM.f=LM,OJ.f=xM,kJ.f=function(e){return RS(MJ(e),e)},kd&&PJ(Om,"description",{configurable:!0,get:function(){return AM(this).description}})),wm({global:!0,constructor:!0,wrap:!0,forced:!Ld,sham:!Ld},{Symbol:ic}),Am(vM(HJ),function(e){LJ(e)}),wm({target:Dm,stat:!0,forced:!Ld},{useSetter:function(){CS=!0},useSimple:function(){CS=!1}}),wm({target:"Object",stat:!0,forced:!Ld,sham:!kd},{create:function(e,t){return t===void 0?xd(e):wS(xd(e),t)},defineProperty:Nm,defineProperties:wS,getOwnPropertyDescriptor:kM}),wm({target:"Object",stat:!0,forced:!Ld},{getOwnPropertyNames:LM}),xJ(),UJ(ic,Dm),RM[Kr]=!0;var UM=cd&&!!Symbol.for&&!!Symbol.keyFor,GJ=Je,WJ=hr,KJ=Mn,qJ=Gr,FM=ud,zJ=UM,bS=FM("string-to-symbol-registry"),YJ=FM("symbol-to-string-registry");GJ({target:"Symbol",stat:!0,forced:!zJ},{for:function(e){var t=qJ(e);if(KJ(bS,t))return bS[t];var n=WJ("Symbol")(t);return bS[t]=n,YJ[n]=t,n}});var $J=Je,XJ=Mn,JJ=Ml,QJ=dd,ZJ=UM,VM=ud("symbol-to-string-registry");$J({target:"Symbol",stat:!0,forced:!ZJ},{keyFor:function(e){if(!JJ(e))throw new TypeError(QJ(e)+" is not a symbol");if(XJ(VM,e))return VM[e]}});var jM=Ul,eQ=Rn,BM=Fo,tQ=Gr,HM=L([].push),nQ=Je,GM=hr,WM=We,rQ=Pn,ch=L,KM=u,qM=Rn,zM=Ml,YM=ea,iQ=function(e){if(eQ(e))return e;if(jM(e)){for(var t=e.length,n=[],r=0;r<t;r++){var o=e[r];typeof o=="string"?HM(n,o):typeof o!="number"&&BM(o)!=="Number"&&BM(o)!=="String"||HM(n,tQ(o))}var c=n.length,d=!0;return function(l,h){if(d)return d=!1,h;if(jM(this))return h;for(var f=0;f<c;f++)if(n[f]===l)return h}}},oQ=cd,sQ=String,aa=GM("JSON","stringify"),Pm=ch(/./.exec),$M=ch("".charAt),aQ=ch("".charCodeAt),cQ=ch("".replace),dQ=ch(1 .toString),uQ=/[\uD800-\uDFFF]/g,XM=/^[\uD800-\uDBFF]$/,JM=/^[\uDC00-\uDFFF]$/,QM=!oQ||KM(function(){var e=GM("Symbol")("stringify detection");return aa([e])!=="[null]"||aa({a:e})!=="{}"||aa(Object(e))!=="{}"}),ZM=KM(function(){return aa("\uDF06\uD834")!=='"\\udf06\\ud834"'||aa("\uDEAD")!=='"\\udead"'}),lQ=function(e,t){var n=YM(arguments),r=iQ(t);if(qM(r)||e!==void 0&&!zM(e))return n[1]=function(o,c){if(qM(r)&&(c=rQ(r,this,sQ(o),c)),!zM(c))return c},WM(aa,null,n)},hQ=function(e,t,n){var r=$M(n,t-1),o=$M(n,t+1);return Pm(XM,e)&&!Pm(JM,o)||Pm(JM,e)&&!Pm(XM,r)?"\\u"+dQ(aQ(e,0),16):e};aa&&nQ({target:"JSON",stat:!0,arity:3,forced:QM||ZM},{stringify:function(e,t,n){var r=YM(arguments),o=WM(QM?lQ:aa,null,r);return ZM&&typeof o=="string"?cQ(o,uQ,hQ):o}});var ek=Fl,pQ=Vo;Je({target:"Object",stat:!0,forced:!cd||u(function(){ek.f(1)})},{getOwnPropertySymbols:function(e){var t=ek.f;return t?t(pQ(e)):[]}}),yn("asyncIterator"),yn("hasInstance"),yn("isConcatSpreadable"),yn("iterator"),yn("match"),yn("matchAll"),yn("replace"),yn("search"),yn("species"),yn("split");var fQ=gM;yn("toPrimitive"),fQ();var mQ=hr,gQ=Es;yn("toStringTag"),gQ(mQ("Symbol"),"Symbol"),yn("unscopables"),Es(Z.JSON,"JSON",!0);var EQ=ai.Symbol,_Q=en,vQ=Mi.f,tk=_Q("metadata"),nk=Function.prototype;nk[tk]===void 0&&vQ(nk,tk,{value:null}),yn("asyncDispose"),yn("dispose"),yn("metadata");var yQ=EQ,TQ=L,AS=hr("Symbol"),SQ=AS.keyFor,CQ=TQ(AS.prototype.valueOf),rk=AS.isRegisteredSymbol||function(e){try{return SQ(CQ(e))!==void 0}catch{return!1}};Je({target:"Symbol",stat:!0},{isRegisteredSymbol:rk});for(var IQ=ud,ik=hr,RQ=L,wQ=Ml,bQ=en,Mm=ik("Symbol"),ok=Mm.isWellKnownSymbol,sk=ik("Object","getOwnPropertyNames"),AQ=RQ(Mm.prototype.valueOf),ak=IQ("wks"),DS=0,ck=sk(Mm),DQ=ck.length;DS<DQ;DS++)try{var dk=ck[DS];wQ(Mm[dk])&&bQ(dk)}catch{}var uk=function(e){if(ok&&ok(e))return!0;try{for(var t=AQ(e),n=0,r=sk(ak),o=r.length;n<o;n++)if(ak[r[n]]==t)return!0}catch{}return!1};Je({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:uk}),yn("customMatcher"),yn("observable"),Je({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:rk}),Je({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:uk}),yn("matcher"),yn("metadataKey"),yn("patternMatch"),yn("replaceAll");var Ud=a(yQ),lk=a(Md.f("iterator"));function dh(e){return dh=typeof Ud=="function"&&typeof lk=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Ud=="function"&&t.constructor===Ud&&t!==Ud.prototype?"symbol":typeof t},dh(e)}var OQ=a(Md.f("toPrimitive"));function NQ(e){var t=function(n,r){if(dh(n)!=="object"||n===null)return n;var o=n[OQ];if(o!==void 0){var c=o.call(n,r||"default");if(dh(c)!=="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(e,"string");return dh(t)==="symbol"?t:String(t)}function b(e,t,n){return(t=NQ(t))in e?iM(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var hk=a(s9),PQ={isBrowser:!0,classes:{URLSearchParams:hk!==void 0?hk:gS,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let OS=typeof window<"u"&&typeof document<"u",NS=typeof navigator=="object"&&navigator||void 0,MQ=OS&&(!NS||["ReactNative","NativeScript","NS"].indexOf(NS.product)<0),kQ=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",LQ=OS&&window.location.href||"http://localhost";function pk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function fk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pk(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var Cr=fk(fk({},Object.freeze({__proto__:null,hasBrowserEnv:OS,hasStandardBrowserEnv:MQ,hasStandardBrowserWebWorkerEnv:kQ,navigator:NS,origin:LQ})),PQ),xQ=Pr,UQ=Pn,FQ=Mn,VQ=V,jQ=function(){var e=xQ(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},mk=RegExp.prototype,gk=function(e){var t=e.flags;return t!==void 0||"flags"in mk||FQ(e,"flags")||!VQ(mk,e)?t:UQ(jQ,e)},BQ=gT.charAt,Ek=Pn,HQ=Pr,GQ=Rn,WQ=Fo,KQ=/./.exec,qQ=TypeError,zQ=Je,_k=Pn,vk=Pl,YQ=Uy,km=Hf,yk=Ka,Tk=_D,uh=Gr,$Q=Pr,XQ=ad,JQ=Fo,QQ=yD,Sk=gk,ZQ=Sf,eZ=u,tZ=Gy,nZ=function(e,t,n){return t+(n?BQ(e,t).length:1)},rZ=function(e,t){var n=e.exec;if(GQ(n)){var r=Ek(n,e,t);return r!==null&&HQ(r),r}if(WQ(e)==="RegExp")return Ek(KQ,e,t);throw new qQ("RegExp#exec called on incompatible receiver")},Ck=Xa,iZ=en("matchAll"),Ik="RegExp String",Rk=Ik+" Iterator",oZ=Ck.set,sZ=Ck.getterFor(Rk),aZ=TypeError,PS=vk("".indexOf),Lm=vk("".matchAll),MS=!!Lm&&!eZ(function(){Lm("a",/./)}),cZ=YQ(function(e,t,n,r){oZ(this,{type:Rk,regexp:e,string:t,global:n,unicode:r,done:!1})},Ik,function(){var e=sZ(this);if(e.done)return km(void 0,!0);var t=e.regexp,n=e.string,r=rZ(t,n);return r===null?(e.done=!0,km(void 0,!0)):e.global?(uh(r[0])===""&&(t.lastIndex=nZ(n,Tk(t.lastIndex),e.unicode)),km(r,!1)):(e.done=!0,km(r,!1))}),wk=function(e){var t,n,r,o=$Q(this),c=uh(e),d=tZ(o,RegExp),l=uh(Sk(o));return t=new d(d===RegExp?o.source:o,l),n=!!~PS(l,"g"),r=!!~PS(l,"u"),t.lastIndex=Tk(o.lastIndex),new cZ(t,c,n,r)};zQ({target:"String",proto:!0,forced:MS},{matchAll:function(e){var t,n,r,o,c=yk(this);if(XQ(e)){if(MS)return Lm(c,e)}else{if(QQ(e)&&(t=uh(yk(Sk(e))),!~PS(t,"g")))throw new aZ("`.matchAll` does not allow non-global regexes");if(MS)return Lm(c,e);if((r=ZQ(e,iZ))===void 0&&JQ(e)==="RegExp"&&(r=wk),r)return _k(r,e,c)}return n=uh(c),o=new RegExp(e,"g"),_k(wk,o,n)}});var dZ=ki("String","matchAll"),uZ=V,lZ=dZ,kS=String.prototype,hZ=function(e){var t=e.matchAll;return typeof e=="string"||e===kS||uZ(kS,e)&&t===kS.matchAll?lZ:t},pZ=a(hZ);function bk(e){function t(n,r,o,c){let d=n[c++];if(d==="__proto__")return!0;let l=Number.isFinite(+d),h=c>=n.length;return d=!d&&re.isArray(o)?o.length:d,h?(re.hasOwnProp(o,d)?o[d]=[o[d],r]:o[d]=r,!l):(o[d]&&re.isObject(o[d])||(o[d]=[]),t(n,r,o[d],c)&&re.isArray(o[d])&&(o[d]=function(f){let m={},E=Object.keys(f),_,v=E.length,A;for(_=0;_<v;_++)A=E[_],m[A]=f[A];return m}(o[d])),!l)}if(re.isFormData(e)&&re.isFunction(e.entries)){let n={};return re.forEachEntry(e,(r,o)=>{t(function(c){return pZ(re).call(re,/\w+|\[(\w*)]/g,c).map(d=>d[0]==="[]"?"":d[1]||d[0])}(r),o,n,0)}),n}return null}let LS={transitional:eM,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let n=t.getContentType()||"",r=n.indexOf("application/json")>-1,o=re.isObject(e);if(o&&re.isHTMLForm(e)&&(e=new FormData(e)),re.isFormData(e))return r?JSON.stringify(bk(e)):e;if(re.isArrayBuffer(e)||re.isBuffer(e)||re.isStream(e)||re.isFile(e)||re.isBlob(e)||re.isReadableStream(e))return e;if(re.isArrayBufferView(e))return e.buffer;if(re.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(d,l){return Rm(d,new Cr.classes.URLSearchParams,Object.assign({visitor:function(h,f,m,E){return Cr.isNode&&re.isBuffer(h)?(this.append(f,h.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)}},l))}(e,this.formSerializer).toString();if((c=re.isFileList(e))||n.indexOf("multipart/form-data")>-1){let d=this.env&&this.env.FormData;return Rm(c?{"files[]":e}:e,d&&new d,this.formSerializer)}}return o||r?(t.setContentType("application/json",!1),function(d,l,h){if(re.isString(d))try{return(l||JSON.parse)(d),Hn(re).call(re,d)}catch(f){if(f.name!=="SyntaxError")throw f}return(h||JSON.stringify)(d)}(e)):e}],transformResponse:[function(e){let t=this.transitional||LS.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(re.isResponse(e)||re.isReadableStream(e))return e;if(e&&re.isString(e)&&(n&&!this.responseType||r)){let o=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(c){if(o)throw c.name==="SyntaxError"?ot.from(c,ot.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Cr.classes.FormData,Blob:Cr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};re.forEach(["delete","get","head","post","put","patch"],e=>{LS.headers[e]={}});var xS=LS;let fZ=re.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ak=Symbol("internals");function lh(e){var t;return e&&Hn(t=String(e)).call(t).toLowerCase()}function xm(e){return e===!1||e==null?e:re.isArray(e)?e.map(xm):String(e)}function US(e,t,n,r,o){return re.isFunction(r)?r.call(this,t,n):(o&&(t=n),re.isString(t)?re.isString(r)?t.indexOf(r)!==-1:re.isRegExp(r)?r.test(t):void 0:void 0)}class Um{constructor(t){t&&this.set(t)}set(t,n,r){let o=this;function c(h,f,m){let E=lh(f);if(!E)throw new Error("header name must be a non-empty string");let _=re.findKey(o,E);(!_||o[_]===void 0||m===!0||m===void 0&&o[_]!==!1)&&(o[_||f]=xm(h))}let d=(h,f)=>re.forEach(h,(m,E)=>c(m,E,f));if(re.isPlainObject(t)||t instanceof this.constructor)d(t,n);else if(re.isString(t)&&(t=Hn(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Hn(l=t).call(l)))d((h=>{let f={},m,E,_;return h&&h.split(`
`).forEach(function(v){var A,C;_=v.indexOf(":"),m=Hn(A=v.substring(0,_)).call(A).toLowerCase(),E=Hn(C=v.substring(_+1)).call(C),!m||f[m]&&fZ[m]||(m==="set-cookie"?f[m]?f[m].push(E):f[m]=[E]:f[m]=f[m]?f[m]+", "+E:E)}),f})(t),n);else if(re.isHeaders(t))for(let[h,f]of t.entries())c(f,h,r);else t!=null&&c(n,t,r);var l;return this}get(t,n){if(t=lh(t)){let r=re.findKey(this,t);if(r){let o=this[r];if(!n)return o;if(n===!0)return function(c){let d=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,h;for(;h=l.exec(c);)d[h[1]]=h[2];return d}(o);if(re.isFunction(n))return n.call(this,o,r);if(re.isRegExp(n))return n.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=lh(t)){let r=re.findKey(this,t);return!(!r||this[r]===void 0||n&&!US(0,this[r],r,n))}return!1}delete(t,n){let r=this,o=!1;function c(d){if(d=lh(d)){let l=re.findKey(r,d);!l||n&&!US(0,r[l],l,n)||(delete r[l],o=!0)}}return re.isArray(t)?t.forEach(c):c(t),o}clear(t){let n=Object.keys(this),r=n.length,o=!1;for(;r--;){let c=n[r];t&&!US(0,this[c],c,t,!0)||(delete this[c],o=!0)}return o}normalize(t){let n=this,r={};return re.forEach(this,(o,c)=>{var d;let l=re.findKey(r,c);if(l)return n[l]=xm(o),void delete n[c];let h=t?function(f){return Hn(f).call(f).toLowerCase().replace(/([a-z\d])(\w*)/g,(m,E,_)=>E.toUpperCase()+_)}(c):Hn(d=String(c)).call(d);h!==c&&delete n[c],n[h]=xm(o),r[h]=!0}),this}concat(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(t){let n=Object.create(null);return re.forEach(this,(r,o)=>{r!=null&&r!==!1&&(n[o]=t&&re.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[n,r]=t;return n+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let n=new this(t);for(var r=arguments.length,o=new Array(r>1?r-1:0),c=1;c<r;c++)o[c-1]=arguments[c];return o.forEach(d=>n.set(d)),n}static accessor(t){let n=(this[Ak]=this[Ak]={accessors:{}}).accessors,r=this.prototype;function o(c){let d=lh(c);n[d]||(function(l,h){let f=re.toCamelCase(" "+h);["get","set","has"].forEach(m=>{Object.defineProperty(l,m+f,{value:function(E,_,v){return this[m].call(this,h,E,_,v)},configurable:!0})})}(r,c),n[d]=!0)}return re.isArray(t)?t.forEach(o):o(t),this}}Um.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),re.reduceDescriptors(Um.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(o){this[r]=o}}}),re.freezeMethods(Um);var mo=Um;function FS(e,t){let n=this||xS,r=t||n,o=mo.from(r.headers),c=r.data;return re.forEach(e,function(d){c=d.call(n,c,o.normalize(),t?t.status:void 0)}),o.normalize(),c}function Dk(e){return!(!e||!e.__CANCEL__)}function Fd(e,t,n){ot.call(this,e??"canceled",ot.ERR_CANCELED,t,n),this.name="CanceledError"}function Ok(e,t,n){let r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new ot("Request failed with status code "+n.status,[ot.ERR_BAD_REQUEST,ot.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}re.inherits(Fd,ot,{__CANCEL__:!0});let Fm=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0,o=function(c,d){c=c||10;let l=new Array(c),h=new Array(c),f,m=0,E=0;return d=d!==void 0?d:1e3,function(_){let v=Date.now(),A=h[E];f||(f=v),l[m]=_,h[m]=v;let C=E,I=0;for(;C!==m;)I+=l[C++],C%=c;if(m=(m+1)%c,m===E&&(E=(E+1)%c),v-f<d)return;let O=A&&v-A;return O?Math.round(1e3*I/O):void 0}}(50,250);return function(c,d){let l,h,f=0,m=1e3/d,E=function(_){f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),l=null,h&&(clearTimeout(h),h=null),c.apply(null,_)};return[function(){let _=Date.now(),v=_-f;for(var A=arguments.length,C=new Array(A),I=0;I<A;I++)C[I]=arguments[I];v>=m?E(C,_):(l=C,h||(h=setTimeout(()=>{h=null,E(l)},m-v)))},()=>l&&E(l)]}(c=>{let d=c.loaded,l=c.lengthComputable?c.total:void 0,h=d-r,f=o(h);r=d,e({loaded:d,total:l,progress:l?d/l:void 0,bytes:h,rate:f||void 0,estimated:f&&l&&d<=l?(l-d)/f:void 0,event:c,lengthComputable:l!=null,[t?"download":"upload"]:!0})},n)},Nk=(e,t)=>{let n=e!=null;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},Pk=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return re.asap(()=>e(...n))};var mZ=Cr.hasStandardBrowserEnv?((e,t)=>n=>(n=new pm(n,Cr.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new pm(Cr.origin),Cr.navigator&&/(msie|trident)/i.test(Cr.navigator.userAgent)):()=>!0,gZ=Cr.hasStandardBrowserEnv?{write(e,t,n,r,o,c){let d=[e+"="+encodeURIComponent(t)];re.isNumber(n)&&d.push("expires="+new Date(n).toGMTString()),re.isString(r)&&d.push("path="+r),re.isString(o)&&d.push("domain="+o),c===!0&&d.push("secure"),document.cookie=d.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Mk(e,t){return e&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(t)?function(n,r){return r?n.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):n}(e,t):t}function kk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}let Lk=e=>e instanceof mo?function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?kk(Object(r),!0).forEach(function(o){b(t,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kk(Object(r)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(r,o))})}return t}({},e):e;function sc(e,t){t=t||{};let n={};function r(f,m,E,_){return re.isPlainObject(f)&&re.isPlainObject(m)?re.merge.call({caseless:_},f,m):re.isPlainObject(m)?re.merge({},m):re.isArray(m)?m.slice():m}function o(f,m,E,_){return re.isUndefined(m)?re.isUndefined(f)?void 0:r(void 0,f,0,_):r(f,m,0,_)}function c(f,m){if(!re.isUndefined(m))return r(void 0,m)}function d(f,m){return re.isUndefined(m)?re.isUndefined(f)?void 0:r(void 0,f):r(void 0,m)}function l(f,m,E){return E in t?r(f,m):E in e?r(void 0,f):void 0}let h={url:c,method:c,data:c,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,withXSRFToken:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:l,headers:(f,m,E)=>o(Lk(f),Lk(m),0,!0)};return re.forEach(Object.keys(Object.assign({},e,t)),function(f){let m=h[f]||o,E=m(e[f],t[f],f);re.isUndefined(E)&&m!==l||(n[f]=E)}),n}var xk=e=>{let t=sc({},e),n,{data:r,withXSRFToken:o,xsrfHeaderName:c,xsrfCookieName:d,headers:l,auth:h}=t;if(t.headers=l=mo.from(l),t.url=QP(Mk(t.baseURL,t.url),e.params,e.paramsSerializer),h&&l.set("Authorization","Basic "+btoa((h.username||"")+":"+(h.password?unescape(encodeURIComponent(h.password)):""))),re.isFormData(r)){if(Cr.hasStandardBrowserEnv||Cr.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((n=l.getContentType())!==!1){let[f,...m]=n?n.split(";").map(E=>Hn(E).call(E)).filter(Boolean):[];l.setContentType([f||"multipart/form-data",...m].join("; "))}}if(Cr.hasStandardBrowserEnv&&(o&&re.isFunction(o)&&(o=o(t)),o||o!==!1&&mZ(t.url))){let f=c&&d&&gZ.read(d);f&&l.set(c,f)}return t},EZ=typeof XMLHttpRequest<"u"&&function(e){return new ie(function(t,n){let r=xk(e),o=r.data,c=mo.from(r.headers).normalize(),d,l,h,f,m,{responseType:E,onUploadProgress:_,onDownloadProgress:v}=r;function A(){f&&f(),m&&m(),r.cancelToken&&r.cancelToken.unsubscribe(d),r.signal&&r.signal.removeEventListener("abort",d)}let C=new XMLHttpRequest;function I(){if(!C)return;let N=mo.from("getAllResponseHeaders"in C&&C.getAllResponseHeaders());Ok(function(x){t(x),A()},function(x){n(x),A()},{data:E&&E!=="text"&&E!=="json"?C.response:C.responseText,status:C.status,statusText:C.statusText,headers:N,config:e,request:C}),C=null}C.open(r.method.toUpperCase(),r.url,!0),C.timeout=r.timeout,"onloadend"in C?C.onloadend=I:C.onreadystatechange=function(){C&&C.readyState===4&&(C.status!==0||C.responseURL&&C.responseURL.indexOf("file:")===0)&&setTimeout(I)},C.onabort=function(){C&&(n(new ot("Request aborted",ot.ECONNABORTED,e,C)),C=null)},C.onerror=function(){n(new ot("Network Error",ot.ERR_NETWORK,e,C)),C=null},C.ontimeout=function(){let N=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",x=r.transitional||eM;r.timeoutErrorMessage&&(N=r.timeoutErrorMessage),n(new ot(N,x.clarifyTimeoutError?ot.ETIMEDOUT:ot.ECONNABORTED,e,C)),C=null},o===void 0&&c.setContentType(null),"setRequestHeader"in C&&re.forEach(c.toJSON(),function(N,x){C.setRequestHeader(x,N)}),re.isUndefined(r.withCredentials)||(C.withCredentials=!!r.withCredentials),E&&E!=="json"&&(C.responseType=r.responseType),v&&([h,m]=Fm(v,!0),C.addEventListener("progress",h)),_&&C.upload&&([l,f]=Fm(_),C.upload.addEventListener("progress",l),C.upload.addEventListener("loadend",f)),(r.cancelToken||r.signal)&&(d=N=>{C&&(n(!N||N.type?new Fd(null,e,C):N),C.abort(),C=null)},r.cancelToken&&r.cancelToken.subscribe(d),r.signal&&(r.signal.aborted?d():r.signal.addEventListener("abort",d)));let O=function(N){let x=/^([-+\w]{1,25})(:?\/\/|:)/.exec(N);return x&&x[1]||""}(r.url);O&&Cr.protocols.indexOf(O)===-1?n(new ot("Unsupported protocol "+O+":",ot.ERR_BAD_REQUEST,e)):C.send(o||null)})},_Z=(e,t)=>{let{length:n}=e=e?e.filter(Boolean):[];if(t||n){let r,o=new AbortController,c=function(f){if(!r){r=!0,l();let m=f instanceof Error?f:this.reason;o.abort(m instanceof ot?m:new Fd(m instanceof Error?m.message:m))}},d=t&&setTimeout(()=>{d=null,c(new ot("timeout ".concat(t," of ms exceeded"),ot.ETIMEDOUT))},t),l=()=>{e&&(d&&clearTimeout(d),d=null,e.forEach(f=>{f.unsubscribe?f.unsubscribe(c):f.removeEventListener("abort",c)}),e=null)};e.forEach(f=>f.addEventListener("abort",c));let{signal:h}=o;return h.unsubscribe=()=>re.asap(l),h}},VS=a(SO),Uk=Md.f("asyncIterator"),vZ=a(Uk);function jS(e,t){this.v=e,this.k=t}function hh(e){var t,n;function r(c,d){try{var l=e[c](d),h=l.value,f=h instanceof jS;VS.resolve(f?h.v:h).then(function(m){if(f){var E=c==="return"?"return":"next";if(!h.k||m.done)return r(E,m);m=e[E](m).value}o(l.done?"return":"normal",m)},function(m){r("throw",m)})}catch(m){o("throw",m)}}function o(c,d){switch(c){case"return":t.resolve({value:d,done:!0});break;case"throw":t.reject(d);break;default:t.resolve({value:d,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(c,d){return new VS(function(l,h){var f={key:c,arg:d,resolve:l,reject:h,next:null};n?n=n.next=f:(t=n=f,r(c,d))})},typeof e.return!="function"&&(this.return=void 0)}function ui(e){return function(){return new hh(e.apply(this,arguments))}}function Ue(e){return new jS(e,0)}function Vm(e){var t={},n=!1;function r(o,c){return n=!0,{done:!1,value:new jS(c=new VS(function(d){d(e[o](c))}),1)}}return t[Ud!==void 0&&lk||"@@iterator"]=function(){return this},t.next=function(o){return n?(n=!1,o):r("next",o)},typeof e.throw=="function"&&(t.throw=function(o){if(n)throw n=!1,o;return r("throw",o)}),typeof e.return=="function"&&(t.return=function(o){return n?(n=!1,o):r("return",o)}),t}hh.prototype[typeof Ud=="function"&&vZ||"@@asyncIterator"]=function(){return this},hh.prototype.next=function(e){return this._invoke("next",e)},hh.prototype.throw=function(e){return this._invoke("throw",e)},hh.prototype.return=function(e){return this._invoke("return",e)};var BS=a(Uk);function HS(e){var t,n,r,o=2;for(typeof Symbol<"u"&&(n=BS,r=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new jm(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function jm(e){function t(n){if(Object(n)!==n)return ie.reject(new TypeError(n+" is not an object."));var r=n.done;return ie.resolve(n.value).then(function(o){return{value:o,done:r}})}return jm=function(n){this.s=n,this.n=n.next},jm.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ie.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ie.reject(n):t(r.apply(this.s,arguments))}},new jm(e)}let yZ=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,o=0;for(;o<n;)r=o+t,yield e.slice(o,r),o=r},TZ=function(){var e=ui(function*(t,n){var r,o=!1,c=!1;try{for(var d,l=HS(SZ(t));o=!(d=yield Ue(l.next())).done;o=!1){let h=d.value;yield*ip(Vm(HS(yZ(h,n))))}}catch(h){c=!0,r=h}finally{try{o&&l.return!=null&&(yield Ue(l.return()))}finally{if(c)throw r}}});return function(t,n){return e.apply(this,arguments)}}(),SZ=function(){var e=ui(function*(t){if(t[BS])return void(yield*ip(Vm(HS(t))));let n=t.getReader();try{for(;;){let{done:r,value:o}=yield Ue(n.read());if(r)break;yield o}}finally{yield Ue(n.cancel())}});return function(t){return e.apply(this,arguments)}}(),Fk=(e,t,n,r)=>{let o=TZ(e,t),c,d=0,l=f=>{c||(c=!0,r&&r(f))};return new ReadableStream({pull(f){return P(this,null,function*(){try{let{done:m,value:E}=yield o.next();if(m)return l(),void f.close();let _=E.byteLength;if(n){let v=d+=_;n(v)}f.enqueue(new Uint8Array(E))}catch(m){throw l(m),m}})},cancel:f=>(l(f),o.return())},{highWaterMark:2})};function Vk(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function jk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Vk(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vk(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Bm=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Bk=Bm&&typeof ReadableStream=="function",CZ=Bm&&(typeof TextEncoder=="function"?(Hk=new TextEncoder,e=>Hk.encode(e)):e=>P(this,null,function*(){return new Uint8Array(yield new Response(e).arrayBuffer())}));var Hk;let Gk=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch{return!1}},IZ=Bk&&Gk(()=>{let e=!1,t=new Request(Cr.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),GS=Bk&&Gk(()=>re.isReadableStream(new Response("").body)),Hm={stream:GS&&(e=>e.body)};var Wk;Bm&&(Wk=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Hm[e]&&(Hm[e]=re.isFunction(Wk[e])?t=>t[e]():(t,n)=>{throw new ot("Response type '".concat(e,"' is not supported"),ot.ERR_NOT_SUPPORT,n)})}));let RZ=(e,t)=>P(this,null,function*(){let n=re.toFiniteNumber(e.getContentLength());return n??(r=>P(this,null,function*(){return r==null?0:re.isBlob(r)?r.size:re.isSpecCompliantForm(r)?(yield new Request(Cr.origin,{method:"POST",body:r}).arrayBuffer()).byteLength:re.isArrayBufferView(r)||re.isArrayBuffer(r)?r.byteLength:(re.isURLSearchParams(r)&&(r+=""),re.isString(r)?(yield CZ(r)).byteLength:void 0)}))(t)});var wZ=Bm&&(e=>P(this,null,function*(){let{url:t,method:n,data:r,signal:o,cancelToken:c,timeout:d,onDownloadProgress:l,onUploadProgress:h,responseType:f,headers:m,withCredentials:E="same-origin",fetchOptions:_}=xk(e);f=f?(f+"").toLowerCase():"text";let v,A=_Z([o,c&&c.toAbortSignal()],d),C=A&&A.unsubscribe&&(()=>{A.unsubscribe()}),I;try{if(h&&IZ&&n!=="get"&&n!=="head"&&(I=yield RZ(m,r))!==0){let j,F=new Request(t,{method:"POST",body:r,duplex:"half"});if(re.isFormData(r)&&(j=F.headers.get("content-type"))&&m.setContentType(j),F.body){let[W,X]=Nk(I,Fm(Pk(h)));r=Fk(F.body,65536,W,X)}}re.isString(E)||(E=E?"include":"omit");let O="credentials"in Request.prototype;v=new Request(t,jk(jk({},_),{},{signal:A,method:n.toUpperCase(),headers:m.normalize().toJSON(),body:r,duplex:"half",credentials:O?E:void 0}));let N=yield fetch(v),x=GS&&(f==="stream"||f==="response");if(GS&&(l||x&&C)){let j={};["status","statusText","headers"].forEach(oe=>{j[oe]=N[oe]});let F=re.toFiniteNumber(N.headers.get("content-length")),[W,X]=l&&Nk(F,Fm(Pk(l),!0))||[];N=new Response(Fk(N.body,65536,W,()=>{X&&X(),C&&C()}),j)}f=f||"text";let B=yield Hm[re.findKey(Hm,f)||"text"](N,e);return!x&&C&&C(),yield new ie((j,F)=>{Ok(j,F,{data:B,headers:mo.from(N.headers),status:N.status,statusText:N.statusText,config:e,request:v})})}catch(O){throw C&&C(),O&&O.name==="TypeError"&&/fetch/i.test(O.message)?Object.assign(new ot("Network Error",ot.ERR_NETWORK,e,v),{cause:O.cause||O}):ot.from(O,O&&O.code,e,v)}}));let Kk={http:null,xhr:EZ,fetch:wZ};re.forEach(Kk,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let qk=e=>"- ".concat(e),bZ=e=>re.isFunction(e)||e===null||e===!1;var zk=e=>{e=re.isArray(e)?e:[e];let{length:t}=e,n,r,o={};for(let c=0;c<t;c++){let d;if(n=e[c],r=n,!bZ(n)&&(r=Kk[(d=String(n)).toLowerCase()],r===void 0))throw new ot("Unknown adapter '".concat(d,"'"));if(r)break;o[d||"#"+c]=r}if(!r){let c=Object.entries(o).map(d=>{let[l,h]=d;return"adapter ".concat(l," ")+(h===!1?"is not supported by the environment":"is not available in the build")});throw new ot("There is no suitable adapter to dispatch the request "+(t?c.length>1?`since :
`+c.map(qk).join(`
`):" "+qk(c[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r};function WS(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Fd(null,e)}function Yk(e){return WS(e),e.headers=mo.from(e.headers),e.data=FS.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),zk(e.adapter||xS.adapter)(e).then(function(t){return WS(e),t.data=FS.call(e,e.transformResponse,t),t.headers=mo.from(t.headers),t},function(t){return Dk(t)||(WS(e),t&&t.response&&(t.response.data=FS.call(e,e.transformResponse,t.response),t.response.headers=mo.from(t.response.headers))),ie.reject(t)})}let AZ="1.7.9",Gm={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Gm[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});let $k={};Gm.transitional=function(e,t,n){function r(o,c){return"[Axios v1.7.9] Transitional option '"+o+"'"+c+(n?". "+n:"")}return(o,c,d)=>{if(e===!1)throw new ot(r(c," has been removed"+(t?" in "+t:"")),ot.ERR_DEPRECATED);return t&&!$k[c]&&($k[c]=!0,console.warn(r(c," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(o,c,d)}},Gm.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var Wm={assertOptions:function(e,t,n){if(typeof e!="object")throw new ot("options must be an object",ot.ERR_BAD_OPTION_VALUE);let r=Object.keys(e),o=r.length;for(;o-- >0;){let c=r[o],d=t[c];if(d){let l=e[c],h=l===void 0||d(l,c,e);if(h!==!0)throw new ot("option "+c+" must be "+h,ot.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new ot("Unknown option "+c,ot.ERR_BAD_OPTION)}},validators:Gm};let Go=Wm.validators,Km=class{constructor(e){this.defaults=e,this.interceptors={request:new ZP,response:new ZP}}request(e,t){return P(this,null,function*(){try{return yield this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;let o=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}catch{}}throw n}})}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=sc(this.defaults,t);let{transitional:n,paramsSerializer:r,headers:o}=t;n!==void 0&&Wm.assertOptions(n,{silentJSONParsing:Go.transitional(Go.boolean),forcedJSONParsing:Go.transitional(Go.boolean),clarifyTimeoutError:Go.transitional(Go.boolean)},!1),r!=null&&(re.isFunction(r)?t.paramsSerializer={serialize:r}:Wm.assertOptions(r,{encode:Go.function,serialize:Go.function},!0)),Wm.assertOptions(t,{baseUrl:Go.spelling("baseURL"),withXsrfToken:Go.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let c=o&&re.merge(o.common,o[t.method]);o&&re.forEach(["delete","get","head","post","put","patch","common"],v=>{delete o[v]}),t.headers=mo.concat(c,o);let d=[],l=!0;this.interceptors.request.forEach(function(v){typeof v.runWhen=="function"&&v.runWhen(t)===!1||(l=l&&v.synchronous,d.unshift(v.fulfilled,v.rejected))});let h=[],f;this.interceptors.response.forEach(function(v){h.push(v.fulfilled,v.rejected)});let m,E=0;if(!l){let v=[Yk.bind(this),void 0];for(v.unshift.apply(v,d),v.push.apply(v,h),m=v.length,f=ie.resolve(t);E<m;)f=f.then(v[E++],v[E++]);return f}m=d.length;let _=t;for(E=0;E<m;){let v=d[E++],A=d[E++];try{_=v(_)}catch(C){A.call(this,C);break}}try{f=Yk.call(this,_)}catch(v){return ie.reject(v)}for(E=0,m=h.length;E<m;)f=f.then(h[E++],h[E++]);return f}getUri(e){return QP(Mk((e=sc(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};re.forEach(["delete","get","head","options"],function(e){Km.prototype[e]=function(t,n){return this.request(sc(n||{},{method:e,url:t,data:(n||{}).data}))}}),re.forEach(["post","put","patch"],function(e){function t(n){return function(r,o,c){return this.request(sc(c||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:o}))}}Km.prototype[e]=t(),Km.prototype[e+"Form"]=t(!0)});var qm=Km;class KS{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new ie(function(o){n=o});let r=this;this.promise.then(o=>{if(!r._listeners)return;let c=r._listeners.length;for(;c-- >0;)r._listeners[c](o);r._listeners=null}),this.promise.then=o=>{let c,d=new ie(l=>{r.subscribe(l),c=l}).then(o);return d.cancel=function(){r.unsubscribe(c)},d},t(function(o,c,d){r.reason||(r.reason=new Fd(o,c,d),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){let t=new AbortController,n=r=>{t.abort(r)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new KS(function(r){t=r}),cancel:t}}}var DZ=KS;let qS={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(qS).forEach(e=>{let[t,n]=e;qS[n]=t});var OZ=qS;let Fn=function e(t){let n=new qm(t),r=kP(qm.prototype.request,n);return re.extend(r,qm.prototype,n,{allOwnKeys:!0}),re.extend(r,n,null,{allOwnKeys:!0}),r.create=function(o){return e(sc(t,o))},r}(xS);Fn.Axios=qm,Fn.CanceledError=Fd,Fn.CancelToken=DZ,Fn.isCancel=Dk,Fn.VERSION=AZ,Fn.toFormData=Rm,Fn.AxiosError=ot,Fn.Cancel=Fn.CanceledError,Fn.all=function(e){return ie.all(e)},Fn.spread=function(e){return function(t){return e.apply(null,t)}},Fn.isAxiosError=function(e){return re.isObject(e)&&e.isAxiosError===!0},Fn.mergeConfig=sc,Fn.AxiosHeaders=mo,Fn.formToJSON=e=>bk(re.isHTMLForm(e)?new FormData(e):e),Fn.getAdapter=zk,Fn.HttpStatusCode=OZ,Fn.default=Fn;var pr=Fn;let NZ=()=>{};function ph(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:NZ};return e.promise=new ie((t,n)=>{e.resolve=r=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(r),e.value=r)},e.reject=r=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(r))}}),e}let zm=new Map,Ym=new Map,Wo=new Map,ln=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),ze=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),zS=new Z7,go=zS.getResult(),YS=null;function Be(e){if(!YS){e&&zS.setUA(e),go=zS.getResult();let t=function(l){if(l.engine.name==="Blink"&&l.browser.name!=="WeChat")return ze.CHROME;switch(l.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return ze.CHROME;case"Safari":case"Mobile Safari":return ze.SAFARI;case"Edge":return ze.EDGE;case"Firefox":return ze.FIREFOX;case"QQ":case"QQBrowser":return ze.QQ;case"Opera":return ze.OPERA;case"WeChat":return ze.WECHAT;default:return l.browser.name||""}}(go),n=Xk(go),r=function(l){return l.os.name==="Windows"?l.os.version?l.os.name+" "+l.os.version:l.os.name:l.os.name||""}(go),o=go.os.version,c=Xk(go,!1),d=go.device.type;if(!(t&&n&&r&&o))return{name:t,version:n,os:r,osVersion:o,browserVersion:c,deviceType:d};YS={name:t,version:n,os:r,osVersion:o,browserVersion:c,deviceType:d}}return YS}function Xk(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function $m(){return Be().os}function Jk(){let e=Be();return"".concat(e.os," ").concat(e.osVersion)}function Xm(){let e=Be();return!!(go.engine.name==="WebKit"&&e.os===ln.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==ze.SAFARI||nr()&&e.name!==ze.SAFARI)}function Ts(){return Be().name===ze.CHROME}function wn(){return Be().name===ze.SAFARI}function Qk(){return Be().name===ze.EDGE}function xt(){return Be().name===ze.FIREFOX}function nr(){return Be().os===ln.IOS}function Vd(e){let t=Be();return!(t.name!==ze.CHROME||!t.osVersion)&&Number(t.version)>=e}function Zk(e){let t=Be();return!(t.name!==ze.CHROME||!t.osVersion)&&Number(t.version)<e}function $S(e,t,n){let r=Be();return!(r.name!==e||!r.osVersion)&&(n?Number(r.version)>=t&&Number(r.version)<=n:Number(r.version)===t)}function XS(e){let t=Be();return!(t.name!==ze.EDGE||!t.osVersion)&&Number(t.version)>=e}function eL(e){let t=Be();return!(t.name!==ze.SAFARI||!t.osVersion)&&Number(t.version)>=e}function tL(e,t,n){let r=Be();if(r.os!==ln.IOS||!r.osVersion)return!1;let o=r.osVersion.split(".");return n?t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e:t?Number(o[0])===e&&Number(o[1])<=t||Number(o[0])<e:Number(o[0])<=e}function nL(e,t,n){let r=Be();if(r.name!==ze.SAFARI||!r.osVersion||!r.browserVersion)return!1;let o=r.browserVersion.split(".");return n?t&&Number(o[0])===e&&Number(o[1])<t||Number(o[0])<e:t?Number(o[0])===e&&Number(o[1])<=t||Number(o[0])<e:Number(o[0])<=e}function JS(e){let t=Be();return!(t.name!==ze.OPERA||!t.osVersion)&&Number(t.version)>=e}function rL(){let e=Be();if(e.os!==ln.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function jd(){let e=Be();if(e.os!==ln.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function QS(){let e=Be();if(e.os!==ln.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function iL(){let e=Be();if(e.os!==ln.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Bi(){return wn()&&navigator.maxTouchPoints>0}function oL(){return Be().name===ze.WECHAT}function sL(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function ZS(){let e=$m();return function(){let{deviceType:t}=Be();return t==="mobile"||t==="tablet"}()||e===ln.ANDROID||e===ln.IOS||e===ln.HARMONY_OS}function Ss(){let e=Be();return e.name!==ze.EDGE&&e.name!==ze.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Jm(){return $m()===ln.ANDROID}function fh(){let e=Be();return Jm()&&(e.name===ze.CHROME||e.name===ze.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Te(e,t,n){return(t=function(r){var o=function(c){if(typeof c!="object"||!c)return c;var d=c[Symbol.toPrimitive];if(d!==void 0){var l=d.call(c,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(r);return typeof o=="symbol"?o:o+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function aL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?aL(Object(n),!0).forEach(function(r){Te(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let D=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({});class K extends Error{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(n),Te(this,"code",void 0),Te(this,"message",void 0),Te(this,"data",void 0),Te(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=r}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return t==="error"&&(n||console).error(this.toString()),t==="warning"&&(n||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}}function Cs(e,t){if(typeof e!="boolean")throw new K(D.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function dn(e,t,n){if(!ne(n).call(n,e))throw new K(D.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function st(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(o){return typeof o=="number"&&o%1==0}(e))throw new K(D.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function eC(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new K(D.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&st(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&st(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&st(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&st(e.ideal,"".concat(t,".ideal"),1,1/0)}else st(e,t,1,1/0)}function Tn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new K(D.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!cL(e,n,r,o))throw new K(D.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(o?" ASCII characters only.":""))}function Is(e,t){if(!Array.isArray(e))throw new K(D.INVALID_PARAMS,"".concat(t," should be an array"))}function Mt(e){return e==null}function cL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||function(o){if(typeof o!="string")return!1;for(let c=0;c<o.length;c+=1){let d=o.charCodeAt(c);if(d<0||d>255)return!1}return!0}(e))}var mh=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(mh||{}),tC=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(tC||{});let dL=new class{constructor(){Te(this,"_clientSize",null),Te(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Te(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Te(this,"getStyle",e=>window.getComputedStyle(e,null)),Te(this,"checkCssVisibleProperty",e=>{var t;let n=!0,r=this.getStyle(e),{display:o,visibility:c,opacity:d,filter:l}=r;return(o==="none"||ne(t=["hidden","collapse"]).call(t,c)||Number(d)<.1)&&(n=!1),!!n&&(l&&l.split(" ").filter(h=>{var f;let m=h.split("(")[0];return ne(f=["brightness","blur","opacity"]).call(f,m)}).map(h=>{let[f,m]=h.split(/\(|\)/);return[f,Number(m.match(/^[0-9\.]+/))]}).forEach(h=>{let[f,m]=h;switch(f){case"brightness":(m<.1||m>3)&&(n=!1);break;case"blur":m>3&&(n=!1);break;case"opacity":m<.1&&(n=!1)}}),n)}),Te(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0,o=d=>t(d),c=e;for(;c&&r;)o(c)||(n=!1,r=!1),c=c.parentElement,c||(r=!1);return n}),Te(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Te(this,"getSizeAboutClient",e=>{let{width:t,height:n,left:r,right:o,top:c,bottom:d}=e.getBoundingClientRect(),l=this.getClientWidth(),h=this.getClientHeight();return{width:t,height:n,left:r,right:o,top:c,bottom:d,clientWidth:l,clientHeight:h,clientMin:Math.min(l,h)}}),Te(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),Te(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Te(this,"checkCoverForAPoint",(e,t,n)=>{let r=this.elementFromPoint(e,t);return r!==null&&r!==n}),Te(this,"getPointPositionList",()=>{let{width:e,height:t,left:n,top:r}=this._clientSize,o=e/6,c=t/6,d=[],l=10**6;for(let h=0;h<5;h++)for(let f=0;f<5;f++){let m=(n*l+(h===0?.1:h===4?(o*h*l-1e5)/l:o*h)*l)/l,E=(r*l+(f===0?.1:f===4?(c*f*l-1e5)/l:c*f)*l)/l;d.push({x:m,y:E})}return[...d]}),Te(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),Te(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),Te(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:n,bottom:r,clientHeight:o,clientWidth:c,clientMin:d}=this._clientSize,l,h,f,m;if(e<0)l=0;else{if(!(e<c))return!1;l=e}if(t<0)return!1;if(h=t<c?t:c,n<0)f=0;else{if(!(n<o))return!1;f=n}if(r<0)return!1;m=r<o?r:o;let E=h-l,_=m-f;return this.checkSizeIsVisible(E,_,d)}),Te(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Te(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(mh.COVERED);{let t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(mh.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(mh.SIZE)}}return this.returnHiddenResult(mh.STYLE)}return this.returnHiddenResult(tC.UNMOUNTED)}return this.returnHiddenResult(tC.INVALID_HTML_ELEMENT)}),Te(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function nC(e){return new TextEncoder().encode(e)}let uL=function(e,t){let n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},rC=e=>P(this,null,function*(){return function(t,n){let r="";return new Uint8Array(t).forEach(o=>{r+=o.toString(n).padStart(2,"0")}),r}(yield crypto.subtle.digest("SHA-256",nC(e)),16)}),Dt=class{constructor(){Te(this,"_events",{}),Te(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let n=this._events[e],r=this._indexOfListener(n,t);r!==-1&&n.splice(r,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(c=>c);for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];for(let c=0;c<t.length;c+=1){let d=t[c];d.once&&this.off(e,d.listener),d.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach(o=>{o.once&&this.off(e,o.listener);try{o.listener.apply(this,n)}catch(c){console.error("safeEmit event:".concat(e," error ").concat(c?.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}},gh=null;function lL(){if(gh)return gh;if(window.electron)return gh=window.electron;if(!window.require)return null;try{return gh=window.require("electron"),gh}catch{return null}}let tn=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),kt=function(e){return e.TRACER="tracer",e}({});function hL(e){return st(e.timeout,"config.timeout",0,1e5),st(e.timeoutFactor,"config.timeoutFactor",0,100,!1),st(e.maxRetryCount,"config.maxRetryConfig",0,1/0),st(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let PZ=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Ye=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Eh(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function pL(e){return Tn(e.turnServerURL,"turnServerURL"),Tn(e.username,"username"),Tn(e.password,"password"),e.udpport&&st(e.udpport,"udpport",1,99999,!0),e.forceturn&&Cs(e.forceturn,"forceturn"),e.security&&Cs(e.security,"security"),e.tcpport&&st(e.tcpport,"tcpport",1,99999,!0),!0}function iC(e){return e.level!==void 0&&dn(e.level,"level",[1,2,3]),e.delay!==void 0&&st(e.delay,"delay",0,3e3,!0),!0}let Oe=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),bn=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Lr=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Bd=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function An(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return e.getListeners(t).length===0?ie.reject(new K(D.UNEXPECTED_ERROR,"can not emit promise")):new ie((c,d)=>{e.emit(t,...r,c,d)})}function lt(e,t){if(e.getListeners(t).length===0)return ie.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return An(e,t,...r)}function qr(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return _h(e,t,...r)}function _h(e,t){let n=null,r=null;for(var o=arguments.length,c=new Array(o>2?o-2:0),d=2;d<o;d++)c[d-2]=arguments[d];if(e.emit(t,...c,l=>{n=l},l=>{r=l}),r!==null)throw r;if(n===null)throw new K(D.UNEXPECTED_ERROR,"handler is not sync");return n}let $t=new class extends Dt{set networkState(e){this.emit(Bd.NETWORK_STATE_CHANGE,e,this._networkState),e===Lr.ONLINE?this.emit(Bd.ONLINE):e===Lr.OFFLINE&&(this.onlineWaiter=new ie(t=>{this.once(Bd.ONLINE,()=>{this.onlineWaiter=void 0,t(Lr.ONLINE)})}),this.emit(Bd.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Lr.ONLINE}constructor(){super(),Te(this,"_moduleName","network-indicator"),Te(this,"_networkState",Lr.ONLINE),Te(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Lr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Lr.OFFLINE})}};function Qm(e,t){let n=e.indexOf(t);n!==-1&&e.splice(n,1)}function Hd(e){let t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function Zm(e){ie!==void 0?ie.resolve().then(e):setTimeout(e,0)}function Ut(e){return JSON.parse(JSON.stringify(e))}function ac(e){try{return Ut(e)}catch{return e}}let fL={};function ca(e,t){fL[t]||(fL[t]=!0,e())}function cc(e){let t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function da(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function mL(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){let r=new Uint8Array(t);r.set(n),n=r}return n}function gL(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=co(t).call(t,(d,l)=>d+l.length,0),o=new Uint8Array(new ArrayBuffer(r)),c=0;return t.forEach(d=>{o.set(d,c),c+=d.length}),o}function Ko(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function EL(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(n=>{t+=typeof n=="string"?Ko(n):n.size}),t+138}function MZ(e){let t=new K(D.TIMEOUT,"timeout");return new ie((n,r)=>{window.setTimeout(()=>r(t),e)})}function Sn(e){return new ie(t=>{window.setTimeout(t,e)})}function ht(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+ht(e-n.length,"")}function dc(){return ht(32,"").toUpperCase()}let eg=()=>{},_L=new class{constructor(){Te(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var o=arguments.length,c=new Array(o>4?o-4:0),d=4;d<o;d++)c[d-4]=arguments[d];if(this.fnMap.has(t)){let l=this.fnMap.get(t);if(l.threshold!==n){l.fn(...l.args),clearTimeout(l.timer);let h=window.setTimeout(()=>{let f=this.fnMap.get(t);f&&f.fn(...f.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:h,args:c,skipFn:r})}else l.skipFn&&l.skipFn(...l.args),this.fnMap.set(t,ae(ae({},l),{},{fn:e,args:c,skipFn:r}))}else{let l=window.setTimeout(()=>{let h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:l,args:c,skipFn:r})}}},vL=_L.throttleByKey.bind(_L);function yL(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function oC(e,t){if(!yL(e)||!yL(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let n=[...e];for(let r=0;r<t.length;r++)n[r]=oC(e[r],t[r]);return n}{let n=ae({},e);for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?n[r]=oC(e[r],t[r]):n[r]=t[r]);return n}}function TL(e,t){let n=[0];if(t&&(n=new Array(t).fill(0)),e===0)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,!t||r!==t););return n}function sC(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function SL(e){let t="0123456789abcdef";function n(x){let B,j="";for(B=0;B<=3;B++)j+=t.charAt(x>>8*B+4&15)+t.charAt(x>>8*B&15);return j}function r(x,B){let j=(65535&x)+(65535&B);return(x>>16)+(B>>16)+(j>>16)<<16|65535&j}function o(x,B,j,F,W,X){return r(function(oe,te){return oe<<te|oe>>>32-te}(r(r(B,x),r(F,X)),W),j)}function c(x,B,j,F,W,X,oe){return o(B&j|~B&F,x,B,W,X,oe)}function d(x,B,j,F,W,X,oe){return o(B&F|j&~F,x,B,W,X,oe)}function l(x,B,j,F,W,X,oe){return o(B^j^F,x,B,W,X,oe)}function h(x,B,j,F,W,X,oe){return o(j^(B|~F),x,B,W,X,oe)}let f=function(x){let B,j=1+(x.length+8>>6),F=new Array(16*j);for(B=0;B<16*j;B++)F[B]=0;for(B=0;B<x.length;B++)F[B>>2]|=x.charCodeAt(B)<<B%4*8;return F[B>>2]|=128<<B%4*8,F[16*j-2]=8*x.length,F}(e),m,E,_,v,A,C=1732584193,I=-271733879,O=-1732584194,N=271733878;for(m=0;m<f.length;m+=16)E=C,_=I,v=O,A=N,C=c(C,I,O,N,f[m+0],7,-680876936),N=c(N,C,I,O,f[m+1],12,-389564586),O=c(O,N,C,I,f[m+2],17,606105819),I=c(I,O,N,C,f[m+3],22,-1044525330),C=c(C,I,O,N,f[m+4],7,-176418897),N=c(N,C,I,O,f[m+5],12,1200080426),O=c(O,N,C,I,f[m+6],17,-1473231341),I=c(I,O,N,C,f[m+7],22,-45705983),C=c(C,I,O,N,f[m+8],7,1770035416),N=c(N,C,I,O,f[m+9],12,-1958414417),O=c(O,N,C,I,f[m+10],17,-42063),I=c(I,O,N,C,f[m+11],22,-1990404162),C=c(C,I,O,N,f[m+12],7,1804603682),N=c(N,C,I,O,f[m+13],12,-40341101),O=c(O,N,C,I,f[m+14],17,-1502002290),I=c(I,O,N,C,f[m+15],22,1236535329),C=d(C,I,O,N,f[m+1],5,-165796510),N=d(N,C,I,O,f[m+6],9,-1069501632),O=d(O,N,C,I,f[m+11],14,643717713),I=d(I,O,N,C,f[m+0],20,-373897302),C=d(C,I,O,N,f[m+5],5,-701558691),N=d(N,C,I,O,f[m+10],9,38016083),O=d(O,N,C,I,f[m+15],14,-660478335),I=d(I,O,N,C,f[m+4],20,-405537848),C=d(C,I,O,N,f[m+9],5,568446438),N=d(N,C,I,O,f[m+14],9,-1019803690),O=d(O,N,C,I,f[m+3],14,-187363961),I=d(I,O,N,C,f[m+8],20,1163531501),C=d(C,I,O,N,f[m+13],5,-1444681467),N=d(N,C,I,O,f[m+2],9,-51403784),O=d(O,N,C,I,f[m+7],14,1735328473),I=d(I,O,N,C,f[m+12],20,-1926607734),C=l(C,I,O,N,f[m+5],4,-378558),N=l(N,C,I,O,f[m+8],11,-2022574463),O=l(O,N,C,I,f[m+11],16,1839030562),I=l(I,O,N,C,f[m+14],23,-35309556),C=l(C,I,O,N,f[m+1],4,-1530992060),N=l(N,C,I,O,f[m+4],11,1272893353),O=l(O,N,C,I,f[m+7],16,-155497632),I=l(I,O,N,C,f[m+10],23,-1094730640),C=l(C,I,O,N,f[m+13],4,681279174),N=l(N,C,I,O,f[m+0],11,-358537222),O=l(O,N,C,I,f[m+3],16,-722521979),I=l(I,O,N,C,f[m+6],23,76029189),C=l(C,I,O,N,f[m+9],4,-640364487),N=l(N,C,I,O,f[m+12],11,-421815835),O=l(O,N,C,I,f[m+15],16,530742520),I=l(I,O,N,C,f[m+2],23,-995338651),C=h(C,I,O,N,f[m+0],6,-198630844),N=h(N,C,I,O,f[m+7],10,1126891415),O=h(O,N,C,I,f[m+14],15,-1416354905),I=h(I,O,N,C,f[m+5],21,-57434055),C=h(C,I,O,N,f[m+12],6,1700485571),N=h(N,C,I,O,f[m+3],10,-1894986606),O=h(O,N,C,I,f[m+10],15,-1051523),I=h(I,O,N,C,f[m+1],21,-2054922799),C=h(C,I,O,N,f[m+8],6,1873313359),N=h(N,C,I,O,f[m+15],10,-30611744),O=h(O,N,C,I,f[m+6],15,-1560198380),I=h(I,O,N,C,f[m+13],21,1309151649),C=h(C,I,O,N,f[m+4],6,-145523070),N=h(N,C,I,O,f[m+11],10,-1120210379),O=h(O,N,C,I,f[m+2],15,718787259),I=h(I,O,N,C,f[m+9],21,-343485551),C=r(C,E),I=r(I,_),O=r(O,v),N=r(N,A);return n(C)+n(I)+n(O)+n(N)}let kZ=1,CL=console,kn=class{static setLogger(e){CL=e}constructor(e,t){Te(this,"id",void 0),Te(this,"lockingPromise",ie.resolve()),Te(this,"locks",0),Te(this,"name",""),Te(this,"lockId",void 0),this.lockId=kZ++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){let n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),r=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");CL.debug("".concat(n," ").concat(r))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);let n=new ie(o=>{t=()=>{this.locks-=1,this.logger("unlocked",e),o()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function Gd(e,t){return function(n,r,o){let c=o.value;if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=function(){return P(this,arguments,function*(){let d=this[t];if(!d)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let l=yield d.lock("From ".concat(e,".").concat(r));try{for(var h=arguments.length,f=new Array(h),m=0;m<h;m++)f[m]=arguments[m];return yield c.apply(this,f)}finally{l()}})},o}}let nn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function aC(e,t){let n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Eo(e,t,n,r){let o=Object.assign({},nn,r),c=o.timeout,d=()=>P(this,null,function*(){yield function(f){return new ie(m=>{window.setTimeout(m,f)})}(c),c*=o.timeoutFactor,c=Math.min(o.maxRetryTimeout,c)}),l=!1,h=new ie((f,m)=>P(this,null,function*(){t=t||(()=>!1),n=n||(()=>!0);for(let E=0;E<o.maxRetryCount;E+=1){if(l)return m(new K(D.OPERATION_ABORTED));try{let _=yield e();if(!t(_,E)||E+1===o.maxRetryCount)return f(_);yield d()}catch(_){if(!n(_,E)||E+1===o.maxRetryCount)return m(_);yield d()}}}));return h.cancel=()=>l=!0,h}let tg,IL=class{constructor(e){Te(this,"input",[]),Te(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:co(e=this.input).call(e,(t,n)=>t+n)/this.input.length}},ng=0,cC=0;function dC(e,t,n,r){return new ie((o,c)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),ng+=Ko(t.data)):n&&(t.data.size?ng+=t.data.size:t.data instanceof FormData?ng+=EL(t.data):ng+=Ko(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,pr.request(t).then(d=>{typeof d.data=="string"?cC+=Ko(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?cC+=d.data.byteLength:cC+=Ko(JSON.stringify(d.data)),r&&o({data:d.data,headers:d.headers}),o(d.data)}).catch(d=>{pr.isCancel(d)?c(new K(D.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?c(new K(D.NETWORK_TIMEOUT,d.message)):d.response?c(new K(D.NETWORK_RESPONSE_ERROR,d.response.status)):c(new K(D.NETWORK_ERROR,d.message))})})}function LZ(e,t){return P(this,null,function*(){let n=new Blob([t.data],{type:"buffer"});return yield dC(e,ae(ae({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)})}let RL=()=>window.isSecureContext!==void 0;function Hi(e){if(Array.isArray(e))return e.map(n=>n);if(!wL(e))return e;let t={};for(let n in e){let r=e[n];wL(r)||Array.isArray(r)?t[n]=Hi(r):t[n]=r}return t}function wL(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let uC=class{constructor(e){Te(this,"input",[]),Te(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},qo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},vh={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:qo,remoteCandidate:qo},updateInterval:0},bL={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},AL={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},DL={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},OL={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0},lC=class{constructor(e,t){Te(this,"onFirstVideoReceived",void 0),Te(this,"onFirstVideoDecoded",void 0),Te(this,"onFirstAudioReceived",void 0),Te(this,"onFirstVideoDecodedTimeout",void 0),Te(this,"onFirstAudioDecoded",void 0),Te(this,"onSelectedLocalCandidateChanged",void 0),Te(this,"onSelectedRemoteCandidateChanged",void 0),Te(this,"videoIsReady",!1),Te(this,"videoIsReady2",{}),Te(this,"pc",void 0),Te(this,"options",void 0),Te(this,"intervalTimer",void 0),Te(this,"stats",Hi(vh)),Te(this,"isFirstVideoReceived",{}),Te(this,"isFirstVideoDecoded",{}),Te(this,"isFirstAudioReceived",{}),Te(this,"isFirstAudioDecoded",{}),Te(this,"isFirstVideoDecodedTimeout",{}),Te(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(()=>P(this,null,function*(){this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ie(e=>{e({local:ae({},qo),remote:ae({},qo)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"],r=0,o=0,c=0,d=0;for(let l of n)e[l].forEach((h,f)=>{if(!this.lossRateWindowStats[t-1][l][f]||!this.lossRateWindowStats[0][l][f])return;let m=this.lossRateWindowStats[t-1][l][f].packets-this.lossRateWindowStats[0][l][f].packets,E=this.lossRateWindowStats[t-1][l][f].packetsLost-this.lossRateWindowStats[0][l][f].packetsLost;l==="videoSend"||l==="audioSend"?(r+=m,c+=E):(o+=m,d+=E),Number.isNaN(m)||Number.isNaN(m)?h.packetLostRate=0:h.packetLostRate=m<=0||E<=0?0:E/(m+E)});e.sendPacketLossRate=r<=0||c<=0?0:c/(r+c),e.recvPacketLossRate=o<=0||d<=0?0:d/(o+d)}},xZ=class extends lC{constructor(){super(...arguments),Te(this,"_stats",vh),Te(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){return P(this,null,function*(){let e=yield this._getStats(),t=this.statsResponsesToObjects(e);this._stats=Hi(vh);let n=t.filter(o=>o.type==="ssrc");this.processSSRCStats(n);let r=t.find(o=>o.type==="VideoBwe");r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats})}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var n;let r=ne(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(r?"send":"recv")){case"video_send":{let o=Hi(AL);o.codec=t.googCodecName,o.adaptionChangeReason="none",t.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(t.googAvgEncodeMs),o.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},o.firsCount=Number(t.googFirReceived),o.nacksCount=Number(t.googNacksReceived),o.plisCount=Number(t.googPlisReceived),o.frameCount=Number(t.framesEncoded),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{let o=Hi(bL),c=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(o.codec=t.googCodecName,o.targetDelayMs=Number(t.googTargetDelayMs),o.renderDelayMs=Number(t.googRenderDelayMs),o.currentDelayMs=Number(t.googCurrentDelayMs),o.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),o.decodeMs=Number(t.googDecodeMs),o.maxDecodeMs=Number(t.googMaxDecodeMs),o.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},o.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},o.decodeFrameRate=Number(t.googFrameRateDecoded),o.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},o.jitterBufferMs=Number(t.googJitterBufferMs),o.firsCount=Number(t.googFirsSent),o.nacksCount=Number(t.googNacksSent),o.plisCount=Number(t.googPlisSent),o.framesDecodeCount=Number(t.framesDecoded),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),c){let d=c.stats,l=Date.now()-c.lts;o.framesDecodeFreezeTime=d.framesDecodeFreezeTime,o.framesDecodeInterval=d.framesDecodeInterval,o.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(c.lts=Date.now(),o.framesDecodeInterval=l,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):o.framesDecodeCount<c.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:ae({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{let o=Hi(OL);o.codec=t.googCodecName,o.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,o.decodingCNG=Number(t.googDecodingCNG),o.decodingCTN=Number(t.googDecodingCTN),o.decodingCTSG=Number(t.googDecodingCTSG),o.decodingNormal=Number(t.googDecodingNormal),o.decodingPLC=Number(t.googDecodingPLC),o.decodingPLCCNG=Number(t.googDecodingPLCCNG),o.expandRate=Number(t.googExpandRate),o.accelerateRate=Number(t.googAccelerateRate),o.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),o.speechExpandRate=Number(t.googSpeechExpandRate),o.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),o.jitterBufferMs=Number(t.googJitterBufferMs),o.jitterMs=Number(t.googJitterReceived),o.bytes=Number(t.bytesReceived),o.packets=Number(t.packetsReceived),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),o.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{let o=Hi(DL);o.codec=t.googCodecName,o.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,o.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(t.bytesSent),o.packets=Number(t.packetsSent),o.packetsLost=Number(t.packetsLost),o.ssrc=Number(t.ssrc),o.rttMs=Number(t.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new ie((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(n=>{let r={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach(o=>{r[o]=n.stat(o)}),t.push(r)}),t}},yh=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),rg=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),hC=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),zr=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Wd=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Wd||{});function Th(e,t,n,r){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Wd.kNone;if(!t)return;let c=Number(t[n]);if(typeof c!="number")return;let d=Number(t[r]);if(typeof d!="number")return;if(!e)return d?c/d*o:void 0;let l=Number(e[n]);if(typeof l!="number")return;let h=Number(e[r]);if(typeof h!="number")return;let f=d-h;return f?(c-l)/f*o:void 0}let NL=class extends lC{constructor(){super(...arguments),Te(this,"_stats",vh),Te(this,"report",void 0),Te(this,"lastDecodeVideoReceiverStats",new Map),Te(this,"lastVideoFramesRecv",new Map),Te(this,"lastVideoFramesSent",new Map),Te(this,"lastVideoFramesDecode",new Map),Te(this,"lastVideoFramesOutput",new Map),Te(this,"lastVideoJBDelay",new Map),Te(this,"lastAudioJBDelay",new Map),Te(this,"mediaBytesSent",new Map),Te(this,"mediaBytesRetransmit",new Map),Te(this,"mediaBytesTargetEncode",new Map),Te(this,"lastDecodeAudioReceiverStats",new Map),Te(this,"lastEncoderMs",new Map)}updateStats(){return P(this,null,function*(){this.report=yield this.pc.getStats(),this._stats=Hi(vh),this.report.forEach(e=>{switch(e.type){case zr.OUTBOUND:case zr.INBOUND:{let t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===zr.OUTBOUND?t==="audio"||r?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===zr.INBOUND&&(t==="audio"||r?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case zr.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case zr.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats})}getSelectedCandidatePair(){return P(this,null,function*(){let e=yield this.pc.getStats(),t={local:ae({},qo),remote:ae({},qo)};return e.forEach(n=>{let r;if(n.type===zr.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===zr.CANDIDATE_PAIR&&n.selected&&(r=n),r){let o=(c,d)=>{c.type=d.type,c.id=d.id,d.address&&(c.address=d.address),d.candidateType&&(c.candidateType=d.candidateType),d.port&&(c.port=d.port),d.priority&&(c.priority=d.priority),d.protocol&&(c.protocol=d.protocol),d.relayProtocol&&(c.relayProtocol=d.relayProtocol)};if(r.localCandidateId){let c=e.get(r.localCandidateId);c&&o(t.local,c)}if(r.remoteCandidateId){let c=e.get(r.remoteCandidateId);c&&o(t.remote,c)}}}),t})}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===zr.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===zr.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===zr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ae({},t),ae({},this.stats.selectedCandidatePair.localCandidate)),e.type===zr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ae({},t),ae({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);t||(t=Hi(OL),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;let n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Th(n,t,"totalProcessingDelay","jitterBufferEmittedCount",Wd.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,ae({},t))}processVideoInboundStats(e){let t=this._stats.videoRecv.find(d=>d.ssrc===e.ssrc);t||(t=Hi(bL),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;let n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),o=this.lastVideoFramesOutput.get(t.ssrc),c=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let d=t.decodedFrame?t.decodedFrame.width:0,l=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,d,l),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){let d=n.stats,l=c-n.lts;t.framesDecodeFreezeTime=d.framesDecodeFreezeTime,t.framesDecodeInterval=d.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&l>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=l,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<d.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Th(n?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Th(n?.stats,t,"totalProcessingDelay","framesDecodeCount",Wd.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Th(n?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",Wd.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Th(n?.stats,t,"totalInterFrameDelay","framesDecodeCount",Wd.kMillisecondsFromSeconds),r&&c-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((c-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:c,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:c,rate:0}),t.framesDroppedCount&&e.framesReceived&&(o&&c-o.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-o.count)/((c-o.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:c,rate:Math.max(t.outputFrameRate,0)})):o?t.outputFrameRate=o.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:c,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:ae({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(r=>r.ssrc===e.ssrc);t||(t=Hi(AL),this._stats.videoSend.push(t));let n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{let r=new uC(10);r.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,r)}if(e.retransmittedBytesSent!==void 0){let r=this.mediaBytesRetransmit.get(e.ssrc);if(r)r.add(e.retransmittedBytesSent);else{let o=new uC(10);o.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,o)}}if(e.totalEncodedBytesTarget){let r=this.mediaBytesTargetEncode.get(e.ssrc);if(r)r.add(e.totalEncodedBytesTarget);else{let o=new uC(10);o.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,o)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){let r=this.lastEncoderMs.get(e.ssrc);if(!r||r.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let o=e.framesEncoded-r.lastFrameCount,c=e.totalEncodeTime-r.lastEncoderTime;t.avgEncodeMs=1e3*c/o}}if(e.framesEncoded&&e.qpSum){let r=this.lastEncoderMs.get(e.ssrc);!r||r.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-r.lastQpSum)/(e.framesEncoded-r.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,zr.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(n=>n.ssrc===e.ssrc);if(t||(t=Hi(DL),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let n=this.findRemoteStatsId(e.ssrc,zr.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;let r=Array.from(Wr(n=this.report).call(n)).find(o=>o.type===t&&o.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){let n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){let n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,o,c,d;let l=t?this.report.get(t):void 0,h=(r=l?.framesSent)!==null&&r!==void 0?r:e.framesSent;if(typeof h!="number")return;let f=(o=l?.frameWidth)!==null&&o!==void 0?o:e.frameWidth,m=(c=l?.frameHeight)!==null&&c!==void 0?c:e.frameHeight,E=(d=l?.framesPerSecond)!==null&&d!==void 0?d:e.framesPerSecond;if(typeof f=="number"&&typeof m=="number"||(f=0,m=0),E==null){let _=Date.now(),v=this.lastVideoFramesSent.get(n.ssrc);v&&_-v.lts>=800?(E=Math.round((h-v.count)/((_-v.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:h,lts:_,rate:E})):v?E=v.rate:this.lastVideoFramesSent.set(n.ssrc,{count:h,lts:_,rate:0})}n.sentFrame={width:f,height:m,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(e,t,n){var r,o,c,d,l;let h=t?this.report.get(t):void 0,f=(r=h?.framesReceived)!==null&&r!==void 0?r:e.framesReceived,m=(o=h?.frameWidth)!==null&&o!==void 0?o:e.frameWidth,E=(c=h?.frameHeight)!==null&&c!==void 0?c:e.frameHeight,_=(d=h?.jitterBufferDelay)!==null&&d!==void 0?d:e.jitterBufferDelay,v=(l=h?.jitterBufferEmittedCount)!==null&&l!==void 0?l:e.jitterBufferEmittedCount;if(typeof f=="number"){let A=this.lastVideoFramesRecv.get(n.ssrc),C=Date.now();n.framesReceivedCount=f;let I=0;A&&C-A.lts>=800?(I=Math.round((f-A.count)/((C-A.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:f,lts:C,rate:I})):A?I=A.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:f,lts:C,rate:0}),n.receivedFrame={width:m||0,height:E||0,frameRate:I||0},n.decodedFrame={width:m||0,height:E||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:m||0,height:E||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(_&&v){let A=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},C=A.jitterBufferMs,I=v-A.jitterBufferEmittedCount;I>0&&(C=1e3*(_-A.jitterBufferDelay)/I),n.jitterBufferMs=C,n.currentDelayMs=Math.round(C),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:_,jitterBufferEmittedCount:v,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,o,c,d;let l=t?this.report.get(t):void 0,h=(r=(o=l?.echoReturnLoss)!==null&&o!==void 0?o:e.echoReturnLoss)!==null&&r!==void 0?r:0,f=(c=(d=l?.echoReturnLossEnhancement)!==null&&d!==void 0?d:e.echoReturnLossEnhancement)!==null&&c!==void 0?c:0;n.aecReturnLoss=h,n.aecReturnLossEnhancement=f}processAudioTrackReceiverStats(e,t,n){var r,o,c,d,l,h,f;let m=t?this.report.get(t):void 0,E=(r=m?.removedSamplesForAcceleration)!==null&&r!==void 0?r:e.removedSamplesForAcceleration,_=(o=m?.totalSamplesReceived)!==null&&o!==void 0?o:e.totalSamplesReceived,v=(c=m?.jitterBufferDelay)!==null&&c!==void 0?c:e.jitterBufferDelay,A=(d=m?.jitterBufferEmittedCount)!==null&&d!==void 0?d:e.jitterBufferEmittedCount,C=(l=m?.audioLevel)!==null&&l!==void 0?l:e?.audioLevel,I=(h=m?.totalSamplesDuration)!==null&&h!==void 0?h:e?.totalSamplesDuration,O=(f=m?.concealedSamples)!==null&&f!==void 0?f:e.concealedSamples;if(E&&_&&(n.accelerateRate=E/_),v&&A){let x=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},B=x.jitterBufferMs,j=A-x.jitterBufferEmittedCount;j>0&&(B=1e3*(v-x.jitterBufferDelay)/j),n.jitterBufferMs=Math.round(B),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:v,jitterBufferEmittedCount:A,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=C;let N=1920;I&&_&&(N=_/I/50,n.receivedFrames=Math.round(_/N)),O&&(n.droppedFrames=Math.round(O/N))}processRemoteInboundStats(e,t){let n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(o=>{e+=o.diffMean()}),this.mediaBytesRetransmit.forEach(o=>{t=t===null?o.diffMean():t+o.diffMean()}),this.mediaBytesTargetEncode.forEach(o=>{n=n===null?o.diffMean():n+o.diffMean()});let r=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},UZ=class extends lC{updateStats(){return ie.resolve()}};function pC(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,c=function(){let d=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return d&&d[0]?Number(d[0].split("/")[1]):null}();return c?c<76?new xZ(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o}):new NL(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o}):function(d){if(!window.RTCStatsReport)return!1;let l=d.getStats();return!!(l instanceof ie||function(h){return!!h&&(typeof h=="object"||typeof h=="function")&&typeof h.then=="function"}(l))}(e)?new NL(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o}):new UZ(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o})}let PL="websdk_ng_install_id";function fC(){try{if(M("INSTALL_ID"))return M("INSTALL_ID");let e=window.localStorage.getItem(PL);return e||(e=dc(),window.localStorage.setItem(PL,e)),nt("INSTALL_ID",e),e}catch{return}}let li=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){let n=t[1],r=t[2];return"".concat(n,".").concat(r)}return"4.0.0.999"}("4.23.1"),mC=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),uc=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),Dn=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");let r=n.join(""),o=[];for(let l=0;l<6;l++)o.push("1");let c=o.join(""),d={};return d[e]=r,d[t]=c,Object.assign(d,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Dn;let ig={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},gC={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},EC="v4.23.1-0-gea45199f-dirty(1/16/2025, 3:18:04 PM)",_C={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"]},Ot=ae(ae(ae({},_C),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:gC,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},ig),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function nt(e,t,n){var r,o,c;ne(r=Object.keys(Ot)).call(r,e)&&(!n&&ne(o=Object.keys(_o)).call(o,e)||(Ot[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"||t!==!0||(Ot.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(c=!!t,Ot.USE_NEW_NETWORK_CONFIG=c,c&&(Ot.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Ot.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Ot.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Ot.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Ot.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Ot.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Ot.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Ot.ENABLE_INSTANT_VIDEO=!0,Ot.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Ot.ENABLE_AUT_CC=!0)))}function M(e){return Ot[e]}mC||(Ot.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Ot.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Ot.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Ot.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Ot.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Ot.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Ot.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Ot.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Ot.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Ot.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Ot.AREAS=["NORTH_AMERICA","OVERSEA"]);let ML=function(e){return e[e.REALTIME=1]="REALTIME",e}({}),_o={};var Ne=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Ne||{});let FZ=class{constructor(e,t,n,r){Te(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:uc.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(e){this.state=function(t,n){switch(n.type){case Ne.SET_SESSION_ID:return ae(ae({},t),{},{sessionId:n.sessionId});case Ne.SET_P2P_ID:return ae(ae({},t),{},{p2pId:n.p2pId});case Ne.SET_UID:return ae(ae({},t),{},{uid:n.uid});case Ne.SET_INT_UID:return ae(ae({},t),{},{intUid:n.intUid});case Ne.SET_PUB_ID:return ae(ae({},t),{},{pubId:n.pubId});case Ne.KEY_METRIC_CLIENT_CREATED:return ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{clientCreated:n.metric})});case Ne.KEY_METRIC_JOIN_START:return ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{joinStart:n.metric})});case Ne.AVOID_JOIN_START:return ae(ae({},t),{},{avoidJoinStart:n.avoidJoinStart});case Ne.KEY_METRIC_JOIN_END:return ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{joinEnd:n.metric})});case Ne.KEY_METRIC_REQUEST_AP_START:return ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{requestAPStart:n.metric})});case Ne.KEY_METRIC_REQUEST_AP_END:return ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{requestAPEnd:n.metric})});case Ne.KEY_METRIC_JOIN_GATEWAY_START:return ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{joinGatewayStart:n.metric})});case Ne.KEY_METRIC_JOIN_GATEWAY_END:return ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{joinGatewayEnd:n.metric})});case Ne.KEY_METRIC_PEER_CONNECTION_START:return ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{peerConnectionStart:n.metric})});case Ne.KEY_METRIC_PEER_CONNECTION_END:return ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{peerConnectionEnd:n.metric})});case Ne.KEY_METRIC_DESCRIPTION_START:return ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{descriptionStart:n.metric})});case Ne.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{signalChannelOpen:n.metric})});case Ne.KEY_METRIC_ICE_CONNECTION_END:return ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{iceConnectionEnd:n.metric})});case Ne.KEY_METRIC_PUBLISH:{let r=t.keyMetrics.publish,o=r.findIndex(c=>c.trackId===n.metric.trackId);return o!==-1?(r[o]=ae(ae({},r[o]),n.metric),ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{publish:[...r]})})):ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{publish:[...t.keyMetrics.publish,n.metric]})})}case Ne.KEY_METRIC_SUBSCRIBE:{let r=t.keyMetrics.subscribe,o=r.findIndex(c=>c.userId===n.metric.userId&&c.type===n.metric.type);return o!==-1?(r[o]=ae(ae({},r[o]),n.metric),ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{subscribe:[...r]})})):ae(ae({},t),{},{keyMetrics:ae(ae({},t.keyMetrics),{},{subscribe:[...t.keyMetrics.subscribe,n.metric]})})}case Ne.SET_CLOUD_PROXY_SERVER_MODE:return t.cloudProxyServerMode=n.mode,t;case Ne.RECORD_JOIN_CHANNEL_SERVICE:return typeof n.index!="number"?t.joinChannelServiceRecords=[...t.joinChannelServiceRecords,n.record]:(t.joinChannelServiceRecords[n.index]=ae(ae({},t.joinChannelServiceRecords[n.index]),n.record),t.joinChannelServiceRecords=[...t.joinChannelServiceRecords]),t;case Ne.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return t.joinChannelServiceRecords=[],t;case Ne.RESET_KEY_METRICS:return t.keyMetrics={publish:[],subscribe:[]},t;case Ne.SET_USE_P2P:return ae(ae({},t),{},{useP2P:n.val});case Ne.SET_TRANSPORT_TYPE:return ae(ae({},t),{},{p2pTransport:n.val});default:return t}}(this.state,e)}set sessionId(e){this.dispatch({type:Ne.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set cid(e){this.state.cid=e}get cid(){return this.state.cid}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:Ne.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:Ne.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:Ne.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:Ne.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:Ne.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:Ne.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:Ne.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:Ne.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(e){this.state.hasStartJoinChannel=e}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(e){this.state.isABTestSuccess=e}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Ne.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Ne.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Ne.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Ne.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Ne.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Ne.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Ne.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Ne.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Ne.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Ne.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Ne.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Ne.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,r){this.dispatch({type:Ne.KEY_METRIC_PUBLISH,metric:ae(ae({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}subscribe(e,t,n,r,o,c,d){this.dispatch({type:Ne.KEY_METRIC_SUBSCRIBE,metric:ae(ae(ae(ae(ae({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),o&&{firstFrame:o}),c&&{streamAdded:c}),d&&{firstDecoded:d})})}massSubscribe(e,t,n,r){e.forEach(o=>{this.dispatch({type:Ne.KEY_METRIC_SUBSCRIBE,metric:ae(ae(ae({userId:o.userId,type:o.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){e.service==="gateway"&&Array.isArray(e.urls)&&(e.urls=e.urls.map(n=>n.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof t!="number"?(this.dispatch({type:Ne.RECORD_JOIN_CHANNEL_SERVICE,record:ae(ae({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Ne.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Ne.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Ne.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:Ne.AVOID_JOIN_START,avoidJoinStart:e})}},og=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let VZ=0;var kL=(()=>{var e={8:(r,o,c)=>{c.r(o),c.d(o,{Parser:()=>oe,Printer:()=>Wt,parse:()=>ee,print:()=>le});let d=`
`,l="".concat("\r").concat(d),h=" ",f;function m(Y){return Y>="0"&&Y<="9"}function E(Y){return Y>="!"&&Y<="~"}function _(Y){return E(Y)||Y>="\x80"&&Y<="\xFF"}function v(Y){return Y==="!"||Y>="#"&&Y<="'"||Y>="*"&&Y<="+"||Y>="-"&&Y<="."||Y>="0"&&Y<="9"||Y>="A"&&Y<="Z"||Y>="^"&&Y<="~"}function A(Y){return Y>="1"&&Y<="9"}function C(Y){return Y>="A"&&Y<="Z"||Y>="a"&&Y<="z"}function I(Y){return Y==="d"||Y==="h"||Y==="m"||Y==="s"}function O(Y){return Y>""&&Y<"	"||Y>"\v"&&Y<"\f"||Y>""&&Y<"\xFF"}function N(Y){return C(Y)||m(Y)||Y==="+"||Y==="/"}function x(Y){return m(Y)||C(Y)||Y==="+"||Y==="/"||Y==="-"||Y==="_"}function B(Y){return C(Y)||m(Y)||Y==="+"||Y==="/"}function j(Y,S){var k=Object.keys(Y);if(Object.getOwnPropertySymbols){var U=Object.getOwnPropertySymbols(Y);S&&(U=U.filter(function(Q){return Object.getOwnPropertyDescriptor(Y,Q).enumerable})),k.push.apply(k,U)}return k}function F(Y){for(var S=1;S<arguments.length;S++){var k=arguments[S]!=null?arguments[S]:{};S%2?j(Object(k),!0).forEach(function(U){W(Y,U,k[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors(k)):j(Object(k)).forEach(function(U){Object.defineProperty(Y,U,Object.getOwnPropertyDescriptor(k,U))})}return Y}function W(Y,S,k){return S in Y?Object.defineProperty(Y,S,{value:k,enumerable:!0,configurable:!0,writable:!0}):Y[S]=k,Y}(function(Y){Y.VERSION="v",Y.ORIGIN="o",Y.SESSION_NAME="s",Y.INFORMATION="i",Y.URI="u",Y.EMAIL="e",Y.PHONE="p",Y.CONNECTION="c",Y.BANDWIDTH="b",Y.TIME="t",Y.REPEAT="r",Y.ZONE_ADJUSTMENTS="z",Y.KEY="k",Y.ATTRIBUTE="a",Y.MEDIA="m"})(f||(f={}));class X{consumeText(S,k){let U=k;for(;U<S.length;){let Q=S[U];if(Q==="\0"||Q==="\r"||Q===d)break;U+=1}if(U-k==0)throw new Error("Invalid text, at ".concat(S));return U}consumeUnicastAddress(S,k,U){return this.consumeTill(S,k,h)}consumeOneOrMore(S,k,U){let Q=k;for(;U(S[Q]);)Q++;if(Q-k==0)throw new Error("Invalid rule at ".concat(k,"."));return Q}consumeSpace(S,k){if(S[k]===h)return k+1;throw new Error("Invalid space at ".concat(k,"."))}consumeIP4Address(S,k){let U=k;for(let Q=0;Q<4;Q++)if(U=this.consumeDecimalUChar(S,U),Q!==3){if(S[U]!==".")throw new Error("Invalid IP4 address.");U++}return U}consumeDecimalUChar(S,k){let U=k;for(let Ce=0;Ce<3&&m(S[U]);Ce++,U++);if(U-k==0)throw new Error("Invalid decimal uchar.");let Q=parseInt(S.slice(k,U));if(Q>=0&&Q<=255)return U;throw new Error("Invalid decimal uchar")}consumeIP6Address(S,k){let U=this.consumeHexpart(S,k);return S[U]===":"&&(U+=1,U=this.consumeIP4Address(S,U)),U}consumeHexpart(S,k){let U=k;if(S[U]===":"&&S[U+1]===":"){U+=2;try{U=this.consumeHexseq(S,U)}catch{}return U}if(U=this.consumeHexseq(S,U),S[U]===":"&&S[U+1]===":"){U+=2;try{U=this.consumeHexseq(S,U)}catch{}return U}return U}consumeHexseq(S,k){let U=k;for(;U=this.consumeHex4(S,U),S[U]===":"&&S[U+1]!==":";)U+=1;return U}consumeHex4(S,k){let U=0;for(;U<4;U++)if(!((Q=S[k+U])>="0"&&Q<="9"||Q>="a"&&Q<="f"||Q>="A"&&Q<="F")){if(U===0)throw new Error("Invalid hex 4");break}var Q;return k+U}consumeFQDN(S,k){let U=k;for(;m(S[U])||C(S[U])||S[U]==="-"||S[U]===".";)U+=1;if(U-k<4)throw new Error("Invalid FQDN");return U}consumeExtnAddr(S,k){return this.consumeOneOrMore(S,k,_)}consumeMulticastAddress(S,k,U){switch(U){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(S,k);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(S,k);default:try{return this.consumeFQDN(S,k)}catch{return this.consumeExtnAddr(S,k)}}}consumeIP6MulticastAddress(S,k){let U=this.consumeHexpart(S,k);return S[U]==="/"?this.consumeInteger(S,U+1):U}consumeIP4MulticastAddress(S,k){let U=k+3,Q=S.slice(k,U),Ce=parseInt(Q);if(Ce<224||Ce>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let at=0;at<3;at++){if(S[U]!==".")throw new Error("Invalid IP4 multicast address.");U+=1,U=this.consumeDecimalUChar(S,U)}return S[U]==="/"&&(U+=1),U=this.consumeTTL(S,U),S[U]==="/"&&(U=this.consumeInteger(S,U)),U}consumeInteger(S,k){if(!A(S[k]))throw new Error("Invalid integer.");for(k+=1;m(S[k]);)k+=1;return k}consumeTTL(S,k){if(S[k]==="0")return k+1;if(!A(S[k]))throw new Error("Invalid TTL.");k+=1;for(let U=0;U<2&&m(S[k]);U++)k+=1;return k}consumeToken(S,k){return this.consumeOneOrMore(S,k,v)}consumeTime(S,k){let U=k;if(S[U]==="0")return U+1;for(A(S[U])&&(U+=1);m(S[U]);)U++;if(U-k<10)throw new Error("Invalid time");return U}consumeAddress(S,k){return this.consumeTill(S,k,h)}consumeTypedTime(S,k){let U=k;return U=this.consumeOneOrMore(S,U,m),I(S[U])?U+1:U}consumeRepeatInterval(S,k){if(!A(S[k]))throw new Error("Invalid repeat interval");for(k+=1;m(S[k]);)k+=1;return I(S[k])&&(k+=1),k}consumePort(S,k){return this.consumeOneOrMore(S,k,m)}consume(S,k,U){for(let Q=0;Q<U.length;Q++){if(k+Q>=S.length)throw new Error("consume exceeding value length");if(S[k+Q]!==U[Q])throw new Error("consume ".concat(U," failed at ").concat(Q))}return k+U.length}consumeTill(S,k,U){let Q=k;for(;Q<S.length&&(typeof U!="string"||S[Q]!==U)&&(typeof U!="function"||!U(S[Q]));)Q++;return Q}}class oe extends X{constructor(){super(),W(this,"records",[]),W(this,"currentLine",0)}parse(S){let k=this.probeEOL(S);this.records=S.split(k).filter(Mc=>!!Hn(Mc).call(Mc)).map(this.parseLine),this.currentLine=0;let U=this.parseVersion(),Q=this.parseOrigin(),Ce=this.parseSessionName(),at=this.parseInformation(),fn=this.parseUri(),Dr=this.parseEmail(),ks=this.parsePhone(),Pc=this.parseConnection(),rp=this.parseBandWidth(),hE=this.parseTimeFields(),pE=this.parseKey(),vi=this.parseSessionAttribute(),wa=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:U,origin:Q,sessionName:Ce,information:at,uri:fn,emails:Dr,phones:ks,connection:Pc,bandwidths:rp,timeFields:hE,key:pE,attributes:vi,mediaDescriptions:wa}}getCurrentRecord(){let S=this.records[this.currentLine];if(!S)throw new Error("Record doesn't exit.");return S}probeEOL(S){for(let k=0;k<S.length;k++)if(S[k]===d)return S[k-1]==="\r"?l:d;throw new Error("Invalid newline character.")}parseLine(S,k){if(S.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let U=S[0];if(S[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:U,value:S.slice(2),line:k,cur:0}}parseSessionAttribute(){let S=new Me;for(;this.currentLine<this.records.length;){let k=this.getCurrentRecord();if(k.type!==f.ATTRIBUTE)break;let U={attField:this.extractOneOrMore(k,Q=>v(Q)&&Q!==":"),_cur:0};k.value[k.cur]===":"&&(k.cur+=1,U.attValue=this.extractOneOrMore(k,O)),S.parse(U),this.currentLine++}return S.digest()}parseMediaAttributes(S){let k=new ke(S);for(;this.currentLine<this.records.length;){let U=this.getCurrentRecord();if(U.type!==f.ATTRIBUTE)break;let Q={attField:this.extractOneOrMore(U,Ce=>v(Ce)&&Ce!==":"),_cur:0};U.value[U.cur]===":"&&(U.cur+=1,Q.attValue=this.extractOneOrMore(U,O)),k.parse(Q),this.currentLine++}return k.digest()}parseKey(){let S=this.getCurrentRecord();if(S.type===f.KEY){if(S.value==="prompt"||S.value==="clear:"||S.value==="base64:"||S.value==="uri:")return S.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let S=this.getCurrentRecord();if(S.type===f.ZONE_ADJUSTMENTS){let k=[];for(;;)try{let U=this.extract(S,this.consumeTime);this.consumeSpaceForRecord(S);let Q=!1;S.value[S.cur]==="-"&&(Q=!0,S.cur+=1);let Ce=this.extract(S,this.consumeTypedTime);k.push({time:U,typedTime:Ce,back:Q})}catch{break}if(k.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,k}return[]}parseRepeat(){let S=[];for(;;){let k=this.getCurrentRecord();if(k.type!==f.REPEAT)break;{let U=this.extract(k,this.consumeRepeatInterval),Q=this.parseTypedTime(k);S.push({repeatInterval:U,typedTimes:Q}),this.currentLine++}}return S}parseTypedTime(S){let k=[];for(;;)try{this.consumeSpaceForRecord(S),k.push(this.extract(S,this.consumeTypedTime))}catch{break}if(k.length===0)throw new Error("Invalid typed time.");return k}parseTime(){let S=this.getCurrentRecord(),k=this.extract(S,this.consumeTime);this.consumeSpaceForRecord(S);let U=this.extract(S,this.consumeTime);return this.currentLine++,{startTime:k,stopTime:U}}parseBandWidth(){let S=[];for(;this.currentLine<this.records.length;){let k=this.getCurrentRecord();if(k.type!==f.BANDWIDTH)break;{let U=this.extractOneOrMore(k,v);if(k.value[k.cur]!==":")throw new Error("Invalid bandwidth field.");k.cur++;let Q=this.extractOneOrMore(k,m);S.push({bwtype:U,bandwidth:Q}),this.currentLine++}}return S}parseVersion(){let S=this.getCurrentRecord();if(S.type!==f.VERSION)throw new Error("first sdp record must be version");let k=S.value.slice(0,this.consumeOneOrMore(S.value,0,m));if(k.length!==S.value.length)throw new Error('invalid proto version, "v='.concat(S.value,'"'));return this.currentLine++,k}parseOrigin(){let S=this.getCurrentRecord();if(S.type!==f.ORIGIN)throw new Error("second line of sdp must be origin");let k=this.extractOneOrMore(S,_);this.consumeSpaceForRecord(S);let U=this.extractOneOrMore(S,m);this.consumeSpaceForRecord(S);let Q=this.extractOneOrMore(S,m);this.consumeSpaceForRecord(S);let Ce=this.extractOneOrMore(S,v);this.consumeSpaceForRecord(S);let at=this.extractOneOrMore(S,v);this.consumeSpaceForRecord(S);let fn=this.extract(S,this.consumeUnicastAddress);return this.currentLine++,{username:k,sessId:U,sessVersion:Q,nettype:Ce,addrtype:at,unicastAddress:fn}}parseSessionName(){let S=this.getCurrentRecord();if(S.type===f.SESSION_NAME){let k=this.extract(S,this.consumeText);return this.currentLine++,k}}parseInformation(){let S=this.getCurrentRecord();if(S.type!==f.INFORMATION)return;let k=this.extract(S,this.consumeText);return this.currentLine++,k}parseUri(){let S=this.getCurrentRecord();if(S.type===f.URI)return this.currentLine++,S.value}parseEmail(){let S=[];for(;;){let k=this.getCurrentRecord();if(k.type!==f.EMAIL)break;S.push(k.value),this.currentLine++}return S}parsePhone(){let S=[];for(;;){let k=this.getCurrentRecord();if(k.type!==f.PHONE)break;S.push(k.value),this.currentLine++}return S}parseConnection(){let S=this.getCurrentRecord();if(S.type===f.CONNECTION){let k=this.extractOneOrMore(S,v);this.consumeSpaceForRecord(S);let U=this.extractOneOrMore(S,v);this.consumeSpaceForRecord(S);let Q=this.extract(S,this.consumeAddress);return this.currentLine++,{nettype:k,addrtype:U,address:Q}}}parseMedia(){let S=this.getCurrentRecord(),k=this.extract(S,this.consumeToken);this.consumeSpaceForRecord(S);let U=this.extract(S,this.consumePort);S.value[S.cur]==="/"&&(S.cur+=1,U+=this.extract(S,this.consumeInteger)),this.consumeSpaceForRecord(S);let Q=[];for(Q.push(this.extract(S,this.consumeToken));S.value[S.cur]==="/";)S.cur+=1,Q.push(this.extract(S,this.consumeToken));if(Q.length===0)throw new Error("Invalid proto");let Ce=this.parseFmt(S);return this.currentLine++,{mediaType:k,port:U,protos:Q,fmts:Ce}}parseTimeFields(){let S=[];for(;this.getCurrentRecord().type===f.TIME;){let k=this.parseTime(),U=this.parseRepeat(),Q=this.parseZone();S.push({time:k,repeats:U,zones:Q})}return S}parseMediaDescription(){let S=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.MEDIA;){let k=this.parseMedia(),U=this.parseInformation(),Q=this.parseConnections(),Ce=this.parseBandWidth(),at=this.parseKey(),fn=this.parseMediaAttributes(k);S.push({media:k,information:U,connections:Q,bandwidths:Ce,key:at,attributes:fn})}return S}parseConnections(){let S=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.CONNECTION;)S.push(this.parseConnection());return S}parseFmt(S){let k=[];for(;;)try{this.consumeSpaceForRecord(S),k.push(this.extract(S,this.consumeToken))}catch{break}if(k.length===0)throw new Error("Invalid fmts");return k}extract(S,k){for(var U=arguments.length,Q=new Array(U>2?U-2:0),Ce=2;Ce<U;Ce++)Q[Ce-2]=arguments[Ce];let at=k.call(this,S.value,S.cur,...Q),fn=S.value.slice(S.cur,at);return S.cur=at,fn}extractOneOrMore(S,k){let U=this.consumeOneOrMore(S.value,S.cur,k),Q=S.value.slice(S.cur,U);return S.cur=U,Q}consumeSpaceForRecord(S){if(S.value[S.cur]!==h)throw new Error("Invalid space at ".concat(S.cur,"."));S.cur+=1}}class te extends X{constructor(){super(...arguments),W(this,"attributes",void 0),W(this,"digested",!1)}extractOneOrMore(S,k,U){let Q=this.consumeOneOrMore(S.attValue,S._cur,k),Ce=S.attValue.slice(S._cur,Q),[at,fn]=U||[];if(typeof at=="number"&&Ce.length<at)throw new Error("error in length, should be more or equal than ".concat(at," characters."));if(typeof fn=="number"&&Ce.length>fn)throw new Error("error in length, should be less or equal than ".concat(fn," characters."));return S._cur=Q,Ce}consumeAttributeSpace(S){if(S.attValue[S._cur]!==h)throw new Error("Invalid space at ".concat(S._cur,"."));S._cur+=1}extract(S,k){if(!S.attValue)throw new Error("Nothing to extract from attValue.");for(var U=arguments.length,Q=new Array(U>2?U-2:0),Ce=2;Ce<U;Ce++)Q[Ce-2]=arguments[Ce];let at=k.call(this,S.attValue,S._cur,...Q),fn=S.attValue.slice(S._cur,at);return S._cur=at,fn}atEnd(S){if(!S.attValue)throw new Error;return S._cur>=S.attValue.length}peekChar(S){if(!S.attValue)throw new Error;return S.attValue[S._cur]}peek(S,k){if(!S.attValue)throw new Error;for(let U=0;U<k.length;U++)if(k[U]!==S.attValue[S._cur+U])return!1;return!0}parseIceUfrag(S){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(S,N,[4,256])}parseIcePwd(S){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(S,N,[22,256])}parseIceOptions(S){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let k=[];for(;!this.atEnd(S);){k.push(this.extractOneOrMore(S,N));try{this.consumeAttributeSpace(S)}catch(U){if(this.atEnd(S))break;throw U}}this.attributes.iceOptions=k}parseFingerprint(S){let k=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);let U=this.extract(S,this.consumeTill);this.attributes.fingerprints.push({hashFunction:k,fingerprint:U})}parseExtmap(S){let k=this.extractOneOrMore(S,m),U;this.peekChar(S)==="/"&&(this.extract(S,this.consume,"/"),U=this.extract(S,this.consumeToken)),this.consumeAttributeSpace(S);let Q=this.extract(S,this.consumeTill,h),Ce=F(F({entry:parseInt(k,10)},U&&{direction:U}),{},{extensionName:Q});this.peekChar(S)===h&&(this.consumeAttributeSpace(S),Ce.extensionAttributes=this.extract(S,this.consumeTill)),this.attributes.extmaps.push(Ce)}parseSetup(S){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let k=this.extract(S,this.consumeTill);if(k!=="active"&&k!=="passive"&&k!=="actpass"&&k!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=k}}class Me extends te{constructor(){super(...arguments),W(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(S){if(this.digested)throw new Error("already digested");try{switch(S.attField){case"group":this.parseGroup(S);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(S);break;case"ice-pwd":this.parseIcePwd(S);break;case"ice-options":this.parseIceOptions(S);break;case"fingerprint":this.parseFingerprint(S);break;case"setup":this.parseSetup(S);break;case"tls-id":this.parseTlsId(S);break;case"identity":this.parseIdentity(S);break;case"extmap":this.parseExtmap(S);break;case"msid-semantic":this.parseMsidSemantic(S);break;default:S.ignored=!0,this.attributes.unrecognized.push(S)}}catch(k){throw console.error("parsing session attribute ".concat(S.attField,' error, "a=').concat(S.attField,":").concat(S.attValue,'"')),k}if(!S.ignored&&S.attValue&&!this.atEnd(S))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(S){let k=this.extract(S,this.consumeToken),U=[];for(;!this.atEnd(S)&&this.peekChar(S)===h;)this.consumeAttributeSpace(S),U.push(this.extract(S,this.consumeToken));this.attributes.groups.push({semantic:k,identificationTag:U})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(S){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(S,x)}parseIdentity(S){let k=this.extractOneOrMore(S,B),U=[];for(;!this.atEnd(S)&&this.peekChar(S)===h;){this.consumeAttributeSpace(S);let Q=this.extract(S,this.consumeToken);this.extract(S,this.consume,"=");let Ce=this.extractOneOrMore(S,at=>at!==h&&O(at));U.push({name:Q,value:Ce})}this.attributes.identities.push({assertionValue:k,extensions:U})}parseMsidSemantic(S){this.peekChar(S)===h&&this.consumeAttributeSpace(S);let k={semantic:this.extract(S,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(S)}catch{break}if(this.peekChar(S)==="*"){this.extract(S,this.consume,"*"),k.applyForAll=!0;break}{let U=this.extract(S,this.consumeTill,h);k.identifierList.push(U)}}this.attributes.msidSemantic=k}}class ke extends te{constructor(S){super(),W(this,"attributes",void 0),S.protos.indexOf("RTP")!==-1||S.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(S){if(this.digested)throw new Error("already digested");try{switch(S.attField){case"extmap":this.parseExtmap(S);break;case"setup":this.parseSetup(S);break;case"ice-ufrag":this.parseIceUfrag(S);break;case"ice-pwd":this.parseIcePwd(S);break;case"ice-options":this.parseIceOptions(S);break;case"candidate":this.parseCandidate(S);break;case"remote-candidate":this.parseRemoteCandidate(S);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(S);break;case"rtpmap":this.parseRtpmap(S);break;case"ptime":this.parsePtime(S);break;case"maxptime":this.parseMaxPtime(S);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(S);break;case"ssrc":this.parseSSRC(S);break;case"fmtp":this.parseFmtp(S);break;case"rtcp-fb":this.parseRtcpFb(S);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(S);break;case"mid":this.parseMid(S);break;case"msid":this.parseMsid(S);break;case"imageattr":this.parseImageAttr(S);break;case"rid":this.parseRid(S);break;case"simulcast":this.parseSimulcast(S);break;case"sctp-port":this.parseSctpPort(S);break;case"max-message-size":this.parseMaxMessageSize(S);break;case"ssrc-group":this.parseSSRCGroup(S);break;default:S.ignored=!0,this.attributes.unrecognized.push(S)}}catch(k){throw console.error("parsing media attribute ".concat(S.attField,' error, "a=').concat(S.attField,":").concat(S.attValue,'"')),k}if(!S.ignored&&S.attValue&&!this.atEnd(S))throw new Error("attribute parsing error")}parseCandidate(S){let k=this.extractOneOrMore(S,N,[1,32]);this.consumeAttributeSpace(S);let U=this.extractOneOrMore(S,m,[1,5]);this.consumeAttributeSpace(S);let Q=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);let Ce=this.extractOneOrMore(S,m,[1,10]);this.consumeAttributeSpace(S);let at=this.extract(S,this.consumeAddress);this.consumeAttributeSpace(S);let fn=this.extract(S,this.consumePort);this.consumeAttributeSpace(S),this.extract(S,this.consume,"typ"),this.consumeAttributeSpace(S);let Dr={foundation:k,componentId:U,transport:Q,priority:Ce,connectionAddress:at,port:fn,type:this.extract(S,this.consumeToken),extension:{}};for(this.peek(S," raddr")&&(this.extract(S,this.consume," raddr"),this.consumeAttributeSpace(S),Dr.relAddr=this.extract(S,this.consumeAddress)),this.peek(S," rport")&&(this.extract(S,this.consume," rport"),this.consumeAttributeSpace(S),Dr.relPort=this.extract(S,this.consumePort));this.peekChar(S)===h;){this.consumeAttributeSpace(S);let ks=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S),Dr.extension[ks]=this.extractOneOrMore(S,E)}this.attributes.candidates.push(Dr)}parseRemoteCandidate(S){let k=[];for(;;){let U=this.extractOneOrMore(S,m,[1,5]);this.consumeAttributeSpace(S);let Q=this.extract(S,this.consumeAddress);this.consumeAttributeSpace(S);let Ce=this.extract(S,this.consumePort);k.push({componentId:U,connectionAddress:Q,port:Ce});try{this.consumeAttributeSpace(S)}catch{break}}this.attributes.remoteCandidatesList.push(k)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(S){let k=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);let U=this.extract(S,this.consumeTill,"/");this.extract(S,this.consume,"/");let Q={encodingName:U,clockRate:this.extractOneOrMore(S,m)};this.atEnd(S)||this.peekChar(S)!=="/"||(this.extract(S,this.consume,"/"),Q.encodingParameters=parseInt(this.extract(S,this.consumeTill),10));let Ce=this.attributes.payloads.find(at=>at.payloadType===parseInt(k,10));Ce?Ce.rtpMap=Q:this.attributes.payloads.push({payloadType:parseInt(k,10),rtpMap:Q,rtcpFeedbacks:[]})}parsePtime(S){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(S,this.consumeTill)}parseMaxPtime(S){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(S,this.consumeTill)}parseDirection(S){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=S.attField}parseSSRC(S){let k=this.extractOneOrMore(S,m);this.consumeAttributeSpace(S);let U=this.extract(S,this.consumeTill,":"),Q;this.peekChar(S)===":"&&(this.extract(S,this.consume,":"),Q=this.extract(S,this.consumeTill));let Ce=this.attributes.ssrcs.find(at=>at.ssrcId===parseInt(k,10));Ce?Ce.attributes[U]=Q:this.attributes.ssrcs.push({ssrcId:parseInt(k,10),attributes:{[U]:Q}})}parseFmtp(S){let k=this.extract(S,this.consumeTill,h);this.consumeAttributeSpace(S);let U=this.extract(S,this.consumeTill),Q={};U.split(";").forEach(at=>{let[fn,Dr]=at.split("=");fn=Hn(fn).call(fn);let ks=typeof Dr=="string"?Hn(Dr).call(Dr):null;typeof fn=="string"&&fn.length>0&&(Q[fn]=ks)});let Ce=this.attributes.payloads.find(at=>at.payloadType===parseInt(k,10));Ce?Ce.fmtp={parameters:Q}:this.attributes.payloads.push({payloadType:parseInt(k,10),rtcpFeedbacks:[],fmtp:{parameters:Q}})}parseFmtParameters(S){let k={},U=this.extract(S,this.consumeTill,"=");S._cur++;let Q=this.extract(S,this.consumeTill,";");for(k[U]=Q;S.attValue[S._cur]===";";){let Ce=this.extract(S,this.consumeTill,"=");S._cur++;let at=this.extract(S,this.consumeTill,";");k[Ce]=at}return k}parseRtcpFb(S){let k="";k=this.peekChar(S)==="*"?this.extract(S,this.consume,"*"):this.extract(S,this.consumeTill,h),this.consumeAttributeSpace(S);let U=this.extract(S,this.consumeTill,h),Q;if(U==="trr-int")Q={type:U,interval:this.extract(S,this.consumeTill)};else{let Ce={type:U};this.peekChar(S)===h&&(this.consumeAttributeSpace(S),Ce.parameter=this.extract(S,this.consumeToken),this.peekChar(S)===h&&(Ce.additional=this.extract(S,this.consumeTill))),Q=Ce}if(k==="*")this.attributes.rtcpFeedbackWildcards.push(Q);else{let Ce=this.attributes.payloads.find(at=>at.payloadType===parseInt(k,10));Ce?Ce.rtcpFeedbacks.push(Q):this.attributes.payloads.push({payloadType:parseInt(k,10),rtcpFeedbacks:[Q]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(S){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let k={port:this.extract(S,this.consumePort)};this.peekChar(S)===h&&(this.consumeAttributeSpace(S),k.netType=this.extractOneOrMore(S,v),this.consumeAttributeSpace(S),k.addressType=this.extractOneOrMore(S,v),this.consumeAttributeSpace(S),k.address=this.extract(S,this.consumeAddress)),this.attributes.rtcp=k}parseMsid(S){let k={id:this.extractOneOrMore(S,v,[1,64])};this.peekChar(S)===h&&(this.consumeAttributeSpace(S),k.appdata=this.extractOneOrMore(S,v,[1,64])),this.attributes.msids.push(k)}parseImageAttr(S){this.attributes.imageattr.push(S.attValue)}parseRid(S){let k=this.extractOneOrMore(S,Q=>C(Q)||m(Q)||Q==="_"||Q==="-");this.consumeAttributeSpace(S);let U={id:k,direction:this.extract(S,this.consumeToken),params:[]};if(this.peekChar(S)===h){if(this.consumeAttributeSpace(S),this.peek(S,"pt=")){this.extract(S,this.consume,"pt=");let Q=[];for(;;){let Ce=this.extract(S,this.consumeToken);Q.push(Ce);try{this.extract(S,this.consume,",")}catch{break}}U.payloads=Q,this.peekChar(S)===h&&this.extract(S,this.consume,h)}for(;;){let Q=this.extract(S,this.consumeToken);switch(Q){case"depend":{let Ce={type:Q,rids:this.extract(S,this.consume,"=").split(",")};U.params.push(Ce);break}default:{let Ce={type:Q};this.peekChar(S)==="="&&(this.extract(S,this.consume,"="),Ce.val=this.extract(S,this.consumeTill,";")),U.params.push(Ce)}}try{this.extract(S,this.consume,";")}catch{break}}}this.attributes.rids.push(U)}parseSimulcast(S){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=S.attValue,this.extract(S,this.consumeTill)}parseSctpPort(S){this.attributes.sctpPort=this.extractOneOrMore(S,m,[1,5])}parseMaxMessageSize(S){this.attributes.maxMessageSize=this.extractOneOrMore(S,m,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(S){this.attributes.mid=this.extract(S,this.consumeToken)}parseSSRCGroup(S){let k=this.extract(S,this.consumeToken),U=[];for(;;)try{this.consumeAttributeSpace(S);let Q=this.extract(S,this.consumeInteger);U.push(parseInt(Q,10))}catch{break}this.attributes.ssrcGroups.push({semantic:k,ssrcIds:U})}}function ft(Y,S,k){return S in Y?Object.defineProperty(Y,S,{value:k,enumerable:!0,configurable:!0,writable:!0}):Y[S]=k,Y}class Wt{constructor(){ft(this,"eol",l)}print(S,k){let U="";return k&&(this.eol=k),U+=this.printVersion(S.version),U+=this.printOrigin(S.origin),U+=this.printSessionName(S.sessionName),U+=this.printInformation(S.information),U+=this.printUri(S.uri),U+=this.printEmail(S.emails),U+=this.printPhone(S.phones),U+=this.printConnection(S.connection),U+=this.printBandwidth(S.bandwidths),U+=this.printTimeFields(S.timeFields),U+=this.printKey(S.key),U+=this.printSessionAttributes(S.attributes),U+=this.printMediaDescription(S.mediaDescriptions),U}printVersion(S){return"v=".concat(S).concat(this.eol)}printOrigin(S){return"o=".concat(S.username," ").concat(S.sessId," ").concat(S.sessVersion," ").concat(S.nettype," ").concat(S.addrtype," ").concat(S.unicastAddress).concat(this.eol)}printSessionName(S){return S?"s=".concat(S).concat(this.eol):""}printInformation(S){return S?"i=".concat(S).concat(this.eol):""}printUri(S){return S?"u=".concat(S).concat(this.eol):""}printEmail(S){let k="";for(let U of S)k+="e=".concat(U).concat(this.eol);return k}printPhone(S){let k="";for(let U of S)k+="e=".concat(U).concat(this.eol);return k}printConnection(S){return S?"c=".concat(S.nettype," ").concat(S.addrtype," ").concat(S.address).concat(this.eol):""}printBandwidth(S){let k="";for(let U of S)k+="b=".concat(U.bwtype,":").concat(U.bandwidth).concat(this.eol);return k}printTimeFields(S){let k="";for(let U of S){k+="t=".concat(U.time.startTime," ").concat(U.time.startTime).concat(this.eol);for(let Q of U.repeats)k+="r=".concat(Q.repeatInterval," ").concat(Q.typedTimes.join(" ")).concat(this.eol);U.zoneAdjustments&&(k+="z=",k+="z=".concat(U.zoneAdjustments.map(Q=>"".concat(Q.time," ").concat(Q.back?"-":""," ").concat(Q.typedTime)).join(" ")).concat(this.eol),k+=this.eol)}return k}printKey(S){return S?"k=".concat(S).concat(this.eol):""}printAttributes(S){let k="";for(let U of S)k+="a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol);return k}printMediaDescription(S){let k="";for(let U of S)k+=this.printMedia(U.media),k+=this.printInformation(U.information),k+=this.printConnections(U.connections),k+=this.printBandwidth(U.bandwidths),k+=this.printKey(U.key),k+=this.printMediaAttributes(U);return k}printConnections(S){let k="";for(let U of S)k+=this.printConnection(U);return k}printMedia(S){return"m=".concat(S.mediaType," ").concat(S.port," ").concat(S.protos.join("/")," ").concat(S.fmts.join(" ")).concat(this.eol)}printSessionAttributes(S){return new _r(this.eol).print(S)}printMediaAttributes(S){return new z(this.eol).print(S)}}class Vt{constructor(S){ft(this,"eol",void 0),this.eol=S}printIceUfrag(S){return S===void 0?"":"a=ice-ufrag:".concat(S).concat(this.eol)}printIcePwd(S){return S===void 0?"":"a=ice-pwd:".concat(S).concat(this.eol)}printIceOptions(S){return S===void 0?"":"a=ice-options:".concat(S.join(h)).concat(this.eol)}printFingerprints(S){return S.length>0?S.map(k=>"a=fingerprint:".concat(k.hashFunction).concat(h).concat(k.fingerprint)).join(this.eol)+this.eol:""}printExtmap(S){return S.map(k=>"a=extmap:".concat(k.entry).concat(k.direction?"/".concat(k.direction):"").concat(h).concat(k.extensionName).concat(k.extensionAttributes?"".concat(h).concat(k.extensionAttributes):"").concat(this.eol)).join("")}printSetup(S){return S===void 0?"":"a=setup:".concat(S).concat(this.eol)}printUnrecognized(S){return S.map(k=>"a=".concat(k.attField).concat(k.attValue?":".concat(k.attValue):"").concat(this.eol)).join("")}}class _r extends Vt{print(S){let k="";return k+=this.printGroups(S.groups),k+=this.printMsidSemantic(S.msidSemantic),k+=this.printIceLite(S.iceLite),k+=this.printIceUfrag(S.iceUfrag),k+=this.printIcePwd(S.icePwd),k+=this.printIceOptions(S.iceOptions),k+=this.printFingerprints(S.fingerprints),k+=this.printSetup(S.setup),k+=this.printTlsId(S.tlsId),k+=this.printIdentity(S.identities),k+=this.printExtmap(S.extmaps),k+=this.printUnrecognized(S.unrecognized),k}printGroups(S){let k="";return S.length>0&&(k+=S.map(U=>"a=group:".concat(U.semantic).concat(U.identificationTag.map(Q=>"".concat(h).concat(Q)).join("")).concat(this.eol)).join("")),k}printIceLite(S){return S===void 0?"":"a=ice-lite"+this.eol}printTlsId(S){return S?"a=tls-id:".concat(S).concat(this.eol):""}printIdentity(S){return S.length===0?"":S.map(k=>"a=identity:".concat(k.assertionValue).concat(k.extensions.map(U=>"".concat(h).concat(U.name).concat(U.value?"=".concat(U.value):"")))).join(this.eol)+this.eol}printMsidSemantic(S){if(!S)return"";let k="a=msid-semantic:".concat(S.semantic);return S.applyForAll?k+="".concat(h,"*"):S.identifierList.length>0&&(k+=S.identifierList.map(U=>"".concat(h).concat(U))),k+this.eol}}class z extends Vt{print(S){let k=S.attributes,U="";return U+=this.printRTCP(k.rtcp),U+=this.printIceUfrag(k.iceUfrag),U+=this.printIcePwd(k.icePwd),U+=this.printIceOptions(k.iceOptions),U+=this.printCandidates(k.candidates),U+=this.printRemoteCandidatesList(k.remoteCandidatesList),U+=this.printEndOfCandidates(k.endOfCandidates),U+=this.printFingerprints(k.fingerprints),U+=this.printSetup(k.setup),U+=this.printMid(k.mid),U+=this.printExtmap(k.extmaps),U+=this.printRTPRelated(k),U+=this.printPtime(k.ptime),U+=this.printMaxPtime(k.maxPtime),U+=this.printDirection(k.direction),U+=this.printSSRCGroups(k.ssrcGroups),U+=this.printSSRC(k.ssrcs),U+=this.printRTCPMux(k.rtcpMux),U+=this.printRTCPMuxOnly(k.rtcpMuxOnly),U+=this.printRTCPRsize(k.rtcpRsize),U+=this.printMSId(k.msids),U+=this.printImageattr(k.imageattr),U+=this.printRid(k.rids),U+=this.printSimulcast(k.simulcast),U+=this.printSCTPPort(k.sctpPort),U+=this.printMaxMessageSize(k.maxMessageSize),U+=this.printUnrecognized(k.unrecognized),U}printCandidates(S){return S.map(k=>"a=candidate:".concat(k.foundation).concat(h).concat(k.componentId).concat(h).concat(k.transport).concat(h).concat(k.priority).concat(h).concat(k.connectionAddress).concat(h).concat(k.port).concat(h,"typ").concat(h).concat(k.type).concat(k.relAddr?"".concat(h,"raddr").concat(h).concat(k.relAddr):"").concat(k.relPort?"".concat(h,"rport").concat(h).concat(k.relPort):"").concat(Object.keys(k.extension).map(U=>"".concat(h).concat(U).concat(h).concat(k.extension[U])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(S){return S.map(k=>"a=remote-candidates:".concat(k.join(h)).concat(this.eol)).join("")}printEndOfCandidates(S){return S===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(S){if(!S.payloads)return"";let k=S.payloads,U="";U+=S.rtcpFeedbackWildcards.map(Q=>this.printRTCPFeedback("*",Q)).join("");for(let Q of k)U+=this.printRtpMap(Q.payloadType,Q.rtpMap),U+=this.printFmtp(Q.payloadType,Q.fmtp),U+=Q.rtcpFeedbacks.map(Ce=>this.printRTCPFeedback(Q.payloadType,Ce)).join("");return U}printFmtp(S,k){if(!k)return"";let U=Object.keys(k.parameters);return U.length===1&&k.parameters[U[0]]===null?"a=fmtp:".concat(S).concat(h).concat(U[0]).concat(this.eol):"a=fmtp:".concat(S).concat(h).concat(Object.keys(k.parameters).map(Q=>"".concat(Q,"=").concat(k.parameters[Q])).join(";")).concat(this.eol)}printRtpMap(S,k){return k?"a=rtpmap:".concat(S).concat(h).concat(k.encodingName,"/").concat(k.clockRate).concat(k.encodingParameters?"/".concat(k.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(S,k){let U="a=rtcp-fb:".concat(S).concat(h),Q=k;return Q.type==="trr-int"?U+="ttr-int".concat(h).concat(Q.interval):(U+="".concat(Q.type),Q.parameter&&(U+="".concat(h).concat(Q.parameter),Q.additional&&(U+="".concat(h).concat(Q.additional)))),U+this.eol}printPtime(S){return S===void 0?"":"a=ptime:".concat(S).concat(this.eol)}printMaxPtime(S){return S===void 0?"":"a=maxptime:".concat(S).concat(this.eol)}printDirection(S){return S===void 0?"":"a=".concat(S).concat(this.eol)}printSSRC(S){return S.map(k=>Object.keys(k.attributes).map(U=>"a=ssrc:".concat(k.ssrcId.toString(10)).concat(h).concat(U).concat(k.attributes[U]?":".concat(k.attributes[U]):"").concat(this.eol)).join("")).join("")}printRTCPMux(S){return S===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(S){return S===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(S){return S===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(S){if(S===void 0)return"";let k="a=rtcp:".concat(S.port);return S.netType&&(k+="".concat(h).concat(S.netType)),S.addressType&&(k+="".concat(h).concat(S.addressType)),S.address&&(k+="".concat(h).concat(S.address)),k+this.eol}printMSId(S){return S.map(k=>"a=msid:".concat(k.id).concat(k.appdata?"".concat(h).concat(k.appdata):"").concat(this.eol)).join("")}printImageattr(S){return S.map(k=>"a=imageattr:".concat(k).concat(this.eol)).join("")}printRid(S){return S.map(k=>{let U="a=rid:".concat(k.id).concat(h).concat(k.direction);return k.payloads&&(U+="".concat(h,"pt=").concat(k.payloads.join(","))),k.params.length>0&&(U+="".concat(h).concat(k.params.map(Q=>Q.type==="depend"?"depend=".concat(Q.rids.join(",")):"".concat(Q.type,"=").concat(Q.val)).join(";"))),U+this.eol}).join("")}printSimulcast(S){return S===void 0?"":"a=simulcast:".concat(S).concat(this.eol)}printSCTPPort(S){return S===void 0?"":"a=sctp-port:".concat(S).concat(this.eol)}printMaxMessageSize(S){return S===void 0?"":"a=max-message-size:".concat(S).concat(this.eol)}printMid(S){return S===void 0?"":"a=mid:".concat(S).concat(this.eol)}printSSRCGroups(S){return S.map(k=>"a=ssrc-group:".concat(k.semantic).concat(k.ssrcIds.map(U=>"".concat(h).concat(U.toString(10))).join("")).concat(this.eol)).join("")}}function ee(Y){return new oe().parse(Y)}function le(Y,S){return new Wt().print(Y,S)}}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}return n.d=(r,o)=>{for(var c in o)n.o(o,c)&&!n.o(r,c)&&Object.defineProperty(r,c,{enumerable:!0,get:o[c]})},n.o=(r,o)=>Object.prototype.hasOwnProperty.call(r,o),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();function Ir(e){return kL.parse(e)}function ua(e,t){return kL.print(e,t)}var jZ=ki("Array","keys"),BZ=gs,HZ=Mn,GZ=V,WZ=jZ,vC=Array.prototype,KZ={DOMTokenList:!0,NodeList:!0},qZ=function(e){var t=e.keys;return e===vC||GZ(vC,e)&&t===vC.keys||HZ(KZ,BZ(e))?WZ:t},Yr=a(qZ);function Lt(e,t,n){return(t=function(r){var o=function(c){if(typeof c!="object"||!c)return c;var d=c[Symbol.toPrimitive];if(d!==void 0){var l=d.call(c,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(r);return typeof o=="symbol"?o:o+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function LL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?LL(Object(n),!0).forEach(function(r){Lt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let xL=new class extends Dt{constructor(){super(...arguments),Lt(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class zZ{constructor(t){Lt(this,"logger",void 0),Lt(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function yC(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function UL(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let hi={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},sg=Date.now(),Sh=e=>{for(let t in hi)if(Object.prototype.hasOwnProperty.call(hi,t)&&hi[t]===e)return t;return"DEFAULT"},T=new class{constructor(){Lt(this,"proxyServerURL",void 0),Lt(this,"logLevel",hi.DEBUG),Lt(this,"uploadState","collecting"),Lt(this,"uploadLogWaitingList",[]),Lt(this,"uploadLogUploadingList",[]),Lt(this,"uploadErrorCount",0),Lt(this,"currentLogID",0),Lt(this,"url",void 0),Lt(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[hi.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[hi.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[hi.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[hi.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=[hi.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){nt("UPLOAD_LOG",!0)}disableLogUpload(){nt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new zZ(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-sg<100)return void setTimeout(()=>{this.log(...t)},Date.now()-sg);let r=Math.max(0,Math.min(4,t[0]));if(t[0]=yC()+" Agora-SDK [".concat(Sh(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;let o=yC()+" %cAgora-SDK [".concat(Sh(r),"]:"),c=[];if(!M("USE_NEW_LOG"))switch(r){case hi.DEBUG:c=[o,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,c);break;case hi.INFO:c=[o,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,c);break;case hi.WARNING:c=[o,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,c);break;case hi.ERROR:c=[o,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,c)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-sg<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-sg);let r=Math.max(0,Math.min(4,t[0]));t[0]=yC()+" Agora-SDK [".concat(Sh(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!M("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=UL()+" Agora-SDK [".concat(Sh(e),"]:"):n[0]=UL()+" Agora-SDK [".concat(Sh(e),"]:");let o="";n.forEach(c=>{typeof c=="object"&&(c=JSON.stringify(c)),o+="".concat(c," ")}),this.uploadLogWaitingList.push({payload_str:o,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}uploadLogs(){return P(this,null,function*(){let e=this.uploadLogUploadingList,t={sdk_version:li,process_id:M("PROCESS_ID"),payload:JSON.stringify(e)};return Eo(()=>P(this,null,function*(){let n=yield pr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(M("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(M("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){let r=new Error("unexpected upload log response");throw r.response=n,r}}),()=>(this.uploadLogUploadingList=[],!1),n=>{let r={status:-1,message:n.message,errorRange:e.map(o=>o.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),xL.reportLogUploadError(r),!0},{timeout:M("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:M("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,M("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),M("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),M("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),M("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var FL;function YZ(e){return Tn(e.reportId,"params.reportId",0,100,!1),Tn(e.category,"params.category",0,100,!1),Tn(e.event,"params.event",0,100,!1),Tn(e.label,"params.label",0,100,!1),st(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(FL={}).FREE="free",FL.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});let $Z={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},hn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Rt=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let XZ=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Ee(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){let o=r.value;if(typeof o=="function"){let c=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var d,l=arguments.length,h=new Array(l),f=0;f<l;f++)h[f]=arguments[f];let m=h;if(e.argsMap)try{m=e.argsMap(this,...h)}catch(_){T.warning(_),m=[]}try{JSON.stringify(m)}catch{T.warning("arguments for method ".concat(c,".").concat(String(n)," not serializable for apiInvoke.")),m=[]}let E=(e.report||he).reportApiInvoke(this._sessionId||null,{id:this._clientId||((d=this.store)===null||d===void 0?void 0:d.clientId)||this._ID,name:"".concat(c,".").concat(String(n)),options:m,tag:kt.TRACER,reportResult:e.reportResult},e.throttleTime);try{let _=o.apply(this,h);return _ instanceof ie?_.then(v=>(E.onSuccess(e.reportResult&&v),v)).catch(v=>{throw E.onError(v),v}):(E.onSuccess(e.reportResult&&_),_)}catch(_){throw E.onError(_),_}}}return r}}let he=new class{constructor(){Lt(this,"baseInfoMap",new Map),Lt(this,"proxyServer",void 0),Lt(this,"eventUploadTimer",void 0),Lt(this,"setSessionIdTimer",void 0),Lt(this,"url",void 0),Lt(this,"sids",new Set),Lt(this,"backupUrl",void 0),Lt(this,"_appId",void 0),Lt(this,"_aid",0),Lt(this,"keyEventUploadPendingItems",[]),Lt(this,"normalEventUploadPendingItems",[]),Lt(this,"apiInvokeUploadPendingItems",[]),Lt(this,"apiInvokeCount",0),Lt(this,"apiInvokeLoggedCount",0),Lt(this,"ltsList",[]),Lt(this,"lastSendNormalEventTime",Date.now()),Lt(this,"customReportCounterTimer",void 0),Lt(this,"customReportCount",0),Lt(this,"extApiInvoke",e=>P(this,null,function*(){for(let t of e){let n=we(we({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:kt.TRACER});this.sendApiInvoke(n)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),M("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),M("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[n,r]=t;return n+r}),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;let r=Date.now();this.apiInvokeCount+=1;let o=this.apiInvokeCount,c=!!M("SHOW_REPORT_INVOKER_LOG"),d=!!M("SHOW_REPORT_USER_INVOKER_LOG"),l=c||d&&t.id;l&&(this.apiInvokeLoggedCount+=1);let h=this.apiInvokeLoggedCount;function f(v,A){if(l){let C="[apiInvoke-".concat(h,"]");t.id&&(C+="[".concat(t.id,"]")),t.name&&(C+="[".concat(t.name,"]")),T.info("".concat(C," ").concat(v),v==="start"?t.options:A||"")}}let m=()=>({tag:t.tag,invokeId:o,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null});f("start");let E=!1;Sn(t.timeout).then(()=>{E||(this.sendApiInvoke(we(we({},m()),{},{error:D.API_INVOKE_TIMEOUT,success:!1})),f("timeout"))});let _=new K(D.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:v=>{let A=()=>{if(E)throw _;return E=!0,this.sendApiInvoke(we(we({},m()),{},{success:!0},t.reportResult&&{result:v})),f("onSuccess"),v};return n?vL(A,t.name+"Success",n,()=>E=!0):A()},onError:v=>{let A=()=>{if(E)throw v;E=!0,this.sendApiInvoke(we(we({},m()),{},{success:!1,error:v})),f("onFailure",v.toString())};return n?vL(A,t.name+"Error",n,()=>E=!0):A()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;let o=Object.assign({},{willUploadConsoleLog:M("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:mC?"global":"oversea",areas:M("AREAS")&&M("AREAS").join(",")},t.extend),{stringUid:c,channelProfile:d,channelMode:l,isABTestSuccess:h,lsid:f,clientRole:m}=t,E=Date.now(),_=we(we({},r),{},{eventType:hn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:EC,lts:E,elapse:E-n,extend:JSON.stringify(o),mode:t.mode,process:M("PROCESS_ID"),appType:M("APP_TYPE"),success:!0,version:li,stringUid:c,channelProfile:d,channelMode:l,isABTestSuccess:h,lsid:f,clientType:ne(v=window.navigator.userAgent).call(v,"AgoraWebView")?42:20,clientRole:m,serviceId:M("PROCESS_ID"),extensionID:M("PLUGIN_INFO").join(",")||""});var v;this.send({type:Rt.SESSION,data:_},!0)}joinChooseServer(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we({},r),{},{role:t.role,eventType:hn.JOIN_CHOOSE_SERVER,lts:o,eventElapse:t.elapse||o-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:o-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:Rt.JOIN_CHOOSE_SERVER,data:c},!0)}reqUserAccount(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we({},r),{},{eventType:hn.REQ_USER_ACCOUNT,lts:o,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||o-n.startTime,eventElapse:o-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Rt.REQ_USER_ACCOUNT,data:c},!0)}joinGateway(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;let o=Date.now(),{firstSuccess:c,avoidJoinStartTime:d,addr:l,isProxy:h}=t,f=o-(c&&d?d:n.startTime),m=we(we({},r),{},{eventType:hn.JOIN_GATEWAY,lts:o,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:f,eventElapse:o-t.lts,firstSuccess:c,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:fC(),isABTestSuccess:t.isABTestSuccess?1:0}),E=m.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=o),c)this.send({type:Rt.JOIN_GATEWAY,data:m},!0);else{let _;if(l)if(h){let A=l.match(/h=(\d{1,3}-){3}\d{1,3}/g),C=l.match(/p=[0-9]{1,6}/g);_={isSuccess:E,gatewayIp:A&&A.length?A[0].split("=")[1].replace(/-/g,"."):"",port:C&&C.length?C[0].split("=")[1]:"",isProxy:h?1:0}}else{let A=l.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),C=l.match(/(:|p=)[0-9]{1,6}/g);_={isSuccess:E,gatewayIp:A&&A.length?A[0].split("//")[1].replace(/-/g,"."):"",port:C&&C.length?C[0].split(/:|p=/g)[1]:"",isProxy:h?1:0}}else _={isSuccess:E,gatewayIp:"",port:"",isProxy:h?1:0};delete m.success,delete m.eventType,delete m.firstSuccess,m.vid=Number(m.vid);let v=Object.assign({},m,_,{eventType:hn.REJOIN_GATEWAY});this.send({type:Rt.RE_JOIN_GATEWAY,data:v},!0)}}joinChannelTimeout(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=Date.now(),o=we(we({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:Rt.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we({},r),{},{eventType:hn.PUBLISH,lts:o,eventElapse:t.eventElapse,elapse:o-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Rt.PUBLISH,data:c},!0)}subscribe(e,t,n){let r=this.baseInfoMap.get(e);if(!r)return;let o=r.info,c=Date.now(),d=we(we({},o),{},{eventType:hn.SUBSCRIBE,lts:c,eventElapse:t.eventElapse,elapse:c-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?d.peerSuid=t.peerid:d.peer=t.peerid,this.send({type:Rt.SUBSCRIBE,data:d},!0)}wsCompressorInit(e){var t;let n=[...Yr(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",o=this.baseInfoMap.get(r);if(!o)return;let c=o.info,d=Date.now(),l=we(we({},c),{},{eventType:hn.WS_COMPRESSOR_INIT,lts:d,eventElapse:e.eventElapse,elapse:d-o.startTime,status:e.status?1:2});this.send({type:Rt.WS_COMPRESSOR_INIT,data:l},!0)}firstRemoteVideoDecode(e,t,n,r){let o=this.baseInfoMap.get(e);if(!o)return;let c=o.info,d=Date.now(),l=we(we(we({},c),r),{},{elapse:d-o.startTime,eventType:t,lts:d,firstDecodeFrame:Math.max((r.firstFrame||d)-o.startTime,0),apEnd:Math.max(r.apEnd-o.startTime,0),apStart:Math.max(r.apStart-o.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-o.startTime,0),joinGwStart:Math.max(r.joinGwStart-o.startTime,0),pcEnd:Math.max(r.pcEnd-o.startTime,0),pcStart:Math.max(r.pcStart-o.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-o.startTime,0),subscriberStart:Math.max(r.subscriberStart-o.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-o.startTime,0)});this.send({type:n,data:l},!0)}firstRemoteFrame(e,t,n,r){let o=this.baseInfoMap.get(e);if(!o)return;let c=o.info,d=Date.now(),l=we(we(we({},c),r),{},{elapse:d-o.startTime,eventType:t,lts:d});this.send({type:n,data:l},!0)}abTest(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we(we({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:o-n.startTime,eventType:hn.AB_TEST,lts:o});this.send({type:Rt.AB_TEST,data:c},!0)}pcStats(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we(we({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:o-n.startTime,eventType:hn.PC_STATS,lts:o,preallocation:t.preallocation?1:0});this.send({type:Rt.PC_STATS,data:c},!0)}updateRemoteRTPCapabilities(e,t){if(e){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we(we({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:hn.UPDATE_REMOTE_RTPCAPABILITIES,lts:o});this.send({type:Rt.UPDATE_REMOTE_RTPCAPABILITIES,data:c},!0)}}onGatewayStream(e,t,n,r){let o=this.baseInfoMap.get(e);if(!o)return;let c=o.info,d=Date.now(),l=we(we(we({},c),r),{},{eventType:t,lts:d});this.send({type:n,data:l},!0)}streamSwitch(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we({},r),{},{eventType:hn.STREAM_SWITCH,lts:o,isDual:t.isdual,elapse:o-n.startTime,success:t.succ});this.send({type:Rt.STREAM_SWITCH,data:c},!0)}requestProxyAppCenter(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we({},r),{},{eventType:hn.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Rt.REQUEST_PROXY_APPCENTER,data:c},!0)}requestProxyWorkerManager(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we({},r),{},{eventType:hn.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Rt.REQUEST_PROXY_WORKER_MANAGER,data:c},!0)}setProxyServer(e){this.proxyServer=e,e?T.debug("reportProxyServerurl: ".concat(e)):T.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:o,elapse:o-n.startTime,joinChannelSuccessElapse:o-(n.lastJoinSuccessTime||o),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Rt.PEER_PUBLISH_STATUS,data:c},!0)}workerEvent(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now();(function(c,d,l){let h=c[d];if(!h||typeof h!="string")return[c];c[d]="";let f=Ko(JSON.stringify(c)),m=0,E=[],_=0;for(let v=0;v<h.length;v++)_+=h.charCodeAt(v)<=127?1:3,_<=l-f||(E[E.length]=ae(ae({},c),{},{[d]:h.substring(m,v)}),m=v,_=h.charCodeAt(v)<=127?1:3);return m!==h.length-1&&(E[E.length]=ae(ae({},c),{},{[d]:h.substring(m)})),E})(we(we(we({},r),t),{},{elapse:o-n.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(c=>this.send({type:Rt.WORKER_EVENT,data:c},!0))}apworkerEvent(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we(we({},r),t),{},{elapse:o-n.startTime,lts:o});this.send({type:Rt.AP_WORKER_EVENT,data:c},!0)}joinWebProxyAP(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we(we({},r),t),{},{elapse:o-n.startTime,lts:o,extend:t.extend||void 0});this.send({type:Rt.JOIN_WEB_PROXY_AP,data:c},!0)}WebSocketQuit(e,t){let n=this.baseInfoMap.get(e);if(!n)return;let r=n.info,o=Date.now(),c=we(we(we({},r),t),{},{elapse:o-n.startTime,lts:o});this.send({type:Rt.WEBSOCKET_QUIT,data:c},!0)}sendCustomReportMessage(e,t){return P(this,null,function*(){if(this.customReportCount+=t.length,this.customReportCount>M("CUSTOM_REPORT_LIMIT"))throw new K(D.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let n=Date.now(),r=t.map(o=>({type:Rt.USER_ANALYTICS,data:we(we({sid:e},o),{},{lts:n})}));try{M("NEW_REPORT_SERVER")?yield this.postDataToStatsCollector2(r):yield this.postDataToStatsCollector(r)}catch(o){throw T.error("send custom report message failed",o.toString()),new K(D.CUSTOM_REPORT_SEND_FAILED,o.message)}})}sendApiInvoke(e){let t=M("NOT_REPORT_EVENT");if(e.tag&&ne(t)&&ne(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;let n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:r,uid:o,cid:c}=n.info,d;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof K){let{code:h,message:f}=e.error;d=h||f||e.error.toString()}else d=e.error.toString();let l={invokeId:e.invokeId,sid:e.sid,cname:r,cid:c,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?d:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Rt.API_INVOKE,data:l},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(e.length===0)return;let t=Array.from(this.sids).find(n=>n!==null);t&&e.forEach(n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>M("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let n=[],r=[];for(;e.length;){let c=e.shift();n.length<20?n.push(c):r.push(c)}e.push(...r);for(let c of[...n]){var o;this.ltsList.indexOf(c.data.lts)!==-1?(c.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(c.data.lts)):(this.ltsList.push(c.data.lts),nh(o=this.ltsList).call(o,(d,l)=>d-l))}return t||(this.lastSendNormalEventTime=Date.now()),M("ENABLE_EVENT_REPORT")&&n.length&&(M("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((c=>d=>{M("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(c):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(c),this.normalEventUploadPendingItems.length>M("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-M("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(n)),e}postDataToStatsCollector2(e){return P(this,null,function*(){$t.networkState===Lr.OFFLINE&&(yield ie.race([$t.onlineWaiter,Sn(2*nn.maxRetryTimeout)]));let t=o=>{let c=new Uint8Array;return o.forEach(d=>{let l=nC(JSON.stringify(d.data)),h=new ArrayBuffer(5),f=(E=>{let _=0;return Object.entries(Rt).forEach(v=>{let[A,C]=v;C===E.type&&(_=XZ[A])}),_})(d),m=new DataView(h);m.setUint16(0,l.byteLength,!0),m.setUint8(2,255&f),m.setUint8(3,f>>>8&255),m.setUint8(4,f>>>16&255),c=uL(c,new Uint8Array(h)),c=uL(c,l)}),c},n="event",r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(M("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){o===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(M("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{yield dC(r,{timeout:1e4,data:t(e),headers:we(we({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(c){if(o===1)throw c;continue}return}})}postDataToStatsCollector(t){return P(this,arguments,function*(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=(h=>{let f=h&&h.data.sid&&this.baseInfoMap.get(h.data.sid);return f&&f.info.vid&&+f.info.vid||0})(e[0]),o=r?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(h=>JSON.stringify(h)),vid:r,aid:o};$t.networkState===Lr.OFFLINE&&(yield ie.race([$t.onlineWaiter,Sn(2*nn.maxRetryTimeout)]));let d=n?"/events/proto-raws":"/events/messages",l=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("EVENT_REPORT_DOMAIN"),"&p=").concat(M("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(M("EVENT_REPORT_DOMAIN"),":").concat(M("STATS_COLLECTOR_PORT")).concat(d));for(let h=0;h<2;h+=1){h===1&&(l=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(M("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(M("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(M("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(M("STATS_COLLECTOR_PORT")).concat(d)));try{n?yield LZ(l,{timeout:1e4,data:c}):yield dC(l,{timeout:1e4,data:c})}catch(f){if(h===1)throw f;continue}return}})}createBaseInfo(e,t){let n=Object.assign({},$Z);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){let n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:kt.TRACER}).onSuccess()}};xL.on("REPORT_LOG_UPLOAD",e=>{e.networkState=$t.networkState,he.reportApiInvoke(null,{name:"logUploadError",options:e,tag:kt.TRACER}).onSuccess("logUploadError")});class G extends K{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Lt(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,T)}throw(){super.throw(T)}}let Cn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function He(){return Cn}function VL(){return"setSinkId"in HTMLAudioElement.prototype&&(!M("RESTRICTION_SET_PLAYBACK_DEVICE")||(Ts()||Qk())&&!ZS())}function jL(){return!Cn.supportUnifiedPlan||M("CHROME_FORCE_PLAN_B")&&Ss()}let In=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Kd(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Fe(e,t,n,r,o){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:o}}function Gi(e,t,n,r,o){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:o}}function TC(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let JZ={"90p":Fe(160,90),"90p_1":Fe(160,90),"120p":Fe(160,120,15,30,65),"120p_1":Fe(160,120,15,30,65),"120p_3":Fe(120,120,15,30,50),"120p_4":Fe(212,120),"180p":Fe(320,180,15,30,140),"180p_1":Fe(320,180,15,30,140),"180p_3":Fe(180,180,15,30,100),"180p_4":Fe(240,180,15,30,120),"240p":Fe(320,240,15,40,200),"240p_1":Fe(320,240,15,40,200),"240p_3":Fe(240,240,15,40,140),"240p_4":Fe(424,240,15,40,220),"360p":Fe(640,360,15,80,400),"360p_1":Fe(640,360,15,80,400),"360p_3":Fe(360,360,15,80,260),"360p_4":Fe(640,360,30,80,600),"360p_6":Fe(360,360,30,80,400),"360p_7":Fe(480,360,15,80,320),"360p_8":Fe(480,360,30,80,490),"360p_9":Fe(640,360,15,80,800),"360p_10":Fe(640,360,24,80,800),"360p_11":Fe(640,360,24,80,1e3),"480p":Fe(640,480,15,100,500),"480p_1":Fe(640,480,15,100,500),"480p_2":Fe(640,480,30,100,1e3),"480p_3":Fe(480,480,15,100,400),"480p_4":Fe(640,480,30,100,750),"480p_6":Fe(480,480,30,100,600),"480p_8":Fe(848,480,15,100,610),"480p_9":Fe(848,480,30,100,930),"480p_10":Fe(640,480,10,100,400),"720p":Fe(1280,720,15,120,1130),"720p_auto":Fe(1280,720,30,900,3e3),"720p_1":Fe(1280,720,15,120,1130),"720p_2":Fe(1280,720,30,120,2e3),"720p_3":Fe(1280,720,30,120,1710),"720p_5":Fe(960,720,15,120,910),"720p_6":Fe(960,720,30,120,1380),"1080p":Fe(1920,1080,15,120,2080),"1080p_1":Fe(1920,1080,15,120,2080),"1080p_2":Fe(1920,1080,30,120,3e3),"1080p_3":Fe(1920,1080,30,120,3150),"1080p_5":Fe(1920,1080,60,120,4780),"1440p":Fe(2560,1440,30,120,4850),"1440p_1":Fe(2560,1440,30,120,4850),"1440p_2":Fe(2560,1440,60,120,7350),"4k":Fe(3840,2160,30,120,8910),"4k_1":Fe(3840,2160,30,120,8910),"4k_3":Fe(3840,2160,60,120,13500)},QZ={"480p":Gi(640,480,5),"480p_1":Gi(640,480,5),"480p_2":Gi(640,480,30),"480p_3":Gi(640,480,15),"720p":Gi(1280,720,5),"720p_auto":Fe(1280,720,30,900,3e3),"720p_1":Gi(1280,720,5),"720p_2":Gi(1280,720,30),"720p_3":Gi(1280,720,15),"1080p":Gi(1920,1080,5),"1080p_1":Gi(1920,1080,5),"1080p_2":Gi(1920,1080,30),"1080p_3":Gi(1920,1080,15)},ZZ={"1SL1TL":TC(1,1),"3SL3TL":TC(3,3),"2SL3TL":TC(2,3)};function zo(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},JZ[e]):e}function SC(e){return typeof e=="string"?Object.assign({},QZ[e]):e}function ag(e){return typeof e=="string"?Object.assign({},ZZ[e]):e}let eee={speech_low_quality:Kd(16e3,!1),speech_standard:Kd(32e3,!1,18),music_standard:Kd(48e3,!1),standard_stereo:Kd(48e3,!0,56),high_quality:Kd(48e3,!1,128),high_quality_stereo:Kd(48e3,!0,192)};function cg(e){return typeof e=="string"?Object.assign({},eee[e]):e}let qd=[];function BL(e){return dn(e,"mediaSource",["screen","window","application"]),!0}let de=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),pt=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),zd=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),tee=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),nee=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),lc=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Yd=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),$d=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),Xd=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),$r=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let CC={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},IC={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},HL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},ree={uplinkNetworkQuality:0,downlinkNetworkQuality:0},GL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},rr=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),Xr=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Ch=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),hc=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Gn=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Yo=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),RC={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},dg=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function Ve(e,t,n,r,o){var c,d,l={};return Object.keys(r).forEach(function(h){l[h]=r[h]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=co(c=OD(d=n.slice()).call(d)).call(c,function(h,f){return f(e,t,h)||h},l),o&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(o):void 0,l.initializer=void 0),l.initializer===void 0?(Object.defineProperty(e,t,l),null):l}function H(e,t,n){return(t=function(r){var o=function(c){if(typeof c!="object"||!c)return c;var d=c[Symbol.toPrimitive];if(d!==void 0){var l=d.call(c,"string");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}(r);return typeof o=="symbol"?o:o+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function WL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function wt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?WL(Object(n),!0).forEach(function(r){H(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):WL(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class KL extends Dt{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(lc.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),H(this,"trackMediaType",void 0),H(this,"_ID",void 0),H(this,"_rtpTransceiver",void 0),H(this,"_lowRtpTransceiver",void 0),H(this,"_hints",[]),H(this,"_isClosed",!1),H(this,"_originMediaStreamTrack",void 0),H(this,"mediaStreamTrack",void 0),H(this,"_external",{}),this._ID=n||ht(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(r){ne(qd).call(qd,r)||qd.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||ca(()=>{var n;he.reportApiInvoke(null,{name:tn.GET_MEDIA_STREAM_TRACK,options:[],tag:kt.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===zd.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){let n=qd.indexOf(t);n!==-1&&qd.splice(n,1)}(this),this.emit(Yd.CLOSED),this.removeAllListeners(lc.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===zd.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(lc.TRANSCEIVER_UPDATED,t,n)}}class Jd extends KL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),H(this,"_enabled",!0),H(this,"_muted",!1),H(this,"_isExternalTrack",!1),H(this,"_isClosed",!1),H(this,"_enabledMutex",void 0),H(this,"processor",void 0),H(this,"_processorContext",void 0),H(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new kn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(de.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(r,o){return P(this,arguments,function*(t,n){let c=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=c,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),yield lt(this,de.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))})}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yd.TRACK_ENDED)}stateCheck(t,n){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Cs(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new K(D.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",T);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new K(D.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",T)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ie.resolve([])}}let qL=window.AudioContext||window.webkitAudioContext,Jr=null,rt=new class extends Dt{constructor(){super(...arguments),H(this,"prevState",void 0),H(this,"curState",void 0),H(this,"currentTime",void 0),H(this,"currentTimeStuckAt",void 0),H(this,"interruptDetectorTrack",void 0),H(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(In.IOS_15_16_INTERRUPTION_START)}),H(this,"onLocalAudioTrackUnmute",()=>P(this,null,function*(){T.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?T.info("ios15-interruption-end-canceled"):(Jr&&(yield Jr.suspend()),this.emit(In.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){T.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){T.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Qd(){if(!Jr){if(function(){if(!qL)return void T.error("your browser is not support web audio");T.info("create audio context");let e=wt({},M("WEBAUDIO_INIT_OPTIONS"));T.debug("audio context init option:",JSON.stringify(e)),Jr=new qL(e),rt.curState=Jr.state,Jr.onstatechange=()=>{rt.prevState=rt.curState,rt.curState=Jr?Jr.state:void 0;let{prevState:t,curState:n}=rt,r=n==="running",o=n==="interrupted",c=t==="running",d=t==="suspended",l=t==="interrupted",h=Be().osVersion;(nr()||Bi())&&c&&o&&(T.info("ios".concat(h,"-interruption-start")),rt.emit(In.IOS_INTERRUPTION_START)),(nr()||Bi())&&(d||l)&&r&&(T.info("ios".concat(h,"-interruption-end")),rt.emit(In.IOS_INTERRUPTION_END)),t!==n&&rt.emit(In.STATE_CHANGE,n,t)},setInterval(()=>{var t;let n=(t=Jr)===null||t===void 0?void 0:t.currentTime;rt.currentTime!==n?(rt.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(n)),rt.currentTimeStuckAt=void 0),rt.currentTime=n):(n!==rt.currentTimeStuckAt&&(he.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:kt.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(n))),rt.currentTimeStuckAt=n)},5e3),function(t){return P(this,null,function*(){let n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],r,o=!1,c=!1,d=!1;function l(C){t.state==="running"?h(!1):nr()||Bi()?t.state==="suspended"&&(h(!0),C&&t.resume().then(f,f)):t.state!=="closed"&&(h(!0),C&&t.resume().then(f,f))}function h(C){if(o!==C){o=C;for(let I=0,O=n;I<O.length;I+=1){let N=O[I];C?window.addEventListener(N,m,{capture:!0,passive:!0}):window.removeEventListener(N,m,{capture:!0,passive:!0})}}}function f(){l(!1)}function m(){l(!0)}function E(C){if(!d)if(r.paused)if(C){let I;_(!1),d=!0;try{I=r.play(),I?I.then(v,v):(r.addEventListener("playing",v),r.addEventListener("abort",v),r.addEventListener("error",v))}catch{v()}}else _(!0);else _(!1)}function _(C){if(c!==C){c=C;for(let I=0,O=n;I<O.length;I++){let N=O[I];C?window.addEventListener(N,A,{capture:!0,passive:!0}):window.removeEventListener(N,A,{capture:!0,passive:!0})}}}function v(){r.removeEventListener("playing",v),r.removeEventListener("abort",v),r.removeEventListener("error",v),d=!1,E(!1)}function A(){E(!0)}if(nr()){let C=t.createMediaStreamDestination(),I=document.createElement("div");I.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=I.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=C.stream,E(!0)}rt.on(In.STATE_CHANGE,function(){l(!0)}),l(!1)})}(Jr)}(),!Jr)throw new K(D.NOT_SUPPORTED,"can not create audio context");return Jr}return Jr}function pc(e){if(function(){if(wC!==null)return wC;let r=Qd(),o=r.createBufferSource(),c=r.createGain(),d=r.createGain();o.connect(c),o.connect(d),o.disconnect(c);let l=!1;try{o.disconnect(c)}catch{l=!0}return o.disconnect(),wC=l,l}())return;let t=e.connect,n=e.disconnect;e.connect=(r,o,c)=>{var d;return e._inputNodes||(e._inputNodes=[]),ne(d=e._inputNodes).call(d,r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,o,c)):t.call(e,r,o)),e},e.disconnect=(r,o,c)=>{n.call(e),r?Qm(e._inputNodes,r):e._inputNodes=[];for(let d of e._inputNodes)t.call(e,d)}}let wC=null;function bC(e,t){let n=!1,r=1/t;if(M("DISABLE_WEBAUDIO")){let o=window.setInterval(()=>{n?window.clearInterval(o):e(performance.now()/1e3)},1e3*r)}else{let o=Qd(),c=o.createGain();c.gain.value=0,c.connect(o.destination);let d=()=>{if(n)return void(c=null);let l=o.createOscillator();l.onended=d,l.connect(c),l.start(0),l.stop(o.currentTime+r),e(o.currentTime)};d()}return()=>{n=!0}}class zL{constructor(){H(this,"context",void 0),H(this,"analyserNode",void 0),H(this,"sourceNode",void 0),this.context=Qd(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||nr()||Bi()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let o=0;o<t.length;++o)t[o]=r[o]/128-1}let n=co(t).call(t,(r,o)=>r+o*o,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class YL extends Dt{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),H(this,"outputNode",void 0),H(this,"outputTrack",void 0),H(this,"isPlayed",!1),H(this,"sourceNode",void 0),H(this,"context",void 0),H(this,"audioBufferNode",void 0),H(this,"destNode",void 0),H(this,"audioOutputLevel",0),H(this,"volumeLevelAnalyser",void 0),H(this,"_processedNode",void 0),H(this,"playNode",void 0),H(this,"isDestroyed",!1),H(this,"onNoAudioInput",void 0),H(this,"isNoAudioInput",!1),H(this,"_noAudioInputCount",0),this.context=Qd(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),pc(this.outputNode),this.volumeLevelAnalyser=new zL}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit($r.ON_AUDIO_BUFFER,function(r){for(let o=0;o<r.outputBuffer.numberOfChannels;o+=1){let c=r.outputBuffer.getChannelData(o);for(let d=0;d<c.length;d+=1)c[d]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!He().webAudioMediaStreamDest)throw new K(D.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Zm(()=>{rt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){return P(this,arguments,function*(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;nr()||Bi()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let n=this.volumeLevelAnalyser.getAnalyserNode(),r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let o=!1;for(let c=0;c<r.length;c++)r[c]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(yield Sn(200),(yield this.checkHasAudioInput(t?t+1:1))&&o)})}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class $L extends YL{get isFreeze(){return!1}constructor(t,n,r){var o;if(super(),H(this,"sourceNode",void 0),H(this,"track",void 0),H(this,"clonedTrack",void 0),H(this,"audioElement",void 0),H(this,"isCurrentTrackCloned",!1),H(this,"isRemoteTrack",!1),H(this,"originVolumeLevelAnalyser",void 0),H(this,"rebuildWebAudio",()=>P(this,null,function*(){if(T.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&(yield this.checkHasAudioInput()),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let l=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?l.stop():this.isCurrentTrackCloned=!0;let h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),pc(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),pc(this.outputNode),this.emit($r.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),t.kind!=="audio")throw new K(D.UNEXPECTED_ERROR);this.track=t;let c=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(c),pc(this.sourceNode),r){let l=r.clone();l.enabled=!0,this.clonedTrack=l,T.debug("create an unmuted track ".concat(l.id," from the original track ").concat(r.id," to get the volume"));let h=this.context.createMediaStreamSource(new MediaStream([l]));pc(h),this.originVolumeLevelAnalyser=new zL,this.originVolumeLevelAnalyser.updateSource(h)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=c;let d=Be();n&&d.os===ln.IOS&&Number((o=d.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(rt.on(In.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(l=>{l||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),pc(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit($r.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),rt.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),T.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));let r=this.context.createMediaStreamSource(new MediaStream([n]));pc(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function XL(e,t,n){return P(this,null,function*(){let r=(c,d)=>c?typeof c!="number"?c.max||c.exact||c.ideal||c.min||d:c:d,o={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(o.video.mandatory.maxFrameRate=t.frameRate.max,o.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(o.video.mandatory.maxFrameRate=t.frameRate),yield navigator.mediaDevices.getUserMedia(o)})}function iee(e,t){return P(this,null,function*(){let n=yield JL(e.mediaSource),{sourceId:r,audio:o}=yield function(c){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ie((l,h)=>{let f=document.createElement("div");f.innerText="share screen",f.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let E=document.createElement("div");E.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",E.setAttribute("style","height: 12%;");let _=document.createElement("div");_.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let v=document.createElement("div");v.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let A=document.createElement("button");A.innerHTML="cancel",A.setAttribute("style","width: 85px;"),A.onclick=()=>{document.body.removeChild(O);let N=new Error("NotAllowedError");N.name="NotAllowedError",h(N)};let C=d,I=document.createElement("div");if(d){let N=document.createElement("input");N.setAttribute("type","checkbox");let x=document.createElement("span");N.setAttribute("style","margin-right: 6px;"),x.innerText="Share audio",N.checked=C,N.onchange=()=>{C=N.checked},I.appendChild(N),I.appendChild(x)}v.appendChild(I),v.appendChild(A),m.appendChild(E),m.appendChild(_),m.appendChild(v);let O=document.createElement("div");O.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),O.appendChild(f),O.appendChild(m),document.body.appendChild(O),c.map(N=>{if(N.id){let x=document.createElement("div");x.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let B=N.thumbnail;try{let{width:j}=B.getSize();j>1920&&(B=B.resize({width:1920}))}catch(j){throw j&&j.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),j}x.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+B.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+N.name.replace(/[\u00A0-\u9999<>\&]/g,function(j){return"&#"+j.charCodeAt(0)+";"})+"</span>",x.onclick=()=>{document.body.removeChild(O),l({sourceId:N.id,audio:C})},_.appendChild(x)}})})}(n,t);return yield XL(r,e,o)})}function JL(e){return P(this,null,function*(){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let n=lL();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new K(D.ELECTRON_IS_NULL);let r=null;try{var o;r=((o=n.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new ie((c,d)=>{n.desktopCapturer.getSources({types:t},(l,h)=>{l?d(l):c(h)})}));try{return yield r}catch(c){throw new K(D.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,c.toString())}})}let AC=new kn("safari"),QL=!1,ZL=!1;function Qr(e,t){return P(this,null,function*(){let n=0,r=null;for(;n<2;)try{r=yield oee(e,t,n>0);break}catch(o){if(o instanceof K)throw T.error("[".concat(t,"] ").concat(o.toString())),o;let c=ug(o.name||o.code||o,o.message);if(c.code===D.MEDIA_OPTION_INVALID){T.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,yield Sn(500);continue}throw T.error("[".concat(t,"] ").concat(c.toString())),c}if(!r)throw new K(D.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r})}function oee(e,t,n){return P(this,null,function*(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new K(D.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let r=He(),o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return T.debug("Using Video Source/ Audio Source"),o;if(e.screen)if(lL())e.screen.sourceId?Zd(o,yield XL(e.screen.sourceId,e.screen,!!e.screenAudio)):Zd(o,yield iee(e.screen,!!e.screenAudio));else if(Ts()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new K(D.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let _=yield(d=e.screen.extensionId,l=t,new ie((v,A)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},C=>{if(!C||!C.streamId)return T.error("[".concat(l,"] No response from Chrome Plugin. Plugin not installed properly"),C),void A(new K(D.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));v(C.streamId)})}catch(C){T.error("[".concat(l,"] AgoraRTC screensharing plugin is not accessible(").concat(d,")"),C.toString()),A(new K(D.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=_,Zd(o,yield navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var c;e.screen.mediaSource&&BL(e.screen.mediaSource);let _={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(c=e.screen.displaySurface)!==null&&c!==void 0?c:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:v,surfaceSwitching:A,systemAudio:C,preferCurrentTab:I}=e.screen,O={selfBrowserSurface:v,surfaceSwitching:A,systemAudio:C,preferCurrentTab:I};!v&&delete O.selfBrowserSurface,!A&&delete O.surfaceSwitching,!C&&delete O.systemAudio,!I&&delete O.preferCurrentTab,T.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:_,audio:e.screenAudio,controls:O})),Zd(o,yield navigator.mediaDevices.getDisplayMedia(wt({video:_,audio:e.screenAudio},O)))}else{if(!xt())throw T.error("[".concat(t,"] This browser does not support screenSharing")),new K(D.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&BL(e.screen.mediaSource);let _={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};T.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(_))),Zd(o,yield navigator.mediaDevices.getUserMedia(_))}}var d,l;if(!e.video&&!e.audio)return o;let h={video:e.video,audio:e.audio},f=M("MEDIA_DEVICE_CONSTRAINTS");if(f)try{typeof f=="string"&&(f=JSON.parse(f)),h=oC(h,f)}catch{}T.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(h)),Be();let m,E=null;(wn()||nr()||Xm())&&(E=yield AC.lock());try{m=yield navigator.mediaDevices.getUserMedia(h)}catch(_){throw E&&E(),_}return h.audio&&(QL=!0),h.video&&(ZL=!0),Zd(o,m),E&&E(),o})}function ug(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new K(D.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new K(D.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new K(D.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new K(D.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new K(D.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new K(D.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return T.error("getUserMedia unexpected error",e),new K(D.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Zd(e,t){let n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],o=t.getVideoTracks()[0],c=t.getAudioTracks()[0];c&&(r&&e.removeTrack(r),e.addTrack(c)),o&&(n&&e.removeTrack(n),e.addTrack(o))}let Zr=new class extends Dt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(hc.STATE_CHANGE,e),this._state=e)}constructor(){super(),H(this,"_state",Ch.IDLE),H(this,"isAccessMicrophonePermission",!1),H(this,"isAccessCameraPermission",!1),H(this,"lastAccessMicrophonePermission",!1),H(this,"lastAccessCameraPermission",!1),H(this,"checkdeviceMatched",!1),H(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(M("ENUMERATE_DEVICES_INTERVAL")||(Jm()||$m()===ln.HARMONY_OS)&&Ss())&&this.updateDevicesInfo()},M("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>T.error(e.toString()))}enumerateDevices(n,r){return P(this,arguments,function*(e,t){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new K(D.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let c=yield navigator.mediaDevices.enumerateDevices(),d=this.checkMediaDeviceInfoIsOk(c),l=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&t;d.audio&&(l=!1),d.video&&(h=!1);let f=null,m=null,E=null;if(!o&&(l||h)){if(AC.isLocked&&(T.debug("[device manager] wait GUM lock"),(yield AC.lock())(),T.debug("[device manager] GUM unlock")),QL&&(l=!1,this.isAccessMicrophonePermission=!0),ZL&&(h=!1,this.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",e,t,l,h),l&&h){try{E=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){let v=ug(_.name||_.code||_,_.message);if(v.code===D.PERMISSION_DENIED)throw v;T.warning("getUserMedia failed in getDevices",v)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{f=yield navigator.mediaDevices.getUserMedia({audio:e})}catch(_){let v=ug(_.name||_.code||_,_.message);if(v.code===D.PERMISSION_DENIED)throw v;T.warning("getUserMedia failed in getDevices",v)}this.isAccessMicrophonePermission=!0}else if(h){try{m=yield navigator.mediaDevices.getUserMedia({video:t})}catch(_){let v=ug(_.name||_.code||_,_.message);if(v.code===D.PERMISSION_DENIED)throw v;T.warning("getUserMedia failed in getDevices",v)}this.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",e,"cam permission",t)}try{let _=yield navigator.mediaDevices.enumerateDevices();return f&&f.getTracks().forEach(v=>v.stop()),m&&m.getTracks().forEach(v=>v.stop()),E&&E.getTracks().forEach(v=>v.stop()),f=null,m=null,E=null,_}catch(_){return f&&f.getTracks().forEach(v=>v.stop()),m&&m.getTracks().forEach(v=>v.stop()),E&&E.getTracks().forEach(v=>v.stop()),f=null,m=null,E=null,new K(D.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}})}getRecordingDevices(){return P(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(yield this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")})}getCamerasDevices(){return P(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(yield this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")})}getSpeakers(){return P(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(yield this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")})}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}getDeviceById(e){return P(this,null,function*(){let t=(yield this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new K(D.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t})}init(){return P(this,null,function*(){this.state=Ch.INITING;try{yield this.updateDevicesInfo(),this.state=Ch.INITEND}catch(e){throw T.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Ch.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new K(D.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}})}updateDevicesInfo(){return P(this,null,function*(){let e=yield this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let o=e.find(d=>d.kind==="audioinput"&&d.deviceId==="default"),c=e.find(d=>d.kind==="audiooutput"&&d.deviceId==="default");o&&c?c.groupId===o.groupId?T.debug("[device-check] default input ".concat(o.label," and output ").concat(c.label," is the same group")):T.debug("[device-check] default input ".concat(o.label," and output ").concat(c.label," is not the same group")):T.debug("[device-check] default input or output not found")}let r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(o=>{if(!o.deviceId)return;let c=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((c?c.state:"INACTIVE")!=="ACTIVE"){let d={initAt:t,updateAt:t,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),d),n.push(d)}c&&(c.updateAt=t)}),this.deviceInfoMap.forEach((o,c)=>{o.state==="ACTIVE"&&o.updateAt!==t&&(o.state="INACTIVE",n.push(o))}),this.state!==Ch.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(o=>{switch(o.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(hc.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(hc.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(hc.PLAYOUT_DEVICE_CHANGED,o)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)})}checkMediaDeviceInfoIsOk(e){let t=e.filter(o=>o.kind==="audioinput"),n=e.filter(o=>o.kind==="videoinput"),r={audio:!1,video:!1};for(let o of t)if(o.label&&o.deviceId){r.audio=!0;break}for(let o of n)if(o.label&&o.deviceId){r.video=!0;break}return r}},DC=!1,ei=new class extends Dt{constructor(){super(...arguments),H(this,"onAutoplayFailed",void 0),H(this,"onAudioAutoplayFailed",void 0)}};function e1(){if(Be(),!DC){let e=t=>{t.preventDefault(),DC=!1,fh()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};DC=!0,fh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ei.onAutoplayFailed?ei.onAutoplayFailed():ei.onAudioAutoplayFailed?T.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):T.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ei.emit("autoplay-failed")}}function t1(e,t,n,r){if(!e)return;let o=he.getBaseInfoBySessionId(e);if(!o)return;let c=o.info,d=Date.now(),l=wt(wt({},c),{},{vid:c.vid===void 0?0:Number(c.vid),lts:d,elapse:d-o.startTime,cbRegistered:ei.onAutoplayFailed||ei.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});he.send({type:Rt.AUTOPLAY_FAILED,data:l},!0)}let see=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],fr=new class{constructor(){H(this,"onAutoplayFailed",void 0),H(this,"elementMap",new Map),H(this,"elementStateMap",new Map),H(this,"elementsNeedToResume",[]),H(this,"sinkIdMap",new Map),H(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,r]=t,o=this.elementStateMap.get(n),c=r.srcObject.getAudioTracks()[0],d=c&&c.readyState;if(T.debug("resume after interrupted, ele: ".concat(o," audio: ").concat(d," ").concat(e)),d==="live"){if(e)return r.pause(),void r.play();if(rt.curState==="running")return jd()?(r.pause(),void r.play()):void(o&&o==="paused"&&r.play())}})}),H(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e,r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),rt.on(In.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),rt.on(In.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),rt.on(In.STATE_CHANGE,()=>{nr()&&rt.prevState==="suspended"&&rt.curState==="running"&&this.autoResumeAfterInterruption()})}setSinkID(e,t){return P(this,null,function*(){let n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{yield n.setSinkId(t)}catch(r){throw new K(D.PERMISSION_DENIED,"can not set sink id: "+r.toString())}})}play(e,t,n,r){if(this.elementMap.has(t))return;let o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,o),this.elementMap.set(t,o),this.elementStateMap.set(t,Gn.INIT),this.setVolume(t,n);let c=this.sinkIdMap.get(t);if(c)try{o.setSinkId(c).catch(l=>{T.warning("[".concat(t,"] set sink id failed"),l.toString())})}catch(l){T.warning("[".concat(t,"] set sink id failed"),l.toString())}let d=o.play();d&&d.then&&d.catch(l=>{r&&t1(r,"audio",l.message,t),T.warning("audio element play warning",l.toString()),this.elementMap.has(t)&&l.name==="NotAllowedError"&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),Zm(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),e1()}))})}updateTrack(e,t){let n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){see.forEach(n=>{t.addEventListener(n,r=>{let o=this.elementStateMap.get(e),c=r.type==="pause"?"paused":r.type;if(T.debug("[".concat(e,"] audio-element-status change ").concat(o," => ").concat(c)),r.type==="error"){let d=t?.error;d&&T.error("[".concat(e,"] media error, code: ").concat(d.code,", message: ").concat(d.message))}this.elementStateMap.set(e,c)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{T.debug("Auto resume audio element success")}).catch(n=>{T.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new ie(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{fh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Ht(){return function(e,t,n){let r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new K(D.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",T);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];let l=r.apply(this,c);return l instanceof ie?new ie((h,f)=>{l.then(h).catch(f)}):l}),n}}class n1 extends Dt{constructor(t){super(),H(this,"name","VideoProcessorDestination"),H(this,"ID","0"),H(this,"_source",void 0),H(this,"videoContext",void 0),H(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new K(D.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new K(D.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(rr.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(rr.ON_TRACK,void 0)}}class r1 extends Dt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),H(this,"constraintsMap",new Map),H(this,"statsRegistry",[]),H(this,"usageRegistry",[]),H(this,"trackId",void 0),H(this,"direction",void 0),H(this,"_chained",!1),this.trackId=t,this.direction=n}getConstraints(){return P(this,null,function*(){return yield An(this,Xr.REQUEST_CONSTRAINTS)})}requestApplyConstraints(t,n){return P(this,null,function*(){var r;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),lt(this,Xr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Wr(r=this.constraintsMap).call(r)))})}requestRevertConstraints(t){return P(this,null,function*(){var n;if(this.constraintsMap.has(t))return T.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),lt(this,Xr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Wr(n=this.constraintsMap).call(n)))})}registerStats(t,n,r){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){let r=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){let t=[];for(let{processorID:n,processorName:r,type:o,cb:c}of this.statsRegistry)try{let d=c();t.push({processorID:n,processorName:r,type:o,stats:d})}catch(d){T.error(new K(D.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){let n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}gatherUsage(){return P(this,null,function*(){let t=[];if(!this.chained)return[];for(let{cb:n}of this.usageRegistry)try{let r=n();r instanceof ie&&(r=yield r),t.push(wt(wt({},r),{},{direction:this.direction}))}catch(r){T.error("gather extension usage error",r)}return t})}getDirection(){return this.direction}}class i1 extends Dt{constructor(t){super(),H(this,"name","AudioProcessorDestination"),H(this,"ID","0"),H(this,"inputTrack",void 0),H(this,"inputNode",void 0),H(this,"audioProcessorContext",void 0),H(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new K(D.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new K(D.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(rr.ON_TRACK,void 0),this.emit(rr.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(rr.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(rr.ON_NODE,this.inputNode))}}class o1 extends Dt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),H(this,"constraintsMap",new Map),H(this,"statsRegistry",[]),H(this,"audioContext",void 0),H(this,"trackId",void 0),H(this,"direction",void 0),H(this,"usageRegistry",[]),H(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}getConstraints(){return P(this,null,function*(){return An(this,Xr.REQUEST_CONSTRAINTS)})}getAudioContext(){return this.audioContext}requestApplyConstraints(t,n){return P(this,null,function*(){var r;return T.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),lt(this,Xr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Wr(r=this.constraintsMap).call(r)))})}requestRevertConstraints(t){return P(this,null,function*(){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),lt(this,Xr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Wr(n=this.constraintsMap).call(n)))})}registerStats(t,n,r){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){let r=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){let t=[];for(let{processorID:n,processorName:r,type:o,cb:c}of this.statsRegistry)try{let d=c();t.push({processorID:n,processorName:r,type:o,stats:d})}catch(d){T.error(new K(D.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){let n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}gatherUsage(){return P(this,null,function*(){let t=[];if(!this.chained)return[];for(let{cb:n}of this.usageRegistry)try{let r=n();r instanceof ie&&(r=yield r),t.push(wt(wt({},r),{},{direction:this.direction}))}catch(r){T.error("gather extension usage error",r)}return t})}getDirection(){return this.direction}}class OC extends Dt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),H(this,"context",void 0),H(this,"processSourceNode",void 0),H(this,"outputTrack",void 0),H(this,"processedNode",void 0),H(this,"clonedTrack",void 0),H(this,"outputNode",void 0),this.outputNode=new aee}setVolume(){}createOutputTrack(){throw new K(D.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class aee{disconnect(){}connect(){}}function s1(e){return new ie((t,n)=>{let r=!1,o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);let c=nr()?"canplay":"playing";o.addEventListener(c,()=>{let d=o.videoWidth,l=o.videoHeight;!d&&xt()||(r=!0,o.srcObject=null,o.remove(),t([d,l]))}),o.srcObject=new MediaStream([e]),o.play().catch(eg),setTimeout(()=>{r||(o.srcObject=null,o.remove(),t([o.videoWidth,o.videoHeight]))},4e3)})}function lg(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let n=zo(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!sL()&&n.frameRate&&(t.frameRate=n.frameRate),Qk()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),xt()&&(t.frameRate={ideal:30,max:30}),t}function a1(e){let t={};return sL()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Ts()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function c1(e){let t=a1(e);if(e.encoderConfig){let n=cg(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Jm()&&(t.sampleRate=void 0),t}let cee=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:n,width:r,height:o}=e.getMediaStreamTrackSettings(),{frameRate:c=n,width:d=r,height:l=o}=t;if(!c||!d||!l)return;d=sC(d),l=sC(l),c=sC(c);let{max:h,min:f}=function(v,A,C){let I=200*Math.pow(C/15,.6)*Math.pow(v*A/640/360,.75);return{min:Math.floor(I),max:Math.floor(4*I)}}(d,l,c),{bitrateMax:m,bitrateMin:E}=t||{};m||T.debug("calculate bitrate: [w: ".concat(d,", h: ").concat(l,", fps: ").concat(c,"] => [brMax: ").concat(m,", brMin: ").concat(E,"]"));let{maxFramerate:_}=M("ENCODER_CONFIG_LIMIT");return _&&typeof _=="number"&&(c=Math.min(c,_)),{frameRate:c,bitrateMax:m||h,bitrateMin:E||f,scaleResolutionDownBy:1,scale:0}},d1=(e,t,n)=>P(this,null,function*(){return yield((r,o,c)=>P(this,null,function*(){let d=function(f){let m=[];for(let E=0;E<f.length;E+=2)m.push(parseInt(f.slice(E,E+2),16));return Uint8Array.from(m)}(SL(""+o+c)).slice(0,16),l=d.slice(0,12),h=yield window.crypto.subtle.importKey("raw",d,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:l},h,r))}))(e.buffer,t,n)}),NC=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new ie((n,r)=>{t.toBlob(o=>P(this,null,function*(){if(t.remove(),o){let c=yield u1(o);n({buffer:c,width:t.width,height:t.height})}else r(new K(D.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)})},u1=e=>P(this,null,function*(){let t=yield e.arrayBuffer();return new Uint8Array(t)});var l1,h1,p1,f1,m1,g1,E1,_1,v1,y1,T1,S1,C1,I1,R1,w1,b1,A1,Nt,D1,O1,N1,P1,M1,k1,$o,L1,x1,U1,F1,V1,j1,B1,H1,G1,W1,K1,q1,z1,On;let Ft=(l1=Ee({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),h1=Ee({argsMap:(e,t)=>[e.getTrackId(),t]}),p1=Ht(),f1=Gd("LocalAudioTrack","_enabledMutex"),m1=Ee({argsMap:(e,t)=>[e.getTrackId(),t]}),g1=Ht(),E1=Gd("LocalAudioTrack","_enabledMutex"),_1=Ee({argsMap:(e,t)=>[e.getTrackId(),t]}),v1=Ht(),y1=Ht(),T1=Ht(),S1=Ee({argsMap:e=>[e.getTrackId()]}),C1=Ht(),I1=Ee({argsMap:e=>[e.getTrackId()]}),R1=Ht(),w1=Ee({argsMap:e=>[e.getTrackId()]}),b1=Ee({argsMap:(e,t)=>[e.getTrackId(),t.name]}),A1=Ee({argsMap:e=>[e.getTrackId()]}),Ve((Nt=class extends Jd{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?fr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),H(this,"trackMediaType",Xd.AUDIO),H(this,"_encoderConfig",void 0),H(this,"_trackSource",void 0),H(this,"metadata",[]),H(this,"_enabled",!0),H(this,"_volume",100),H(this,"_useAudioElement",!0),H(this,"_bypassWebAudio",!1),H(this,"processor",void 0),H(this,"_processorContext",void 0),H(this,"_processorDestination",void 0),H(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new OC,M("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),M("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),wn()&&!Jr?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){st(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&fr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,lt(this,de.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(e){return P(this,null,function*(){if(!this._useAudioElement||!VL())throw new K(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield fr.setSinkID(this.getTrackId(),e)})}setEnabled(e,t,n){return P(this,null,function*(){return this._setEnabled(e,t,n)})}_setEnabled(e,t,n){return P(this,null,function*(){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),yield lt(this,de.NEED_ENABLE_TRACK,this),T.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{yield lt(this,de.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}})}setMuted(e){return P(this,null,function*(){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?yield lt(this,de.NEED_MUTE_TRACK,this):yield lt(this,de.NEED_UNMUTE_TRACK,this))})}getStats(){return ca(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),qr(this,de.GET_STATS)||wt({},CC)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners($r.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners($r.ON_AUDIO_BUFFER),this._source.on($r.ON_AUDIO_BUFFER,n=>e(n))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),fr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?fr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&fr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(e,t){return P(this,null,function*(){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),yield lt(this,de.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))})}renewMediaStreamTrack(e){return ie.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new K(D.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new K(D.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(rr.ON_TRACK,t=>P(this,null,function*(){t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),yield lt(this,de.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),yield lt(this,de.NEED_REPLACE_TRACK,this))})),e.on(rr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(rr.ON_TRACK),e.removeAllListeners(rr.ON_NODE)}bindProcessorContextEvents(e){e.on(Xr.REQUEST_CONSTRAINTS,t=>P(this,null,function*(){t(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(Xr.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof OC&&(this._trackSource=new $L(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new o1(this._source.context,this.getTrackId(),"local"),t=new i1(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on($r.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(fr.stop(this.getTrackId()),this._source.play()),lt(this,de.NEED_REPLACE_MIXING_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{T.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[l1],Object.getOwnPropertyDescriptor(Nt.prototype,"setVolume"),Nt.prototype),Ve(Nt.prototype,"setPlaybackDevice",[h1,p1],Object.getOwnPropertyDescriptor(Nt.prototype,"setPlaybackDevice"),Nt.prototype),Ve(Nt.prototype,"setEnabled",[f1,m1,g1],Object.getOwnPropertyDescriptor(Nt.prototype,"setEnabled"),Nt.prototype),Ve(Nt.prototype,"setMuted",[E1,_1,v1],Object.getOwnPropertyDescriptor(Nt.prototype,"setMuted"),Nt.prototype),Ve(Nt.prototype,"getStats",[y1],Object.getOwnPropertyDescriptor(Nt.prototype,"getStats"),Nt.prototype),Ve(Nt.prototype,"setAudioFrameCallback",[T1],Object.getOwnPropertyDescriptor(Nt.prototype,"setAudioFrameCallback"),Nt.prototype),Ve(Nt.prototype,"play",[S1,C1],Object.getOwnPropertyDescriptor(Nt.prototype,"play"),Nt.prototype),Ve(Nt.prototype,"stop",[I1,R1],Object.getOwnPropertyDescriptor(Nt.prototype,"stop"),Nt.prototype),Ve(Nt.prototype,"close",[w1],Object.getOwnPropertyDescriptor(Nt.prototype,"close"),Nt.prototype),Ve(Nt.prototype,"pipe",[b1],Object.getOwnPropertyDescriptor(Nt.prototype,"pipe"),Nt.prototype),Ve(Nt.prototype,"unpipe",[A1],Object.getOwnPropertyDescriptor(Nt.prototype,"unpipe"),Nt.prototype),Nt),hg=(D1=Ee({argsMap:(e,t)=>[e.getTrackId(),t]}),O1=Ht(),N1=Gd("MicrophoneAudioTrack","_enabledMutex"),P1=Ee({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),M1=Ht(),k1=Ee({argsMap:e=>[e.getTrackId()]}),Ve(($o=class e extends Ft{get __className__(){return"MicrophoneAudioTrack"}constructor(t,n,r,o){super(t,n.encoderConfig?cg(n.encoderConfig):{},o,M("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),H(this,"_config",void 0),H(this,"_deviceName","default"),H(this,"_constraints",void 0),H(this,"_originalConstraints",void 0),H(this,"_enabled",!0),this._config=n,this._constraints=r,this._originalConstraints=r,this._deviceName=t.label,typeof n.bypassWebAudio=="boolean"&&(this._bypassWebAudio=n.bypassWebAudio),(jd()||QS())&&rt.bindInterruptDetectorTrack(this)}setDevice(t){return P(this,null,function*(){if(T.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{let n=yield Zr.getDeviceById(t),r={};r.audio=wt({},this._constraints),r.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let o=null;try{o=yield Qr(r,this.getTrackId())}catch(c){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=yield Qr({audio:this._constraints},this.getTrackId()),yield this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}yield this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=n.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{let n=yield Zr.getDeviceById(t);this._deviceName=n.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}T.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))})}setEnabled(t,n,r){return P(this,null,function*(){if(n)return T.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),yield iR(e.prototype,this,"_setEnabled").call(this,t);if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),M("AUTO_RESET_AUDIO_ROUTE")&&(nr()||Bi())){let l=navigator.audioSession;l&&(t||(l.type="playback"),l.type="auto")}if(!t){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),r||(this._enabled=!1);try{yield lt(this,de.NEED_DISABLE_TRACK,this)}catch(l){throw T.error("[".concat(this.getTrackId(),"] setEnabled false failed"),l.toString()),l}return}let c=wt({},this._constraints),d=Zr.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{r||(this._enabled=!0);let l=yield Qr({audio:this._constraints},this.getTrackId());yield this._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),yield lt(this,de.NEED_ENABLE_TRACK,this)}catch(l){throw r||(this._enabled=!1),T.error("[".concat(this.getTrackId(),"] setEnabled true failed"),l.toString()),l}T.info("[".concat(this.getTrackId(),"] setEnabled success"))})}close(){super.close(),(jd()||QS())&&rt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((nr()||Bi())&&this._enabled&&!this._isClosed&&rt.duringInterruption){let t=()=>P(this,null,function*(){rt.off(In.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield this.setEnabled(!1),yield this.setEnabled(!0))});rt.on(In.IOS_INTERRUPTION_END,t)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yd.TRACK_ENDED)}renewMediaStreamTrack(t){return P(this,null,function*(){let n=t||this._constraints,r=Zr.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId=r),this._constraints=n,this._enabled){this._originMediaStreamTrack.stop();let o=yield Qr({audio:this._constraints},this.getTrackId());yield this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}})}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Xr.REQUEST_UPDATE_CONSTRAINTS,(n,r,o)=>P(this,null,function*(){try{let c=Object.assign({},this._originalConstraints,...n);yield this.renewMediaStreamTrack(c),r()}catch(c){o(c)}}))}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Xr.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[D1,O1],Object.getOwnPropertyDescriptor($o.prototype,"setDevice"),$o.prototype),Ve($o.prototype,"setEnabled",[N1,P1,M1],Object.getOwnPropertyDescriptor($o.prototype,"setEnabled"),$o.prototype),Ve($o.prototype,"close",[k1],Object.getOwnPropertyDescriptor($o.prototype,"close"),$o.prototype),$o),dee=(L1=Ee({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),x1=Ht(),U1=Ee({argsMap:e=>[e.getTrackId()]}),F1=Ht(),V1=Ee({argsMap:e=>[e.getTrackId()]}),j1=Ht(),B1=Ee({argsMap:e=>[e.getTrackId()]}),H1=Ht(),G1=Ee({argsMap:e=>[e.getTrackId()]}),W1=Ht(),K1=Ee({argsMap:e=>[e.getTrackId()]}),q1=Ee({argsMap:e=>[e.getTrackId()]}),z1=Ht(),Ve((On=class extends Ft{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),H(this,"source",void 0),H(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on($r.AUDIO_SOURCE_STATE_CHANGE,o=>{this.safeEmit(Yd.SOURCE_STATE_CHANGE,o)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){st(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[L1,x1],Object.getOwnPropertyDescriptor(On.prototype,"startProcessAudioBuffer"),On.prototype),Ve(On.prototype,"pauseProcessAudioBuffer",[U1,F1],Object.getOwnPropertyDescriptor(On.prototype,"pauseProcessAudioBuffer"),On.prototype),Ve(On.prototype,"seekAudioBuffer",[V1,j1],Object.getOwnPropertyDescriptor(On.prototype,"seekAudioBuffer"),On.prototype),Ve(On.prototype,"resumeProcessAudioBuffer",[B1,H1],Object.getOwnPropertyDescriptor(On.prototype,"resumeProcessAudioBuffer"),On.prototype),Ve(On.prototype,"stopProcessAudioBuffer",[G1,W1],Object.getOwnPropertyDescriptor(On.prototype,"stopProcessAudioBuffer"),On.prototype),Ve(On.prototype,"close",[K1],Object.getOwnPropertyDescriptor(On.prototype,"close"),On.prototype),Ve(On.prototype,"setAudioBufferPlaybackSpeed",[q1,z1],Object.getOwnPropertyDescriptor(On.prototype,"setAudioBufferPlaybackSpeed"),On.prototype),On);class sn extends Ft{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=Qd().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,ht(8,"track-mix-")),H(this,"trackList",void 0),H(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(T.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):T.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){T.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}Qm(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof sn?n.emit(lc.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class uee extends YL{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit($r.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),H(this,"audioBuffer",void 0),H(this,"sourceNode",void 0),H(this,"startPlayTime",0),H(this,"startPlayOffset",0),H(this,"pausePlayTime",0),H(this,"options",void 0),H(this,"currentLoopCount",0),H(this,"currentPlaybackSpeed",100),H(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let Y1=new Map;class PC{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let t=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){H(this,"trackId",void 0),H(this,"config",void 0),H(this,"onFirstVideoFrameDecoded",void 0),H(this,"onVideoStateChanged",void 0),H(this,"freezeTimeCounterList",[]),H(this,"renderFreezeAccTime",0),H(this,"isKeepLastFrame",!1),H(this,"timeUpdatedCount",0),H(this,"freezeTime",0),H(this,"playbackTime",0),H(this,"lastTimeUpdatedTime",0),H(this,"autoplayFailed",!1),H(this,"videoTrack",void 0),H(this,"videoElement",void 0),H(this,"cacheVideoElement",void 0),H(this,"renderStats",void 0),H(this,"_videoState",Yo.VideoStateStopped),H(this,"videoElementCheckInterval",void 0),H(this,"videoElementFreezeTimeout",void 0),H(this,"_videoElementStatus",Gn.NONE),H(this,"isGettingVideoDimensions",!1),H(this,"startGetVideoDimensions",()=>{let n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),H(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&rt.curState==="running"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Jk())),iL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),H(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Gn.PLAYING;break;case"loadeddata":if(this.videoState=Yo.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Gn.CANPLAY;break;case"stalled":this.videoElementStatus=Gn.STALLED;break;case"suspend":this.videoElementStatus=Gn.SUSPEND;break;case"pause":this.videoElementStatus=Gn.PAUSED,nr()||Bi()||wn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Gn.WAITING;break;case"abort":this.videoElementStatus=Gn.ABORT;break;case"ended":this.videoElementStatus=Gn.ENDED;break;case"emptied":this.videoElementStatus=Gn.EMPTIED;break;case"error":{let r=this.videoElement.error;r&&(this.videoElementStatus=Gn.ERROR,T.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")")));break}case"timeupdate":{let r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);let o=r-this.lastTimeUpdatedTime,c=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Rs.lastVisibleTime<Rs.lastHiddenTime||c<Rs.lastHiddenTime||c<Rs.lastVisibleTime)return;for(o>M("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;let d=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(d),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),H(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Jk())),iL()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),rt.on(In.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),rt.on(In.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let n=this.videoElement.play();n&&n.catch&&n.catch(o=>{t&&t1(t,"video",o.message,this.trackId),o.name==="NotAllowedError"?(T.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),o)});let r=Be();if((r.name==="Safari"&&Number(r.version)===15||jd())&&n&&n.then){let o=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(o).catch(o)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let n=t.getContext("2d");if(!n)return T.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);let r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}getCurrentFrameToUint8Array(n){return P(this,arguments,function*(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;let c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new ie((d,l)=>{o.toBlob(h=>P(this,null,function*(){if(o.remove(),h){let f=yield u1(h);d({buffer:f,width:o.width,height:o.height})}else l(new K(D.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),t,r<0?.1:r>1?1:r)})):yield NC(t)})}destroy(){this.renderStats=void 0,rt.off(In.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),rt.off(In.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Yo.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Gn.INIT,!this.videoElementCheckInterval&&($1.forEach(c=>{this.videoElement.addEventListener(c,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(c){return c!==document.body&&document.body.contains(c)})(this.videoElement)||(this.videoElementStatus=Gn.DESTROYED)},1e3),M("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let c,d=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",d),this.videoElementFreezeTimeout=window.setTimeout(l,M("VIDEO_FREEZE_DURATION")))},l=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Yo.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Yo.VideoStateFrozen:document.addEventListener("visibilitychange",d))},h=(f,m)=>{if(this.videoElementStatus===Gn.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=m.mediaTime):this.renderStats={lastTs:m.mediaTime,curTs:m.mediaTime,lastRenderNum:0,renderNum:0},c){let v=m.presentationTime-c.presentationTime;this.videoState===Yo.VideoStateStarting&&(this.videoState=Yo.VideoStateDecoding),this.videoState===Yo.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(l,M("VIDEO_FREEZE_DURATION"))),v<M("VIDEO_FREEZE_DURATION")&&this.videoState===Yo.VideoStateFrozen&&(this.videoState=Yo.VideoStateDecoding),v>M("VIDEO_FREEZE_DURATION")&&Rs.lastVisibleTime>=Rs.lastHiddenTime&&c.timestamp>Rs.lastVisibleTime&&c.timestamp>Rs.lastHiddenTime&&(this.renderFreezeAccTime+=v)}c=wt(wt({},m),{},{timestamp:f})}var E,_;M("ENABLE_VIDEO_FRAME_CALLBACK")&&((E=(_=this.videoElement).requestVideoFrameCallback)===null||E===void 0||E.call(_,h))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Jm()&&!M("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let r=Be();r.name==="Safari"&&Number(r.version)===15||jd()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,xt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,xt()&&this.videoElement.load());let o=this.videoElement.play();o!==void 0&&o.catch(c=>{T.debug("[".concat(this.trackId,"] playback interrupted"),c.toString())})}resetVideoElement(){$1.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Gn.NONE}handleAutoPlayFailed(){let t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{T.error(r)}),this.autoplayFailed=!1,fh()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};fh()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),e1()}}let $1=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class pg extends PC{constructor(t){super(t),H(this,"container",void 0),H(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(n){return P(this,arguments,function*(t){var r;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?yield iR(pg.prototype,this,"getCurrentFrameToUint8Array").call(this,t,o):yield NC(t)})}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",M("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var X1,J1,Q1,Z1,ex,tx,nx,rx,ix,ox,sx,ax,cx,dx,ux,lx,hx,px,fx,mx,gx,Ex,_x,vx,Le,yx,Tx,Sx,Cx,Ix,Rx,wx,bx,ti;let vt=(X1=Ee({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),J1=Ht(),Q1=Ee({argsMap:e=>[e.getTrackId()]}),Z1=Gd("LocalVideoTrack","_enabledMutex"),ex=Ee({argsMap:(e,t)=>[e.getTrackId(),t]}),tx=Ht(),nx=Gd("LocalVideoTrack","_enabledMutex"),rx=Ee({argsMap:(e,t)=>[e.getTrackId(),t]}),ix=Ht(),ox=Ee({argsMap:(e,t)=>[e.getTrackId(),t]}),sx=Ht(),ax=Ht(),cx=Ee({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),dx=Ht(),ux=Ht(),lx=Ht(),hx=Ht(),px=Ht(),fx=Ht(),mx=Ht(),gx=Ee({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Ex=Ee({argsMap:e=>[e.getTrackId()]}),_x=Ee({argsMap:e=>[e.getTrackId()]}),vx=Ee({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),Le=class s4 extends Jd{get videoHeight(){if(wn()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(wn()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Gn.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,o,c,d){if(super(t,c),H(this,"trackMediaType",Xd.VIDEO),H(this,"_player",void 0),H(this,"isUseScaleResolutionDownBy",!1),H(this,"_videoVisibleTimer",null),H(this,"_previousVideoVisibleStatus",void 0),H(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),H(this,"_encoderConfig",void 0),H(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),H(this,"_optimizationMode",void 0),H(this,"_videoHeight",void 0),H(this,"_videoWidth",void 0),H(this,"_forceBitrateLimit",void 0),H(this,"_enabled",!0),H(this,"_processorDestination",void 0),H(this,"_processorContext",void 0),wn()){let{width:l,height:h}=t.getSettings();this._videoWidth=l,this._videoHeight=h}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=r,this._optimizationMode=o,this._hints=d||[],this._hints.indexOf(pt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if($S(ze.CHROME,115)&&$m().indexOf("Windows")!==-1){let l=function(h,f){if("VideoFrame"in window&&"TransformStream"in window&&He().supportWebRTCInsertableStream){let m=new MediaStreamTrackProcessor(h),E=new MediaStreamTrackGenerator({kind:"video"}),_,v,A=Date.now(),C=()=>{I&&(clearInterval(I),I=void 0),_&&(_.close(),_=void 0),h.stop(),v=void 0,E.removeEventListener("ended",C)},I=window.setInterval(()=>{if(v&&_&&Date.now()-A>(f??1e3))try{E.readyState==="live"?v.enqueue(_.clone()):C()}catch{C()}},f??1e3),O=new TransformStream({transform:(N,x)=>{E.readyState==="live"?(v=x,A=Date.now(),_===void 0?(_=N,x.enqueue(N.clone())):(x.enqueue(_),_=N)):N.close()}});return E.addEventListener("ended",C),m.readable.pipeThrough(O).pipeTo(E.writable),E}}(t);l&&(T.info("local screen video track begin to inject frame"),this._mediaStreamTrack=l)}n&&this._hints.indexOf(pt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new r1(this.getTrackId(),"local"),this._processorDestination=new n1(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let o=document.getElementById(t);o?t=o:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));let r=wt(wt(wt({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new PC(r):this._player=new pg(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let o=this.getVideoElementVisibleStatus();this.safeEmit(Yd.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},M("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(t,n){return P(this,null,function*(){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{yield lt(this,de.NEED_DISABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{yield lt(this,de.NEED_ENABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)})}setMuted(t){return P(this,null,function*(){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,T.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?yield lt(this,de.NEED_MUTE_TRACK,this):yield lt(this,de.NEED_UNMUTE_TRACK,this))})}setEncoderConfiguration(t,n){return P(this,null,function*(){if(!this._enabled)throw new K(D.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=zo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let r=lg({encoderConfig:t});(wn()||nr()||Bi())&&(r.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{yield this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(o){let c=new K(D.UNEXPECTED_ERROR,o.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}}this._encoderConfig=t,this._hints.indexOf(pt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{yield lt(this,de.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(T)}})}getStats(){return ca(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),qr(this,de.GET_STATS)||wt({},IC)}setBeautyEffect(t){return P(this,null,function*(){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(n){return P(this,arguments,function*(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):yield NC(t)})}setBitrateLimit(t){return P(this,null,function*(){T.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))})}setOptimizationMode(t){return P(this,null,function*(){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void T.error(D.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let n=this._optimizationMode;try{this._optimizationMode=t,yield lt(this,de.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,T.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))})}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return T.error(D.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){s1(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(eg)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}setSenderConfiguration(t){return P(this,null,function*(){if(!this._enabled)throw new K(D.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");T.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=zo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(pt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{yield lt(this,de.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(T)}})}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;let{bitrateMax:o,bitrateMin:c}=this._encoderConfig;if(c==null||o==null){let{max:d,min:l}=function(h,f,m,E,_){let v=M("BITRATE_ADAPTER_TYPE");if(v==="DEFAULT_BITRATE")return{min:E,max:_};if(_===void 0){var A;let I=Math.floor(200*Math.pow(m/15,.6)*Math.pow(h*f/640/360,.75));_=v==="STANDARD_BITRATE"?4*I:2*I,E=(A=E)!==null&&A!==void 0?A:I}else{var C;E=(C=E)!==null&&C!==void 0?C:Math.floor(_/10)}return{min:E,max:_}}(t,n,r,c,o);this._encoderConfig.bitrateMin=l,this._encoderConfig.bitrateMax=d,T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(d,", brMin: ").concat(l,"]"))}}getVideoElementVisibleStatus(){try{var t,n;let r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r?.parentElement},{element:c,slot:d}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){let l=dL.checkOneElementVisible(c),h=Object.assign({},l);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;let f=he.reportApiInvoke(null,{tag:kt.TRACER,name:tn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(r){throw new K(D.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}renewMediaStreamTrack(t){return P(this,null,function*(){})}pipe(t){if(this.processor===t)return t;if(t._source)throw new K(D.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=wt(wt({},r),zo(t))),r=ac(r);let o=ht(8,"track-video-cloned-"),c=new s4(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,ac(this._scalabilityMode),this._optimizationMode,o,ac(this._hints));return t&&r&&c.setEncoderConfiguration(r),T.debug("clone video track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),c}replaceTrack(t,n){return P(this,null,function*(){if(!(t instanceof MediaStreamTrack))throw new K(D.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new K(D.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()})}sendSeiData(t){if(ca(()=>{he.reportApiInvoke(null,{name:tn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:kt.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!M("ENABLE_VIDEO_SEI")||!M("ENABLE_ENCODED_TRANSFORM"))return void T.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new K(D.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let n=this.getRTCRtpTransceiver();if(!n)return void T.warning("Video track is not published, SEI can not be send");let r=n.sender.getParameters();if(r.codecs.length===0)return;let o=r.codecs[0].mimeType.toLocaleLowerCase();o==="video/h264"?this.safeEmit("sei-to-send",t):T.warning("SEI is not supported by ".concat(o))}bindProcessorDestinationEvents(){this.processorDestination.on(rr.ON_TRACK,t=>P(this,null,function*(){t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),yield lt(this,de.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),yield lt(this,de.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(rr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Xr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Xr.REQUEST_CONSTRAINTS)}},Ve(Le.prototype,"play",[X1,J1],Object.getOwnPropertyDescriptor(Le.prototype,"play"),Le.prototype),Ve(Le.prototype,"stop",[Q1],Object.getOwnPropertyDescriptor(Le.prototype,"stop"),Le.prototype),Ve(Le.prototype,"setEnabled",[Z1,ex,tx],Object.getOwnPropertyDescriptor(Le.prototype,"setEnabled"),Le.prototype),Ve(Le.prototype,"setMuted",[nx,rx,ix],Object.getOwnPropertyDescriptor(Le.prototype,"setMuted"),Le.prototype),Ve(Le.prototype,"setEncoderConfiguration",[ox,sx],Object.getOwnPropertyDescriptor(Le.prototype,"setEncoderConfiguration"),Le.prototype),Ve(Le.prototype,"getStats",[ax],Object.getOwnPropertyDescriptor(Le.prototype,"getStats"),Le.prototype),Ve(Le.prototype,"setBeautyEffect",[cx,dx],Object.getOwnPropertyDescriptor(Le.prototype,"setBeautyEffect"),Le.prototype),Ve(Le.prototype,"getCurrentFrameData",[ux],Object.getOwnPropertyDescriptor(Le.prototype,"getCurrentFrameData"),Le.prototype),Ve(Le.prototype,"getCurrentFrameImage",[lx],Object.getOwnPropertyDescriptor(Le.prototype,"getCurrentFrameImage"),Le.prototype),Ve(Le.prototype,"setBitrateLimit",[hx],Object.getOwnPropertyDescriptor(Le.prototype,"setBitrateLimit"),Le.prototype),Ve(Le.prototype,"setOptimizationMode",[px],Object.getOwnPropertyDescriptor(Le.prototype,"setOptimizationMode"),Le.prototype),Ve(Le.prototype,"setScalabiltyMode",[fx],Object.getOwnPropertyDescriptor(Le.prototype,"setScalabiltyMode"),Le.prototype),Ve(Le.prototype,"updateMediaStreamTrackResolution",[mx],Object.getOwnPropertyDescriptor(Le.prototype,"updateMediaStreamTrackResolution"),Le.prototype),Ve(Le.prototype,"pipe",[gx],Object.getOwnPropertyDescriptor(Le.prototype,"pipe"),Le.prototype),Ve(Le.prototype,"unpipe",[Ex],Object.getOwnPropertyDescriptor(Le.prototype,"unpipe"),Le.prototype),Ve(Le.prototype,"close",[_x],Object.getOwnPropertyDescriptor(Le.prototype,"close"),Le.prototype),Ve(Le.prototype,"replaceTrack",[vx],Object.getOwnPropertyDescriptor(Le.prototype,"replaceTrack"),Le.prototype),Le),MC=(yx=Ee({argsMap:(e,t)=>[e.getTrackId(),t]}),Tx=Ht(),Sx=Gd("CameraVideoTrack","_enabledMutex"),Cx=Ee({argsMap:(e,t)=>[e.getTrackId(),t]}),Ix=Ht(),Rx=Ee({argsMap:(e,t)=>[e.getTrackId(),t]}),wx=Ht(),bx=Ee({argsMap:e=>[e.getTrackId()]}),ti=class a4 extends vt{get __className__(){return"CameraVideoTrack"}constructor(t,n,r,o,c,d){super(t,zo(n.encoderConfig),o,c,d),H(this,"_config",void 0),H(this,"_originalConstraints",void 0),H(this,"_constraints",void 0),H(this,"_enabled",!0),H(this,"_deviceName","default"),H(this,"tryResumeVideoForIOS15_16WeChat",()=>P(this,null,function*(){(jd()||QS())&&!function(){let l=Be();if(l.os!==ln.IOS||!l.osVersion)return!1;let h=l.osVersion.split(".");return Number(h[0])===15&&Number(h[1])>=2}()&&oL()&&this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield this.renewMediaStreamTrack())})),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=t.label,this._encoderConfig=zo(this._config.encoderConfig),rt.on(In.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),rt.on(In.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(t){return P(this,null,function*(){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0})}_setDeviceById(t){return P(this,null,function*(){if(T.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let n=yield Zr.getDeviceById(t),r={};r.video=wt({},this._constraints),r.video.deviceId={exact:t},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let o=null;try{o=yield Qr(r,this.getTrackId())}catch(c){throw T.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=yield Qr({video:this._constraints},this.getTrackId()),yield this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}yield this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{let n=yield Zr.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw T.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}T.info("[".concat(this.getTrackId(),"] setDevice success"))})}_setDeviceByFacingModel(t){return P(this,null,function*(){T.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let n={video:wt(wt({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=yield Qr(n,this.getTrackId())}catch(o){throw T.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),o.toString()),r=yield Qr({video:this._constraints},this.getTrackId()),yield this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),o}yield this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=wt({},n.video),T.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))})}setEnabled(t,n){return P(this,null,function*(){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(T.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let r=yield Qr({video:this._constraints},this.getTrackId());yield this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}yield lt(this,de.NEED_ENABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),T.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{yield lt(this,de.NEED_DISABLE_TRACK,this)}catch(r){throw T.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}T.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}})}setEncoderConfiguration(t,n){return P(this,null,function*(){if(!this._enabled)throw new K(D.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=zo(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let r=Ut(this._config);r.encoderConfig=t;let o=lg(r);(wn()||nr()||Bi())&&(o.deviceId=void 0),T.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{yield this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){let d=new K(D.UNEXPECTED_ERROR,c.toString());throw T.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}this._config=r,this._constraints=o,this._originalConstraints=o,this._encoderConfig=t,this._hints.indexOf(pt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{yield lt(this,de.NEED_UPDATE_VIDEO_ENCODER,this)}catch(c){return c.throw(T)}})}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((nr()||Bi())&&this._enabled&&!this._isClosed&&rt.duringInterruption){let t=()=>P(this,null,function*(){rt.off(In.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(T.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield this.setEnabled(!1),yield this.setEnabled(!0))});rt.on(In.IOS_INTERRUPTION_END,t)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yd.TRACK_ENDED)}renewMediaStreamTrack(t){return P(this,null,function*(){let n=t||this._constraints,r=Zr.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){let o=yield Qr({video:n},this.getTrackId());this._constraints=n,yield this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}})}close(){super.close(),rt.off(In.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),rt.off(In.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;t&&(r=wt(wt({},r),zo(t))),r=ac(r);let o=ht(8,"track-cam-cloned-"),c=new a4(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,ac(wt(wt({},this._config),{},{encoderConfig:r})),ac(this._constraints),ac(this._scalabilityMode),this._optimizationMode,o);return t&&r&&c.setEncoderConfiguration(r),T.debug("clone track from ".concat(this.getTrackId()," to ").concat(o,", clone ").concat(n)),c}bindProcessorContextEvents(){this.processorContext.on(Xr.REQUEST_UPDATE_CONSTRAINTS,(t,n,r)=>P(this,null,function*(){try{let o=Object.assign({},this._originalConstraints,...t);yield this.renewMediaStreamTrack(o),n()}catch(o){r(o)}})),this.processorContext.on(Xr.REQUEST_CONSTRAINTS,t=>P(this,null,function*(){t(this._originMediaStreamTrack.getSettings())}))}},Ve(ti.prototype,"setDevice",[yx,Tx],Object.getOwnPropertyDescriptor(ti.prototype,"setDevice"),ti.prototype),Ve(ti.prototype,"setEnabled",[Sx,Cx,Ix],Object.getOwnPropertyDescriptor(ti.prototype,"setEnabled"),ti.prototype),Ve(ti.prototype,"setEncoderConfiguration",[Rx,wx],Object.getOwnPropertyDescriptor(ti.prototype,"setEncoderConfiguration"),ti.prototype),Ve(ti.prototype,"close",[bx],Object.getOwnPropertyDescriptor(ti.prototype,"close"),ti.prototype),ti);function kC(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=wt(wt({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?T.debug("[".concat(e,"] set content hint to"),n.optimizationMode):T.debug("[".concat(e,"] set content hint failed")))):T.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Ax,Dx,Ox,Nx,pi,Px,Mx,kx,Lx,xx,Ux,Wn;class Fx extends KL{getUserId(){return this._userId}constructor(t,n,r,o){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(o.clientId,"_").concat(ht(5,""))),H(this,"_userId",void 0),H(this,"_uintId",void 0),H(this,"_isDestroyed",!1),H(this,"store",void 0),H(this,"processor",void 0),H(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=o}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let eu=(Ax=Ee({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Dx=Ee({argsMap:e=>[e.getTrackId()]}),Ox=Ee({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Nx=Ee({argsMap:e=>[e.getTrackId()]}),Ve((pi=class extends Fx{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Gn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),H(this,"_videoVisibleTimer",null),H(this,"_previousVideoVisibleStatus",void 0),H(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),H(this,"trackMediaType",Xd.VIDEO),H(this,"_videoWidth",void 0),H(this,"_videoHeight",void 0),H(this,"_player",void 0),H(this,"processorDestination",void 0),H(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new r1(this.getTrackId(),"remote"),this.processorDestination=new n1(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return ca(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),qr(this,de.GET_STATS)||wt({},GL)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){let r=document.getElementById(e);r?e=r:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let n=wt(wt({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new PC(n):this._player=new pg(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit($d.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=r=>{this.safeEmit($d.VIDEO_STATE_CHANGED,r)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let r=this.getVideoElementVisibleStatus();this.safeEmit($d.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},M("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){s1(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(eg)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n?.parentElement},{element:o,slot:c}=r;if(this.isPlaying&&o instanceof HTMLVideoElement&&c instanceof HTMLElement){let d=dL.checkOneElementVisible(o),l=Object.assign({},d);if(l.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=l.visible;let h=he.reportApiInvoke(null,{tag:kt.TRACER,name:tn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});l.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(l.reason))}return l}return}catch(n){throw new K(D.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new K(D.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(rr.ON_TRACK,e=>P(this,null,function*(){e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(rr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(lc.SEI_RECEIVED,e)}}).prototype,"play",[Ax],Object.getOwnPropertyDescriptor(pi.prototype,"play"),pi.prototype),Ve(pi.prototype,"stop",[Dx],Object.getOwnPropertyDescriptor(pi.prototype,"stop"),pi.prototype),Ve(pi.prototype,"pipe",[Ox],Object.getOwnPropertyDescriptor(pi.prototype,"pipe"),pi.prototype),Ve(pi.prototype,"unpipe",[Nx],Object.getOwnPropertyDescriptor(pi.prototype,"unpipe"),pi.prototype),pi),tu=(Px=Ee({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Mx=Ee({argsMap:(e,t)=>[e.getTrackId(),t]}),kx=Ee({argsMap:e=>[e.getTrackId()]}),Lx=Ee({argsMap:e=>[e.getTrackId()]}),xx=Ee({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Ux=Ee({argsMap:e=>[e.getTrackId()]}),Ve((Wn=class extends Fx{get isPlaying(){return this._useAudioElement?fr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),H(this,"trackMediaType",Xd.AUDIO),H(this,"_source",void 0),H(this,"_useAudioElement",!0),H(this,"_volume",100),H(this,"processorContext",void 0),H(this,"processorDestination",void 0),H(this,"_played",!1),H(this,"_bypassWebAudio",!1),M("DISABLE_WEBAUDIO")?(this._source=new OC,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new $L(e,!0),M("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once($r.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit($d.FIRST_FRAME_DECODED)}),this.processorContext=new o1(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new i1(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on($r.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners($r.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners($r.ON_AUDIO_BUFFER),this._source.on($r.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?fr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}setPlaybackDevice(e){return P(this,null,function*(){if(!this._useAudioElement||!VL())throw new K(D.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield fr.setSinkID(this.getTrackId(),e)})}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return ca(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),qr(this,de.GET_STATS)||wt({},HL)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),fr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?fr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&fr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new K(D.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new K(D.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new K(D.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(rr.ON_TRACK,e=>P(this,null,function*(){e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(rr.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(rr.ON_TRACK),this.processorDestination.removeAllListeners(rr.ON_NODE)}}).prototype,"setVolume",[Px],Object.getOwnPropertyDescriptor(Wn.prototype,"setVolume"),Wn.prototype),Ve(Wn.prototype,"setPlaybackDevice",[Mx],Object.getOwnPropertyDescriptor(Wn.prototype,"setPlaybackDevice"),Wn.prototype),Ve(Wn.prototype,"play",[kx],Object.getOwnPropertyDescriptor(Wn.prototype,"play"),Wn.prototype),Ve(Wn.prototype,"stop",[Lx],Object.getOwnPropertyDescriptor(Wn.prototype,"stop"),Wn.prototype),Ve(Wn.prototype,"pipe",[xx],Object.getOwnPropertyDescriptor(Wn.prototype,"pipe"),Wn.prototype),Ve(Wn.prototype,"unpipe",[Ux],Object.getOwnPropertyDescriptor(Wn.prototype,"unpipe"),Wn.prototype),Wn),Rs=new class extends Dt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),H(this,"_lastHiddenTime",0),H(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),T.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class Vx extends Dt{constructor(t,n){super(),H(this,"trackMediaType",Xd.DATA),H(this,"_version",1),H(this,"_type",3),H(this,"_config",void 0),H(this,"_originDataChannel",void 0),H(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),H(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),H(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return M("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){return P(this,null,function*(){return new ie((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let r=setTimeout(()=>{var o;n(new K(D.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((o=this._originDataChannel)===null||o===void 0?void 0:o.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new K(D.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new K(D.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[dg.OPEN,dg.CLOSE,dg.ERROR].forEach(n=>{let r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),t.addEventListener(n,r)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,o]=n;t.removeEventListener(r,o)}),this._datachannelEventMap.clear()}}class lee extends Vx{constructor(t){super(t),H(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),o=new DataView(r).getUint8(3);if(o!==this.id)return void(M("SHOW_DATASTREAM2_LOG")&&T.debug("invalid datachannel id: ".concat(o," !== ").concat(this.id)));let c=n.data.slice(this._dataStreamPacketHeader.byteLength);c=this._dataStreamPacketHandler.deserialize(c),this.emit(dg.MESSAGE,c)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class hee extends Vx{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);let r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function fg(){let e=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>pm.revokeObjectURL(e),0),new Worker(pm.createObjectURL(e))}var nu=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e}(nu||{});function jx(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=e.getUint8(0);if(n!==71)return;let r=e.getUint16(1),o=3+r,c=new Uint8Array(e.byteLength-o);c.set(new Uint8Array(e.buffer,o,e.byteLength-o));let d={m:n,tlvLen:r,tlv:[],frame:c},l=3;for(;l<o;){let h=e.getUint8(l),f=e.getUint16(l+1),m=3;if(h===nu.AUDIO_LEVEL){let E=e.getUint8(l+m);for(let _=1;_<f;_++)E=E<<8|e.getUint8(l+m+_);d.tlv.push({tag:h,length:f,value:t?127^E>>1:127&E})}else if(h===nu.METADATA){let E=new Uint8Array(f);for(let _=0;_<f;_++)E[_]=e.getUint8(l+m+_);d.tlv.push({tag:h,length:f,value:E})}l+=m+f}return d}let mg=new Map;function pee(t){return P(this,arguments,function*(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!He().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(mg.has(e)||!e.track)return;let r={track:e.track};if(Ts()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(l){return void T.error("create audio-encoded-streams error",l&&l.message)}let d=new TransformStream({transform(l,h){r.controller||(r.controller=h),e.track&&e.track.id!==r.track.id&&(T.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o));let f=n.metadata&&n.metadata();f?function(m,E){let{chunk:_,controller:v}=E;_.data=function(A,C,I){let O=I.byteLength,N=O+1+2,x=3+N,B=new ArrayBuffer(A.byteLength+x),j=new DataView(B);j.setUint8(0,71),j.setUint16(1,N),j.setUint8(3,C),j.setUint16(4,O);for(let W=0;W<O;W++)j.setUint8(6+W,I[W]);let F=new Uint8Array(j.buffer);return F.set(new Uint8Array(A),x),F.buffer}(_.data,nu.METADATA,m),v.enqueue(_)}(f,{sender:e,chunk:l,controller:h}):h.enqueue(l)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(wn()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");let c=fg(),d=new MessageChannel;yield new ie(h=>c.onmessage=f=>{f.data==="registered"&&h(void 0)});let l=new RTCRtpScriptTransform(c,{name:"tx",port:d.port2},[d.port2]);e.transform=l,yield new ie(h=>c.onmessage=f=>{f.data==="started"&&h(void 0)}),d.port1.onmessage=h=>{var f;h.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==r.track.id&&(T.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o))},r.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}let c=mg.get(e);if(c){mg.delete(e);try{var d,l;(d=c.controller)===null||d===void 0||d.terminate(),(l=c.worker)===null||l===void 0||l.terminate()}catch(h){T.warning(h&&h.message)}}}mg.set(e,r),e.track.addEventListener("ended",o)})}let gg=127,fc=1e-10,LC=139/13,Eg=new Map;function xC(e,t,n){let r="".concat(e,"-").concat(t,"-").concat(n),o=0;return Eg.has(r)?o=Eg.get(r):(o=Math.log(function(d,l){let h=d-l;l<h&&(l=h);let f=1;for(let m=d,E=1;m>l;m--,E++)f=f*m/E;return f}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,Eg.set(r,o)),o<fc&&(o=fc),o}function Bx(e,t,n){let r=t.length,o=e.length/r,c=!1;for(let d=0,l=0;d<r;d++){let h=0;for(let f=l+o;l<f;l++)e[l]>n&&h++;t[d]!==h&&(t[d]=h,c=!0)}return c}window.cache=Eg;let fee=0;class Hx{constructor(t){H(this,"id",void 0),H(this,"immediates",[]),H(this,"lastNonSilence",-1),H(this,"immediateSpeechActivityScore",fc),H(this,"lastLevelChangedTime",Date.now()),H(this,"levels",[]),H(this,"longs",[]),H(this,"longSpeechActivityScore",fc),H(this,"mediums",[]),H(this,"mediumSpeechActivityScore",fc),H(this,"minLevel",0),H(this,"nextMinLevel",0),H(this,"nextMinLevelWindowLength",0),H(this,"energyScore",0),this.id=t||"".concat(fee++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let t=this.immediates,n=this.levels,r=this.minLevel+LC,o=!1;for(let c=0;c<t.length;++c){let d=n[c];d<r&&(d=0);let l=Math.floor(d/LC);t[c]!==l&&(t[c]=l,o=!0)}return o}computeLongs(){return Bx(this.mediums,this.longs,4)}computeMediums(){return Bx(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=xC(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=xC(this.longs[0],10,47),this.longSpeechActivityScore>fc&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=xC(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(OD(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let r=t;return t<0&&(r=0),t>gg&&(r=gg),this.levels.unshift(r),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(r),r>=this.minLevel+LC?r:r/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>gg&&(n=gg),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class mee{constructor(t){H(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{let n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class UC{constructor(t,n,r){H(this,"isDominant",void 0),H(this,"energyRanking",void 0),H(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=r}}class gee extends Dt{constructor(t){super(),H(this,"dominantId",null),H(this,"lastDecisionTime",0),H(this,"lastLevelChangedTime",0),H(this,"lastLevelIdleTime",0),H(this,"relativeSpeechActivities",[]),H(this,"speakers",new Map),H(this,"enableSilence",!1),H(this,"timeoutToSilenceInterval",0),H(this,"decisionMaker",null),H(this,"loudest",[]),H(this,"numLoudestToTrack",3),H(this,"energyExpireTimeMs",250),H(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),r!=null&&(this.energyAlphaPct=r),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(n=>n.id===t)}levelChanged(t,n){let r=Date.now(),o=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<r&&(this.lastLevelChangedTime=r,this.maybeStartDecisionMaker());let c=o.levelChanged(n,r);return this.updateLoudestList(o,c,r)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)})}removeSpeakers(t){t.forEach(n=>{this.speakers.delete(n.id)})}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new Hx(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,r){let o=t.id===this.dominantId;if(n<0){let h=0;for(;h<this.loudest.length&&this.loudest[h]!==t;)++h;return new UC(o,h,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new UC(o,0,t.energyScore);let c=r-this.energyExpireTimeMs,d=0;for(;d<this.loudest.length;){let h=this.loudest[d];if(h.getLastLevelChangedTime()<c&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(d,1);else if(h.id!==t.id)++d;else if(this.loudest.splice(d,1),this.loudest.length<this.numLoudestToTrack)break}let l=0;for(;l<this.loudest.length&&!(this.loudest[l].energyScore<t.energyScore);)++l;return l<this.numLoudestToTrack&&(this.loudest.splice(l,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new UC(o,l,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new mee(this),this.decisionMaker.execute())}makeDecision(t){let n=null,r=null,o=this.speakers.size,c=null;if(o===0)c=null;else if(o===1){var d;let l=Wr(d=this.speakers).call(d).next().value;this.enableSilence&&l&&(c=l.id,l.evaluateSpeechActivityScores(t),t-l.lastNonSilence>this.timeoutToSilenceInterval&&(c=null))}else{let l=this.dominantId==null?null:this.speakers.get(this.dominantId);if(l==null){let m=this.speakers.entries().next();m.value&&(c=m.value[0],l=m.value[1])}else c=l.id;l?.evaluateSpeechActivityScores(t);let h=this.relativeSpeechActivities,f=2;for(let m of this.speakers.entries()){let[E,_]=m;if(_===l)continue;_.evaluateSpeechActivityScores(t);for(let I=0;I<h.length;++I){let O=l==null?fc:l.getSpeechActivityScore(I);h[I]=Math.log(_.getSpeechActivityScore(I)/O)}let v=h[0],A=h[1],C=h[2];v>3&&A>2&&C>0&&A>f&&(f=A,c=E)}this.enableSilence&&l!=null&&c===l.id&&t-l.lastNonSilence>this.timeoutToSilenceInterval&&(c=null)}c==null&&!this.enableSilence||c===this.dominantId||(n=this.dominantId,this.dominantId=c,r=this.dominantId),r==null&&!this.enableSilence||r===n||this.emit("ActiveSpeakerChanged",r)}_runInDecisionMaker(){let t=Date.now(),n=300-(t-this.lastLevelIdleTime),r=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):r=n;let o=300-(t-this.lastDecisionTime);return o<=0&&(this.lastDecisionTime=t,this.makeDecision(t),o=300-(Date.now()-t)),o>0&&r>o&&(r=o),r}timeoutIdleLevels(t){let n=[];for(let o of Wr(r=this.speakers).call(r)){var r;let c=t-o.getLastLevelChangedTime();36e5<c&&(this.dominantId==null||o.id!==this.dominantId)?n.push(o.id):300<c&&o.levelTimedOut()}n.forEach(o=>this.speakers.delete(o))}}let ru=new Map,vo=null,_g=null,mc=[],Eee=1e3/15,yo=new Map,vg=new Map;class _ee{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){H(this,"id",void 0),H(this,"track",void 0),H(this,"score",0),H(this,"active",!0),H(this,"muted",!1),H(this,"timer",0),H(this,"actives",0),H(this,"inactives",0),this.id=t,this.track=n,this.setActive(yo.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let t=this.active;this.active=this.activeRate>=.8;let{actives:n,inactives:r}=function(){let o=[],c=[];return Array.from(Wr(yo).call(yo)).forEach(d=>{d.active?o.push(d):c.push(d)}),{actives:o,inactives:c}}();if(n.length>3){let o;n.forEach(c=>{(!o||o.score>c.score)&&(o=c)}),o&&o.setActive(!1)}if(n.length<3&&r.length>0){let o;r.forEach(c=>{(!o||o.score<c.score)&&c.id!==this.id&&(o=c)}),o&&t&&!this.active&&(o.samples>40&&o.activeRate-this.activeRate>.4?o.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){let t=function(n){let r;return Array.from(Wr(yo).call(yo)).forEach(o=>{!o.active||o.id===n||o.samples<40||(!r||o.score<r.score)&&(r=o)}),r}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){let t=function(n){let r;return Array.from(Wr(yo).call(yo)).forEach(o=>{o.active||o.id===n||o.samples<40||(!r||o.score>r.score)&&(r=o)}),r}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>Eee&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let yg;function Gx(e){let t=yo.get(e);t&&(yo.delete(e),t.clearTimer())}let Tg=new Map,vee=new Map;function FC(t){return P(this,arguments,function*(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!He().supportWebRTCEncodedTransform)return void T.warning("browser not support audio encoded transform");if(Tg.has(e))return;let r={track:e.track};if(Ts()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");$S(ze.CHROME,87,116)||(n.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(l){return void T.error("create audio-encoded-streams error",l&&l.message)}let d=new TransformStream({transform(l,h){r.controller||(r.controller=h),e.track&&e.track.id!==r.track.id&&(T.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o)),n.enableTopn?function(f,m,E){var _;let v=jx(new DataView(m.data));if(!v)return E.enqueue(m);let A=f.track.id;vee.set(A,f.track);let C=(_=v.tlv.find(j=>j.tag===nu.AUDIO_LEVEL))===null||_===void 0?void 0:_.value,I=0;typeof C=="number"&&(I=127-C);let O=Math.round(Math.pow(10,I/60)-1),{selected:N,speaker:x}=function(j,F){let W=ru.get(j);if(W||(W=function(X){let oe=new Hx;return ru.set(X,oe),vo||(vo=new gee(M("TOPN_SILENCE_THRESHOLD")||500),vo.on("ActiveSpeakerChanged",te=>{te!=null&&(_g=te)})),vo.addSpeakers([oe]),oe}(j)),ru.size<=3)return{selected:!0,speaker:W};if(!vo)throw new Error("no active speaker detector");return vo.levelChanged(W.id,F),mc=vo.loudest.map(X=>X.id),_g&&!ne(mc).call(mc,_g)&&mc.length>=3&&mc.pop(),{selected:ne(mc).call(mc,W.id)||W.id===_g,speaker:W}}(f,O),B=function(j,F,W){let X=yo.get(j)||new _ee(j,F);return X.score=W,yo.set(j,X),function(oe){if(vg.set(oe,!0),!yg)return void(yg=Date.now());let te=Date.now();te-yg>1e3&&(vg.get(oe)?vg.set(oe,!1):(Gx(oe),vg.delete(oe)),yg=te)}(j),X}(A,f.track,x.energyScore);B.addSample(N),B.active&&(m.data=v.frame.buffer,E.enqueue(m))}(e,l,h):n.enableMetadata?function(f,m,E){let _=jx(new DataView(f.data));if(!_)return m.enqueue(f);let v=_.tlv.find(A=>A.tag===nu.METADATA);v&&E&&v.value instanceof Uint8Array&&E(v.value),f.data=_.frame.buffer,m.enqueue(f)}(l,h,n.onMetadata):h.enqueue(l)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(wn()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");let c=fg(),d=new MessageChannel;yield new ie(h=>c.onmessage=f=>{f.data==="registered"&&h(void 0)});let l=new RTCRtpScriptTransform(c,{name:"rx",port:d.port2},[d.port2]);e.transform=l,yield new ie(h=>c.onmessage=f=>{f.data==="started"&&h(void 0)}),d.port1.onmessage=h=>{var f;h.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==r.track.id&&(T.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o))},r.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){let d=Tg.get(c);if(d){(function(f){let m=ru.get(f);m&&(ru.delete(f),vo&&(vo.removeSpeakers([m]),ru.size===0&&(vo.destroy(),vo=null)))})(c),Gx(c.track.id),Tg.delete(c);try{var l,h;(l=d.controller)===null||l===void 0||l.terminate(),(h=d.worker)===null||h===void 0||h.terminate()}catch(f){T.warning(f&&f.message)}}}(e)}Tg.set(e,r),e.track.addEventListener("ended",o)})}function yee(e,t,n){let r=new Uint8Array(e,t,n),o=[],c=0;for(;o.length<n;)c+3<n&&r[c]===0&&r[c+1]===0&&r[c+2]===3&&(r[c+3]===0||r[c+3]===1||r[c+3]===2||r[c+3]===3)?(o.push(r[c],r[c+1],r[c+3]),c+=4):(o.push(r[c]),c++);return new Uint8Array(o)}let Sg=new Map;function Tee(e,t){return P(this,null,function*(){if(!He().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(Sg.has(e)||!e.track)return;let n={track:e.track};if(Ts()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let o=null;try{o=e.createEncodedStreams()}catch(l){return void T.error("create video-encoded-streams error",l&&l.message)}let c=[];t.on("sei-to-send",l=>{c.push(l)});let d=new TransformStream({transform(l,h){n.controller||(n.controller=h),e.track&&e.track.id!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));let f=c.shift();f&&(l.data=function(m,E){let _=function(N){let x=N.length,B=[],j=0;for(;j<x;)j+2<x&&N[j]===0&&N[j+1]===0&&(N[j+2]===0||N[j+2]===1||N[j+2]===2||N[j+2]===3)?(B.push(N[j],N[j+1],3,N[j+2]),j+=3):(B.push(N[j]),j++);return new Uint8Array(B)}(E),v=_.length,A=Math.floor(v/255),C=v%255,I=new Uint8Array(6+A+1+v+m.byteLength);I[0]=0,I[1]=0,I[2]=0,I[3]=1,I[4]=6,I[5]=101;let O=0;for(;O<A;)I[6+O]=255,O++;return I[6+O]=C,O++,I.set(_,6+O),I.set(new Uint8Array(m),6+O+v),I.buffer}(l.data,f)),h.enqueue(l)}});o.readable.pipeThrough(d).pipeTo(o.writable)}else{if(!wn())return;{if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");let o=fg(),c=new MessageChannel;yield new ie(l=>o.onmessage=h=>{h.data==="registered"&&l(void 0)});let d=new RTCRtpScriptTransform(o,{name:"tx",port:c.port2},[c.port2]);e.transform=d,yield new ie(l=>o.onmessage=h=>{h.data==="started"&&l(void 0)}),t.on("sei-to-send",l=>{c.port1.postMessage({sei:l})}),c.port1.onmessage=l=>{var h;l.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==n.track.id&&(T.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=o}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}let o=Sg.get(e);if(o){Sg.delete(e);try{var c,d;(c=o.controller)===null||c===void 0||c.terminate(),(d=o.worker)===null||d===void 0||d.terminate()}catch(l){T.warning(l&&l.message)}}}Sg.set(e,n),e.track.addEventListener("ended",r)})}let Ih=new Map;function VC(t){return P(this,arguments,function*(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!He().supportWebRTCEncodedTransform)return void T.warning("browser not support video encoded transform");if(!e.track)return;if(Ih.has(e)){let c=Ih.get(e);return void(c&&(c.onSei=n.onSei))}let r={track:e.track,onSei:n.onSei};if(Ts()){if(!e.createEncodedStreams)return void T.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(l){return void T.error("create video-encoded-streams error",l&&l.message)}let d=new TransformStream({transform(l,h){r.controller||(r.controller=h),e.track&&e.track.id!==r.track.id&&(T.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o));let f=function(m){let E=new DataView(m.data),_=0;for(;_+4<m.data.byteLength;){if(E.getUint8(_+0)===0&&E.getUint8(_+1)===0&&E.getUint8(_+2)===0&&E.getUint8(_+3)===1&&E.getUint8(_+4)===6){let v=_+6,A=0,C=0;for(;(C=E.getUint8(v++))===255;)A+=255;A+=C;let I=yee(m.data,v,A);return new Uint8Array(I)}_++}return null}(l);f&&r.onSei&&r.onSei(f),h.enqueue(l)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(wn()){if(typeof RTCRtpScriptTransform>"u")return void T.warning("browser not support RTCRtpScriptTransform");let c=fg(),d=new MessageChannel;yield new ie(h=>c.onmessage=f=>{f.data==="registered"&&h(void 0)});let l=new RTCRtpScriptTransform(c,{name:"rx",port:d.port2},[d.port2]);e.transform=l,yield new ie(h=>c.onmessage=f=>{f.data==="started"&&h(void 0)}),d.port1.onmessage=h=>{var f;h.data.transformed&&e.track&&((f=e.track)===null||f===void 0?void 0:f.id)!==r.track.id?(T.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",o),r.track=e.track,r.track.addEventListener("ended",o)):h.data.sei&&r.onSei&&r.onSei(h.data.sei)},r.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){let d=Ih.get(c);if(d){Ih.delete(c);try{var l,h;(l=d.controller)===null||l===void 0||l.terminate(),(h=d.worker)===null||h===void 0||h.terminate()}catch(f){T.warning(f&&f.message)}}})(e)}Ih.set(e,r),e.track.addEventListener("ended",o)})}(function(){let e=Be();Cn.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Cn.getStreamFromExtension=e.name===ze.CHROME&&Number(e.version)>34,Cn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),Cn.supportMinBitrate=e.name===ze.CHROME||e.name===ze.EDGE,Cn.supportSetRtpSenderParameters=function(){let t=Be();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ss()||!(!wn()&&!Xm())||t.name===ze.FIREFOX&&Number(t.version)>=64)}(),e.name===ze.SAFARI&&(Number(e.version)>=14?Cn.supportDualStream=!0:Cn.supportDualStream=!1),Cn.webAudioMediaStreamDest=function(){let t=Be();return!(t.name===ze.SAFARI&&Number(t.version)<12)}(),Cn.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Cn.supportWebGL=typeof WebGLRenderingContext<"u",Cn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ss()||(Cn.webAudioWithAEC=!0),Cn.supportShareAudio=function(){let t=Be();return(t.os===ln.WIN_10||t.os===ln.WIN_81||t.os===ln.WIN_7||t.os===ln.LINUX||t.os===ln.MAC_OS||t.os===ln.CHROMIUM_OS)&&t.name===ze.CHROME&&Number(t.version)>=74}(),Cn.supportDataChannel=!!(Vd(76)||function(t){let n=Be();return!(n.name!==ze.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||eL(14)),Cn.supportPCSetConfiguration=function(){let t=window.RTCPeerConnection;return!xt()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Cn.supportWebRTCEncodedTransform=function(){let t=Be();return t.name==="Chrome"&&Number(t.version)>=87||t.name==="Safari"&&Number(t.version)>=15}(),Cn.supportWebRTCInsertableStream=function(){let t=Be();return(t.name===ze.CHROME||t.name===ze.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Cn.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Cn.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Zm(()=>{Cn.supportDualStreamEncoding=function(){let t=Be();return!!M("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&M("CHROME_DUAL_STREAM_USE_ENCODING"))}(),T.debug("browser ua: ",navigator.userAgent),T.info("browser info: ",e),T.info("browser compatibility: ",Cn)})})();let See=["CHINA","GLOBAL"],Wx=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],gc=[],iu=[];function Ec(e,t){return!!t&&gc.some(n=>n.uid===e&&n.channelName===t)}function jC(){return iu.length>0}var Cee=_M.forEach,Kx=Rf("forEach")?[].forEach:function(e){return Cee(this,e,arguments.length>1?arguments[1]:void 0)};Je({target:"Array",proto:!0,forced:[].forEach!==Kx},{forEach:Kx});var Iee=ki("Array","forEach"),Ree=gs,wee=Mn,bee=V,Aee=Iee,BC=Array.prototype,Dee={DOMTokenList:!0,NodeList:!0},Oee=function(e){var t=e.forEach;return e===BC||bee(BC,e)&&t===BC.forEach||wee(Dee,Ree(e))?Aee:t},Nee=a(Oee),Pee=Vo,qx=Nf;Je({target:"Object",stat:!0,forced:u(function(){qx(1)})},{keys:function(e){return qx(Pee(e))}});var zx=a(ai.Object.keys),Mee=a(bD),kee=a(DD),Lee=Je,Yx=Ul,xee=Kf,Uee=Sr,$x=ly,Fee=Qs,Vee=Xs,jee=AT,Bee=en,Hee=ea,Gee=cM("slice"),Wee=Bee("species"),HC=Array,Kee=Math.max;Lee({target:"Array",proto:!0,forced:!Gee},{slice:function(e,t){var n,r,o,c=Vee(this),d=Fee(c),l=$x(e,d),h=$x(t===void 0?d:t,d);if(Yx(c)&&(n=c.constructor,(xee(n)&&(n===HC||Yx(n.prototype))||Uee(n)&&(n=n[Wee])===null)&&(n=void 0),n===HC||n===void 0))return Hee(c,l,h);for(r=new(n===void 0?HC:n)(Kee(h-l,0)),o=0;l<h;l++,o++)l in c&&jee(r,o,c[l]);return r.length=o,r}});var qee=ki("Array","slice"),zee=V,Yee=qee,GC=Array.prototype,$ee=function(e){var t=e.slice;return e===GC||zee(GC,e)&&t===GC.slice?Yee:t},Xee=a($ee);function ue(e,t,n,r,o){var c,d,l,h={};return Nee(c=zx(r)).call(c,function(f){h[f]=r[f]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=Mee(d=kee(l=Xee(n).call(n)).call(l)).call(d,function(f,m){return m(e,t,f)||f},h),o&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(o):void 0,h.initializer=void 0),h.initializer===void 0&&(iM(e,t,h),h=null),h}let Cg=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),WC=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Wi=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),ir=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),ge=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),mt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),ye=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),ve=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),Rh=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Pe=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),or=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Re=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function Ig(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw T.error("Invalid Channel Name ".concat(e)),new G(D.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Rg(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||cL(e,1,255)))throw new G(D.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&T.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Xo=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({}),Jee={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},KC={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function qC(e,t){Tn(e.url,"".concat(t,".url"),1,1e3,!1),Mt(e.x)||st(e.x,"".concat(t,".x"),0,1e4),Mt(e.y)||st(e.y,"".concat(t,".y"),0,1e4),Mt(e.width)||st(e.width,"".concat(t,".width"),0,1e4),Mt(e.height)||st(e.height,"".concat(t,".height"),0,1e4),Mt(e.zOrder)||st(e.zOrder,"".concat(t,".zOrder"),0,255),Mt(e.alpha)||st(e.alpha,"".concat(t,".alpha"),0,1,!1)}let Qee={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},la=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),zC=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),an=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function Xx(e){if(!e.channelName)throw new G(D.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new G(D.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Tn(e.token,"info.token",1,2047),Rg(e.uid),Ig(e.channelName),!0}let sr=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),ws=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Rr=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),ou=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Xe=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),gn=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),wg=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),pn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Ke=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),Jx=[Ke.AFRICA,Ke.ASIA,Ke.CHINA,Ke.EUROPE,Ke.GLOBAL,Ke.INDIA,Ke.JAPAN,Ke.NORTH_AMERICA,Ke.OCEANIA,Ke.OVERSEA,Ke.SOUTH_AMERICA],Ln=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),bg={CHINA:{},ASIA:{CODE:Ln.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Ln.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Ln.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Ln.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Ln.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Ln.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Ln.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Ln.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Ln.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Ln.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Ln.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Ln.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Ln.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};mC&&(bg.CHINA={CODE:Ln.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let wh=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function Qx(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class Zx extends Dt{constructor(t,n){super(),b(this,"onICEConnectionStateChange",void 0),b(this,"onConnectionStateChange",void 0),b(this,"onDTLSTransportStateChange",void 0),b(this,"onDTLSTransportError",void 0),b(this,"onICETransportStateChange",void 0),b(this,"onFirstAudioReceived",void 0),b(this,"onFirstVideoReceived",void 0),b(this,"onFirstAudioDecoded",void 0),b(this,"onFirstVideoDecoded",void 0),b(this,"onFirstVideoDecodedTimeout",void 0),b(this,"onSelectedLocalCandidateChanged",void 0),b(this,"onSelectedRemoteCandidateChanged",void 0),b(this,"onICECandidateError",void 0),b(this,"getLocalVideoStats",void 0)}}class eU extends Zx{constructor(t,n){super(t,n),b(this,"establishPromise",void 0)}}let ce=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Vn=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),bs=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),tU=["disconnected","failed"],J=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),$e=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),me=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Ki=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),qi=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),En=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),nU=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Jo=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),fi=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),To=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),su=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Gt=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),au=function(e){return e.ABORT="abort",e}({}),ha=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Zee=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),ete={[Cg.ACCESS_POINT]:{[ir.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ir.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ir.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ir.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ir.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ir.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ir.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ir.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ir.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ir.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ir.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ir.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ir.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ir.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ir.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ir.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ir.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ir.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Cg.UNILBS]:{[Wi.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Wi.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Wi.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Wi.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Wi.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Wi.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Wi.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Wi.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Wi.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Wi.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Wi.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Wi.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Cg.STRING_UID_ALLOCATOR]:{[WC.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[WC.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[WC.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function cu(e){let t=ete[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Cg.ACCESS_POINT){let r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}let tte={[ge.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[ge.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[ge.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[ge.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[ge.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[ge.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[ge.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[ge.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[ge.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[ge.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[ge.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[ge.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[ge.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[ge.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ge.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ge.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[ge.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[ge.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[ge.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[ge.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[ge.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[ge.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[ge.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[ge.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[ge.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[ge.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[ge.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[ge.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[ge.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[ge.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[ge.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[ge.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[ge.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[ge.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[ge.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[ge.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[ge.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[ge.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[ge.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[ge.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[ge.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[ge.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ge.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ge.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[ge.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[ge.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[ge.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[ge.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[ge.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[ge.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[ge.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[ge.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[ge.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[ge.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[ge.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[ge.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[ge.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[ge.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[ge.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[ge.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[ge.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[ge.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[ge.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[ge.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function bh(e){return tte[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function rU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function YC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?rU(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function iU(e,t){if(typeof e=="string")return e;let{proxy:n,host:r,port:o}=e;if(t){let c=M("JOIN_GATEWAY_FALLBACK_PORT")||443;return c===443?"wss://".concat(r,"/ws/?p=").concat(Number(o)+150):"wss://".concat(r,":").concat(c,"/ws/?p=").concat(Number(o)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(o):"wss://".concat(r,":").concat(o)}let nte=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,rte=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,ite=/wss:\/\/(.+):([0-9]+)\/?/,ote=/wss:\/\/(.[^\/]+)\/?/,ste=0;class ate{constructor(t,n){b(this,"id",0),b(this,"store",void 0),b(this,"recordIndex",void 0),b(this,"websockets",[]),b(this,"try443PortDuration",2e3),b(this,"forceCloseWSDuration",5e3),b(this,"try443PortTimeout",null),b(this,"forceCloseTimeout",null),b(this,"isTry443PortFailed",!1),b(this,"isNormalPortFailed",!1),b(this,"useDoubleDomain",!1),b(this,"useProxy",!1),b(this,"startTime",Date.now()),this.id=++ste,this.try443PortDuration=M("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;let n=Date.now()-this.startTime;for(var r=arguments.length,o=new Array(r),c=0;c<r;c++)o[c]=arguments[c];T.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...o)}createWebSocket(t,n,r){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:r});let o=M("GATEWAY_DOMAINS"),c=Date.now(),d=[],l=o.find(_=>{var v;return ne(v=t.host).call(v,_)});l||(this.useDoubleDomain=!1);let h=[];if(this.useDoubleDomain)o.forEach(_=>{h.push(iU(YC(YC({},t),{},{host:t.host.replace(l,_)}),n))});else{let _=YC({},t);if(n&&l){let v=o.find(A=>A!==l);v&&(_.host=_.host.replace(l,v))}h.push(iU(_,n))}try{h.forEach(_=>{let v=new WebSocket(_);v.binaryType="arraybuffer",d.push(v),this.logger("ws is connecting:",v.url)})}catch(_){if(this.logger("ws create failed"),d.forEach(v=>v.close()),d.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,r);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,r);throw new G(D.WS_ERR,"init websocket failed! Error: ".concat(_.toString()))}let f=ph();this.store&&this.store.recordJoinChannelService({urls:d.map(_=>_.url),service:"gateway"},this.recordIndex),d.forEach(_=>{_.onopen=()=>{this.logger("onopen: ws ".concat(_.url," open cost ").concat(Date.now()-c,"ms")),this.websockets.forEach(v=>{v!==_&&(v.onopen=null,v.onclose=null,v.onmessage=null,v.close(),this.logger("close backup websocket: ".concat(v.url)))}),this.websockets.length=0,f.resolve(_)},_.onclose=v=>{this.logger("onclose: ws ".concat(_.url," closed cost ").concat(Date.now()-c,"ms state: ").concat(_.readyState));let A=d.every(C=>C.readyState===WebSocket.CLOSED||C.readyState===WebSocket.CLOSING);this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(A)),A&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(v.reason)),f.reject({code:v.code,reason:wg.A_ROUND_WS_FAILED})):!n&&A&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),E()),n?this.isTry443PortFailed=A:this.isNormalPortFailed=A},_.onmessage=v=>this.logger("".concat(_.url," onmessage: ").concat(v.data))}),this.websockets.push(...d);let m=()=>{this.websockets.forEach(_=>_.readyState!==WebSocket.OPEN&&_.close())},E=()=>{if(f.isResolved)return m();Be().os===ln.MAC_OS&&xt()&&m(),this.createWebSocket(t,!0,!0).then(_=>{f.resolve(_)}).catch(_=>{this.isNormalPortFailed&&f.reject(_),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",f.isResolved),this.forceCloseTimeout=null,m()},this.forceCloseWSDuration)};return r||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,m()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",f.isResolved),this.try443PortTimeout=null,E()},this.try443PortDuration)})(),f.promise}chooseBestWebsocket(t,n,r,o){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=function(c){let d,l,h;return[,d,l,h]=c.match(nte)||[],d||([,l,h]=c.match(rte)||[]),l&&h||([,l,h]=c.match(ite)||[]),l&&h||([,l]=c.match(ote)||[]),l||T.warning("un-destructible url: ",c),{proxy:d,host:l,port:h||"443"}}(t)),this.recordIndex=o,this.useProxy=!!t.proxy,r&&this.useProxy&&(T.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(t,!!r,!1).finally(()=>this.clearTimeout())}}function oU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}class sU extends Dt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;ne(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Re.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Re.CONNECTED):this._state==="closed"?this.emit(Re.CLOSED):this._state==="failed"&&this.emit(Re.FAILED))}resetReconnectCount(t){T.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],c=arguments.length>4&&arguments[4]!==void 0&&arguments[4],d=arguments.length>5?arguments[5]:void 0;super(),b(this,"connectionID",0),b(this,"currentURLIndex",0),b(this,"urls",[]),b(this,"_reconnectMode","tryNext"),b(this,"reconnectReason",void 0),b(this,"_initMutex",void 0),b(this,"name",void 0),b(this,"_state","closed"),b(this,"reconnectInterrupter",void 0),b(this,"websocket",void 0),b(this,"retryConfig",void 0),b(this,"reconnectCount",0),b(this,"forceCloseTimeout",5e3),b(this,"onlineReconnectListener",void 0),b(this,"useCompress",void 0),b(this,"tryDoubleDomain",!1),b(this,"use443PortOnly",!1),b(this,"wsInflateLength",0),b(this,"wsDeflateLength",0),b(this,"closeEstablishingWs",()=>{}),b(this,"store",void 0),b(this,"joinGatewayRecordIndex",void 0),this.store=d,this.name=t,this.retryConfig=function(E){for(var _=1;_<arguments.length;_++){var v=arguments[_]!=null?arguments[_]:{};_%2?oU(Object(v),!0).forEach(function(A){b(E,A,v[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(E,Object.getOwnPropertyDescriptors(v)):oU(Object(v)).forEach(function(A){Object.defineProperty(E,A,Object.getOwnPropertyDescriptor(v,A))})}return E}({},n),this.useCompress=r,this.tryDoubleDomain=o,this.use443PortOnly=c,this._initMutex=new kn("websocket",d?d.clientId:void 0);let{timeout:l,timeoutFactor:h}=n,f=Math.max(300,Math.floor(3*l/5)),m=Math.max(1.2,Math.floor(8*h)/10);Lr.ONLINE&&(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m),$t.on(Bd.NETWORK_STATE_CHANGE,(E,_)=>{E!==_&&(this.resetReconnectCount("network state change: ".concat(_," -> ").concat(E)),E===Lr.ONLINE?(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=h))})}getConnection(){return this.websocket||void 0}init(n){return P(this,arguments,function*(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,o=yield this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{let c=ph(),d=this.urls[this.currentURLIndex];M("ENABLE_PREALLOC_PC")&&this.emit(nU.PRE_CONNECT_PC),this.createWebSocketConnection(d).then(c.resolve).catch(c.reject),this.once(Re.CLOSED,()=>{c.reject(new K(D.WS_DISCONNECT))}),this.once(Re.CONNECTED,c.resolve),yield c.promise}catch{}finally{o()}})}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);let r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new K(D.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new K(D.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(t){return P(this,null,function*(){var n;let r=ph();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let o=m=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),T.debug("[".concat(this.name,"] websocket opened:"),m),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},c=m=>P(this,null,function*(){var E;if(T.debug("[".concat(this.name,"] websocket close ").concat((E=this.websocket)===null||E===void 0?void 0:E.url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new K(D.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");let _=qr(this,Re.WILL_RECONNECT,this.reconnectMode,m.reason)||this.reconnectMode,v=yield this.reconnectWithAction(_);if(this.state==="closed")return void T.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!v)return r.reject(new K(D.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),this.close(!0);r.resolve()}}),d=m=>{this.emit(Re.ON_MESSAGE,m)},l=m=>{T.warn("[".concat(this.connectionID,"] ws open error ").concat(m))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),M("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=M("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(this.name,"] start connect, url:"),t);let h=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var f;let m=yield this.chooseBestWebsocketConnection(t);this.websocket=m,o&&o(this.websocket.url),this.websocket.onclose=c,this.websocket.onmessage=d,this.websocket.onerror=l,(f=this.store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this.joinGatewayRecordIndex=h}catch(m){let E=this.state==="closed",_=m instanceof K,v=_&&m.code===D.WS_ABORT,A=_&&m.code===D.WS_ERR,C=_?m.message:m&&(m.reason||m.toString());T.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(C)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:v?"aborted":"error",errors:[m]},h),E||A?(r.reject(E?new K(D.WS_DISCONNECT,"websocket is closed: ".concat(C)):new K(D.WS_ERR,"init websocket failed: ".concat(C))),A&&T.error("[".concat(this.name,"] init websocket failed: ").concat(C))):c&&c(m)}return r.promise})}reconnectWithAction(n){return P(this,arguments,function*(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;T.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||$t.isOnline||!$t.onlineWaiter||(this.onlineReconnectListener=$t.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,r){let l=aC(this.reconnectCount,this.retryConfig);T.debug("[".concat(this.name,"] wait ").concat(l,"ms to reconnect websocket, mode: ").concat(t)),yield ie.race([Sn(l),this.onlineReconnectListener||new ie(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;let c=(l,h)=>P(this,null,function*(){this.emit(Re.RECONNECT_CREATE_CONNECTION,h),yield this.createWebSocketConnection(l)});try{if(t==="retry")yield c(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);T.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),yield c(this.urls[this.currentURLIndex],t)}else t==="recover"&&(T.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=yield An(this,Re.REQUEST_NEW_URLS),this.currentURLIndex=0,yield c(this.urls[this.currentURLIndex],t))}catch(l){var d;T.error("[".concat(this.name,"] reconnect failed ").concat(l&&l.toString()));let h=l==null||(d=l.data)===null||d===void 0?void 0:d.desc;return Array.isArray(h)&&ne(h).call(h,"dynamic key expired")?(this.emit(Re.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,r)}return!0})}}class $C extends sU{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(t,n){return P(this,null,function*(){let r=ph(),o=function(d,l){return new ate(d,l)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),o.closeAllWebsockets(),r.reject(new K(D.WS_ABORT,"choose best websocket aborted"))};let c=M("GATEWAY_DOMAINS");return T.debug("[choose-best-ws] currentDomain: ",t,", domains: ",c,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),o.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})})}}class Ah extends sU{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(t,n){return P(this,null,function*(){return new ie((r,o)=>{let c=!1,d=[];this.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),d.forEach(A=>{A.onclose=null,A.onopen=null,A.onmessage=null,A.close()}),o(new K(D.WS_ABORT,"choose best websocket aborted"))};let l=M("GATEWAY_DOMAINS"),h,f=t.indexOf("?h="),m=l.find(A=>f!==-1?ne(t).call(t,A,f):ne(t).call(t,A));T.debug("[choose-best-ws] currentDomain: ",m,", domains: ",l);let E=!this.tryDoubleDomain||!m;if(!E&&m){var _;let A=Date.now();try{l.forEach(C=>{let I=f===-1?t.replace(m,C):t.substr(0,f)+t.substr(f).replace(m,C),O=new WebSocket(I);O.binaryType="arraybuffer",d.push(O),T.debug("[choose-best-ws] ws is connecting:",O.url)})}catch{for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),d.forEach(I=>I.close());d.length;)d.pop();E=!0}(_=this.store)===null||_===void 0||_.recordJoinChannelService({urls:d.map(C=>C.url),service:"gateway"},n),d.forEach(C=>{C.onopen=()=>{if(c)return;let I=Date.now()-A;T.debug("[choose-best-ws] ws open cost ".concat(I,"ms")),d.filter(O=>O!==C).forEach(O=>{T.debug("[choose-best-ws]close backup websocket: ".concat(O.url)),O.close()}),c=!0,r(C)},C.onclose=I=>{h=I,!c&&(d.find(O=>!(O.readyState===WebSocket.CLOSED||O.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),c=!0,o(h)))},C.onmessage=I=>{T.debug("[choose-best-ws]".concat(C.url," onmessage: ").concat(I.data))}}),Sn(this.forceCloseTimeout).then(()=>{d.forEach(C=>{C.readyState!==WebSocket.OPEN&&C.close()})})}if(E){var v;let A;T.debug("[choose-best-ws] use single url: ",t),(v=this.store)===null||v===void 0||v.recordJoinChannelService({urls:[t],service:"gateway"},n);try{A=new WebSocket(t),d.push(A),A.binaryType="arraybuffer"}catch(C){let I=new K(D.WS_ERR,"init websocket failed! Error: ".concat(C.toString()));return T.error("[".concat(this.name,"]").concat(I)),void o(I)}A.onopen=()=>{r(A)},A.onclose=C=>{o(C)},A.onmessage=C=>{T.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(C.data))},Sn(this.forceCloseTimeout).then(()=>{A&&A.readyState!==WebSocket.OPEN&&A.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})})}}class cte extends Dt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===mt.CONNECTED?this.emit(ye.WS_CONNECTED):t===mt.RECONNECTING?this.emit(ye.WS_RECONNECTING,this._websocketReconnectReason):t===mt.CLOSED&&this.emit(ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),b(this,"_disconnectedReason",void 0),b(this,"_websocketReconnectReason",void 0),b(this,"_connectionState",mt.CLOSED),b(this,"reconnectToken",void 0),b(this,"websocket",void 0),b(this,"openConnectionTime",void 0),b(this,"clientId",void 0),b(this,"lastMsgTime",Date.now()),b(this,"uploadCache",[]),b(this,"uploadCacheInterval",void 0),b(this,"rttRolling",new IL(5)),b(this,"pingpongTimer",void 0),b(this,"wsInflateDataTimer",void 0),b(this,"pingpongTimeoutCount",0),b(this,"joinResponse",void 0),b(this,"multiIpOption",void 0),b(this,"initError",void 0),b(this,"spec",void 0),b(this,"store",void 0),b(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ye.ON_BINARY_DATA,r.data);let o=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){let c="res-@".concat(o._id);this.emit(c,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===Pe.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===Pe.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}if(o._type===Pe.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case ge.ERR_LICENSE_MISSING:this.close(Ye.LICENSE_MISSING);break;case ge.ERR_LICENSE_EXPIRED:this.close(Ye.LICENSE_EXPIRED);break;case ge.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ye.LICENSE_MINUTES_EXCEEDED);break;case ge.ERR_LICENSE_PERIOD_INVALID:this.close(Ye.LICENSE_PERIOD_INVALID);break;case ge.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ye.LICENSE_MULTIPLE_SDK_SERVICE);break;case ge.ERR_LICENSE_ILLEGAL:this.close(Ye.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new $C("gateway-".concat(this.clientId),this.spec.retryConfig,!0,M("JOIN_GATEWAY_USE_DUAL_DOMAIN"),M("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===mt.CONNECTED&&this.reconnect("retry",bn.OFFLINE)})}request(t,n,r,o){return P(this,null,function*(){let c=ht(6,""),d={_id:c,_type:t,_message:n},l=this.websocket.connectionID,h=()=>new ie((A,C)=>{if(this.connectionState===mt.CONNECTED)return A();let I=()=>{this.off(ye.WS_CLOSED,O),A()},O=()=>{this.off(ye.WS_CONNECTED,I),C(new G(D.WS_ABORT))};this.once(ye.WS_CONNECTED,I),this.once(ye.WS_CLOSED,O),t!==ve.PUBLISH&&t!==ve.PUBLISH_DATASTREAM&&t!==ve.SUBSCRIBE&&t!==ve.SUBSCRIBE_DATASTREAM&&t!==ve.UNSUBSCRIBE&&t!==ve.UNSUBSCRIBE_DATASTREAM&&t!==ve.UNPUBLISH&&t!==ve.UNPUBLISH_DATASTREAM&&t!==ve.CONTROL&&t!==ve.RESTART_ICE||this.once(ye.DISCONNECT_P2P,()=>{C(new G(D.DISCONNECT_P2P))}),t!==ve.PUBLISH&&t!==ve.RESTART_ICE||this.once(ye.ABORT_P2P_EXECUTION,()=>{C(new G(D.DISCONNECT_P2P))})});if(this.connectionState!==mt.CONNECTING&&this.connectionState!==mt.RECONNECTING||t===ve.JOIN||t===ve.REJOIN||(yield h()),this.websocket.sendMessage(d,!0),o)return;let f=new ie((A,C)=>{let I=!1,O=(x,B)=>{I=!0,A({isSuccess:x==="success",message:B||{}}),this.off(ye.WS_CLOSED,N),this.off(ye.WS_RECONNECTING,N),this.emit(ye.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(c),O);let N=()=>{C(new G(D.WS_ABORT,"type: ".concat(t))),this.off(ye.WS_CLOSED,N),this.off(ye.WS_RECONNECTING,N),this.off("res-@".concat(c),O)};this.once(ye.WS_CLOSED,N),this.once(ye.WS_RECONNECTING,N),Sn(M("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||I||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ye.REQUEST_TIMEOUT,t,n))})}),m=null;try{m=yield f}catch(A){if(this.connectionState===mt.CLOSED||t===ve.LEAVE)throw new G(D.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?A.throw():t===ve.JOIN||t===ve.REJOIN?null:(yield h(),yield this.request(t,n))}if(m.isSuccess)return m.message;let E=Number(m.message.error_code||m.message.code),_=bh(E),v=new G(D.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(m.message.error_str),{code:E,data:m.message,desc:_.desc});return _.action==="success"?m.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(_.desc,", action: ").concat(_.action)),E===ge.ERR_TOO_MANY_BROADCASTERS?((t===ve.JOIN||t===ve.REJOIN)&&(this.initError=v,this.close()),v.throw()):_.action==="failed"?v.throw():_.action==="quit"?(this.initError=v,this.close(),v.throw()):(E===ge.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",bn.MULTI_IP)):this.reconnect(_.action,bn.SERVER_ERROR),t===ve.JOIN||t===ve.REJOIN?null:yield this.request(t,n)))})}waitMessage(t,n){return new ie(r=>{let o=c=>{(!n||n(c))&&(this.off(t,o),r(c))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Rh.WRTC_STATS,n)}upload(t,n){let r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{let c=M("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==mt.CONNECTED)return;let d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},M("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){let r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ie((n,r)=>{this.once(ye.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ye.WS_CLOSED,o=>r(this.initError||new G(D.WS_ABORT,o))),this.connectionState=mt.CONNECTING,this.websocket.init(t).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Ye.LEAVE,this.connectionState=mt.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}join(){return P(this,null,function*(){if(!this.joinResponse){this.emit(ye.ABORT_P2P_EXECUTION);let t=yield An(this,ye.REQUEST_JOIN_INFO),n=yield this.request(ve.JOIN,t);if(!n)return this.emit(ye.REPORT_JOIN_GATEWAY,wg.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=mt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0})}rejoin(){return P(this,null,function*(){if(!this.reconnectToken)throw new G(D.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=_h(this,ye.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let n=yield this.request(ve.REJOIN,t);return!!n&&(this.connectionState=mt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Pe.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Pe.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Pe.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Pe.MUTE_AUDIO,{uid:r.uid}):this.emit(Pe.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Pe.MUTE_VIDEO,{uid:r.uid}):this.emit(Pe.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Pe.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Pe.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Pe.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Pe.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Pe.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)})}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);let n=bh(t.code);if(t.code===28&&"detail"in t&&(T.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(ye.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(n.action,bn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=M("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>M("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",bn.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-n;this.rttRolling.add(r),M("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Rh.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Re.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ye.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Re.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Re.CLOSED,()=>{this.connectionState=mt.CLOSED}),this.websocket.on(Re.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=mt.CLOSED}),this.websocket.on(Re.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===mt.CONNECTED?this.connectionState=mt.RECONNECTING:this.connectionState=mt.CONNECTING}),this.websocket.on(Re.WILL_RECONNECT,(t,n,r)=>{let o=_h(this,ye.IS_P2P_DISCONNECTED),c=o||t!=="retry";o&&t==="retry"&&(T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=wg.P2P_DISCONNECTED),c&&(T.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(ye.REPORT_JOIN_GATEWAY,n||wg.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ye.DISCONNECT_P2P)),r(t)}),this.websocket.on(Re.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",bn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(ye.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof G){if(t.code===D.UNEXPECTED_RESPONSE&&t.data.code===ge.ERR_NO_AUTHORIZED)return this.initError=new G(D.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Ye.TOKEN_EXPIRE);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",bn.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Re.REQUEST_NEW_URLS,(t,n)=>{An(this,ye.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Re.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(nU.PRE_CONNECT_PC,()=>{this.emit(ye.PRE_CONNECT_PC)})}}let dte=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Xt=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function aU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Ag(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?aU(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function du(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(M("TURN_DOMAIN")):(T.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function XC(e,t){e.addresses||(e.addresses=[]);let n=function(l,h){if(M("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(E=>{let{ip:_,port:v}=E;return{address:"".concat(_,":").concat(v)}});let f=M("GATEWAY_DOMAINS"),m=f[1]&&ne(h).call(h,f[1])?1:0;return l.map(E=>{let{domain_prefix:_,port:v,ip:A}=E;if(_)return{address:"".concat(_,".").concat(f[m++%f.length],":").concat(v)};let C=/^[\.\:\d]+$/.test(A),I=C?"".concat(A.replace(/[^\d]/g,"-"),".").concat(f[m++%f.length],":").concat(v):"".concat(A,":").concat(v);return C||T.debug("Cannot recognized as ip address: ".concat(A,", use as host")),{ip:A,port:v,address:I}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&typeof r=="string"){let l=r.split(";");for(let h=0;h<l.length;h++){var o;let f=Hn(o=l[h]).call(o);n[h]&&f&&(n[h].ip6=f)}}let c=e.detail&&e.detail.candidate,d;if(c){let[l,h]=c.split(":");l&&h&&(d={port:Number(h),ip:l,address:"".concat(l,":").concat(h)})}return{gatewayAddrs:n,apGatewayAddress:d,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function xr(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function cU(e){let t=e._encoderConfig;if(!t)return{};let n={resolution:t.width&&t.height?"".concat(xr(t.width),"x").concat(xr(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function dU(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function Dh(e,t){let n,r,o;switch(t){case Xt.CHOOSE_SERVER:r=4096,o="choose server";break;case Xt.CLOUD_PROXY:r=1048576,o="proxy";break;case Xt.CLOUD_PROXY_5:r=4194304,o="proxy5";break;case Xt.CLOUD_PROXY_FALLBACK:r=4194310,o="proxy fallback";break;default:throw new G(D.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(c=>{c.buffer&&c.buffer.flag===r&&(n={code:c.buffer.code,addresses:(c.buffer.edges_services||[]).map(d=>Ag(Ag({},d),{},{ticket:c.buffer.cert})),server_ts:e.enter_ts,uid:c.buffer.uid,cid:c.buffer.cid,cname:c.buffer.cname,detail:Ag(Ag({},c.buffer.detail),e.detail),flag:c.buffer.flag,opid:e.opid,cert:c.buffer.cert})}),!n)throw new G(D.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(o," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}function uU(e,t){return P(this,null,function*(){return yield ie.all(e.addresses.map(n=>P(this,null,function*(){return{address:du(n.ip),tcpport:n.port,udpport:n.port,username:t&&M("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Dn.username,password:t&&M("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield rC(t.toString()):Dn.password}})))})}function JC(e,t){let n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,o=t.videoWidth||n.width;return r&&o?Math.max(Math.min(r,o)/Math.min(xr(e.height),xr(e.width)),1):(T.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function pa(e){let{candidateType:t,relayProtocol:n,type:r,address:o,port:c,protocol:d}=e,l={candidateType:t,relayProtocol:n,protocol:d};if(r!=="local-candidate"){let h=o.split(".");h.length>=4&&(h[1]="*",h[2]="*"),l.address=h.join("."),l.port=c}return l}function Dg(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:M("SVC_MODE");if(M("ENABLE_SVC"))return function(t){return t in rg}(e)?e:rg.L1T3}let lU={[ce.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[ce.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function Og(e,t,n){t.forEach(r=>{var o;let c=lU[e].find(l=>{var h;let{key:f}=l;return ne(h=r.extensionName).call(h,f)});if(!c)return;let d=n.find(l=>{let{extensionName:h}=l;return ne(h).call(h,c.key)});d&&ne(o=d.extensionName).call(o,"gdpr_forbidden")&&(r.extensionName=d.extensionName)})}function uu(e,t){t.forEach(n=>{var r;let o=lU[e].find(c=>{var d;let{key:l}=c;return ne(d=n.extensionName).call(d,l)});ne(r=n.extensionName).call(r,"gdpr_forbidden")&&o&&(n.extensionName=o.extensionName)})}function hU(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ne(e).call(e,"abs-send-time")}function Ng(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ne(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function pU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function fU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pU(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Oh(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0,{filterRTX:o,filterVideoFec:c,filterAudioFec:d,filterAudioCodec:l,filterVideoCodec:h}=t,{useXR:f}=n,m=[],E=[],_=[],v=[],A=!1,C=!1;if(Ir(e).mediaDescriptions.forEach(O=>{r&&r!==O.attributes.direction||(O.media.mediaType!=="video"||A||(E=O.attributes.payloads,v=O.attributes.extmaps,A=!0),O.media.mediaType!=="audio"||C||(m=O.attributes.payloads,_=O.attributes.extmaps,C=!0))}),!v||E.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!_||m.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(E.forEach(O=>{var N;(N=O.rtpMap)!==null&&N!==void 0&&N.clockRate&&(O.rtpMap.clockRate=parseInt(O.rtpMap.clockRate)),f&&O.rtcpFeedbacks.push({type:"rrtr"})}),m.forEach(O=>{var N;(N=O.rtpMap)!==null&&N!==void 0&&N.clockRate&&(O.rtpMap.clockRate=parseInt(O.rtpMap.clockRate)),f&&O.rtcpFeedbacks.push({type:"rrtr"})}),o&&(m=m.filter(O=>{var N;return((N=O.rtpMap)===null||N===void 0?void 0:N.encodingName.toLowerCase())!=="rtx"}),E=E.filter(O=>{var N;return((N=O.rtpMap)===null||N===void 0?void 0:N.encodingName.toLowerCase())!=="rtx"})),c&&(E=E.filter(O=>{var N;return!/(red)|(ulpfec)|(flexfec)/i.test(((N=O.rtpMap)===null||N===void 0?void 0:N.encodingName)||"")})),d&&(m=m.filter(O=>{var N;return!/(red)|(ulpfec)|(flexfec)/i.test(((N=O.rtpMap)===null||N===void 0?void 0:N.encodingName)||"")})),l&&l?.length>0&&(m=m.filter(O=>{var N;return ne(l).call(l,((N=O.rtpMap)===null||N===void 0?void 0:N.encodingName.toLowerCase())||"")})),h&&h?.length>0){let O=E.filter(N=>{var x;return ne(h).call(h,((x=N.rtpMap)===null||x===void 0?void 0:x.encodingName.toLowerCase())||"")});E=O.concat(o?[]:eI(O,E))}let I=M("UNSUPPORTED_VIDEO_CODEC");return I&&I.length>0&&(E=E.filter(O=>!(O.rtpMap&&ne(I).call(I,O.rtpMap.encodingName.toLowerCase())))),{audioCodecs:m,videoCodecs:E,audioExtensions:_,videoExtensions:v}}function fa(e){let t=Ir(e),n,r;for(let o of t.mediaDescriptions){if(!n){let c=o.attributes.iceUfrag,d=o.attributes.icePwd;if(!c||!d)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:c,icePwd:d}}if(!r){let c=o.attributes.fingerprints;c.length>0&&(r={fingerprints:c})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function mU(e,t){let n=[],r=e.attributes.ssrcGroups.filter(d=>d.semantic==="FID"),o=e.attributes.ssrcGroups.find(d=>d.semantic==="SIM"),c=e.attributes.ssrcs;if(o)o.ssrcIds.forEach(d=>{var l;let h=(l=r.find(f=>f.ssrcIds[0]===d))===null||l===void 0?void 0:l.ssrcIds[1];n.push({ssrcId:d,rtx:t?h:void 0})});else if(r.length>0){let d=r[0].ssrcIds[0],l=r[0].ssrcIds[1];n.push({ssrcId:d,rtx:t?l:void 0})}else{if(c.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:c[0].ssrcId})}return n}function gU(e,t,n){let{cname:r}=e,o=[];t&&(o=EU(t)),o.length===0&&(o=e.iceParameters.candidates.map(m=>({foundation:m.foundation,componentId:"1",transport:m.protocol,priority:m.priority.toString(),connectionAddress:m.ip,port:m.port.toString(),type:m.type,extension:{}})),T.debug("Using candidates from gateway."));let c={fingerprints:e.dtlsParameters.fingerprints.map(m=>({hashFunction:m.algorithm,fingerprint:m.fingerprint}))},d={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},l;switch(e.dtlsParameters.role){case"server":l="passive";break;case"client":l="active";break;case"auto":l="actpass"}let h=Mg(e.rtpCapabilities),f=[];return Array.isArray(n)&&n.length>0&&n.forEach(m=>{f.push({kind:ce.VIDEO,ssrcId:m.v,rtx:m.v_rtx,mslabel:"".concat(m.v,"_").concat(m.a)},{kind:ce.AUDIO,ssrcId:m.a,mslabel:"".concat(m.v,"_").concat(m.a)})}),{dtlsParameters:c,iceParameters:d,candidates:o,rtpCapabilities:h,setup:l,cname:r,preSSRCs:f}}function EU(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function _c(e,t,n){let r=[],o=[];return e.forEach(c=>{let{ssrcId:d,rtx:l}=c,h=ht(8,"track-"),f={ssrcId:d,attributes:fU({label:h,mslabel:n=n||ht(10,""),msid:"".concat(n," ").concat(h)},t&&{cname:t})};if(r.push(f),l!==void 0){let m={ssrcId:l,attributes:fU({label:h,mslabel:n,msid:"".concat(n," ").concat(h)},t&&{cname:t})};r.push(m),o.push({semantic:"FID",ssrcIds:[d,l]})}}),e.length>1&&o.push({semantic:"SIM",ssrcIds:e.map(c=>{let{ssrcId:d}=c;return d})}),{ssrcs:r,ssrcGroups:o}}function lu(e,t){t instanceof Ft&&e.attributes.payloads.forEach(n=>{var r;let o=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";let c=t._encoderConfig;c&&o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(c.bitrate&&!xt()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*c.bitrate))),c.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(c.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(c.sampleRate)),c.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function QC(e){let t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function ZC(e,t){var n;if(!(t instanceof vt&&t._encoderConfig&&t._hints.indexOf(pt.SCREEN_TRACK)===-1))return;let r=t._encoderConfig;He().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(o=>{var c,d;ne(c=["h264","h265","vp8","vp9","av1"]).call(c,((d=o.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),He().supportMinBitrate&&!ne(n=t._hints).call(n,pt.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(o=>{var c,d;ne(c=["h264","h265","vp8","vp9","av1"]).call(c,((d=o.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters["x-google-start-bitrate"]="".concat(M("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function _U(e){if(e.media.mediaType!=="video")return;let t=Be();if(t.name!==ze.SAFARI&&t.os!==ln.IOS)return;let n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function Pg(e,t,n){if(!t)return;let r,o;if(e.media.mediaType==="video"?(r=n.videoExtensions,o=n.videoCodecs):(r=n.audioExtensions,o=n.audioCodecs),t.twcc===!0){let c=r.find(d=>Ng(d.extensionName));if(c){let d=c.extensionName;e.attributes.extmaps.find(h=>Ng(h.extensionName))||e.attributes.extmaps.push({entry:c.entry,extensionName:d}),function(h,f){return f.filter(m=>!!h.find(E=>E.payloadType===m.payloadType&&!!E.rtcpFeedbacks.find(_=>_.type==="transport-cc")))}(o,e.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(f=>f.type==="transport-cc")||h.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){let c=e.attributes.extmaps.findIndex(d=>Ng(d.extensionName));c!==-1&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach(d=>{let l=d.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");l!==-1&&d.rtcpFeedbacks.splice(l,1)})}if(t.remb===!0){let c=r.find(d=>hU(d.extensionName));if(c){let d=c.extensionName;e.attributes.extmaps.find(h=>h.extensionName===d)||e.attributes.extmaps.push({entry:c.entry,extensionName:d}),function(h,f){return f.filter(m=>!!h.find(E=>E.payloadType===m.payloadType&&!!E.rtcpFeedbacks.find(_=>_.type==="goog-remb")))}(o,e.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(f=>f.type==="goog-remb")||h.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){let c=e.attributes.extmaps.findIndex(d=>hU(d.extensionName));c!==-1&&e.attributes.extmaps.splice(c,1),e.attributes.payloads.forEach(d=>{let l=d.rtcpFeedbacks.findIndex(h=>h.type==="goog-remb");l!==-1&&d.rtcpFeedbacks.splice(l,1)})}}function vU(e,t,n){if(xt()||e.media.mediaType!=="video"||!(t instanceof vt)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!M("SIMULCAST")||n==="vp9"&&M("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let r=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,o=e.attributes.ssrcs[0],c=e.attributes.ssrcGroups.find(l=>l.semantic==="FID"&&l.ssrcIds[0]===o.ssrcId),d={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let l=1;l<r;l++)e.attributes.ssrcs.push({ssrcId:o.ssrcId+l,attributes:Ut(o.attributes)}),d.ssrcIds.push(o.ssrcId+l),c&&(e.attributes.ssrcs.push({ssrcId:c.ssrcIds[1]+l,attributes:Ut(o.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+l,c.ssrcIds[1]+l]}));e.attributes.ssrcGroups.unshift(d)}function yU(){return P(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});let r=(yield n.createOffer()).sdp,{send:o,recv:c,sendrecv:d}=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0,m=Oh(f,l,h,"sendonly"),E=Oh(f,l,h,"recvonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zi(m,E,"videoExtensions",_,v,A),zi(m,E,"videoCodecs",_,v,A),zi(m,E,"audioExtensions",_,v,A),zi(m,E,"audioCodecs",_,v,A),M("RAISE_H264_BASELINE_PRIORITY")){let C=[],I=[];A.videoCodecs.forEach((O,N)=>{var x;if(((x=O.rtpMap)===null||x===void 0?void 0:x.encodingName.toLocaleLowerCase())==="h264"){var B,j;let F=A.videoCodecs[N+1],W=F&&RU(O,F),X=(B=O.fmtp)===null||B===void 0?void 0:B.parameters["profile-level-id"],oe=(j=O.fmtp)===null||j===void 0?void 0:j.parameters["packetization-mode"];!X||X!==M("FIRST_H264_PROFILE_LEVEL_ID")||M("FIRST_PACKETIZATION_MODE")&&oe!==M("FIRST_PACKETIZATION_MODE")?W?I.push([O,F]):I.push([O]):W?C.push([O,F]):C.push([O])}}),C.length>0&&I.length>0&&(T.debug("raising H264 baseline profile priority"),A.videoCodecs.forEach((O,N)=>{var x;if(((x=O.rtpMap)===null||x===void 0?void 0:x.encodingName.toLocaleLowerCase())==="h264"){let B=RU(O,A.videoCodecs[N+1]),j=C.shift()||I.shift()||[];j.length>0&&(B?A.videoCodecs.splice(N,2,...j):A.videoCodecs.splice(N,1,...j))}}),v.videoCodecs=v.videoCodecs.filter(O=>{var N,x;return!(((N=O.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"&&((x=O.fmtp)===null||x===void 0?void 0:x.parameters["profile-level-id"])!==M("FIRST_H264_PROFILE_LEVEL_ID"))}),M("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(O=>{var N,x;return!(((N=O.rtpMap)===null||N===void 0?void 0:N.encodingName.toLocaleLowerCase())==="h264"&&((x=O.fmtp)===null||x===void 0?void 0:x.parameters["profile-level-id"])!==M("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:_,recv:v,sendrecv:A}}(e,t,r);try{n.close()}catch{}return{send:o,recv:c,sendrecv:d}})}function TU(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=Oh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zi(e,t,"videoExtensions",n,r,o),zi(e,t,"videoCodecs",n,r,o),zi(e,t,"audioExtensions",n,r,o),zi(e,t,"audioCodecs",n,r,o),M("RAISE_H264_BASELINE_PRIORITY")){let c=o.videoCodecs.findIndex(d=>d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&d.fmtp&&d.fmtp.parameters["profile-level-id"]==="42001f");if(c!==-1){let d=o.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(d<c){T.debug("raising H264 baseline profile priority");let l=o.videoCodecs[c];o.videoCodecs.splice(c,1),o.videoCodecs.splice(d,0,l)}d!==-1&&(r.videoCodecs=r.videoCodecs.filter(l=>!(l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:o}}function zi(e,t,n,r,o,c){if(n==="videoExtensions"||n==="audioExtensions"){let d=[];return e[n].forEach(l=>{t[n].some((h,f)=>{if(l.entry===h.entry&&l.extensionName===h.extensionName)return d.push(f),!0})?c[n].push(l):r[n].push(l)}),void t[n].forEach((l,h)=>{d.indexOf(h)===-1&&o[n].push(l)})}if(n==="videoCodecs"||n==="audioCodecs"){let d=[];return e[n].forEach(l=>{t[n].some((h,f)=>{if(l.payloadType===h.payloadType&&JSON.stringify(l)===JSON.stringify(h))return d.push(f),!0})?c[n].push(l):r[n].push(l)}),void t[n].forEach((l,h)=>{d.indexOf(h)===-1&&o[n].push(l)})}}function Mg(e){let{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let o,c;return t?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...t.audioCodecs,...r.audioCodecs],o.videoCodecs=[...t.videoCodecs,...r.videoCodecs],o.audioExtensions=[...t.audioExtensions,...r.audioExtensions],o.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):o=r,n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...r.audioCodecs],c.videoCodecs=[...n.videoCodecs,...r.videoCodecs],c.audioExtensions=[...n.audioExtensions,...r.audioExtensions],c.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):c=r,{send:o,recv:c}}function hu(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function Nh(e,t,n,r){let o=[];if(e===ce.VIDEO){if(M("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(o=t.videoCodecs.filter(c=>{var d;return ne(d=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(d,r)&&c&&c.fmtp&&c.fmtp.parameters["profile-level-id"]===M("H264_PROFILE_LEVEL_ID")})),!Array.isArray(o)||o.length===0){let c=[],d=[],l=[],h=[];if(n.videoCodecs.forEach(f=>{let m=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"";ne(m).call(m,r)?c.push(f):ne(m).call(m,"vp9")?d.push(f):ne(m).call(m,"vp8")?l.push(f):ne(m).call(m,"h264")&&h.push(f)}),c.length===0){let f="";d.length!==0?(c=d,f="vp9"):l.length!==0?(c=l,f="vp8"):h.length!==0&&(c=h,f="h264"),T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(f))}c.length!==0&&(o=t.videoCodecs.filter(f=>c.some(m=>m.payloadType===f.payloadType)))}if(o.length===0&&(T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),o=t.videoCodecs),M("USE_PUB_RTX")||M("USE_SUB_RTX")){let c=eI(o,t.videoCodecs);o=[...o,...c]}}else o=t.audioCodecs.filter(c=>{var d;return ne(d=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(d,r)}),o.length===0&&(T.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),o=t.audioCodecs.filter(c=>{var d;return ne(d=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(d,"opus")}));return o}function eI(e,t){let n=e.map(r=>r.payloadType.toString());return t.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&ne(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}function kg(e,t,n){return P(this,null,function*(){let r=t.toString(),o=CU(r,"offer","remote","exchangeSDP");yield e.setRemoteDescription({type:"offer",sdp:r});let c=yield e.createAnswer();if(!c.sdp)throw new Error("cannot get answer sdp");let d=c.sdp;d=SU(d,n||{}),o?.(d||""),yield e.setLocalDescription({type:"answer",sdp:d})})}function SU(e,t,n){let r=Ir(e),{useXR:o}=t;return r.mediaDescriptions.forEach(c=>{var d;c.attributes.mid&&(Array.isArray(n)&&!ne(n).call(n,c.attributes.mid)||(c.media.mediaType==="audio"&&hu(c),o&&ne(d=["audio","video"]).call(d,c.media.mediaType)&&c.attributes.payloads.forEach(l=>{l.rtcpFeedbacks.findIndex(h=>h.type==="rrtr")===-1&&l.rtcpFeedbacks.push({type:"rrtr"})})))}),ua(r)}function CU(e,t,n,r){if(M("SDP_LOGGING"))return T.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,`
`),e),t==="offer"?o=>{CU(o,"answer",n==="local"?"remote":"local",r)}:void 0}function IU(e){let t=M("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(n=>ne(e).call(e,n))}function RU(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function wU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function mi(e,t){return typeof M(e)===t?M(e):void 0}function ute(){try{let e=M("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?wU(Object(r),!0).forEach(function(o){b(t,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):wU(Object(r)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(r,o))})}return t}({},e)}catch(e){return T.debug("handle gateway attributes failed: ",e),{}}}let bU={};function vc(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&T.debug("install service ".concat(e.name)),bU[e.name]=e}function ma(e){let t=bU[e];if(!t)throw new K(D.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function AU(e,t){return ma("DataStream").create(e,t)}function DU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function As(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?DU(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let tI=new Map;class lte extends Dt{get state(){return this._state}set state(t){if(t===this._state)return;let n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(gn.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(gn.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var r,o,c;super(),b(this,"store",void 0),b(this,"joinInfo",void 0),b(this,"key",void 0),b(this,"ntpOffset",0),b(this,"signal",void 0),b(this,"role",void 0),b(this,"inChannelInfo",{joinAt:null,duration:0}),b(this,"spec",void 0),b(this,"_state","DISCONNECTED"),b(this,"_statsCollector",void 0),b(this,"_disconnectedReason",void 0),b(this,"isSignalRecover",!1),b(this,"hasChangeBGPAddress",!1),b(this,"trafficStatsInterval",void 0),b(this,"networkQualityInterval",void 0),b(this,"_joinGatewayStartTime",0),b(this,"_signalTimeout",!1),b(this,"_clientRoleOptions",void 0),b(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(r={spec:As(As({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(o=(c=ma("P2PChannel")).createSubmodule)===null||o===void 0?void 0:o.call(c,r)):new cte(As(As({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}join(t,n,r){return P(this,null,function*(){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let o=Date.now(),c=tI.get(t.cname);if(c||(c=new Map,tI.set(t.cname,c)),this._isProactiveJoin=!0,c.has(t.uid)){let f=new G(D.UID_CONFLICT);throw he.joinGateway(t.sid,{lts:o,succ:!1,ec:f.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),f}c.set(t.uid,!0),this.joinInfo=t,this.key=n;let d=0;this.joinGatewayStartTime=o;let l=t.proxyServer;try{T.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(d));let f=t.gatewayAddrs.map(m=>{let{address:E}=m,[_,v]=E.split(":"),A={host:_,port:v};return t.proxyServer&&(A.proxy=t.proxyServer),A});d=(yield this.signal.init(f)).uid,T.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(d," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(f){var h;throw T.error("[".concat(this.store.clientId,"] User join failed"),f.toString()),he.joinGateway(t.sid,{lts:o,succ:!1,ec:((h=f.data)===null||h===void 0?void 0:h.desc)||f.code,errorMsg:f.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!l,signalChannel:"0",preload:t.preload}),c.delete(t.uid),this.signal.close(),f}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(f=>{T.warning("[".concat(this.store.clientId,"] get traffic stats error"),f.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(gn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(gn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(gn.NETWORK_QUALITY,{uplinkNetworkQuality:dU(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:dU(this._statsCollector.trafficStats.B_dnq)}):this.emit(gn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),d})}leave(){return P(this,arguments,function*(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Ye.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==mt.CONNECTED||(yield function(r,o){return o===1/0?r:ie.race([r,MZ(o)])}(this.signal.request(ve.LEAVE,void 0,!0),3e3))}catch(r){T.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==Ye.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}})}publish(t,n,r){return P(this,null,function*(){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let o={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:M("PUB_EXTEND"),twcc:!!M("PUBLISH_TWCC"),rtx:!!M("USE_PUB_RTX")};try{return(yield this.signal.request(ve.PUBLISH,o,!0))._message}catch(c){if(r&&c.data&&c.data.code===ge.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),c.toString()),yield this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw c}})}publishDataChannel(t,n,r){return P(this,null,function*(){var o;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let c={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(o=n.maxRetransmits)!==null&&o!==void 0?o:10,channel_id:n.channelId,metadata:n.metadata};try{yield this.signal.request(ve.PUBLISH_DATASTREAM,c,!0)}catch(d){if(r&&d.data&&d.data.code===ge.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),d.toString()),yield this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw d}})}unpublish(t,n){return P(this,null,function*(){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));yield this.signal.request(ve.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){T.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}})}unpublishDataChannel(t){return P(this,null,function*(){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));yield ie.all(t.map(n=>this.signal.request(ve.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){T.warning("unpublish datachannels warning: ",n)}})}presubscribe(t,n,r){return P(this,null,function*(){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let o={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!M("SUBSCRIBE_TWCC"),rtx:!!M("USE_SUB_RTX")||void 0,extend:M("SUB_EXTEND"),svc:Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0};try{return yield this.signal.request(ve.PRE_SUBSCRIBE,o,!0)}catch(c){if(r&&c.data&&c.data.code===ge.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),c.toString()),this.presubscribe(t,n,!1);throw c}})}subscribe(t,n,r){return P(this,null,function*(){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let o={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!M("SUBSCRIBE_TWCC"),rtx:!!M("USE_SUB_RTX"),extend:M("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0};try{return(yield this.signal.request(ve.SUBSCRIBE,o,!0))._message}catch(c){if(r&&c.data&&c.data.code===ge.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),c.toString()),yield this.tryUnsubBeforeResub(t,n),yield this.subscribe(t,n,!1);throw c}})}subscribeDataChannel(t,n,r){return P(this,null,function*(){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let o={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void(yield this.signal.request(ve.SUBSCRIBE_DATASTREAM,o,!0))}catch(c){if(r&&c.data&&c.data.code===ge.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),c.toString()),yield this.tryUnsubDataChannelBeforeResub(t,n),yield this.subscribeDataChannel(t,n,!1);throw c}})}subscribeAll(t,n){return P(this,null,function*(){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!M("USE_SUB_RTX"),twcc:!!M("SUBSCRIBE_TWCC"),svc:Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0};try{return yield this.signal.request(ve.SUBSCRIBE_STREAMS,r,!0)}catch(o){if(n&&o.data&&o.data.code===ge.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),yield this.tryMassUnsubBeforeResub(t),yield this.subscribeAll(t,!1);throw o}})}setVideoProfile(t){return P(this,null,function*(){let n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let o=r.frameRate,c=r.width,d=r.height,l=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(l=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(l=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,o||(l=!1)),l?{stream_type:0,width:c,height:d,fps:o,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(n)return this.signal.request(ve.SET_VIDEO_PROFILE,n);T.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))})}unsubscribe(t,n){return P(this,null,function*(){try{yield this.signal.request(ve.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){T.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}})}unsubscribeDataChannel(t,n){return P(this,null,function*(){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));yield ie.all(t.map(r=>this.signal.request(ve.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){T.warning("unsubscribeDataChannel warning: ",r)}})}massUnsubscribe(t){return P(this,null,function*(){try{yield this.signal.request(ve.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){T.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}})}reconnectPC(t){return P(this,null,function*(){let{iceParameters:n,dtlsParameters:r,rtpCapabilities:o}=t;return{gatewayEstablishParams:yield this.signal.request(ve.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}})}getGatewayInfo(){return this.signal.request(ve.GATEWAY_INFO)}renewToken(t){return P(this,null,function*(){yield this.signal.request(ve.RENEW_TOKEN,t),this.key=t.token})}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),M("CLIENT_ROLE_OPTIONS")&&(T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(M("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},M("CLIENT_ROLE_OPTIONS"))),this.role=t}setClientRole(t,n){return P(this,null,function*(){if(n&&(this._clientRoleOptions=Object.assign({},n)),M("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},M("CLIENT_ROLE_OPTIONS")),T.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(M("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let r,o=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,o=1):o=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:o=0,yield this.signal.request(ve.SET_CLIENT_ROLE,{role:t,level:o,delay:r,client_ts:Date.now()}),this.role=t})}setRemoteVideoStreamType(t,n){return P(this,null,function*(){yield this.signal.request(ve.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})})}setDefaultRemoteVideoStreamType(t){return P(this,null,function*(){yield this.signal.request(ve.DEFAULT_VIDEO_STREAM,{stream_type:t})})}setStreamFallbackOption(t,n){return P(this,null,function*(){yield this.signal.request(ve.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})})}pickSVCLayer(t,n){return P(this,null,function*(){yield this.signal.request(ve.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})})}setRTM2Flag(t){return P(this,null,function*(){yield this.signal.request(ve.SET_RTM2_FLAG,{rtm2_flag:t})})}sendExtensionMessage(t,n,r){return P(this,null,function*(){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,r)})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),As({},this.inChannelInfo)}getGatewayVersion(){return P(this,null,function*(){return(yield this.signal.request(ve.GATEWAY_INFO)).version})}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=tI.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Dn.username,password:Dn.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(As(As({},Dn),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){return P(this,null,function*(){if(this.state!=="CONNECTED")return;let t=yield this.signal.request(ve.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(n=>{let r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&Zm(()=>{this.emit(gn.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)})}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new G(D.UNEXPECTED_ERROR,"can not generate join message, no join info");let n=Object.assign({},this.joinInfo.apResponse),r=M("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}var o;r&&r.length>128&&(r=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(gn.UPDATE_GATEWAY_CONFIG),o=this.store.clientId,ne(iu).call(iu,o)||iu.push(o);let c=!(xt()||Zk(87)||jL())&&typeof M("ENABLE_PRE_SUB")=="boolean"&&M("ENABLE_PRE_SUB"),d=!jL()&&mi("ENABLE_PREALLOC_PC","boolean"),l=ute(),h=As({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:li,browser:navigator.userAgent,process_id:M("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:M("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:As({enableEncodedTransform:!!M("ENABLE_AUDIO_METADATA")&&Vd(87)||!!M("ENABLE_AUDIO_TOPN")&&$S(ze.CHROME,87,116)||void 0,enableAudioMetadata:!!M("ENABLE_AUDIO_METADATA")&&Vd(87),topnSmoothLevel:M("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:M("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:M("TOPN_SWITCH_HOLD_MS"),topnAudioGain:M("TOPN_AUDIO_GAIN"),enablePublishedUserList:M("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:M("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:mi("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:mi("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:mi("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:M("USE_PUB_RTX")===!0||M("USE_SUB_RTX")===!0||void 0,disableFEC:M("DISABLE_FEC"),enableNTPReport:!!M("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!M("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!M("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:mi("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!M("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!M("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:mi("USE_XR","boolean"),enableLossbasedBwe:mi("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!M("ENABLE_AUT_CC")||void 0,enableCCFallback:mi("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:d,preSubNum:c?mi("PRE_SUB_NUM","number"):void 0,enablePubTWCC:mi("PUBLISH_TWCC","boolean"),enableSubTWCC:mi("SUBSCRIBE_TWCC","boolean"),enablePubRTX:mi("USE_PUB_RTX","boolean"),enableSubRTX:mi("USE_SUB_RTX","boolean"),enableSubSVC:M("ENABLE_SVC")?M("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(M("SVC"))&&M("SVC").length!==0?M("SVC"):void 0,enableSvcExtended:M("ENABLE_SVC")&&Array.isArray(M("SVC_EXTENDED"))&&M("SVC_EXTENDED").length!==0?M("SVC_EXTENDED"):void 0},l)},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,M("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new G(D.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ye.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ye.WS_RECONNECTING,t=>{this.joinInfo&&he.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||bn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",he.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ye.WS_CLOSED,t=>{let n;switch(t){case Ye.LEAVE:n=bn.LEAVE;break;case Ye.UID_BANNED:case Ye.IP_BANNED:case Ye.CHANNEL_BANNED:case Ye.SERVER_ERROR:n=bn.SERVER_ERROR;break;case Ye.FALLBACK:n=bn.FALLBACK;break;case Ye.LICENSE_MISSING:case Ye.LICENSE_EXPIRED:case Ye.LICENSE_MINUTES_EXCEEDED:case Ye.LICENSE_PERIOD_INVALID:case Ye.LICENSE_MULTIPLE_SDK_SERVICE:case Ye.LICENSE_ILLEGAL:case Ye.TOKEN_EXPIRE:n=t;break;default:n=bn.NETWORK_ERROR}T.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+bn.NETWORK_ERROR)),this.joinInfo&&he.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Ye.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Ye.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ye.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){let t=M("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(he.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));nt("EVENT_REPORT_DOMAIN",t[1]),nt("EVENT_REPORT_BACKUP_DOMAIN",t[1]),nt("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Pe.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(ye.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new G(D.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,An(this,gn.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(ye.REQUEST_JOIN_INFO,(t,n,r)=>P(this,null,function*(){var o;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let{iceParameters:c,dtlsParameters:d,rtpCapabilities:l}=yield An(this,gn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(o=this.joinInfo)===null||o===void 0?void 0:o.turnServer});try{t(this.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:d,rtpCapabilities:l,version:"2"}}))}catch(h){n(h)}})),this.signal.on(ye.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(ye.REPORT_JOIN_GATEWAY,(t,n)=>{if(!this.joinInfo)return;let r,o="";var c;t instanceof G?(r=((c=t.data)===null||c===void 0?void 0:c.desc)||t.code,o=t.message):r=t,he.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:o,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(ye.IS_P2P_DISCONNECTED,t=>{t(_h(this,gn.IS_P2P_DISCONNECTED))}),this.signal.on(ye.DISCONNECT_P2P,()=>{this.emit(gn.DISCONNECT_P2P)}),this.signal.on(ye.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ye.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ye.JOIN_RESPONSE,t=>{let n=this.getCurrentGatewayAddress();this.emit(gn.JOIN_RESPONSE,t,n)}),this.signal.on(ye.PRE_CONNECT_PC,()=>P(this,null,function*(){if(this.joinInfo){this.updateTurnConfigFromSignal();let t=this.getCurrentGatewayAddress(),n=M("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t&&n){let r=EU(t);this.emit(gn.PRE_CONNECT_PC,{candidates:r,fingerprint:n})}}})),this.signal.on(ye.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof M("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(M("AP_REQUEST_DETAIL"),";").concat(t))})}tryUnsubBeforeResub(t,n){return P(this,null,function*(){try{yield this.signal.request(ve.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}})}tryUnsubDataChannelBeforeResub(t,n){return P(this,null,function*(){try{yield this.signal.request(ve.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw T.warning("unsubscribe datachannel warning",r),r}})}tryUnpubBeforeRepub(t,n){return P(this,null,function*(){try{yield this.signal.request(ve.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}})}tryUnpubDataChannelBeforeRepub(t,n){return P(this,null,function*(){try{yield this.signal.request(ve.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw T.warning("unpublish datastream warning: ",r),r}})}tryMassUnsubBeforeResub(t){return P(this,null,function*(){let n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{yield this.signal.request(ve.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}})}muteLocal(t,n){return P(this,null,function*(){let r={action:t.find(o=>o.stream_type===Xe.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{yield this.signal.request(ve.CONTROL,r,!0,!0)}catch(o){throw T.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}})}unmuteLocal(t,n){return P(this,null,function*(){let r={action:t.find(o=>o.stream_type===Xe.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{yield this.signal.request(ve.CONTROL,r,!0,!0)}catch(o){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}})}muteRemote(t,n){return P(this,null,function*(){let r={action:t===ce.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{yield this.signal.request(ve.CONTROL,r,!0,!0)}catch(o){throw T.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),o),o}})}unmuteRemote(t,n){return P(this,null,function*(){let r={action:t===ce.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{yield this.signal.request(ve.CONTROL,r,!0,!0)}catch(o){throw T.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),o),o}})}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}restartICE(t){return P(this,null,function*(){let n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return yield this.signal.request(ve.RESTART_ICE,n,!0)}catch(r){throw T.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}})}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||bn.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!M("GATEWAY_WSS_ADDRESS"))return M("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(T.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(t){return P(this,null,function*(){yield this.signal.request(ve.SET_PARAMETER,{enablePublishAudioFilter:t})})}}let Lg=0,nI=0;function So(e,t,n,r){return new ie((o,c)=>{t.timeout=t.timeout||M("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Lg+=Ko(t.data)):n&&(t.data.size?Lg+=t.data.size:t.data instanceof FormData?Lg+=EL(t.data):Lg+=Ko(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,pr.request(t).then(d=>{typeof d.data=="string"?nI+=Ko(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?nI+=d.data.byteLength:nI+=Ko(JSON.stringify(d.data)),r&&o({data:d.data,headers:d.headers}),o(d.data)}).catch(d=>{pr.isCancel(d)?c(new G(D.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?c(new G(D.NETWORK_TIMEOUT,d.message)):d.response?c(new G(D.NETWORK_RESPONSE_ERROR,d.response.status)):c(new G(D.NETWORK_ERROR,d.message))})})}(function(){var e;function t(z){var ee=0;return function(){return ee<z.length?{done:!1,value:z[ee++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(z,ee,le){return z==Array.prototype||z==Object.prototype||(z[ee]=le.value),z},r,o=function(z){z=[typeof globalThis=="object"&&globalThis,z,typeof window=="object"&&window,typeof self=="object"&&self,typeof s=="object"&&s];for(var ee=0;ee<z.length;++ee){var le=z[ee];if(le&&le.Math==Math)return le}throw Error("Cannot find global object")}(this);function c(z,ee){if(ee)e:{var le=o;z=z.split(".");for(var Y=0;Y<z.length-1;Y++){var S=z[Y];if(!(S in le))break e;le=le[S]}(ee=ee(Y=le[z=z[z.length-1]]))!=Y&&ee!=null&&n(le,z,{configurable:!0,writable:!0,value:ee})}}function d(z){return(z={next:z})[Symbol.iterator]=function(){return this},z}function l(z){var ee=typeof Symbol<"u"&&Symbol.iterator&&z[Symbol.iterator];return ee?ee.call(z):{next:t(z)}}if(c("Symbol",function(z){function ee(S,k){this.A=S,n(this,"description",{configurable:!0,writable:!0,value:k})}if(z)return z;ee.prototype.toString=function(){return this.A};var le="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Y=0;return function S(k){if(this instanceof S)throw new TypeError("Symbol is not a constructor");return new ee(le+(k||"")+"_"+Y++,k)}}),c("Symbol.iterator",function(z){if(z)return z;z=Symbol("Symbol.iterator");for(var ee="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),le=0;le<ee.length;le++){var Y=o[ee[le]];typeof Y=="function"&&typeof Y.prototype[z]!="function"&&n(Y.prototype,z,{configurable:!0,writable:!0,value:function(){return d(t(this))}})}return z}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var h;e:{var f={};try{f.__proto__={a:!0},h=f.a;break e}catch{}h=!1}r=h?function(z,ee){if(z.__proto__=ee,z.__proto__!==ee)throw new TypeError(z+" is not extensible");return z}:null}var m=r;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function _(z){if(z.m)throw new TypeError("Generator is already running");z.m=!0}function v(z,ee){return z.h=3,{value:ee}}function A(z){this.g=new E,this.G=z}function C(z,ee,le,Y){try{var S=ee.call(z.g.j,le);if(!(S instanceof Object))throw new TypeError("Iterator result "+S+" is not an object");if(!S.done)return z.g.m=!1,S;var k=S.value}catch(U){return z.g.j=null,z.g.s(U),I(z)}return z.g.j=null,Y.call(z.g,k),I(z)}function I(z){for(;z.g.h;)try{var ee=z.G(z.g);if(ee)return z.g.m=!1,{value:ee.value,done:!1}}catch(le){z.g.v=void 0,z.g.s(le)}if(z.g.m=!1,z.g.l){if(ee=z.g.l,z.g.l=null,ee.F)throw ee.D;return{value:ee.return,done:!0}}return{value:void 0,done:!0}}function O(z){this.next=function(ee){return z.o(ee)},this.throw=function(ee){return z.s(ee)},this.return=function(ee){return function(le,Y){_(le.g);var S=le.g.j;return S?C(le,"return"in S?S.return:function(k){return{value:k,done:!0}},Y,le.g.return):(le.g.return(Y),I(le))}(z,ee)},this[Symbol.iterator]=function(){return this}}function N(z,ee){return ee=new O(new A(ee)),m&&z.prototype&&m(ee,z.prototype),ee}if(E.prototype.o=function(z){this.v=z},E.prototype.s=function(z){this.l={D:z,F:!0},this.h=this.C||this.u},E.prototype.return=function(z){this.l={return:z},this.h=this.u},A.prototype.o=function(z){return _(this.g),this.g.j?C(this,this.g.j.next,z,this.g.o):(this.g.o(z),I(this))},A.prototype.s=function(z){return _(this.g),this.g.j?C(this,this.g.j.throw,z,this.g.o):(this.g.s(z),I(this))},c("Array.prototype.entries",function(z){return z||function(){return function(ee,le){ee instanceof String&&(ee+="");var Y=0,S=!1,k={next:function(){if(!S&&Y<ee.length){var U=Y++;return{value:le(U,ee[U]),done:!1}}return S=!0,{done:!0,value:void 0}}};return k[Symbol.iterator]=function(){return k},k}(this,function(ee,le){return[ee,le]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var x=function(z,ee){for(var le=0;le<z.length;le++)ee(z[le])},B=function(z){return z.replace(/\r?\n|\r/g,`\r
`)},j=function(z,ee,le){return ee instanceof Blob?(le=le!==void 0?le+"":typeof ee.name=="string"?ee.name:"blob",ee.name===le&&Object.prototype.toString.call(ee)!=="[object Blob]"||(ee=new File([ee],le)),[String(z),ee]):[String(z),String(ee)]},F=function(z,ee){if(z.length<ee)throw new TypeError(ee+" argument required, but only "+z.length+" present.")},W=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,X=W.FormData,oe=W.XMLHttpRequest&&W.XMLHttpRequest.prototype.send,te=W.Request&&W.fetch,Me=W.navigator&&W.navigator.sendBeacon,ke=W.Element&&W.Element.prototype,ft=W.Symbol&&Symbol.toStringTag;ft&&(Blob.prototype[ft]||(Blob.prototype[ft]="Blob"),"File"in W&&!File.prototype[ft]&&(File.prototype[ft]="File"));try{new File([],"")}catch{W.File=function(ee,le,Y){return ee=new Blob(ee,Y||{}),Object.defineProperties(ee,{name:{value:le},lastModified:{value:+(Y&&Y.lastModified!==void 0?new Date(Y.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ft&&Object.defineProperty(ee,ft,{value:"File"}),ee}}var Wt=function(z){return z.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Vt=function(z){this.i=[];var ee=this;z&&x(z.elements,function(le){if(le.name&&!le.disabled&&le.type!=="submit"&&le.type!=="button"&&!le.matches("form fieldset[disabled] *"))if(le.type==="file"){var Y=le.files&&le.files.length?le.files:[new File([],"",{type:"application/octet-stream"})];x(Y,function(S){ee.append(le.name,S)})}else le.type==="select-multiple"||le.type==="select-one"?x(le.options,function(S){!S.disabled&&S.selected&&ee.append(le.name,S.value)}):le.type==="checkbox"||le.type==="radio"?le.checked&&ee.append(le.name,le.value):(Y=le.type==="textarea"?B(le.value):le.value,ee.append(le.name,Y))})};if((e=Vt.prototype).append=function(z,ee,le){F(arguments,2),this.i.push(j(z,ee,le))},e.delete=function(z){F(arguments,1);var ee=[];z=String(z),x(this.i,function(le){le[0]!==z&&ee.push(le)}),this.i=ee},e.entries=function z(){var ee,le=this;return N(z,function(Y){if(Y.h==1&&(ee=0),Y.h!=3)return ee<le.i.length?Y=v(Y,le.i[ee]):(Y.h=0,Y=void 0),Y;ee++,Y.h=2})},e.forEach=function(z,ee){F(arguments,1);for(var le=l(this),Y=le.next();!Y.done;Y=le.next()){var S=l(Y.value);Y=S.next().value,S=S.next().value,z.call(ee,S,Y,this)}},e.get=function(z){F(arguments,1);var ee=this.i;z=String(z);for(var le=0;le<ee.length;le++)if(ee[le][0]===z)return ee[le][1];return null},e.getAll=function(z){F(arguments,1);var ee=[];return z=String(z),x(this.i,function(le){le[0]===z&&ee.push(le[1])}),ee},e.has=function(z){F(arguments,1),z=String(z);for(var ee=0;ee<this.i.length;ee++)if(this.i[ee][0]===z)return!0;return!1},e.keys=function z(){var ee,le,Y,S,k=this;return N(z,function(U){if(U.h==1&&(ee=l(k),le=ee.next()),U.h!=3)return le.done?void(U.h=0):(Y=le.value,S=l(Y),v(U,S.next().value));le=ee.next(),U.h=2})},e.set=function(z,ee,le){F(arguments,2),z=String(z);var Y=[],S=j(z,ee,le),k=!0;x(this.i,function(U){U[0]===z?k&&(k=!Y.push(S)):Y.push(U)}),k&&Y.push(S),this.i=Y},e.values=function z(){var ee,le,Y,S,k=this;return N(z,function(U){if(U.h==1&&(ee=l(k),le=ee.next()),U.h!=3)return le.done?void(U.h=0):(Y=le.value,(S=l(Y)).next(),v(U,S.next().value));le=ee.next(),U.h=2})},Vt.prototype._asNative=function(){for(var z=new X,ee=l(this),le=ee.next();!le.done;le=ee.next()){var Y=l(le.value);le=Y.next().value,Y=Y.next().value,z.append(le,Y)}return z},Vt.prototype._blob=function(){var z="----formdata-polyfill-"+Math.random(),ee=[],le="--"+z+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Y,S){return typeof Y=="string"?ee.push(le+Wt(B(S))+`"\r
\r
`+B(Y)+`\r
`):ee.push(le+Wt(B(S))+'"; filename="'+Wt(Y.name)+`"\r
Content-Type: `+(Y.type||"application/octet-stream")+`\r
\r
`,Y,`\r
`)}),ee.push("--"+z+"--"),new Blob(ee,{type:"multipart/form-data; boundary="+z})},Vt.prototype[Symbol.iterator]=function(){return this.entries()},Vt.prototype.toString=function(){return"[object FormData]"},ke&&!ke.matches&&(ke.matches=ke.matchesSelector||ke.mozMatchesSelector||ke.msMatchesSelector||ke.oMatchesSelector||ke.webkitMatchesSelector||function(z){for(var ee=(z=(this.document||this.ownerDocument).querySelectorAll(z)).length;0<=--ee&&z.item(ee)!==this;);return-1<ee}),ft&&(Vt.prototype[ft]="FormData"),oe){var _r=W.XMLHttpRequest.prototype.setRequestHeader;W.XMLHttpRequest.prototype.setRequestHeader=function(z,ee){_r.call(this,z,ee),z.toLowerCase()==="content-type"&&(this.B=!0)},W.XMLHttpRequest.prototype.send=function(z){z instanceof Vt?(z=z._blob(),this.B||this.setRequestHeader("Content-Type",z.type),oe.call(this,z)):oe.call(this,z)}}te&&(W.fetch=function(z,ee){return ee&&ee.body&&ee.body instanceof Vt&&(ee.body=ee.body._blob()),te.call(this,z,ee)}),Me&&(W.navigator.sendBeacon=function(z,ee){return ee instanceof Vt&&(ee=ee._asNative()),Me.call(this,z,ee)}),W.FormData=Vt}})();let Ph=()=>{let e=M("AREAS");return e.length===0&&e.push(Ke.GLOBAL),co(e).call(e,(t,n,r)=>{let o=OU(n);return o?r===0?o:"".concat(t,",").concat(o):t},"")},OU=e=>e===Ke.OVERSEA?"".concat(Ln.ASIA,",").concat(Ln.EUROPE,",").concat(Ln.AFRICA,",").concat(Ln.NORTH_AMERICA,",").concat(Ln.SOUTH_AMERICA,",").concat(Ln.OCEANIA):Ln[e],xg={GLOBAL:{ASIA:[Ke.CHINA,Ke.JAPAN,Ke.INDIA,Ke.KOREA,Ke.HKMC],EUROPE:[],NORTH_AMERICA:[Ke.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Ug=Object.keys(xg[Ke.GLOBAL]),rI=[Ke.CHINA,Ke.NORTH_AMERICA,Ke.EUROPE,Ke.ASIA,Ke.JAPAN,Ke.INDIA,Ke.OCEANIA,Ke.SOUTH_AMERICA,Ke.AFRICA,Ke.KOREA,Ke.HKMC,Ke.US],hte=function(e,t){let n=[];if(ne(e).call(e,Ke.GLOBAL)){let c=[Ke.GLOBAL,Ke.OVERSEA],d=Object.keys(bg);if(t===Ke.GLOBAL)throw new G(D.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Ke.CHINA)n=[Ke.OVERSEA];else if(o=t,ne(Ug).call(Ug,o)){let l=(r=t,xg[Ke.GLOBAL][r]||[]),h=[...c,t,...l];n=d.filter(f=>!ne(h).call(h,f))}else if(function(l){let h=!1;return Ug.forEach(f=>{var m;ne(m=xg[Ke.GLOBAL][f]).call(m,l)&&(h=!0)}),h}(t)){let l=function(f){let m;return Ug.forEach(E=>{var _;ne(_=xg[Ke.GLOBAL][E]).call(_,f)&&(m=E)}),m}(t),h=[...c,l,t];n=d.filter(f=>!ne(h).call(h,f))}else n=e;n=function(l){let h=[];return rI.forEach(f=>{ne(l).call(l,f)&&h.push(f)}),h.concat(l.filter(f=>!ne(rI).call(rI,f)))}(n)}else n=e;var r,o;return n};function NU(e){var t,n;if(!e&&ne(t=M("AREAS")).call(t,Ke.EXTENSIONS))return T.debug("update area from ap : reset"),void iI(See,!0);if(!ne(n=M("AREAS")).call(n,Ke.GLOBAL)||!e)return;let r=bg.EXTENSIONS;r&&(r={CODE:OU(Ke.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},T.debug("update area from ap success: ".concat(e,",config is "),r),nt("AREAS",[Ke.EXTENSIONS],!0),Object.keys(r).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?nt(o,r[o][0]):nt(o,r[o])}))}function iI(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=he.reportApiInvoke(null,{name:tn.SET_AREA,options:e,tag:kt.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(c=>{if(!ne(Jx).call(Jx,c))throw new G(D.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:c,excludedArea:d}=e;if(!c)throw new G(D.INVALID_PARAMS,"area code is needed");let l=c;typeof c=="string"&&(l=[c]),r=d?hte(l,d):l}if(!t){if(_o.AREAS){let c=new G(D.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(c),void T.warning("setArea is prohibited because of config-distribute")}if(ne(r).call(r,Ke.GLOBAL)&&M("AREAS")===Ke.EXTENSIONS){let c=new G(D.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(c),void T.warning("setArea is prohibited because of ap extensions")}}nt("AREAS",r,t);let o=(c=>{let d={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return c.map(l=>{let h=bg[l],f=Object.keys(h);f&&f.map(m=>{m!=="CODE"&&(d[m]=d[m].concat(h[m]))})}),d})(r);Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?nt(c,o[c][0]):nt(c,o[c])}),T.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function PU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Qo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PU(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let oI=1;function pte(e,t,n,r,o){oI+=1;let c={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:oI,requestId:oI,version:li,cname:n.cname},d={service_name:t,json_body:JSON.stringify(c)},l,h,f=e[0];return Eo(()=>P(this,null,function*(){l=Date.now();let m=yield So(f,{data:d,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(h=Date.now()-l,m.code!==0){let v=new G(D.UNEXPECTED_RESPONSE,"live streaming ap error, code"+m.code,{retry:!0,responseTime:h});throw T.error(v.toString()),v}let E=JSON.parse(m.json_body);if(E.code!==200){let v=new G(D.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:h});throw T.error(v.toString()),v}if(!E.servers||E.servers.length===0){let v=new G(D.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:h});throw T.error(v.toString()),v}let _=function(v,A){return{addressList:v.servers.map(C=>"wss://".concat(C.address.replace(/\./g,"-"),".").concat(M("WORKER_DOMAIN"),":").concat(C.wss,"?serviceName=").concat(encodeURIComponent(A))),workerToken:v.workerToken,vid:v.vid}}(E,t);return M("LIVE_STREAMING_ADDRESS")&&(_.addressList=M("LIVE_STREAMING_ADDRESS")instanceof Array?M("LIVE_STREAMING_ADDRESS"):[M("LIVE_STREAMING_ADDRESS")]),Qo(Qo({},_),{},{responseTime:h})}),(m,E)=>(he.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(m.addressList),firstSuccess:E===0,responseTime:h,serverIp:e[E%e.length]}),!1),(m,E)=>(he.apworkerEvent(n.sid,{success:!1,sc:m.data&&m.data.code||200,serviceName:t,responseTime:h,serverIp:e[E%e.length]}),!!(m.code!==D.OPERATION_ABORTED&&m.code!==D.UNEXPECTED_RESPONSE||m.data&&m.data.retry)&&(f=e[(E+1)%e.length],!0)),o)}let sI=1;function MU(e,t,n,r){let{url:o,areaCode:c}=e,{clientId:d,sid:l}=t,h=Date.now(),f,m=t.role,[E,_]=cI(t,c,[Xt.CHOOSE_SERVER]),v=$t.networkState;return Eo(()=>P(this,null,function*(){v&&$t.networkState===Lr.OFFLINE&&$t.onlineWaiter&&(yield ie.race([$t.onlineWaiter,Sn(r&&r.maxRetryTimeout||nn.maxRetryTimeout)])),v=$t.networkState;let{data:A,headers:C}=yield So(o,{data:E,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f=C.http3==="1"?1:-1,he.reportResourceTiming(o,l),LU(A,o,t,h,[Xt.CHOOSE_SERVER],f);let I=Dh(A,Xt.CHOOSE_SERVER);return aI(I),XC(I,o)}),A=>(A&&he.joinChooseServer(l,{role:m,lts:h,succ:!0,csAddr:o,opid:_,serverList:A.gatewayAddrs.map(C=>C.address),ec:null,cid:A.cid.toString(),uid:A.uid.toString(),csIp:A.csIp,unilbsServerIds:[Xt.CHOOSE_SERVER].toString(),isHttp3:f,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:A.res.detail&&A.res.detail[38]}),!1),A=>A.code!==D.OPERATION_ABORTED&&(A.code===D.CAN_NOT_GET_GATEWAY_SERVER?A.data.retry:(he.joinChooseServer(l,{role:m,lts:h,succ:!1,csAddr:o,serverList:null,opid:_,ec:A.code,csIp:A.data&&A.data.csIp,unilbsServerIds:[Xt.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:v}),isHttp3:f,corssRegionTagReq:t.apRequestDetail}),T.warning("[".concat(d||"sid-".concat(l.slice(0,6)),"] Choose server network error, retry"),A),!0)),r)}function kU(e,t,n,r){let o,{url:c,areaCode:d,serviceIds:l}=e,h=Date.now(),f=t.role,[m,E]=cI(t,d,l),_;return Eo(()=>P(this,null,function*(){_&&$t.networkState===Lr.OFFLINE&&$t.onlineWaiter&&(yield ie.race([$t.onlineWaiter,Sn(r&&r.maxRetryTimeout||nn.maxRetryTimeout)])),_=$t.networkState;let{data:v,headers:A}=yield So(c,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=A.http3==="1"?1:-1,he.reportResourceTiming(c,t.sid),LU(v,c,t,h,l,o);let C=Dh(v,Xt.CHOOSE_SERVER),I=Dh(v,t.cloudProxyServer==="proxy5"?Xt.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Xt.CLOUD_PROXY:Xt.CLOUD_PROXY_FALLBACK);return aI(C),{gatewayInfo:XC(C,c),proxyInfo:I,url:c}}),v=>(v.gatewayInfo&&he.joinChooseServer(t.sid,{role:f,lts:h,succ:!0,csAddr:c,serverList:v.gatewayInfo.gatewayAddrs.map(A=>A.address),ec:null,opid:E,cid:v.gatewayInfo.cid.toString(),uid:v.gatewayInfo.uid.toString(),csIp:v.gatewayInfo.csIp,unilbsServerIds:l.toString(),isHttp3:o,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:v.gatewayInfo.res.detail&&v.gatewayInfo.res.detail[38]}),v.proxyInfo&&he.joinWebProxyAP(t.sid,{lts:h,sucess:1,apServerAddr:c,turnServerAddrList:v.proxyInfo.addresses.map(A=>A.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:l.toString()}),!1),v=>v.code!==D.OPERATION_ABORTED&&(v.code===D.CAN_NOT_GET_GATEWAY_SERVER?v.data.retry:(he.joinWebProxyAP(t.sid,{lts:h,sucess:0,apServerAddr:c,turnServerAddrList:null,errorCode:v.code,eventType:t.cloudProxyServer,unilbsServerIds:l.toString(),extend:JSON.stringify({networkState:_})}),T.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),v),!0)),r)}let LU=(e,t,n,r,o,c)=>{let{sid:d,clientId:l,cloudProxyServer:h}=n,f=[],m=E=>{E.flag===4096?he.joinChooseServer(d,{role:n.role,lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:E.error.message,csIp:E.error.data&&E.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:c,corssRegionTagReq:n.apRequestDetail}):E.flag!==1048576&&E.flag!==4194304&&E.flag!==4194310||he.joinWebProxyAP(d,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:E.error.code,eventType:h,unilbsServerIds:o.toString()})};if(e.response_body.forEach(E=>{let _=E.buffer.code;if(E.uri===23&&_===0&&!E.buffer.edges_services)if(E.buffer.flag===4194310)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),E.buffer.edges_services=[];else{let v={error:new G(D.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:E.buffer.flag};f.push(v),m(v)}if(_!==0){let v=cu(_),A={error:new G(D.CAN_NOT_GET_GATEWAY_SERVER,v.desc,{desc:v.desc,retry:v.retry,csIp:e.detail[502]}),flag:E.buffer.flag};E.buffer.flag===4194310?T.warning(A.error.toString()):f.push(A),m(A)}}),f.length)throw T.warning("[".concat(l||"sid-".concat(d.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(f.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message,", retry: ").concat(E.error.data.retry)).join(" | "))),new G(D.CAN_NOT_GET_GATEWAY_SERVER,f.map(E=>"flag: ".concat(E.flag,", message: ").concat(E.error.message)).join(" | "),{retry:!!f.find(E=>E.error.data.retry),csIp:e.detail[502],desc:[...new Set(f.map(E=>{var _;return E==null||(_=E.error)===null||_===void 0||(_=_.data)===null||_===void 0?void 0:_.desc}).filter(E=>!!E))]})},aI=e=>{var t,n,r,o;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new G(D.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(M("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((o=e.detail)===null||o===void 0?void 0:o[23])=="string"?NU(e.detail[23].toLowerCase()):NU()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){let d=e.detail[19],l=d?.split(";");for(let h=0;h<l.length;h++){var c;let f=Hn(c=l[h]).call(c);e.addresses[h]&&l&&(e.addresses[h].fingerprint=f)}}if(M("GATEWAY_ADDRESS")&&M("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",M("GATEWAY_ADDRESS"));let d=M("GATEWAY_ADDRESS").map(l=>{var h,f;let m=(h=(f=e.addresses.find(E=>E.ip===l.ip&&E.port===l.port))===null||f===void 0?void 0:f.fingerprint)!==null&&h!==void 0?h:"";return{ip:l.ip,port:l.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:m}});e.addresses=d}},fte=(e,t)=>{if(e.response_body&&e.response_body.length){let n=e.response_body[0];if(n.buffer.code!==0){let r=cu(n.buffer.code);throw new G(D.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",t),new G(D.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},cI=(e,t,n)=>{let r=Math.floor(Math.random()*1e12),o=e.role==="host"?"1":e.role==="audience"?"2":void 0,c={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Qo(Qo(Qo({6:e.stringUid,11:t,12:M("USE_NEW_TOKEN")?"1":void 0},o?{17:o}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};c.request_bodies.forEach(l=>{e.multiIP&&e.multiIP.gateway_ip&&(l.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let d=new FormData;return d.append("request",JSON.stringify(c)),[d,r]},mte=(e,t)=>{let n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(c=>({ip:c.ip,port:c.port}))}}]},o=new FormData;return o.append("request",JSON.stringify(r)),[o,n]},pu=0;function fu(e){return ie.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}let Mh=e=>P(this,null,function*(){let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:o,promisesCollector:c}=e,d=0,l=t,h,f=0,m=()=>P(this,null,function*(){let E=(()=>{let _=d*l,v=_+l;return n.slice(_,v).map(r)})();c&&c.push(...E);try{h=yield fu(E)}catch(_){if(f+=l,d++,!(f>=n.length))return void(yield m());o(_)}E.forEach(_=>_.cancel())});return yield m(),h}),xU=e=>P(this,null,function*(){let{referenceList:t,asyncMapHandler:n,closeFn:r}=e,o=t.length,c=0,d=()=>P(this,null,function*(){let l=n(t.shift());try{return yield l}catch(h){if(c++,c>=o||r!=null&&r(h))throw h;return d()}});return d()});function dI(e,t,n,r){return P(this,null,function*(){return{gatewayInfo:yield function(c,d,l,h){return P(this,null,function*(){let f=null,m=[],E=()=>P(this,null,function*(){let v=M("WEBCS_DOMAIN").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(I=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:Ph()})),A=h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:v.map(I=>I.url)}),C=yield Mh({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:I=>(T.debug("[".concat(c.clientId,"] Connect to choose_server:"),I.url),MU(I,c,d,l)),allFailedhandler:I=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},A),I[0]},promisesCollector:m});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},A),C}),_=()=>P(this,null,function*(){if(yield Sn(1e3),f!==null)return f;let v=M("WEBCS_DOMAIN_BACKUP_LIST").map(I=>({url:c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:Ph()})),A=h.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:v.map(I=>I.url)}),C=yield Mh({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:I=>(T.debug("[".concat(c.clientId,"] Connect to backup choose_server:"),I.url),MU(I,c,d,l)),allFailedhandler:I=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},A),I[0]},promisesCollector:m});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},A),C});try{return f=yield fu([E(),_()]),m.length&&m.forEach(v=>v.cancel&&typeof v.cancel=="function"&&v.cancel()),f}catch(v){throw v[0]}})}(e,t,n,r)}})}function UU(e,t,n,r,o){return P(this,null,function*(){let c=e.cloudProxyServer;if(c==="disabled"){if(!r)return;if(e.useLocalAccessPoint)return yield dI(e,t,n,o);if(M("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:_,proxyInfo:v}=yield jU(e,t,n,o);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:_};let A=v.map(C=>({turnServerURL:C.address,tcpport:C.tcpport||Dn.tcpport,udpport:C.udpport||Dn.udpport,username:C.username||Dn.username,password:C.password||Dn.password,forceturn:!1,security:!0}));if(o.useP2P){var d;let C=(d=e.uid)!==null&&d!==void 0?d:_.uid,I="glb:".concat(C.toString()),O=yield rC(I),N=v.map(x=>({turnServerURL:x.address,tcpport:x.tcpport||Dn.tcpport,udpport:x.udpport||Dn.udpport,username:I,password:O,forceturn:!1,security:!0}));A.push(...N)}return e.turnServer={mode:"manual",servers:A},{gatewayInfo:_}}return yield dI(e,t,n,o)}let{proxyInfo:l,gatewayInfo:h}=yield jU(e,t,n,o),f={gatewayInfo:h},m=l.map(_=>({turnServerURL:_.address,tcpport:c==="proxy3"?void 0:_.tcpport?_.tcpport:Dn.tcpport,udpport:c==="proxy4"?void 0:_.udpport?_.udpport:Dn.udpport,username:_.username||Dn.username,password:_.password||Dn.password,forceturn:c!=="proxy4",security:c==="proxy5"}));if(o.useP2P){var E;let _=(E=e.uid)!==null&&E!==void 0?E:h.uid,v="glb:".concat(_.toString()),A=yield rC(v),C=l.map(I=>({turnServerURL:I.address,tcpport:c==="proxy3"?void 0:I.tcpport||Dn.tcpport,udpport:c==="proxy4"?void 0:I.udpport||Dn.udpport,username:v,password:A,forceturn:c!=="proxy4",security:c==="proxy5"}));m.push(...C)}return e.turnServer={mode:"manual",servers:m},T.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(c)),f})}function FU(e,t,n,r,o){return P(this,null,function*(){let c=M("ACCOUNT_REGISTER").slice(0,M("AJAX_REQUEST_CONCURRENT")),d=[];d=t.proxyServer?c.map(h=>"https://".concat(t.proxyServer,"/ap/?url=").concat(h+"/api/v1")):c.map(h=>"https://".concat(h,"/api/v1"));let l=o?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:d});try{let h=yield function(f,m,E,_,v){return P(this,null,function*(){let A=Date.now(),C={sid:E.sid,opid:10,appid:E.appId,string_uid:m},I=f[0],O=yield Eo(()=>So(I+"".concat(I.indexOf("?")===-1?"?":"&","action=stringuid"),{data:C,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(N,x)=>{if(N.code===0){if(N.uid<=0||N.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(m," => ").concat(N.uid),N),he.reqUserAccount(C.sid,{lts:A,success:!1,serverAddr:I,stringUid:C.string_uid,uid:N.uid,errorCode:D.INVALID_UINT_UID_FROM_STRING_UID,extend:C}),new G(D.INVALID_UINT_UID_FROM_STRING_UID);return he.reqUserAccount(C.sid,{lts:A,success:!0,serverAddr:I,stringUid:C.string_uid,uid:N.uid,errorCode:null,extend:C}),!1}let B=cu(N.code);return B.retry&&(I=f[(x+1)%f.length]),he.reqUserAccount(C.sid,{lts:A,success:!1,serverAddr:I,stringUid:C.string_uid,uid:N.uid,errorCode:B.desc,extend:C}),B.retry},(N,x)=>N.code!==D.OPERATION_ABORTED&&(he.reqUserAccount(C.sid,{lts:A,success:!1,serverAddr:I,stringUid:C.string_uid,uid:null,errorCode:N.code,extend:C}),I=f[(x+1)%f.length],!0),v);if(O.code!==0){let N=cu(O.code);throw new G(D.UNEXPECTED_RESPONSE,N.desc)}return O})}(d,e,t,n,r);return o?.recordJoinChannelService({status:"success",endTs:Date.now()},l),h.uid}catch(h){throw o?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[h]},l),h}})}function gte(e,t,n){return P(this,null,function*(){let r=M("ACCOUNT_REGISTER"),o=[];o=t.proxyServer?r.map(c=>"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1")):r.map(c=>"https://".concat(c,"/api/v1"));try{return yield xU({referenceList:o,asyncMapHandler:d=>function(l,h,f,m){return P(this,null,function*(){let E=Date.now(),_={sid:f.sid,opid:10,appid:f.appId,string_uid:h};try{let v=yield So(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(v.code!==0){let A=cu(v.code);throw new G(D.UNEXPECTED_RESPONSE,"preload sua error:".concat(A.desc),A)}if(v.uid<=0||v.uid>=Math.pow(2,32))throw new G(D.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:E,url:l,req:_,uid:v.uid,elapse:Date.now()-E}}catch(v){throw v}})}(d,e,t,n),closeFn:d=>d.code===D.OPERATION_ABORTED||d.code===D.UNEXPECTED_RESPONSE&&!d.data.retry})}catch(c){throw c}})}function Ete(e,t,n){return P(this,null,function*(){let r=M("CDS_AP").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v1"):"https://".concat(h,"/api/v1?action=config")),o=r.map(h=>function(f,m,E,_){let v=Be(),A={flag:64,cipher_method:0,features:Qo(Qo(Qo(Qo(Qo({install_id:fC(),device:v.name,system:v.os,system_general:navigator.userAgent,vendor:m.appId,version:li,cname:m.cname,session_id:m.sid,proxyServer:m.proxyServer,sdk_type:dte.WEB_RTC,browser_name:v.name,browser_version:v.version,user_agent:navigator.userAgent,channel_name:m.cname},m.stringUid&&{string_uid:m.stringUid}),m.uid&&{uid:m.uid+""}),v.os&&{os_name:v.os}),v.osVersion&&{os_version:v.osVersion}),{},{detail:""})};return Eo(()=>So(f,{data:A,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,C=>C.code!==D.OPERATION_ABORTED,_)}(h,e,t,n)),c=null,d=null,l={};try{c=yield fu(o)}catch(h){if(h.code===D.OPERATION_ABORTED)throw h;d=h}if(o.forEach(h=>h.cancel()),he.reportApiInvoke(e.sid,{name:tn.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:c}}).onSuccess(),c&&c.test_tags)try{l=function(h){if(!h.test_tags)return{};let f=h.test_tags,m=Object.keys(f),E={};return m.forEach(_=>{var v;let A=Hn(v=_.slice(4)).call(v),C=JSON.parse(f[_]),I=C[1];E[A]={tag:C[0]||"",value:I}}),E}(c)}catch{}return l})}function VU(e,t){return P(this,null,function*(){let n=M("WEBCS_DOMAIN").concat(M("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:Ph(),serviceIds:[Xt.CHOOSE_SERVER,Xt.CLOUD_PROXY_FALLBACK]}));try{return yield xU({referenceList:n,asyncMapHandler:o=>function(c,d,l){return P(this,null,function*(){let h,{url:f,areaCode:m,serviceIds:E}=c,_=Date.now(),[v,A]=cI(d,m,E),C=$t.networkState;try{C&&$t.networkState===Lr.OFFLINE&&$t.onlineWaiter&&(yield ie.race([$t.onlineWaiter,Sn(nn.maxRetryTimeout)])),C=$t.networkState;let{data:I,headers:O}=yield So(f,{data:v,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=O.http3==="1"?1:-1,(j=>{let F=[];if(j.response_body.forEach(W=>{let X=W.buffer.code;if(W.uri===23&&X===0&&!W.buffer.edges_services)if(W.buffer.flag===4194310)W.buffer.edges_services=[];else{let oe={error:new G(D.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:j.detail[502]}),flag:W.buffer.flag};F.push(oe)}if(X!==0){let oe=cu(X),te={error:new G(D.CAN_NOT_GET_GATEWAY_SERVER,oe.desc,{desc:oe.desc,retry:oe.retry,csIp:j.detail[502]}),flag:W.buffer.flag};W.buffer.flag===4194310?T.warning(te.error.toString()):F.push(te)}}),F.length)throw new G(D.CAN_NOT_GET_GATEWAY_SERVER,F.map(W=>"flag: ".concat(W.flag,", message: ").concat(W.error.message)).join(" | "),{retry:!!F.find(W=>W.error.data.retry),csIp:j.detail[502],desc:[...new Set(F.map(W=>{var X;return W==null||(X=W.error)===null||X===void 0||(X=X.data)===null||X===void 0?void 0:X.desc}).filter(W=>!!W))]})})(I);let x=Dh(I,Xt.CHOOSE_SERVER),B=Dh(I,Xt.CLOUD_PROXY_FALLBACK);return aI(x),{gatewayInfo:XC(x,f),proxyInfo:B,opid:A,requestTime:_,url:f,isHttp3:h,elapse:Date.now()-_}}catch(I){throw I}})}(o,e,t),closeFn:o=>o.code===D.OPERATION_ABORTED||o.code===D.CAN_NOT_GET_GATEWAY_SERVER&&!o.data.retry})}catch(r){throw r}})}function jU(e,t,n,r){return P(this,null,function*(){let o=M("PROXY_SERVER_TYPE3"),c=(v,A,C)=>{let I=C||o;return Array.isArray(I)&&(I=A%2==0?o[1]:o[0]),"https://".concat(I,"/ap/?url=").concat(v)},d=null,l=[],h=()=>P(this,null,function*(){let v=M("WEBCS_DOMAIN").slice(0,M("AJAX_REQUEST_CONCURRENT")).map((I,O)=>{let N;return N=e.cloudProxyServer==="disabled"&&e.proxyServer?c("".concat(I,"/api/v2/transpond/webrtc?v=2"),O,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):c("".concat(I,"/api/v2/transpond/webrtc?v=2"),O),{url:N,areaCode:Ph(),serviceIds:[Xt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Xt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Xt.CLOUD_PROXY:Xt.CLOUD_PROXY_FALLBACK]}}),A=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:v.map(I=>I.url)}),C=yield Mh({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:I=>(T.debug("[".concat(e.clientId,"] Connect to choose_server:"),I.url),kU(I,e,t,n)),allFailedhandler:I=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},A),I[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},A),C}),f=()=>P(this,null,function*(){if(yield Sn(1e3),d!==null)return d;let v=M("WEBCS_DOMAIN_BACKUP_LIST").map((I,O)=>{let N;return N=e.cloudProxyServer==="disabled"&&e.proxyServer?c("".concat(I,"/api/v2/transpond/webrtc?v=2"),O,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(I,"/api/v2/transpond/webrtc?v=2"):c("".concat(I,"/api/v2/transpond/webrtc?v=2"),O),{url:N,areaCode:Ph(),serviceIds:[Xt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Xt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Xt.CLOUD_PROXY:Xt.CLOUD_PROXY_FALLBACK]}}),A=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:v.map(I=>I.url)}),C=yield Mh({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:v,asyncMapHandler:I=>(T.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),I.url),kU(I,e,t,n)),allFailedhandler:I=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},A),I[0]},promisesCollector:l});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},A),C}),m,E,_;try{({gatewayInfo:m,proxyInfo:E,url:_}=yield fu([h(),f()]))}catch(v){throw v[0]}if(l.length&&l.forEach(v=>v.cancel&&typeof v.cancel=="function"&&v.cancel()),!m||!E)throw new G(D.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=_,e.cloudProxyServer!=="disabled"&&Array.isArray(o)&&_){let v=/^https?:\/\/(.+?)(\/.*)?$/.exec(_)[1];ne(o).call(o,v)&&(e.proxyServer=v,T.setProxyServer(v),he.setProxyServer(v))}return d={gatewayInfo:m,proxyInfo:yield uU(E,m.uid)},d})}function _te(e,t,n){return P(this,null,function*(){let r=M("UAP_AP").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(c=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1?action=uap"):"https://".concat(c,"/api/v1?action=uap")),o=r.map(c=>function(d,l,h,f){let m={command:"convergeAllocateEdge",sid:l.sid,appId:l.appId,token:l.token,ts:Date.now(),version:li,cname:l.cname,uid:l.uid.toString(),requestId:sI,seq:sI};sI+=1;let E={service_name:"tele_channel",json_body:JSON.stringify(m)};return Eo(()=>P(this,null,function*(){let _=yield So(d,{data:E,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(_.code!==0){let A=new G(D.UNEXPECTED_RESPONSE,"cross channel ap error, code"+_.code,{retry:!0});throw T.error(A.toString()),A}let v=JSON.parse(_.json_body);if(v.code!==200){let A=new G(D.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(v.code,", reason: ").concat(v.reason));throw T.error(A.toString()),A}if(!v.servers||v.servers.length===0){let A=new G(D.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(A.toString()),A}return{vid:v.vid,workerToken:v.workerToken,addressList:(M("CHANNEL_MEDIA_RELAY_SERVERS")||v.servers).map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(M("WORKER_DOMAIN"),":").concat(A.wss))}}),void 0,_=>!!(_.code!==D.OPERATION_ABORTED&&_.code!==D.UNEXPECTED_RESPONSE||_.data&&_.data.retry),f)}(c,e,t,n));try{let c=yield fu(o);return o.forEach(d=>d.cancel()),c}catch(c){throw c[0]}})}function vte(e,t,n){return P(this,null,function*(){let r=null,o=[],c=d=>P(this,null,function*(){let l=M(d?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(h,"/api/v2/transpond/webrtc?v=2"));return d&&(yield Sn(1e3),r!==null)?r:yield Mh({fragementLength:M("FRAGEMENT_LENGTH"),referenceList:l,asyncMapHandler:h=>(T.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(d?"backup":""," choose_server:"),h),function(f,m,E,_){let[v]=mte(m,[Xt.CHOOSE_SERVER]),A=$t.networkState;return Eo(()=>P(this,null,function*(){A&&$t.networkState===Lr.OFFLINE&&$t.onlineWaiter&&(yield ie.race([$t.onlineWaiter,Sn(_&&_.maxRetryTimeout||nn.maxRetryTimeout)])),A=$t.networkState;let C=yield So(f,{data:v,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return fte(C,f)}),()=>!1,C=>C.code!==D.OPERATION_ABORTED&&(C.code===D.UPDATE_TICKET_FAILED?C.data.retry:(T.warning("[".concat(m.clientId,"] update ticket network error, retry"),C),!0)),_)}(h,e,t,n)),allFailedhandler:h=>{throw h[0]},promisesCollector:o})});try{return r=yield fu([c(!1),c(!0)]),o.length&&o.forEach(d=>d.cancel&&typeof d.cancel=="function"&&d.cancel()),r}catch(d){throw d[0]}})}function BU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function uI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?BU(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):BU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class yte extends Dt{get isSuccess(){return!!this.configs}constructor(t,n){super(),b(this,"configs",void 0),b(this,"store",void 0),b(this,"joinInfo",void 0),b(this,"cancelToken",void 0),b(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),b(this,"interval",void 0),b(this,"mutex",void 0),b(this,"mutableParamsRead",!1),b(this,"configCache",{}),b(this,"limit_bitrate",void 0),this.mutex=new kn("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),M("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},M("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}awaitConfigDistributeComplete(){return P(this,null,function*(){this.mutex.isLocked&&(yield this.mutex.lock())()})}updateConfigDistribute(){return P(this,null,function*(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,he.reportApiInvoke(null,{options:void 0,name:tn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:kt.TRACER}).onSuccess(JSON.stringify(_o))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,n=yield this.mutex.lock();try{t=yield Ete(this.joinInfo,this.cancelToken,this.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(t));let r=function(o){var c;let d=nh(c=Object.keys(o).filter(f=>/^webrtc_ng_global_parameter/.test(f))).call(c);for(let f=0;f<d.length;f++)for(let m=d.length-1;m>f;m--){let E=d[m],_=o[E].value;if(typeof _.__priority=="number"){let v=_.__priority,A=d[m-1],C=o[A].value;if(typeof C.__priority=="number"){if(!(v>C.__priority))continue;{let I=E;d[m]=d[m-1],d[m-1]=I}}else{let I=E;d[m]=d[m-1],d[m-1]=I}}}let l=Date.now(),h={};return d.forEach(f=>{let m=o[f].value.__expires;m&&m<=l||(h[f]=o[f])}),h}(t);this.cacheGlobalParameterConfig(r),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=r}catch(r){let o=new G(D.NETWORK_RESPONSE_ERROR,r);T.warning("[config-distribute] ".concat(o.toString()))}finally{n()}})}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){Qx(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(wh.UPDATE_BITRATE_LIMIT,t):this.emit(wh.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&uI({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{let n={},r=Object.keys(t),o=[];r.forEach(c=>{let d=t[c].value;n[c]=d;let l=d.__id;if(l&&this.configCache[c]&&this.configCache[c].__id===l)return;let h=d.__type,f=t[c].value,m=t[c].tag,E=0;h?h===ML.REALTIME&&(E=1):Object.keys(f).some(_=>Object.prototype.hasOwnProperty.call(_C,_)||!jC()&&Object.prototype.hasOwnProperty.call(ig,_)?(E=1,!0):void 0),o.push({tag:m,isApplied:E,feature:c,params:JSON.stringify(d)})}),o.forEach(c=>{let{tag:d,feature:l,params:h,isApplied:f}=c;this.store.sessionId&&he.abTest(this.store.sessionId,{intSucc:1,isApplied:f,tag:d,feature:l,params:h,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=n}catch(n){T.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){let n=function(o){let c={};return Object.keys(o).forEach(d=>{let l=o[d].value,h=l.__expires,f=l.__type;Object.keys(l).forEach(m=>{m==="__id"||m==="__type"||m==="__priority"||m==="__expires"||Object.prototype.hasOwnProperty.call(c,m)||(c[m]=uI(uI({value:l[m]},h&&{expires:h}),f&&{type:f}))})}),c}(t);try{var r;let o=(r=n.LIMIT_BITRATE)===null||r===void 0?void 0:r.value;delete n.LIMIT_BITRATE,o&&Qx(o)&&this.handleBitrateLimit(o),this.limit_bitrate=o,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),function(l){try{let h=Date.now();Object.keys(l).forEach(f=>{let{value:m,type:E,expires:_}=l[f];_&&_<=h||((E===ML.REALTIME||Object.prototype.hasOwnProperty.call(_C,f))&&(_o[f]=m,Ot[f]=m,T.debug("Update realtime parameters from config distribute",f,m)),E||jC()||!Object.prototype.hasOwnProperty.call(ig,f)||(_o[f]=m,Ot[f]=m,T.debug("Update gateway parameters from config distribute",f,m)))})}catch(h){T.error("Error update config immediately: ".concat(l),h.message)}}(n);let c=JSON.stringify(n),d=window.btoa(c);window.localStorage.setItem("websdk_ng_global_parameter",d),T.debug("Caching global parameters ".concat(c))}catch(o){T.error("Error caching global parameters:",o.message)}}handleGlobalParameterConfig(t){try{let n=Date.now();Object.keys(t).forEach(r=>{if(r==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Ot,r)){let{value:o,expires:c}=t[r];if(c&&c<=n)return;(function(d,l){try{return typeof d=="object"&&typeof l=="object"&&JSON.stringify(d)===JSON.stringify(l)}catch{return!1}})(Ot[r],o)||(_o[r]=o,Ot[r]=o,this.emit(wh.UPDATE_CLIENT_ROLE_OPTIONS,o),T.debug("Updating client role options: ".concat(JSON.stringify(o))))}})}catch(n){T.error("Error handling global parameter config:",n.message)}}}class Tte extends Dt{constructor(){super(...arguments),b(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r))}setRemoteAudioStats(t,n){let r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){let r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(M("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let o=this.resultStorage.get(t);if(o&&(o.result.push(r),o.result.length>=5)){var c;let d=ne(c=o.result).call(c,!0);o.isPrevNormal&&!d&&this.emit("exception",HU[t],t,n),!o.isPrevNormal&&d&&this.emit("exception",HU[t]+2e3,t+"_RECOVER",n),o.isPrevNormal=d,o.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof sn&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=xr(n._encoderConfig.frameRate));let o=t.captureFrameRate;return!r||!o||!(r>10&&o<5||r<10&&r>=5&&o<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof sn&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let HU={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},xn=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){let r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){let n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){let r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function GU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function yc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?GU(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class kh{constructor(t){b(this,"store",void 0),b(this,"onStatsException",void 0),b(this,"onUploadPublishDuration",void 0),b(this,"onStatsChanged",void 0),b(this,"localStats",new Map),b(this,"remoteStats",new Map),b(this,"updateStatsInterval",void 0),b(this,"trafficStats",void 0),b(this,"trafficStatsPeerList",[]),b(this,"uplinkStats",void 0),b(this,"exceptionMonitor",void 0),b(this,"p2pChannel",void 0),b(this,"scalabilityMode",rg.L1T1),b(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new Tte,this.exceptionMonitor.on("exception",(n,r,o)=>{this.onStatsException&&this.onStatsException(n,r,o)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(J.LocalAudioTrack)||yc({},CC)}getLocalVideoTrackStats(){return this.localStats.get(J.LocalVideoTrack)||yc({},IC)}getRemoteAudioTrackStats(t){let n=(c,d)=>{if(!this.trafficStats)return d;let l=this.trafficStats.peer_delay.find(h=>h.peer_uid===c);return l&&(d.publishDuration=l.B_ppad+(Date.now()-this.trafficStats.timestamp)),d},r={};if(t){var o;let c=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.audioStats;c&&(r[t]=n(t,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{audioStats:l}]=c;l&&(r[d]=n(d,l))});return r}getRemoteNetworkQualityStats(t){let n={};if(t){var r;let o=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;o&&(n[t]=o)}else Array.from(this.remoteStats.entries()).forEach(o=>{let[c,{networkStats:d}]=o;d&&(n[c]=d)});return n}getRemoteVideoTrackStats(t){let n=(c,d)=>{if(!this.trafficStats)return d;let l=this.trafficStats.peer_delay.find(h=>h.peer_uid===c);return l&&(d.publishDuration=l.B_ppvd+(Date.now()-this.trafficStats.timestamp)),d},r={};if(t){var o;let c=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.videoStats;c&&(r[t]=n(t,c))}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{videoStats:l}]=c;l&&(r[d]=n(d,l))});return r}getRTCStats(){let t=0,n=0,r=0,o=0,c=this.localStats.get(J.LocalAudioTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate);let d=this.localStats.get(J.LocalVideoTrack);d&&(t+=d.sendBytes,n+=d.sendBitrate);let l=this.localStats.get(J.LocalVideoLowTrack);l&&(t+=l.sendBytes,n+=l.sendBitrate),this.remoteStats.forEach(f=>{let{audioStats:m,videoStats:E}=f;m&&(r+=m.receiveBytes,o+=m.receiveBitrate),E&&(r+=E.receiveBytes,o+=E.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;let o=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),c=o!=null&&o.videoSSRC?xn.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,d=o!=null&&o.audioSSRC?xn.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,c>d?c:d),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;let o=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,c=!r||n.framesDecodeCount>r.framesDecodeCount;return o||!c}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,o]=n;switch(r){case J.LocalVideoTrack:case J.LocalVideoLowTrack:{let d=o,l=yc({},IC),h=t.getStats(),f=t.getLocalMedia(r);if(h){let m=h.videoSend.find(E=>E.ssrc===f?.ssrcs[0].ssrcId);if(m){let E=t.getLocalVideoSize(),_=t.getEncoderConfig(J.LocalVideoTrack);m.codec!=="H264"&&m.codec!=="H265"&&m.codec!=="VP8"&&m.codec!=="VP9"&&m.codec!=="AV1X"&&m.codec!=="AV1"||(l.codecType=m.codec),l.sendBytes=m.bytes,l.sendBitrate=d?8*Math.max(0,l.sendBytes-d.sendBytes):0,m.inputFrame?(l.captureFrameRate=m.inputFrame.frameRate,l.captureResolutionHeight=m.inputFrame.height,l.captureResolutionWidth=m.inputFrame.width):E&&(l.captureResolutionWidth=E.width,l.captureResolutionHeight=E.height),m.sentFrame?(l.sendFrameRate=m.sentFrame.frameRate,l.sendResolutionHeight=m.sentFrame.height,l.sendResolutionWidth=m.sentFrame.width):E&&(l.sendResolutionWidth=E.width,l.sendResolutionHeight=E.height),m.avgEncodeMs&&(l.encodeDelay=m.avgEncodeMs),_&&_.bitrateMax&&(l.targetSendBitrate=1e3*_.bitrateMax),l.sendPackets=m.packets,l.sendPacketsLost=m.packetsLost,l.sendJitterMs=m.jitterMs,l.sendRttMs=m.rttMs,l.totalDuration=d?d.totalDuration+1:1,l.totalFreezeTime=d?d.totalFreezeTime:0,this.isLocalVideoFreeze(m)&&(l.totalFreezeTime+=1),m.scalabilityMode&&this.scalabilityMode!==m.scalabilityMode&&(T.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(m.scalabilityMode)),this.scalabilityMode=m.scalabilityMode)}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var c;this.localStats.set(r,l),(d?.sendResolutionWidth!==l.sendResolutionWidth||d?.sendResolutionHeight!==l.sendResolutionHeight)&&((c=this.onStatsChanged)===null||c===void 0||c.call(this,"resolution",{width:l.sendResolutionWidth,height:l.sendResolutionHeight})),l&&f&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,f.track,l);break}case J.LocalAudioTrack:{let d=o,l=yc({},CC),h=t.getStats(),f=t.getLocalMedia(r);if(h){let m=h.audioSend.find(E=>E.ssrc===f?.ssrcs[0].ssrcId);if(m){if(m.codec!=="opus"&&m.codec!=="aac"&&m.codec!=="PCMU"&&m.codec!=="PCMA"&&m.codec!=="G722"||(l.codecType=m.codec),m.inputLevel)l.sendVolumeLevel=Math.round(32767*m.inputLevel);else{let E=t.getLocalAudioVolume();E&&(l.sendVolumeLevel=Math.round(32767*E))}l.sendBytes=m.bytes,l.sendPackets=m.packets,l.sendPacketsLost=m.packetsLost,l.sendJitterMs=m.jitterMs,l.sendRttMs=m.rttMs,l.sendBitrate=d?8*Math.max(0,l.sendBytes-d.sendBytes):0}}this.trafficStats&&(l.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(J.LocalAudioTrack,l),l&&f&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,f.track,l);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{var r,o;let[c,{videoStats:d,audioStats:l,videoPcStats:h}]=n,f=l,m=d,E=h,_=yc({},HL),v=yc({},GL),A=yc({},ree),{audioTrack:C,videoTrack:I,audioSSRC:O,videoSSRC:N}=t.getRemoteMedia(c),x;x=this.store.useP2P?t.getStats(!0):t.getStats();let B=(r=x)===null||r===void 0?void 0:r.audioRecv.find(X=>X.ssrc===O),j=(o=x)===null||o===void 0?void 0:o.videoRecv.find(X=>X.ssrc===N),F=this.trafficStats&&this.trafficStats.peer_delay.find(X=>X.peer_uid===c);if(B&&(B.codec!=="opus"&&B.codec!=="aac"&&B.codec!=="PCMU"&&B.codec!=="PCMA"&&B.codec!=="G722"||(_.codecType=B.codec),B.outputLevel?_.receiveLevel=Math.round(32767*B.outputLevel):C&&(_.receiveLevel=Math.round(32767*C.getVolumeLevel())),_.receiveBytes=B.bytes,_.receivePackets=B.packets,_.receivePacketsLost=B.packetsLost,_.receivePacketsDiscarded=B.packetsDiscarded,_.packetLossRate=_.receivePacketsLost/(_.receivePackets+_.receivePacketsLost),_.receiveBitrate=f?8*Math.max(0,_.receiveBytes-f.receiveBytes):0,_.totalDuration=f?f.totalDuration+1:1,_.totalFreezeTime=f?f.totalFreezeTime:0,_.freezeRate=_.totalFreezeTime/_.totalDuration,_.receiveDelay=B.jitterBufferMs,_.totalDuration>10&&kh.isRemoteAudioFreeze(C)&&(_.totalFreezeTime+=1)),j){var W;j.codec!=="H264"&&j.codec!=="H265"&&j.codec!=="VP8"&&j.codec!=="VP9"&&j.codec!=="AV1X"&&j.codec!=="AV1"||(v.codecType=j.codec),v.receiveBytes=j.bytes,v.receiveBitrate=m?8*Math.max(0,v.receiveBytes-m.receiveBytes):0,v.decodeFrameRate=j.decodeFrameRate<0?0:j.decodeFrameRate,v.renderFrameRate=j.decodeFrameRate<0?0:j.decodeFrameRate,j.outputFrame&&(v.renderFrameRate=j.outputFrame.frameRate),j.receivedFrame?(v.receiveFrameRate=j.receivedFrame.frameRate,v.receiveResolutionHeight=j.receivedFrame.height,v.receiveResolutionWidth=j.receivedFrame.width):I&&(v.receiveResolutionHeight=I._videoHeight||0,v.receiveResolutionWidth=I._videoWidth||0),j.framesRateFirefox!==void 0&&(v.receiveFrameRate=Math.round(j.framesRateFirefox)),v.receivePackets=j.packets,v.receivePacketsLost=j.packetsLost,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost);let X=m?m.totalFreezeTime:0,oe=m?m.totalDuration:0;v.totalDuration=m?m.totalDuration+1:1,v.totalFreezeTime=(W=j.totalFreezesDuration)!==null&&W!==void 0?W:X||0,v.receiveDelay=j.jitterBufferMs||0;let te=!!N&&t.getRemoteVideoIsReady(N);j.totalFreezesDuration===void 0&&I&&te&&kh.isRemoteVideoFreeze(I,j,E)&&(v.totalFreezeTime+=1),v.freezeRate=Math.max(0,Math.min((v.totalFreezeTime-X)/(v.totalDuration-oe),1))}F&&(_.end2EndDelay=F.B_ad,v.end2EndDelay=F.B_vd,_.transportDelay=F.B_ed,v.transportDelay=F.B_ed,_.currentPacketLossRate=F.B_ealr4/100,v.currentPacketLossRate=F.B_evlr4/100,A.uplinkNetworkQuality=F.B_punq?F.B_punq:0,A.downlinkNetworkQuality=F.B_pdnq?F.B_pdnq:0),this.remoteStats.set(c,{audioStats:_,videoStats:v,videoPcStats:j,networkStats:A}),C&&this.exceptionMonitor.setRemoteAudioStats(C,_),I&&this.exceptionMonitor.setRemoteVideoStats(I,v)})}}class WU{constructor(){b(this,"destChannelMediaInfos",new Map),b(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){Xx(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){Xx(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Ig(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function KU(e){if(!(e instanceof WU))return new G(D.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new G(D.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new G(D.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class ga{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){b(this,"uid",void 0),b(this,"_uintid",void 0),b(this,"_trust_in_room_",!0),b(this,"_trust_audio_enabled_state_",!0),b(this,"_trust_video_enabled_state_",!0),b(this,"_trust_audio_mute_state_",!0),b(this,"_trust_video_mute_state_",!0),b(this,"_audio_muted_",!1),b(this,"_video_muted_",!1),b(this,"_audio_enabled_",!0),b(this,"_video_enabled_",!0),b(this,"_audio_added_",!1),b(this,"_video_added_",!1),b(this,"_is_pre_created",!1),b(this,"_video_pre_subscribed",!1),b(this,"_audio_pre_subscribed",!1),b(this,"_trust_video_stream_added_state_",!0),b(this,"_trust_audio_stream_added_state_",!0),b(this,"_audioTrack",void 0),b(this,"_videoTrack",void 0),b(this,"_dataChannels",[]),b(this,"_audioSSRC",void 0),b(this,"_videoSSRC",void 0),b(this,"_audioOrtc",void 0),b(this,"_videoOrtc",void 0),b(this,"_cname",void 0),b(this,"_rtxSsrcId",void 0),b(this,"_videoMid",void 0),b(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function qU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function zU(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qU(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Lh="9",YU=4e4,Ste=class{get localCapabilities(){return Ut(this._localCapabilities)}get rtpCapabilities(){return Ut(this._rtpCapabilities)}get candidates(){return Ut(this._candidates)}get iceParameters(){return Ut(this._iceParameters)}get dtlsParameters(){return Ut(this._dtlsParameters)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];b(this,"sessionDesc",void 0),b(this,"_localCapabilities",void 0),b(this,"_rtpCapabilities",void 0),b(this,"_candidates",void 0),b(this,"_originCandidates",void 0),b(this,"_iceParameters",void 0),b(this,"_isUseExtmapAllowMixed",void 0),b(this,"_dtlsParameters",void 0),b(this,"setup",void 0),b(this,"currentMidIndex",void 0),b(this,"cname",void 0),b(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=t,e=Ut(e);let{iceParameters:n,dtlsParameters:r,candidates:o,rtpCapabilities:c,setup:d,localCapabilities:l,cname:h}=e;this._rtpCapabilities=c,this._candidates=o,this._originCandidates=Ut(o),this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=l,this.setup=d,this.cname=h,this.sessionDesc=this.updateRemoteRTPCapabilities(c),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){let t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,o=this.rtpCapabilities.send,c=this.sessionDesc.mediaDescriptions.length-1;for(let d=1;d<e;d++){let l=2*d+2e4,h=2*d+YU,{ssrcs:f,ssrcGroups:m}=_c([{ssrcId:l}],this.cname),{ssrcs:E,ssrcGroups:_}=_c([{ssrcId:h,rtx:M("USE_SUB_RTX")?h+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Lh,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.videoCodecs.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:o.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:_,rtcpFeedbackWildcards:[],payloads:o.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++c)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Lh,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.audioCodecs.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:o.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:f,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:o.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++c)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return ua(this.sessionDesc)}send(e,t,n,r){let{ssrcs:o,ssrcGroups:c}=_c(t,this.cname,M("SYNC_GROUP")?n:void 0),d=this.findPreloadMediaDesc(o);if(d){if(xt()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,d.attributes.mid),r&&(r.twcc||r.remb)){let l=this.sessionDesc.mediaDescriptions.indexOf(d);return this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(d,r),{mid:d.attributes.mid,needExchangeSDP:!0}}return{mid:d.attributes.mid,needExchangeSDP:!1}}{let l=this.findAvailableMediaIndex(e,o),h;return l===-1||l===1&&(wn()||function(){let f=Be();return!(f.name!==ze.CHROME||!f.osVersion)&&Number(f.version)<=90}()||M("ENABLE_ENCODED_TRANSFORM")&&Ts())||l===0&&M("USE_SUB_RTX")||rL()?(h=this.createOrRecycleSendMedia(e,o,c,"sendonly",r),this.updateBundleMids()):(h=Ut(this.sessionDesc.mediaDescriptions[l]),h.attributes.direction="sendonly",h.attributes.ssrcs=o,h.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[l]=this.mungSendMediaDesc(h,r)),xt()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,h.attributes.mid),{mid:h.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){let t=e.map(o=>{let{kind:c,ssrcMsg:d,mslabel:l}=o;return this.send(c,d,l)}),n=[],r=!1;return t.forEach(o=>{let{mid:c,needExchangeSDP:d}=o;d&&(r=!0),n.push(c)}),{mids:n,needExchangeSDP:r}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.mid==="0"||xt()||rL()?n.attributes.ssrcs=[]:(n.attributes.ssrcs=[],n.attributes.direction="inactive",n.media.port="0")}),this.updateBundleMids()}mute(e){let t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>ne(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>ne(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}receive(e,t,n,r){e.forEach((o,c)=>{this.createOrRecycleRecvMedia(o,[],"recvonly",t,n,r[c])}),this.updateBundleMids()}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){let t=this.sessionDesc||Ir((n=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(n?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var n;this._rtpCapabilities=e;let r=this.rtpCapabilities.send,o=this.localCapabilities.send;for(let c of t.mediaDescriptions){if(c.attributes.iceUfrag=this._iceParameters.iceUfrag,c.attributes.icePwd=this._iceParameters.icePwd,c.attributes.fingerprints=this._dtlsParameters.fingerprints,c.attributes.candidates=this._candidates,c.attributes.setup=this.setup,c.media.mediaType==="application"&&(c.attributes.sctpPort="5000"),c.media.mediaType==="video"){if(r.videoCodecs.length===0){let d=o.videoCodecs.filter(l=>{var h,f;return(h=l.rtpMap)===null||h===void 0?void 0:ne(f=h.encodingName.toLowerCase()).call(f,"vp8")})||[o.videoCodecs[0]];c.media.fmts=d.map(l=>l.payloadType.toString(10)),c.attributes.payloads=d,c.attributes.extmaps=[]}else if(c.media.fmts=r.videoCodecs.map(d=>d.payloadType.toString(10)),c.attributes.payloads=r.videoCodecs,c.attributes.extmaps=r.videoExtensions,M("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:d,ssrcGroups:l}=_c([{ssrcId:YU,rtx:M("USE_SUB_RTX")?40001:void 0}],this.cname);c.attributes.ssrcs=d,c.attributes.ssrcGroups=l}}if(c.media.mediaType==="audio"){if(r.audioCodecs.length===0){let d=o.audioCodecs.filter(l=>{var h,f;return(h=l.rtpMap)===null||h===void 0?void 0:ne(f=h.encodingName.toLowerCase()).call(f,"opus")})||[o.audioCodecs[0]];c.media.fmts=d.map(l=>l.payloadType.toString(10)),c.attributes.payloads=d,c.attributes.extmaps=[]}else if(c.media.fmts=r.audioCodecs.map(d=>d.payloadType.toString(10)),c.attributes.payloads=r.audioCodecs,c.attributes.extmaps=r.audioExtensions,hu(c),M("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:d,ssrcGroups:l}=_c([{ssrcId:2e4}],this.cname);c.attributes.ssrcs=d,c.attributes.ssrcGroups=l}}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){let t=this._originCandidates.filter(r=>r.transport==="udp"),n=[];if(t.forEach(r=>{n.push(zU(zU({},r),{},{foundation:"tcpcandidate",priority:Number(r.priority)-1+"",transport:"tcp",port:Number(r.port)+90+""}))}),t.length!==0){switch(e){case Vn.TCP_RELAY:this._candidates=n;break;case Vn.UDP_TCP_RELAY:case Vn.RELAY:this._candidates=[...t,...n];break;default:this._candidates=t}for(let r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}}restartICE(e){e=Ut(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{let r=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(xt()){if(r){let o=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!o||o!==n.attributes.mid)}return!1}return r})}createOrRecycleDataChannel(){for(let n of this.sessionDesc.mediaDescriptions)if(n.media.mediaType==="application")return{mediaDesc:n,needExchangeSDP:!1};this.currentMidIndex+=1;let e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:Lh,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,r,o,c){let d=e._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,h=Nh(d,l,this.localCapabilities.send,d===ce.VIDEO?r:o),f=d===ce.VIDEO?l.videoExtensions:l.audioExtensions;this.currentMidIndex+=1;let m="".concat(this.currentMidIndex),E={media:{mediaType:d,port:Lh,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:f,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};E=this.mungRecvMediaDsec(E,e,c);let _=this.findFirstClosedMedia(d);if(_){let v=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[v]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateRemoteCodec(e,t,n){let r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(E=>E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"").filter(E=>{var _;return ne(_=Object.keys(og)).call(_,E)}))],o=new Set(t);if(r.every(E=>o.has(E)))return T.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;let c=this._rtpCapabilities.recv.videoCodecs.filter(E=>t.some(_=>{var v;return ne(v=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"").call(v,_)}));if(c.length===0)return T.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;let d=[...new Set(c.map(E=>E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||""))],l;if(T.debug("updateRemoteCodec, from ".concat(r," to ").concat(d)),e.length===0)l=this.sessionDesc.mediaDescriptions.filter(E=>E.media.mediaType==="video"&&E.attributes.direction==="recvonly");else if(l=this.sessionDesc.mediaDescriptions.filter(E=>E.attributes.mid&&ne(e).call(e,E.attributes.mid)&&E.attributes.direction==="recvonly"),l.length!==e.length)return T.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(M("USE_PUB_RTX")||M("USE_SUB_RTX")){let E=eI(c,this.rtpCapabilities.recv.videoCodecs);c.push(...E)}this._rtpCapabilities.recv.videoCodecs=c;let h=this.localCapabilities.send,f=this.rtpCapabilities.recv,m=Nh(ce.VIDEO,f,h,n);return l.forEach(E=>{let _=m.map(v=>v.payloadType.toString(10));T.debug("updateRemoteCodec mid: ".concat(E.attributes.mid,", from"),E.attributes.payloads,"to",m),E.attributes.payloads=m,E.media.fmts=_}),!0}createOrRecycleSendMedia(e,t,n,r,o){let c=this.rtpCapabilities.send,d=e===ce.VIDEO?c.videoCodecs:c.audioCodecs,l=e===ce.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;let h="".concat(this.currentMidIndex),f={media:{mediaType:e,port:Lh,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(h)}};f=this.mungSendMediaDesc(f,o);let m=this.findFirstClosedMedia(e);if(m){let E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){let r=Ut(e);return QC(r),lu(r,t),ZC(r,t),_U(r),Pg(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let n=Ut(e);return Pg(n,t,this.localCapabilities.recv),hu(n),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){let r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>xt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return(t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e))===null||t===void 0?void 0:t.attributes.ssrcs}};function $U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Ds(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?$U(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$U(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var mu=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(mu||{});let Fg=new Map;function XU(e,t,n,r){let{scale:o}=e;if(o===0&&r===mu.UP||o>=t.length-1&&r===mu.DOWN)return e;let c=Ds(Ds({},e),{},{scale:r===mu.DOWN?++o:--o});switch(n){case"maintain-framerate":c=Ds(Ds({},c),t[o].motion);break;case"maintain-resolution":c=Ds(Ds({},c),t[o].detail);break;case"balanced":c=Ds(Ds({},c),t[o].balanced)}return c}function JU(e,t){if(t){let n={overUse:0,underUse:0,adaptationList:QU(t)};Fg.set(e,n)}else Fg.delete(e)}function QU(e){let t=Ds({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:o,bitrateMin:c}=t,{MIN_FRAME_RATE:d,MAX_THRESHOLD_FRAMERATE:l,MAX_SCALE:h,BITRATE_MIN_THRESHOLD:f,BITRATE_MAX_THRESHOLD:m,BWE_SCALE_UP_THRESHOLD:E,BWE_SCALE_DOWN_THRESHOLD:_,PERF_SCALE_DOWN_THRESHOLD:v,PERF_SCALE_UP_THRESHOLD:A,BALANCE_BITRATE_FACTOR:C,BALANCE_FRAMERATE_FACTOR:I,BALANCE_RESOLUTION_FACTOR:O,MOTION_RESOLUTION_FACTOR:N,MOTION_BITRATE_FACTOR:x,DETAIL_FRAMERATE_FACTOR:B,DETAIL_BITRATE_FACTOR:j}=gC,F=Math.min(t.frameRate,l),W=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(_,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(v,1)*F),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:c},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:c},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:c}}];for(let X=1;X<=h;X++){let oe={bwe_up:Math.round(Math.pow(E,X)*n),bwe_down:Math.round(Math.pow(_,X+1)*n),fps_up:Math.round(Math.pow(A,X)*F),fps_down:Math.round(Math.pow(v,X+1)*F)},te={scaleResolutionDownBy:o/Math.pow(O,X),frameRate:Math.max(Math.round(Math.pow(I,X)*r),d),bitrateMax:Math.max(Math.round(Math.pow(C,X)*n),m),bitrateMin:Math.max(Math.round(Math.pow(C,X)*c),f)},Me={scaleResolutionDownBy:o/Math.pow(N,X),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(x,X)*n),m),bitrateMin:Math.max(Math.round(Math.pow(x,X)*c),f)},ke={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(B,X)*r),d),bitrateMax:Math.max(Math.round(Math.pow(j,X)*n),m),bitrateMin:Math.max(Math.round(Math.pow(j,X)*c),f)};W.push({scale:X,threshold:oe,balanced:te,motion:Me,detail:ke})}return W}function Cte(e,t,n,r,o,c){let d=Fg.get(e)||{overUse:0,underUse:0,adaptationList:QU(o)},{adaptationList:l}=d;Fg.set(e,d);let{OVERUSE_TIMES_THRESHOLD:h,UNDERUSE_TIMES_THRESHOLD:f}=gC,{scale:m}=r,E,_;return typeof t=="number"&&t>0&&function(v,A,C,I){if(A>=C.length)return!1;let{threshold:{fps_down:O}}=C[A];return M("FORCE_AG_HIGH_FRAMERATE")&&I==="maintain-framerate"&&(O=C[0].threshold.fps_down),v<O}(t,m,l,c)&&(d.overUse++,_=yh.CPU,d.overUse>h)||typeof n=="number"&&n>0&&function(v,A,C){if(A>=C.length)return!1;let{threshold:{bwe_down:I}}=C[A];return v<I}(n,m,l)&&(d.overUse++,_=yh.BANDWIDTH,d.overUse>h)?(d.overUse=0,d.underUse=0,E=XU(r,l,c,mu.DOWN),[E,_]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&function(v,A,C,I){if(A===0)return;let{threshold:{fps_up:O}}=C[A];return M("FORCE_AG_HIGH_FRAMERATE")&&I==="maintain-framerate"&&(O=C[1].threshold.fps_up),v>O}(t,m,l,c)&&function(v,A,C){if(A===0)return;let{threshold:{bwe_up:I}}=C[A];return v>I}(n,m,l)&&(d.underUse++,d.underUse>f&&(d.overUse=0,d.underUse=0,E=XU(r,l,c,mu.UP),E.scale===0&&(_=yh.NONE))),[E,_])}function ZU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function lI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ZU(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ZU(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Ite(e){var t;return!!M("ENABLE_AG_ADAPTATION")&&!!(e instanceof MC||ne(t=e._hints).call(t,pt.CUSTOM_TRACK))&&(!!M("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){let r=Be();if(r.os!==ln.IOS||!r.osVersion)return!1;let o=r.osVersion.split(".");return Number(o[0])>=n}(14)&&tL(17,4,!0)||eL(14)&&nL(17,4,!0)))}let Vg=new Map;function jg(e,t){let n=Vg.get(e);if(n){let{timer:r}=n;window.clearTimeout(r),Vg.delete(e)}t.qualityLimitationReason=yh.NONE,JU(e)}function Rte(e,t){var n;let r;switch(t){case J.LocalAudioTrack:r=Xe.Audio;break;case J.LocalVideoTrack:r=ne(n=e._hints).call(n,pt.SCREEN_TRACK)?Xe.Screen:Xe.High;break;case J.LocalVideoLowTrack:r=Xe.Low}return r}function hI(e){let t=He();if(e.some(n=>n._bypassWebAudio))throw new K(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new K(D.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function pI(e,t){hI(e);let n=t||new sn;return e.forEach(r=>n.addAudioTrack(r)),n}let wte=!He().supportUnifiedPlan||M("CHROME_FORCE_PLAN_B")&&Ss();function Bg(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return wte?(n={spec:t,store:e},ma("PlanBConnection").create(n)):new Os(t,e)}function fI(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function eF(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Eh(e.turnServer.servers))return!1;if(M("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var xe;function tF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Co(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tF(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tF(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Os=(xe=class af extends eU{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ne(n=Object.keys(og)).call(n,t)}))]}constructor(t,n){super(t,n),b(this,"id",ht(5,"connection-")),b(this,"store",void 0),b(this,"peerConnection",void 0),b(this,"forceTurn",!1),b(this,"remoteSDP",void 0),b(this,"initialOffer",void 0),b(this,"transportEventReceiver",void 0),b(this,"statsFilter",void 0),b(this,"extension",{useXR:M("USE_XR")}),b(this,"localCapabilities",void 0),b(this,"remoteCodecs",void 0),b(this,"localCandidateCount",0),b(this,"allCandidatesReceived",!1),b(this,"isPreallocation",!1),b(this,"preSSRCMap",new Map),b(this,"dataStreamChannelMap",new Map),b(this,"establishPromise",void 0),b(this,"recoveredDataChannelIds",[]),b(this,"currentDataChannelId",1),b(this,"supportAV1RtpSpec",!1),b(this,"mutex",void 0),b(this,"qualityLimitationReason",yh.NONE),this.store=n,this.forceTurn=eF(t),this.mutex=new kn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(af.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=pC(this.peerConnection,M("STATS_UPDATE_INTERVAL"),void 0,xt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){let n=this.preSSRCMap.get(t);if(n!==void 0){let r=this.peerConnection.getTransceivers().find(o=>o.mid===n);if(r)return{transceiver:r,track:r.receiver.track,id:n}}}updateRemoteRTPCapabilities(t,n){return P(this,null,function*(){if(this.remoteCodecs=n,!this.remoteSDP)return void T.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){let r=yield this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");yield this.peerConnection.setLocalDescription(r);let c=this.remoteSDP.toString();o?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}else T.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")})}establish(){return P(this,null,function*(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let r=yield this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let o=fa(r.sdp),c=yield yU({filterRTX:!M("USE_PUB_RTX")&&!M("USE_SUB_RTX"),filterVideoFec:M("FILTER_VIDEO_FEC"),filterAudioFec:M("FILTER_AUDIO_FEC"),filterVideoCodec:M("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=Mg(c),this.initialOffer=r,M("ENABLE_SVC")&&this.store.codec=="av1"){let l=yield function(){return P(this,null,function*(){try{let h=new RTCPeerConnection;h.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:rg.L1T3}]});let f=yield h.createOffer();if(!f.sdp)return void h.close();let m=Ir(f.sdp).mediaDescriptions[0];if(!m)return;let E=m.attributes.extmaps.find(_=>_.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return h.close(),E}catch{return}})}();var t;l&&(this.supportAV1RtpSpec=!0,(t=c.send)===null||t===void 0||t.videoExtensions.push(l))}let d;return r.sdp&&IU(r.sdp)&&(d=Ut(c),(n=d).send&&(uu(ce.VIDEO,n.send.videoExtensions),uu(ce.AUDIO,n.send.audioExtensions)),n.recv&&(uu(ce.VIDEO,n.recv.videoExtensions),uu(ce.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(uu(ce.VIDEO,n.sendrecv.videoExtensions),uu(ce.AUDIO,n.sendrecv.audioExtensions))),Co(Co({},o),{},{rtpCapabilities:d||c,offerSDP:r.sdp})}catch(r){throw new K(D.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}var n})}connect(t){return P(this,null,function*(){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&IU(this.initialOffer.sdp)&&(n=t.rtpCapabilities,r=this.localCapabilities,n.send&&(Og(ce.VIDEO,n.send.videoExtensions,r.send.videoExtensions),Og(ce.AUDIO,n.send.audioExtensions,r.send.audioExtensions)),n.recv&&(Og(ce.VIDEO,n.recv.videoExtensions,r.recv.videoExtensions),Og(ce.AUDIO,n.recv.audioExtensions,r.recv.audioExtensions))),this.remoteSDP=new Ste(Co(Co({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let o=this.remoteSDP.toString(),c=SU(this.initialOffer.sdp,this.extension),d=this.logSDPExchange(c||"","offer","local","connect");this.store.descriptionStart(),yield this.peerConnection.setLocalDescription({type:"offer",sdp:c}),d?.(o),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:o});let l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),M("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(M("PRELOAD_MEDIA_COUNT"));let f=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"offer",sdp:f});let m=yield this.peerConnection.createAnswer();yield this.peerConnection.setLocalDescription(m)}let{preSSRCs:h}=t;if(Array.isArray(h)&&h.length>0){let{mids:f}=this.remoteSDP.batchSend(h.map(m=>({kind:m.kind,ssrcMsg:[{ssrcId:m.ssrcId,rtx:m.rtx}],mslabel:m.mslabel})));f.forEach((m,E)=>{this.preSSRCMap.set(h[E].ssrcId,m)}),yield kg(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(o){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(o.toString()))}var n,r})}updateRemoteConnect(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let{rtpCapabilities:n}=t;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let{preSSRCs:r}=t;if(Array.isArray(r)&&r.length>0){let{mids:o}=this.remoteSDP.batchSend(r.map(c=>Object.assign({},{kind:c.kind,ssrcMsg:[{ssrcId:c.ssrcId,rtx:c.rtx}],mslabel:c.mslabel})));o.forEach((c,d)=>{this.preSSRCMap.set(r[d].ssrcId,c)})}yield kg(this.peerConnection,this.remoteSDP,this.extension),T.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}})}send(t,n,r){var o=this;return ui(function*(){let c=yield Ue(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let d=[],l=Dg();t.forEach(I=>{let O=o.peerConnection.addTransceiver(I._mediaStreamTrack,Co({direction:"sendonly"},I.trackMediaType==="video"&&o.supportAV1RtpSpec&&l?{sendEncodings:[{scalabilityMode:l}]}:{}));d.push(O),I._updateRtpTransceiver(O)}),xt()&&M("SIMULCAST")===!0&&(yield Ue(o.applySimulcastForFirefox(d,t)));let h=yield Ue(o.peerConnection.createOffer()),f=o.remoteSDP.predictReceivingMids(t.length),m=o.mungSendOfferSDP(h.sdp,t,f),E=Ir(m),_=f.map(I=>{let O=E.mediaDescriptions.find(N=>N.attributes.mid===I);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return mU(O,M("USE_PUB_RTX"))}),v;try{v=yield _}catch(I){v=[],o.remoteSDP.receive(t,n,r,v);let O=o.remoteSDP.toString();throw yield Ue(o.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Ue(o.peerConnection.setRemoteDescription({type:"answer",sdp:O})),yield Ue(o.stopSending(f,!0)),I}o.remoteSDP.receive(t,n,r,v);let A=o.remoteSDP.toString(),C=o.logSDPExchange(m,"offer","local","send");return yield Ue(o.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Ue(o.applySimulcastEncodings(d,t)),yield Ue(o.applySendEncodings(d,t)),C?.(A),yield Ue(o.peerConnection.setRemoteDescription({type:"answer",sdp:A})),d.map((I,O)=>{let N=f[O];return{localSSRC:_[O],id:N,transceiver:I}})}catch(d){throw d instanceof K?d:new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}createDataChannels(t,n){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(t);if(r&&r.readyState==="open")T.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let c=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof c!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:c,negotiated:!0,ordered:!1,maxRetransmits:M("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,r)}n.forEach(c=>{c._updateOriginDataChannel(r)});let{needExchangeSDP:o}=this.remoteSDP.sendDataChannel();if(o){let c=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"offer",sdp:c});let d=yield this.peerConnection.createAnswer();yield this.peerConnection.setLocalDescription(d),T.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else T.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof K?r:new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}})}stopDataChannels(t){return P(this,null,function*(){try{let n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof K?n:new K(D.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}})}stopSending(t,n){return P(this,null,function*(){let r=n?void 0:yield this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let o=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(h=>{var f;jg(this.id+h.mid,this),h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});let c=yield this.peerConnection.createOffer(),d=this.logSDPExchange(c.sdp||"","offer","local","stopSending");yield this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);let l=this.remoteSDP.toString();d?.(l),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{r&&r()}})}receive(t,n,r,o){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:c,needExchangeSDP:d}=this.remoteSDP.send(t,n,r,o);d&&(yield kg(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let l=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:c,transceiver:l}}catch(c){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}})}batchReceive(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);return r&&(yield kg(this.peerConnection,this.remoteSDP,this.extension),T.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(o=>{let c=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:o,transceiver:c}})}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}})}stopReceiving(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(c=>{Array.from(this.preSSRCMap.entries()).some(d=>{let[l,h]=d;if(h===c)return this.preSSRCMap.delete(l),!0})}),this.remoteSDP.stopSending(t);let n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");yield this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let o=yield this.peerConnection.createAnswer();r?.(o.sdp||""),yield this.peerConnection.setLocalDescription(o)}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}})}muteRemote(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");yield this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let o=yield this.peerConnection.createAnswer();r?.(o.sdp||""),yield this.peerConnection.setLocalDescription(o)}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}})}unmuteRemote(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");yield this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let o=yield this.peerConnection.createAnswer();r?.(o.sdp||""),yield this.peerConnection.setLocalDescription(o)}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}})}muteLocal(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});let r=yield this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");yield this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);let c=this.remoteSDP.toString();o?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}})}unmuteLocal(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((d,l)=>P(this,null,function*(){d.direction="sendonly"}));let r=yield this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");yield this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let c=this.remoteSDP.toString();o?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}})}restartICE(t){var n=this;return ui(function*(){let r=yield Ue(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let o=He().supportPCSetConfiguration,c=M("FORCE_TURN_TCP")||n.forceTurn;if(t===Vn.RELAY&&!o)return;if(o&&!c){let E=t===Vn.RELAY?"relay":"all",_=n.peerConnection.getConfiguration();_.iceTransportPolicy!==E&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(E,"]")),_.iceTransportPolicy=E,n.peerConnection.setConfiguration(_))}n.remoteSDP.updateCandidates(t);let d=yield Ue(n.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let l=fa(d.sdp),{remoteIceParameters:h}=yield l.iceParameters;n.remoteSDP.restartICE(h);let f=n.remoteSDP.toString(),m=n.logSDPExchange(d.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Ue(n.peerConnection.setLocalDescription(d)),m?.(f),yield Ue(n.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(o){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{r()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(n=>{jg(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Co(Co({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}updateEncoderConfig(t,n){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=yield this.peerConnection.createOffer(),o=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);let c=this.remoteSDP.toString(),d=this.logSDPExchange(o,"offer","local","updateEncoderConfig");yield this.peerConnection.setLocalDescription({type:"offer",sdp:o}),d?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new K(D.EXCHANGE_SDP_FAILED,r.toString())}})}updateSendParameters(t,n){return P(this,null,function*(){let r=this.peerConnection.getTransceivers().filter(o=>o.mid===t);r.length===1&&(this.isVP8Simulcast(n)?xt()||(yield this.applySimulcastEncodings(r,[n])):yield this.applySendEncodings(r,[n]))})}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}replaceTrack(t,n){return P(this,null,function*(){let r=this.peerConnection.getTransceivers().find(o=>o.mid===n);r&&(yield r.sender.replaceTrack(t._mediaStreamTrack))})}getSelectedCandidatePair(){return P(this,null,function*(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let n=t[0].transport.iceTransport,{local:r,remote:o}=n.getSelectedCandidatePair();return{local:Co(Co({},qo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Co(Co({},qo),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;let r="code: ".concat(t.errorCode,", message: ").concat(t.errorText),o=t.port?"local: ".concat(t.port):"";T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(r,"), url: ").concat(t.url||"",", host_candidate:").concat(o)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,r)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},M("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Eh(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...af.turnServerConfigToIceServers(t.turnServer.servers)),M("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...af.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),M("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),M("ENABLE_ENCODED_TRANSFORM")&&He().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){let n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(du(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!M("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(t){let n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};let r=n.iceTransport;r&&(r.onstatechange=()=>{let o=n?.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:o,remote:c}=r.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(t,n){return P(this,null,function*(){var r,o;if(n||(n=this.peerConnection.getSenders().find(I=>I.track===t._mediaStreamTrack)),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!He().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let c={},d={};switch(t._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;case"balanced":c.degradationPreference="balanced"}let l=function(C,I){return C.getTransceivers().find(O=>O.sender.track===I||O.receiver.track===I)}(this.peerConnection,t._mediaStreamTrack),h=cee(t);if(Ite(t)&&l&&n&&h&&this.getLocalVideoStats&&ne(r=["vp8","vp9"]).call(r,this.store.codec)){var f;let C=c.degradationPreference||(ne(f=t._hints).call(f,pt.CUSTOM_TRACK)?M("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(I,O,N,x,B,j){if(jg(I,N),B(O),x!=="balanced"&&x!=="maintain-framerate"&&x!=="maintain-resolution")return;let F=-1;JU(I,O);let W=window.setInterval(()=>{let oe=Vg.get(I);if(!M("ENABLE_AG_ADAPTATION")||!oe)return jg(I,N),void B(O);let te=j();if(te.sendPackets>0&&te.OutgoingAvailableBandwidth>0){if(F===-1)return void(F=Date.now());if(Date.now()-F<1e3)return;let Me=te.sendFrameRate,ke=te.OutgoingAvailableBandwidth,[ft,Wt]=Cte(I,Me,ke,oe.adaptationConfig,O,x);Wt&&(N.qualityLimitationReason=Wt),ft&&oe.adaptationConfig.scale!==ft.scale&&(T.debug("[".concat(I,"] applyAdaptation: ").concat(N.qualityLimitationReason,`
           sendFps `).concat(Me,", bwe ").concat(ke,", switch from ").concat(oe.adaptationConfig.scale," to ").concat(ft.scale," ")),oe.adaptationConfig=lI(lI({},oe.adaptationConfig),ft),B(ft))}},M("CHECK_LOCAL_STATS_INTERVAL")),X=lI({},O);Vg.set(I,{timer:W,adaptationConfig:X,originConfig:O,adaptationFunc:B}),T.debug("[".concat(I,"] start adaptation, originConfig: ").concat(JSON.stringify(O),", degradationPreference: ").concat(x))})(this.id+l.mid,h,this,C,I=>{n&&this.updateAdaptation(n,I)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var m;let{bitrateMax:C,frameRate:I,scaleResolutionDownBy:O}=t._encoderConfig;C&&(d.maxBitrate=1e3*C),(ne(m=t._hints).call(m,pt.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(I&&(d.maxFramerate=xr(I)),O&&O>=1&&(d.scaleResolutionDownBy=O))}let{maxFramerate:E}=M("ENCODER_CONFIG_LIMIT");if(E&&typeof E=="number"&&(d.maxFramerate=d.maxFramerate?Math.min(d.maxFramerate,E):E),M("DSCP_TYPE")&&Ss()){var _;let C=M("DSCP_TYPE");ne(_=["very-low","low","medium","high"]).call(_,C)&&(d.networkPriority=C)}let v=n.getParameters(),A=(o=v.encodings)===null||o===void 0?void 0:o[0];xt()&&!A&&(c.encodings=[d]),A&&Object.assign(A,d),Object.assign(v,c),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(v.encodings))),yield n.setParameters(v),yield function(C,I,O){return P(this,null,function*(){try{var N;if(!He().supportSetRtpSenderParameters||!function(W){return W==="vp9"||W==="av1"}(C)||!M("ENABLE_SVC"))return;let x={},B={},j=I.getParameters(),F=(N=j.encodings)===null||N===void 0?void 0:N[0];B.scalabilityMode=Dg(O),F&&Object.assign(F,B),Object.assign(j,x),yield I.setParameters(j),T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(j.encodings)))}catch(x){T.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",x)}})}(this.store.codec,n,M("SVC_MODE"))})}updateAdaptation(t,n){return P(this,null,function*(){var r,o;if(!t)return T.debug("[updateAdaptation] no rtpSender found");if(!He().supportSetRtpSenderParameters)return T.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let c={},{bitrateMax:d,frameRate:l,scaleResolutionDownBy:h}=n;d&&(c.maxBitrate=1e3*d),l&&(c.maxFramerate=xr(l)),h&&h>=1&&ne(r=["vp8","vp9"]).call(r,this.store.codec)&&(c.scaleResolutionDownBy=h);let f=t.getParameters(),m=(o=f.encodings)===null||o===void 0?void 0:o[0];m&&Object.assign(m,c),Object.assign(f,{});try{yield t.setParameters(f),T.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(f.encodings)))}catch(E){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?T.debug("[updateAdaptation] peerConnection not connected}"):T.debug("[updateAdaptation] updateRtpSenderEncodings failed",E):T.debug("[updateAdaptation] rtpSender transport not connected}")}})}applySendEncodings(t,n){return P(this,null,function*(){try{if(!He().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){let o=t[r],c=n[r];c instanceof vt&&!this.isVP8Simulcast(c)&&(yield this.updateRtpSenderEncodings(c,o.sender))}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}})}mungSendOfferSDP(t,n,r){let o=Ir(t);return n.forEach((c,d)=>{let l=r[d],h=o.mediaDescriptions.find(f=>f.attributes.mid===l);h&&(lu(h,c),vU(h,c,this.store.codec))}),ua(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(t,n){return P(this,null,function*(){if(t.length===n.length)for(let h=0;h<t.length;h++){var r,o,c,d,l;let f=t[h],m=n[h];if(m instanceof vt&&!ne(r=m._hints).call(r,pt.LOW_STREAM)&&(o=m._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=m._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=m._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((l=m._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){let E={},_={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];let v=f.sender.getParameters();yield f.sender.setParameters(Object.assign(v,E))}}})}applySimulcastEncodings(t,n){return P(this,null,function*(){if(!xt()&&t.length===n.length)for(let r=0;r<t.length;r++){let o=n[r];if(o instanceof vt&&this.isVP8Simulcast(o)){let c=t[r],d={},l={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];let h=c.sender.getParameters();yield c.sender.setParameters(Object.assign(h,d))}}})}isVP8Simulcast(t){var n,r,o,c,d;return!!(t instanceof vt&&M("SIMULCAST")&&this.store.codec==="vp8"&&!ne(n=t._hints).call(n,pt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,r,o){if(M("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",r==="local"?"remote":"local",o)}:void 0}getRemoteSSRC(t){return P(this,null,function*(){if(!this.remoteSDP)return;let n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0})}setConfiguration(t){if(He().supportPCSetConfiguration){let n=af.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},ue(xe.prototype,"updateRemoteRTPCapabilities",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"updateRemoteRTPCapabilities"),xe.prototype),ue(xe.prototype,"connect",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"connect"),xe.prototype),ue(xe.prototype,"updateRemoteConnect",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"updateRemoteConnect"),xe.prototype),ue(xe.prototype,"createDataChannels",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"createDataChannels"),xe.prototype),ue(xe.prototype,"receive",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"receive"),xe.prototype),ue(xe.prototype,"batchReceive",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"batchReceive"),xe.prototype),ue(xe.prototype,"stopReceiving",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"stopReceiving"),xe.prototype),ue(xe.prototype,"muteRemote",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"muteRemote"),xe.prototype),ue(xe.prototype,"unmuteRemote",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"unmuteRemote"),xe.prototype),ue(xe.prototype,"muteLocal",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"muteLocal"),xe.prototype),ue(xe.prototype,"unmuteLocal",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"unmuteLocal"),xe.prototype),ue(xe.prototype,"close",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"close"),xe.prototype),ue(xe.prototype,"updateEncoderConfig",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"updateEncoderConfig"),xe.prototype),ue(xe.prototype,"updateSendParameters",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"updateSendParameters"),xe.prototype),ue(xe.prototype,"replaceTrack",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"replaceTrack"),xe.prototype),ue(xe.prototype,"updateAdaptation",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"updateAdaptation"),xe.prototype),ue(xe.prototype,"getRemoteSSRC",[mr],Object.getOwnPropertyDescriptor(xe.prototype,"getRemoteSSRC"),xe.prototype),xe);function mr(e,t,n){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=function(){return P(this,arguments,function*(){let o=this.mutex,c=yield o.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,l=new Array(d),h=0;h<d;h++)l[h]=arguments[h];return yield r.apply(this,l)}finally{c()}})},n}function mI(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=xr(t.width),r.height=xr(t.height);let o=xr(t.framerate||15);document.body.append(n),document.body.append(r);let c=e._mediaStreamTrack;n.srcObject=new MediaStream([c]),n.play();let d=r.getContext("2d");if(!d)throw new G(D.UNEXPECTED_ERROR,"can not get canvas context");let l=He(),h=r.captureStream(l.supportRequestFrame?0:o).getVideoTracks()[0];h.canvas||(h.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){let m=n.videoWidth,E=n.videoHeight/m,_=r.width*E;Math.abs(_-r.height)>=2&&(T.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(_)),r.height=_)}d.drawImage(n,0,0,r.width,r.height),h.requestFrame&&h.requestFrame(),c!==e._mediaStreamTrack&&(c=e._mediaStreamTrack,n.srcObject=new MediaStream([c]))},r.stopCapture=bC(()=>r.startCapture&&r.startCapture(),o);let f=h.stop;return h.stop=()=>{f.call(h),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),T.debug("clean low stream renderer")},h}var Hg=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(Hg||{}),Jt=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(Jt||{}),Tc=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(Tc||{}),Qt=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(Qt||{}),Sc=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(Sc||{}),nF=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(nF||{}),Zo=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(Zo||{}),wr=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e}(wr||{}),rF=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(rF||{}),gr=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(gr||{}),Gg=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(Gg||{});let Wg=1e3,bte=Math.max(6,3);function _e(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function iF(e){let t={[gr.CONN_TYPE]:0,[gr.RTT]:e.rtt,[gr.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[gr.CONN_TYPE]=1),n==="tcp"&&(t[gr.CONN_TYPE]=3),n==="tls"&&(t[gr.CONN_TYPE]=4);break}case"srflx":t[gr.CONN_TYPE]=2;break;case"unknown":t[gr.CONN_TYPE]=5;break;default:t[gr.CONN_TYPE]=0}return t}function oF(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class sF extends Dt{constructor(t){super(),b(this,"store",void 0),b(this,"uploadWRTCStatsTimer",void 0),b(this,"uploadOutboundDenoiserStatsTimer",void 0),b(this,"uploadExtStatsTimer",void 0),b(this,"uploadExtUsageStatsTimer",void 0),b(this,"uploadInboundExtStatsTimer",void 0),b(this,"requestStats",void 0),b(this,"requestTransportStats",void 0),b(this,"requestLocalMedia",void 0),b(this,"requestRemoteMedia",void 0),b(this,"requestAllTracks",void 0),b(this,"requestVideoIsReady",void 0),b(this,"requestUploadStats",void 0),b(this,"requestUpload",void 0),b(this,"uploadOutboundStarted",!1),b(this,"uploadInboundStarted",!1),b(this,"uploadTransportStarted",!1),b(this,"uploadBaseStatsStarted",!1),b(this,"uploadExtensionUsageStarted",!1),b(this,"lastRecvStats",void 0),b(this,"lastSendStats",void 0),b(this,"lastRefRecvStats",void 0),b(this,"lastRefSendStats",void 0),b(this,"lastFullRecvStats",void 0),b(this,"lastFullSendStats",void 0),b(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let n=t%3==0,r=t%6==0,o,c;if(this.uploadTransportStarted&&(o=this.requestStats(),this.store.useP2P&&(c=this.requestStats(!0))),!o&&this.uploadOutboundStarted&&(o=this.requestStats()),!c&&this.uploadInboundStarted&&(c=this.requestStats(!0)),o||c){var d;let l={};if(this.uploadTransportStarted&&o){let f=this.getTransportStats(o,c,n);f&&(l.misc=[f])}if(this.uploadOutboundStarted&&o){let f=this.getOutboundStats(o,r?this.lastFullSendStats:n?this.lastRefSendStats:this.lastSendStats,n,r);f&&(l.outbound=[f])}if(this.uploadInboundStarted&&c){let f=this.getInboundStats(c,r?this.lastFullRecvStats:n?this.lastRefRecvStats:this.lastRecvStats,n,r);f&&(l.inbound=f)}let h=(d=this.requestTransportStats)===null||d===void 0?void 0:d.call(this).connectState;h&&(Array.isArray(l.misc)?l.misc[0]&&l.misc[0].addition&&(l.misc[0].addition[Gg.RTC_PEER_CONNECTION_STATE]=hC[h]):l.misc=[{addition:{[Gg.RTC_PEER_CONNECTION_STATE]:hC[h]}}]),this.requestUploadStats(l)}this.lastRecvStats=c,this.lastSendStats=o,r&&(this.lastFullRecvStats=c,this.lastFullSendStats=o),n&&(this.lastRefRecvStats=c,this.lastRefSendStats=o)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,r;let o=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(o&&((r=this.requestUploadStats)===null||r===void 0||r.call(this,{misc:[{addition:{[Gg.RTC_PEER_CONNECTION_STATE]:hC[o.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===bte+1&&(t=1)},Wg)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,n,r){if(!this.requestStats)return;if(!r)return t.rtt==null?void 0:{addition:{[gr.RTT]:t.rtt,[gr.CONN_TYPE]:void 0,[gr.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};let o=iF(t);if(this.store.useP2P){if(n){let c=iF(n);o[gr.CONN_TYPE]+=c[gr.CONN_TYPE]<<3}o[gr.CONN_TYPE]+=110}else o[gr.CONN_TYPE]+=100;return{addition:o}}getOutboundStats(t,n,r,o){if(!this.requestUploadStats||!this.requestLocalMedia)return;let c=this.requestLocalMedia();if(!c||c.length===0)return;let d,l,h;return c.forEach(f=>{let[m,{track:E,ssrcs:_}]=f;switch(m){case J.LocalVideoLowTrack:case J.LocalVideoTrack:if(m===J.LocalVideoTrack){let v=function(I,O,N,x,B,j){let F=O.videoSend.find(te=>te.ssrc===I);if(!F)return;let W={},{sentFrame:X,inputFrame:oe}=F;if(j&&(_e(W,Jt.QP_SUM,F.qpSumPerFrame),oe&&X)){let te=oe.frameRate,Me=X.frameRate;W[Jt.FREEZE]=function(ke,ft){let Wt=!0;return Wt=!(ke<=5)&&(ke<=10?ft<3:ke<=20?ft<4:ft<5),Wt}(te,Me)?1:0}if(B){switch(X&&(_e(W,Jt.HEIGHT,X.height),_e(W,Jt.WIDTH,X.width),_e(W,Jt.FRAME_RATE,X.frameRate)),W[Jt.DISABLED]=x._originMediaStreamTrack&&!x._originMediaStreamTrack.enabled||x._mediaStreamTrack&&!x._mediaStreamTrack.enabled?1:0,F.adaptionChangeReason){case"none":W[Jt.ADAPTATION]=0;break;case"cpu":W[Jt.ADAPTATION]=1;break;case"bandwidth":W[Jt.ADAPTATION]=2;break;case"other":W[Jt.ADAPTATION]=3}let te=0;F.adaptionChangeReason&&(te+=oF(F.adaptionChangeReason)),O.qualityLimitationReason&&(te+=oF(O.qualityLimitationReason)<<3),W[Jt.ADAPTATION]=te,W[Jt.PLAYER_STATUS]=RC[x._player?x._player.videoElementStatus:"uninit"],_e(W,Jt.NACKS,F.nacksCount),_e(W,Jt.PLIS,F.plisCount),_e(W,Jt.FIRS,F.firsCount),_e(W,Jt.AVG_ENCODE,F.avgEncodeMs),_e(W,Jt.HUGE_FRAME_SENT,F.hugeFramesSent),_e(W,Jt.BYTES_RETRANSMIT,F.retransmittedBytesSent),_e(W,Jt.PACKAGES_RETRANSMIT,F.retransmittedPacketsSent),_e(W,Jt.KEY_FRAMES_ENCODED,F.keyFramesEncoded);let Me=N&&N.videoSend.find(ke=>ke.ssrc===I);if(Me){let ke=B?Wg:6e3;Me.timestamp&&F.timestamp&&(ke=F.timestamp-Me.timestamp),Me.packets!=null&&F.packets!=null&&_e(W,Jt.PACKAGE_RATE,1e3*(F.packets-Me.packets)/ke),F.packetsLost!=null&&Me.packetsLost!=null&&_e(W,Jt.PACKAGE_LOST,F.packetsLost-Me.packetsLost),Me.bytes!=null&&F.bytes!=null&&_e(W,Jt.BITRATE,8*(F.bytes-Me.bytes)/ke)}}return W}(_[0].ssrcId,t,n,E,r,o),A=E&&function(I,O,N,x){let B=O.videoSend.find(F=>F.ssrc===I);if(!B)return null;let j={};if(x){let F=B.inputFrame,W=F&&F.height||N.videoHeight||0,X=F&&F.width||N.videoWidth||0,oe=F&&F.frameRate||0;_e(j,Hg.HEIGHT,W),_e(j,Hg.WIDTH,X),_e(j,Hg.FRAME_RATE,oe)}return j}(_[0].ssrcId,t,E,r),C=function(I,O){let N={};return O&&(_e(N,Jt.RETRANSMIT,I.bitrate.retransmit),_e(N,Jt.TARGET_ENCODED,I.bitrate.targetEncoded),_e(N,Jt.ACTUAL_ENCODED,I.bitrate.actualEncoded),_e(N,Jt.TRANSMIT,I.bitrate.transmit),_e(N,Jt.BANDWIDTH,I.sendBandwidth)),N}(t,r);l=Object.assign({},v,A,C)}else h=function(v,A,C,I){let O=A.videoSend.find(x=>x.ssrc===v);if(!O)return;let N={};if(I){let x=O.sentFrame;if(x&&(_e(N,Tc.HEIGHT,x.height),_e(N,Tc.WIDTH,x.width),_e(N,Tc.FRAME_RATE,x.frameRate)),C){let B=C.videoSend.find(j=>j.ssrc===v);if(B){let j=6e3;B.timestamp&&O.timestamp&&(j=O.timestamp-B.timestamp),B.packets!=null&&O.packets!=null&&_e(N,Tc.PACKAGE_RATE,1e3*(O.packets-B.packets)/j),O.packetsLost!=null&&B.packetsLost!=null&&_e(N,Tc.PACKAGE_LOST,O.packetsLost-B.packetsLost),B.bytes!=null&&O.bytes!=null&&_e(N,Tc.BITRATE,8*(O.bytes-B.bytes)/j)}}}return N}(_[0].ssrcId,t,n,r);break;case J.LocalAudioTrack:d=E&&function(v,A,C,I,O){let N=A.audioSend.find(B=>B.ssrc===v);if(!N)return;let x={};if(O){x[Zo.DISABLED]=I._originMediaStreamTrack&&!I._originMediaStreamTrack.enabled||I._mediaStreamTrack&&!I._mediaStreamTrack.enabled?1:0;let B=100*I._source.getAccurateVolumeLevel(),j=N.inputLevel;if(j!=null){let W=Math.ceil(50*Math.log10(100*j+1));_e(x,Zo.LEVEL,W)}_e(x,nF.PCM_LEVEL,B),_e(x,Zo.AEC_RETURN_LOSS,N.aecReturnLoss),_e(x,Zo.AEC_RETURN_LOSS_ENH,N.aecReturnLossEnhancement),_e(x,Zo.BYTES_RETRANSMIT,N.retransmittedBytesSent),_e(x,Zo.PACKAGES_RETRANSMIT,N.retransmittedPacketsSent),x[Zo.FREEZE]=0;let F=C&&C.audioSend.find(W=>W.ssrc===v);if(F){let W=6e3;F.timestamp&&N.timestamp&&(W=N.timestamp-F.timestamp),F.bytes!=null&&N.bytes!=null&&_e(x,Zo.BITRATE,8*(N.bytes-F.bytes)/W),F.packets!=null&&N.packets!=null&&_e(x,Zo.PACKAGE_RATE,1e3*(N.packets-F.packets)/W)}}return x}(_[0].ssrcId,t,n,E,r)}}),{high:l,low:h,audio:d}}getInboundStats(t,n,r,o){if(!this.requestRemoteMedia)return;let c=this.requestRemoteMedia()||[],d=[];return c.forEach(l=>{let[h,f]=l,m={peer:h.uid};if(f.has(ce.VIDEO)&&h.videoTrack){let E=h._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(h._videoSSRC)||!1,_=h.videoTrack?function(v,A,C,I,O,N,x,B){let j=A.videoRecv.find(ke=>ke.ssrc===v);if(!j)return;let F={},{receivedFrame:W,outputFrame:X,decodeFrameRate:oe}=j,te=C&&C.videoRecv.find(ke=>ke.ssrc===v);if(_e(F,Sc.FRAME_RATE_DECODE,oe),j.framesRateFirefox&&_e(F,Qt.FRAME_RATE,j.framesRateFirefox),W&&_e(F,Qt.FRAME_RATE,W.frameRate),_e(F,Qt.FRAMES_DROPPED,j.framesDroppedCount),_e(F,Qt.BYTES_RETRANSMIT,j.retransmittedBytesReceived),_e(F,Qt.PACKAGES_RETRANSMIT,j.retransmittedPacketsReceived),_e(F,Qt.PACKAGES_DISCARDED,j.packetsDiscarded),_e(F,Qt.AVG_DECODE,j.avgDecodeMs),_e(F,Qt.AVG_PROCESSING_DELAY,j.avgProcessingDelayMs),_e(F,Qt.AVG_ASSEMBLY_TIME,j.avgFramesAssembledFromMultiplePacketsMs),_e(F,Qt.AVG_INTER_FRAME_DELAY,j.avgInterFrameDelayMs),_e(F,Qt.KEY_FRAMES_DECODED,j.keyFramesDecoded),te){let ke=A.timestamp-C.timestamp||Wg*(B?6:x?3:1);j.packetsLost!=null&&te.packetsLost!=null&&_e(F,Qt.PACKAGE_LOST,j.packetsLost-te.packetsLost),te.bytes!=null&&j.bytes!=null&&_e(F,Qt.BITRATE,8*(j.bytes-te.bytes)/ke),te.packets!=null&&j.packets!=null&&_e(F,Qt.PACKAGE_RATE,1e3*(j.packets-te.packets)/ke)}if(B&&(_e(F,Qt.QP_SUM,j.qpSumPerFrame),F[Qt.FREEZE]=O&&kh.isRemoteVideoFreeze(I,j,te)?1:0),x){var Me;W?(_e(F,Qt.HEIGHT,W.height),_e(F,Qt.WIDTH,W.width)):I&&(_e(F,Qt.HEIGHT,I._videoHeight||0),_e(F,Qt.WIDTH,I._videoWidth||0)),X&&_e(F,Sc.FRAME_RATE_OUTPUT,X.frameRate);let ke=(Me=I._player)===null||Me===void 0?void 0:Me.rendFrameRate.toFixed(0);if(ke&&_e(F,Sc.FRAME_RATE_RENDER,+ke),_e(F,Qt.JITTER_BUFFER,j.jitterBufferMs),_e(F,Qt.CURRENT_DELAY,j.currentDelayMs),_e(F,Qt.FIRS,j.firsCount),_e(F,Qt.NACKS,j.nacksCount),_e(F,Qt.PLIS,j.plisCount),I){F[Qt.DISABLED]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1;let ft=I._player;if(ft){let{freezeTimeCounterList:Wt,renderFreezeAccTime:Vt,videoElementStatus:_r}=ft;if(Wt&&Wt.length>0&&_e(F,Sc.FREEZE_TIME,Wt.splice(0,1)[0]),N&&Rs.visibility==="visible"&&_r===Gn.PLAYING&&He().supportRequestVideoFrameCallback){let z=Math.min(6e3,Vt);ft.renderFreezeAccTime=Math.max(0,Vt-z),_e(F,Sc.FREEZE_TIME_RENDER,z)}if(typeof j.totalFreezesDuration=="number"){let z=te&&te.totalFreezesDuration?j.totalFreezesDuration-te.totalFreezesDuration:j.totalFreezesDuration;_e(F,Sc.FREEZE_DURATION,1e3*z)}}}if(F[Qt.PLAYER_STATUS]=RC[I._player?I._player.videoElementStatus:"uninit"],te&&j.totalInterFrameDelay!==void 0&&j.totalSquaredInterFrameDelay!==void 0&&te.totalInterFrameDelay!==void 0&&te.totalSquaredInterFrameDelay!==void 0){let ft=j.totalInterFrameDelay-te.totalInterFrameDelay,Wt=j.totalSquaredInterFrameDelay-te.totalSquaredInterFrameDelay,Vt=j.framesDecodeCount-te.framesDecodeCount,_r=ft/Vt*1e3,z=Math.round(1e3*Math.sqrt((Wt-Math.pow(ft,2)/Vt)/Vt));!isNaN(z)&&_r+z>Math.max(3*_r,_r+150)&&(F[Qt.I_FRAME_DELAY]=z)}}return F}(h._videoSSRC,t,n,h.videoTrack,E===!0,this.needUploadRenderFreezeTime,r,o):void 0;_&&(m.video=_)}if(f.has(ce.AUDIO)&&h.audioTrack){let E=h.audioTrack?function(_,v,A,C,I,O){let N=v.audioRecv.find(F=>F.ssrc===_);if(!N)return;let x={},B=A&&A.audioRecv.find(F=>F.ssrc===_);if(_e(x,wr.JITTER,N.jitterMs),_e(x,wr.BYTES_RETRANSMIT,N.retransmittedBytesReceived),_e(x,wr.PACKAGES_RETRANSMIT,N.retransmittedPacketsReceived),_e(x,wr.PACKAGES_DISCARDED,N.packetsDiscarded),_e(x,wr.AVG_PROCESSING_DELAY,N.avgProcessingDelayMs),B){let F=v.timestamp-A.timestamp||Wg*(O?6:I?3:1);N.packets!=null&&B.packets!=null&&_e(x,wr.PACKAGE_RATE,1e3*(N.packets-B.packets)/F),I&&B.bytes!=null&&N.bytes!=null&&_e(x,wr.BITRATE,8*(N.bytes-B.bytes)/F),N.packetsLost!=null&&B.packetsLost!=null&&_e(x,wr.PACKAGE_LOST,N.packetsLost-B.packetsLost)}if(O){let{receivedFrames:F,droppedFrames:W}=N;F!=null&&W!=null&&(x[wr.FREEZE]=(j=F)===0||100*W/j>20?1:0)}var j;if(I){let F=100*C._source.getAccurateVolumeLevel(),W=N.outputLevel;if(W!=null){let X=Math.ceil(50*Math.log10(100*W+1));_e(x,rF.LEVEL,X)}if(_e(x,wr.PCM_LEVEL,F),C&&(x[wr.DISABLED]=C._originMediaStreamTrack.enabled&&C._mediaStreamTrack.enabled?0:1),_e(x,wr.JITTER_BUFFER,N.jitterBufferMs),_e(x,wr.CURRENT_DELAY,N.jitterBufferMs),x[wr.PLAYER_STATUS]=RC[fr.getPlayerState(C.getTrackId())],B){let X=N.concealedSamples-B.concealedSamples;X>0&&_e(x,wr.CONCEALED_SAMPLES,X)}}return x}(h._audioSSRC,t,n,h.audioTrack,r,o):void 0;E&&(m.audio=E)}(m.video||m.audio)&&d.push(m)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,d}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(n=>n instanceof hg);if(t&&t._external.getDenoiserStats){let n=t._external.getDenoiserStats();n&&this.requestUpload(Rh.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[n,r]=t;r.has(ce.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)}),r.has(ce.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(o=>{this.requestUpload&&this.requestUpload(o.type,o.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(()=>P(this,null,function*(){let n=Date.now(),r={connectionInterval:M("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n},o=[],c=this.requestAllTracks&&this.requestAllTracks()||[];for(let f of c)!f.muted&&f.enabled&&(o=o.concat(yield f.getProcessorUsage()));let d=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[f,m]of d)m.has(ce.VIDEO)&&f.videoTrack&&(o=o.concat(yield f.videoTrack.getProcessorUsage())),m.has(ce.AUDIO)&&f.audioTrack&&(o=o.concat(yield f.audioTrack.getProcessorUsage()));if(o.length===0)return;r.details=function(f,m){let E={};for(let{id:C,value:I,level:O,direction:N}of f){var _;let x=(_=m.get(C))!==null&&_!==void 0?_:0,B=I===2?x+M("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:x;var v,A;m.set(C,B),E[C]?(I===2&&(E[C].value=I),O>E[C].level&&(E[C].level=O),N==="remote"&&(E[C].remoteUidCount+=1),E[C].totalTs=(v=m.get(C))!==null&&v!==void 0?v:0):E[C]={value:I,level:O,remoteUidCount:N==="local"?0:1,totalTs:(A=m.get(C))!==null&&A!==void 0?A:0}}return Object.keys(E).map(C=>{let{level:I,value:O,totalTs:N}=E[C];return{id:C,level:I,value:O,totalTs:N}})}(o,t);let l=Date.now(),h=l>n?l:n+1;this.requestUpload&&this.requestUpload(Rh.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:h})}),M("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}let Ate=M("ICE_RESTART_INTERVAL"),Kg=new Map,gu=new Map,Ea=[Vn.UDP_TCP_RELAY,Vn.TCP_RELAY,Vn.RELAY],gI=M("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&He().supportPCSetConfiguration;function aF(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],n=Kg.get(e.id);n&&(window.clearTimeout(n),Kg.delete(e.id));let r=gu.get(e.id);t&&r&&r.index===Ea.length-1&&(T.debug("[".concat(e.id,"] reset ICE restart policy")),gu.delete(e.id))}function cF(e,t,n){if(Kg.size===0&&gu.size===0&&(Array.isArray(M("RESTART_SEQUENCE"))&&M("RESTART_SEQUENCE").length>0&&!function(l,h){if(l.length!==h.length)return!1;for(let f=0;f<l.length;f+=1){let m=l[f];if(l.filter(E=>E===m).length!==h.filter(E=>E===m).length)return!1}return!0}(Ea,M("RESTART_SEQUENCE"))&&(Ea=M("RESTART_SEQUENCE").filter(l=>{var h;if(ne(h=Object.values(Vn)).call(h,l))return!0}),T.debug("use reconnection policy from config distribution, queues: ".concat(Ea.join(" => ")))),gI=M("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&He().supportPCSetConfiguration),Ea.length===0)return void n();let r,{index:o=0,type:c}=gu.get(e.id)||{};if(gI&&c===Vn.RELAY)return void n();let d=c&&o>=Ea.length-1;if(gI)c=Vn.RELAY;else{if(d)return void n();c?(o++,c=Ea[o]):(c=Ea[0],o=0)}T.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(c,", index: ").concat(o)),t(c),gu.set(e.id,{index:o,type:c}),r=window.setTimeout(()=>cF(e,t,n),Ate),Kg.set(e.id,r)}var Ae;function dF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function es(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dF(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dF(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function uF(e){var t,n,r,o=2;for(typeof Symbol<"u"&&(n=BS,r=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new qg(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function qg(e){function t(n){if(Object(n)!==n)return ie.reject(new TypeError(n+" is not an object."));var r=n.done;return ie.resolve(n.value).then(function(o){return{value:o,done:r}})}return qg=function(n){this.s=n,this.n=n.next},qg.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ie.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ie.reject(n):t(r.apply(this.s,arguments))}},new qg(e)}let xh=(Ae=class extends Dt{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(me.StateChange,t,this._state)}constructor(e,t){super(),b(this,"isPlanB",void 0),b(this,"store",void 0),b(this,"statsUploader",void 0),b(this,"connection",void 0),b(this,"localTrackMap",new Map),b(this,"remoteUserMap",new Map),b(this,"localDataChannels",[]),b(this,"remoteDataChannelMap",new Map),b(this,"pendingLocalTracks",[]),b(this,"pendingRemoteTracks",[]),b(this,"pendingLocalDataChannels",[]),b(this,"pendingRemoteDataChannels",[]),b(this,"statsCollector",void 0),b(this,"shouldForwardP2PCreation",void 0),b(this,"iceFailedCount",0),b(this,"dtlsFailedCount",0),b(this,"mutex",void 0),b(this,"_state",$e.Disconnected),b(this,"_pcStatsUploadType",M("NEW_ICE_RESTART")?bs.FIRST_CONNECTION:bs.OLD_FIRST_CONNECTION),b(this,"_isStartRestartIce",!1),b(this,"_restartTimer",void 0),b(this,"_isTryConnecting",!1),b(this,"_iceError",null),b(this,"_forceTurn",!1),b(this,"_isWaitPcToRePub",!1),b(this,"handleMuteLocalTrack",(n,r,o)=>P(this,null,function*(){let c=yield this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==$e.Connected)return void o(new K(D.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let d=this.filterTobeMutedTracks(n);if(d.length===0)return void r();let l=d.find(f=>f[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),yield this.connection.muteLocal(d.map(f=>{let[,{id:m}]=f;return m}));let h=this.createMuteMessage(d);yield lt(this,me.RequestMuteLocal,h),r()}catch(d){o(d)}finally{c()}})),b(this,"handleUnmuteLocalTrack",(n,r,o)=>P(this,null,function*(){let c=yield this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==$e.Connected)return void o(new K(D.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void r();let l=d.find(f=>f[0]==="videoLowTrack");if(l){let f=l[1];if(f.track._originMediaStreamTrack.stop(),!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&He().supportDualStreamEncoding){let m=n._mediaStreamTrack.clone();f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m}else{let m=mI(n,_h(this,me.RequestLowStreamParameter));f.track._mediaStreamTrack=m,f.track._originMediaStreamTrack=m}yield new ie((m,E)=>{this.handleReplaceTrack(f.track,m,E,!0)})}yield this.connection.unmuteLocal(d.map(f=>{let[,{id:m}]=f;return m}));let h=this.createUnmuteMessage(d);yield lt(this,me.RequestUnmuteLocal,h),r()}catch(d){o(d)}finally{c()}})),b(this,"handleUpdateVideoEncoder",(n,r,o,c)=>P(this,null,function*(){let d;c||(d=yield this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let h=this.localTrackMap.get(J.LocalVideoTrack);if(!this.connection||!h||h.track!==n||this.state!==$e.Connected)return void r();let{id:f,track:m}=h;yield this.connection.updateSendParameters(f,m),yield this.connection.updateEncoderConfig(f,m),this.emit(me.UpdateVideoEncoder,m),r()}catch(h){o(h)}finally{var l;(l=d)===null||l===void 0||l()}})),b(this,"handleUpdateVideoSendParameters",(n,r,o)=>P(this,null,function*(){let c=yield this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let d=this.localTrackMap.get(J.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==$e.Connected)return void r();let{id:l,track:h}=d;yield this.connection.updateSendParameters(l,h),r()}catch(d){o(d)}finally{c()}})),b(this,"handleReplaceMixingTrack",(n,r,o,c)=>P(this,null,function*(){if(!this.connection||this.state!==$e.Connected)return void r();let d=pI([n]),l;T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(d.getTrackId(),"]")),typeof c=="boolean"&&c||(l=yield this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{yield this.replaceTrack(n,d),r()}catch(f){o(f)}finally{var h;(h=l)===null||h===void 0||h()}})),b(this,"handleReplaceTrack",(n,r,o,c)=>P(this,null,function*(){let d;T.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof c=="boolean"&&c||(d=yield this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var l;let f=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:E}]=m;return n===E});if(!this.connection||!f||this.state!==$e.Connected)return void r();if(yield(l=this.connection)===null||l===void 0?void 0:l.replaceTrack(n,f[1].id),this.isPlanB){let m=f[1];m.id=n._mediaStreamTrack.id,this.localTrackMap.set(f[0],m)}if(f[0]===J.LocalVideoTrack&&!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&He().supportDualStreamEncoding){let m=this.localTrackMap.get(J.LocalVideoLowTrack);if(m){let E=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E,yield new ie((_,v)=>{this.handleReplaceTrack(m.track,_,v,!0)})}}r()}catch(f){o(f)}finally{var h;(h=d)===null||h===void 0||h()}})),b(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),b(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),b(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),b(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),b(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new sF(this.store),this.bindStatsUploaderEvents(),this.mutex=new kn("P2PChannel-mutex",this.store.clientId),this.isPlanB=!He().supportUnifiedPlan||M("CHROME_FORCE_PLAN_B")&&Ss(),this.shouldForwardP2PCreation=M("FORWARD_P2P_CREATION")&&He().supportPCSetConfiguration&&ZS(),this.shouldForwardP2PCreation&&(this.connection=Bg(this.store),this.emit(me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}startP2PConnection(e){return P(this,null,function*(){var t;this.state=$e.New,this._forceTurn=eF(e),T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let n=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=Bg(this.store,e),this.emit(me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new K(D.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=M("NEW_ICE_RESTART")?bs.FIRST_CONNECTION:bs.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise})}connect(e){return P(this,null,function*(){if(!this.connection)throw new K(D.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");M("ENABLE_PREALLOC_PC")&&this.state===$e.Connected?yield this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),yield this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=$e.Connected)})}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(o=>{var c;let[d]=o;return ne(c=[J.LocalVideoLowTrack,J.LocalVideoTrack]).call(c,d)}),n=t.map(o=>{let[,{id:c}]=o;return c}),r=t.map(o=>{let[c]=o;return c});if(this.connection instanceof Os){if(he.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ne(e).call(e,this.store.codec)){let o=["vp9","vp8","h264"].find(c=>ne(e).call(e,c));o&&(this.store.codec=o,T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(o,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}getEstablishParams(){return P(this,null,function*(){var e;if(this.connection instanceof Os&&this.connection.peerConnectionState!=="closed"&&ne(e=[$e.New,$e.Connected]).call(e,this.state))return this.connection.establishPromise})}publishDataChannel(e){return P(this,null,function*(){if(!this.connection||this.state!==$e.Connected){if(this.state===$e.Disconnected)throw new K(D.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(n=>{var r;ne(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(n=>{let r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),yield this.connection.createDataChannels(this.store.uid,t),t.forEach(n=>{this.localDataChannels.push(n);let r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}),e.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))})}publish(e,t,n){var r=this;return ui(function*(){let o=yield Ue(r.mutex.lock("From P2PChannel.publish"));try{var c;let d=r.connection&&ne(c=["disconnected","failed"]).call(c,r.connection.peerConnectionState);if(!r.connection||r.state!==$e.Connected||d){if(r.state===$e.Disconnected)throw new K(D.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);let h=e.filter(f=>r.pendingLocalTracks.indexOf(f)===-1);return r.pendingLocalTracks=r.pendingLocalTracks.concat(h),void(d&&(r._isWaitPcToRePub=!0))}r.store.pubId=r.store.pubId+1,xn.markPublishStart(r.store.clientId,r.store.pubId);let l=r.filterTobePublishedTracks(e,t,n);if(l.length===0)return void(yield Ue(r.tryToUnmuteAudio(e)));yield*ip(Vm(uF(r.doPublish(r.connection,l))))}finally{o()}})()}doPublish(e,t){var n=this;return ui(function*(){t.forEach(_=>{let{track:v,type:A}=_,C=Date.now();n.store.publish(v.getTrackId(),A===J.LocalAudioTrack?"audio":"video",C)}),n.bindLocalTrackEvents(t);let r=t.map(_=>{let{track:v}=_;return v}),o=yield Ue(e.send(r,n.store.codec,n.store.audioCodec)),c=(yield Ue(o.next())).value,d=n.createGatewayPublishMessage(t,c),l;try{l=yield d}catch(_){throw o.throw(_),_?.code===D.WS_ABORT&&t.forEach(v=>{let{track:A}=v;n.pendingLocalTracks.indexOf(A)===-1&&n.pendingLocalTracks.push(A)}),n.unbindLocalTrackEvents(t),_}let h=n.mapPubResToRemoteConfig(d,l,r),f=(yield Ue(o.next(h))).value;if(n.state===$e.Disconnected)throw new K(D.UNEXPECTED_ERROR,"PeerConnection already disconnected.");M("ENABLE_VIDEO_SEI");let m=M("ENABLE_ENCODED_TRANSFORM"),E=M("ENABLE_AUDIO_METADATA");r.forEach(_=>P(this,null,function*(){let v=_.getRTCRtpTransceiver();v&&m&&(_.trackMediaType===ce.VIDEO?yield Tee(v.sender,_):_.trackMediaType===ce.AUDIO&&(yield pee(v.sender,{metadata:E?()=>{let A=_.metadata.shift();return A&&A.value}:void 0})))})),t.forEach(_=>{let{type:v}=_;n.statsCollector.addLocalStats(v)}),n.assignLocalTracks(t,f),n.statsUploader.startUploadOutboundStats(),t.forEach(_=>{let{track:v,type:A}=_,C=Date.now();n.store.publish(v.getTrackId(),A===J.LocalAudioTrack?"audio":"video",void 0,C)})})()}updateVideoStreamParameter(e,t){return P(this,null,function*(){let n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof vt))return T.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:r}=n,o=function(c,d){let l={};return c.height&&c.width&&(l.scaleResolutionDownBy=JC(c,d)),l.maxFramerate=c.framerate?xr(c.framerate):void 0,l.maxBitrate=c.bitrate?1e3*c.bitrate:void 0,l}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==J.LocalVideoLowTrack||!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&He().supportDualStreamEncoding)o.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=o.scaleResolutionDownBy);else{let c=r._originMediaStreamTrack;if(!c.canvas)return T.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(d,l){let h=d.canvas;l.width&&(h.width=xr(l.width)),l.height&&(h.height=xr(l.height)),l.framerate&&(h.stopCapture&&h.stopCapture(),h.stopCapture=bC(()=>{!h.startCapture&&h.stopCapture&&h.stopCapture(),h.startCapture&&h.startCapture()},xr(l.framerate)))})(c,e)}o.maxBitrate!=null&&(r._encoderConfig.bitrateMax=o.maxBitrate/1e3),o.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=o.maxFramerate:r._encoderConfig.frameRate={max:o.maxFramerate}),T.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),yield this.connection.updateRtpSenderEncodings(r)})}publishLowStream(e){var t=this;return ui(function*(){if(!t.connection||t.state!==$e.Connected)return;let n=yield Ue(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let o=t.localTrackMap.get(J.LocalVideoTrack);if(!o)throw new K(D.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(J.LocalVideoLowTrack))throw new K(D.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let c=[{track:t.getLowVideoTrack(o.track,e),type:J.LocalVideoLowTrack}];if(yield*ip(Vm(uF(t.doPublish(t.connection,c)))),o.track.muted||!o.track.enabled){var r;let d=(r=t.localTrackMap.get(J.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;d!==void 0&&(yield Ue(t.connection.muteLocal([d])))}}finally{n()}})()}republish(){return P(this,null,function*(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield An(this,me.RequestRePublish,this.pendingLocalTracks),this.emit(me.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield An(this,me.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1})}reSubscribe(e){return P(this,null,function*(){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==ce.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==ce.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)yield An(this,me.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:n}of this.pendingRemoteTracks)yield this.subscribe(t,n,n===ce.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(me.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]})}unpublish(e){return P(this,null,function*(){if(!this.connection||this.state!==$e.Connected)return void e.forEach(r=>{let o=this.pendingLocalTracks.indexOf(r);o!==-1&&this.pendingLocalTracks.splice(o,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)})}unpublishDataChannel(e){return P(this,null,function*(){if(!this.connection||this.state!==$e.Connected)return void e.forEach(n=>{let r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(n=>{let r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&(yield this.connection.stopDataChannels(this.store.uid)),t.map(n=>n.id)):void 0})}unpublishLowStream(){return P(this,null,function*(){if(!this.connection||this.state!==$e.Connected)return;let e=this.localTrackMap.get(J.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[J.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)})}doUnpublish(e,t){return P(this,null,function*(){let n=this.createGatewayUnpublishMessage(t);return yield e.stopSending(t.map(r=>{let[,{id:o}]=r;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[o,{track:c}]=r;return{type:o,track:c}})),t.forEach(r=>{let[o]=r;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n})}subscribeDataChannel(e,t){return P(this,null,function*(){if(!this.connection||this.state!==$e.Connected)throw new K(D.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let n=t.filter(r=>{var o;return!((o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.get(r.id))});if(n.length!==0)return yield this.connection.createDataChannels(e.uid,n),n.forEach(r=>{var o;this.remoteDataChannelMap.has(e)?(o=this.remoteDataChannelMap.get(e))===null||o===void 0||o.set(r.id,r):this.remoteDataChannelMap.set(e,new Map([[r.id,r]]));let c=this.pendingRemoteDataChannels.findIndex(d=>{let{user:l,id:h}=d;return l.uid===e.uid&&h===r.id});c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),n.map(r=>r.id)})}subscribe(e,t,n,r,o){return P(this,null,function*(){var c;if(!this.connection||this.state!==$e.Connected)throw new K(D.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(t))return;let d,l,h,f=this.connection.getPreMedia(n);if(f)T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),h=f.transceiver,d=f.track,l=f.id;else if(o){let _=o.find(A=>{let{stream_type:C}=A;return C===t});if(!_)throw new K(D.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let v=yield this.connection.receive(t,_.ssrcs,String(e._uintid),_.attributes);this.connection instanceof Os&&(h=v.transceiver),d=v.track,l=v.id}else{let _=yield this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof Os&&(h=_.transceiver),d=_.track,l=_.id}t===ce.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new tu(d,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new eu(d,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack)),h&&M("ENABLE_ENCODED_TRANSFORM")&&(t==ce.VIDEO?yield VC(h.receiver,{onSei:M("ENABLE_VIDEO_SEI")&&(_=>{var v;return(v=e._videoTrack)===null||v===void 0?void 0:v._onSei(_)})}):t==ce.AUDIO&&(yield FC(h.receiver,{enableTopn:!!M("ENABLE_AUDIO_TOPN"),enableMetadata:!!M("ENABLE_AUDIO_METADATA"),onMetadata:_=>{this.safeEmit(me.AudioMetadata,_)}})));let m=this.remoteUserMap.get(e);m?m.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let E=this.pendingRemoteTracks.findIndex(_=>{let{user:v,kind:A}=_;return v.uid===e.uid&&t===A});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(me.MediaReconnectEnd,e.uid))})}massSubscribe(e){return P(this,null,function*(){return this.massSubscribeNoLock(e)})}massSubscribeNoLock(e){return P(this,null,function*(){if(!this.connection||this.state!==$e.Connected)throw new K(D.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(o=>{var c;let{user:d,mediaType:l}=o;return!((c=this.remoteUserMap.get(d))!==null&&c!==void 0&&c.has(l))});let t=[],n=new Map;e.forEach(o=>{if(!this.connection)return;let c=this.connection.getPreMedia(o.ssrcId);c?n.set(o.ssrcId,c):t.push(o)});let r=yield this.connection.batchReceive(t.map(o=>{let{user:c,mediaType:d,ssrcId:l,rtxSsrcId:h}=o;return{kind:d,ssrcMsg:[{ssrcId:l,rtx:h}],mslabel:String(c._uintid)}}));t.forEach((o,c)=>{n.set(o.ssrcId,r[c])});for(let{user:o,mediaType:c,ssrcId:d}of e){let l=n.get(d);if(!l)return void T.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o.uid," subscribe data,").concat(c,", ").concat(d));let{track:h,id:f,transceiver:m}=l;m&&M("ENABLE_ENCODED_TRANSFORM")&&(c==ce.VIDEO?yield VC(m.receiver,{onSei:M("ENABLE_VIDEO_SEI")&&(v=>{var A;return(A=o._videoTrack)===null||A===void 0?void 0:A._onSei(v)})}):c==ce.AUDIO&&(yield FC(m.receiver,{enableTopn:!!M("ENABLE_AUDIO_TOPN"),enableMetadata:!!M("ENABLE_AUDIO_METADATA"),onMetadata:v=>{this.safeEmit(me.AudioMetadata,v)}}))),c===ce.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(h):(o._audioTrack=new tu(h,o.uid,o._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),m&&o._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(h):(o._videoTrack=new eu(h,o.uid,o._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),m&&o._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(o,o._videoTrack)),M("ENABLE_VIDEO_SEI")&&m&&(c==ce.VIDEO?yield VC(m.receiver,{onSei:v=>{var A;(A=o._videoTrack)===null||A===void 0||A._onSei(v)}}):c==ce.AUDIO&&(yield FC(m.receiver)));let E=this.remoteUserMap.get(o);E?E.set(c,f):this.remoteUserMap.set(o,new Map([[c,f]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats();let _=this.pendingRemoteTracks.findIndex(v=>{let{user:A,kind:C}=v;return A.uid===o.uid&&c===C});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(me.MediaReconnectEnd,o.uid))}})}unsubscribe(e,t,n){return P(this,null,function*(){let r=this.pendingRemoteTracks.filter(d=>{let{user:l,kind:h}=d;return t!==void 0?l.uid===e.uid&&t===h:l.uid===e.uid});if(r.forEach(d=>{let l=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(l,1)}),this.connection&&this.state===$e.Connected||n||r.forEach(d=>{let{kind:l}=d;var h;if(l===ce.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(l===ce.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==$e.Connected)return;let o=this.filterTobeUnSubscribedTracks(e,t);if(o.length===0)return;yield this.connection.stopReceiving(o.map(d=>{let[,{id:l}]=d;return l}));let c=this.createUnsubscribeMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),o.forEach(d=>{let[l,{kind:h}]=d;var f,m;if(h===ce.VIDEO&&l._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),h===ce.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),n||((m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0);else if(h===ce.AUDIO){var E;this.unbindRemoteTrackEvents(l._audioTrack),!n&&((E=l._audioTrack)===null||E===void 0||E._destroy(),l._audioTrack=void 0)}}),c})}unsubscribeDataChannel(e,t){return P(this,null,function*(){if(t.forEach(o=>{let c=this.pendingRemoteDataChannels.findIndex(d=>d.id===o.id);c!==-1&&this.pendingRemoteDataChannels.splice(c,1)}),!this.connection)return;let n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach(o=>{o._close()});let r=this.remoteDataChannelMap.get(e);return n.forEach(o=>{r&&r.delete(o.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(e),yield this.connection.stopDataChannels(e.uid)),n.map(o=>o.id)})}massUnsubscribe(e){return P(this,null,function*(){return this.massUnsubscribeNoLock(e)})}massUnsubscribeNoLock(e){return P(this,null,function*(){let t=[];for(let{user:o,mediaType:c}of e){let d=this.pendingRemoteTracks.filter(l=>{let{user:h,kind:f}=l;return c!==void 0?h.uid===o.uid&&c===f:h.uid===o.uid});d.forEach(l=>{let h=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(h,1)}),t=t.concat(d)}if(!this.connection||this.state!==$e.Connected)return void t.forEach(o=>{let{user:c,kind:d}=o;var l;if(d===ce.AUDIO)(l=c._audioTrack)===null||l===void 0||l._destroy(),c._audioTrack=void 0;else if(d===ce.VIDEO){var h;(h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0}});let n=co(e).call(e,(o,c)=>{let{user:d,mediaType:l}=c,h=this.filterTobeUnSubscribedTracks(d,l);return o.concat(h)},[]);if(n.length===0)return;yield this.connection.stopReceiving(n.map(o=>{let[,{id:c}]=o;return c}));let r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(o=>{let[c,{kind:d}]=o;var l,h;if(d===ce.VIDEO&&c._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),d===ce.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),(h=c._videoTrack)===null||h===void 0||h._destroy(),c._videoTrack=void 0;else if(d===ce.AUDIO){var f;this.unbindRemoteTrackEvents(c._audioTrack),(f=c._audioTrack)===null||f===void 0||f._destroy(),c._audioTrack=void 0}}),r})}isPreSubScribe(e){return!this.connection||this.state!==$e.Connected?!1:!!this.connection.getPreMedia(e)}muteRemote(e,t){return P(this,null,function*(){if(!this.connection)return;let n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void T.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===ce.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)})}unmuteRemote(e,t){return P(this,null,function*(){return this.unmuteRemoteNoLock(e,t)})}unmuteRemoteNoLock(e,t){return P(this,null,function*(){if(!this.connection)return;let n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||T.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))})}addAudioMetadata(e){let t=this.localTrackMap.get(J.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){let t=this.localTrackMap.get(J.LocalAudioTrack);if(t?.track instanceof sn){let n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[o]=r;return o!==J.LocalAudioTrack}).filter(r=>{let[o]=r;return!(e&&o===J.LocalVideoLowTrack)}).map(r=>{let[,{track:o}]=r;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===J.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,o){if(e){let d=this.localTrackMap.get(J.LocalAudioTrack),l=r?this.localTrackMap.get(J.LocalVideoLowTrack):this.localTrackMap.get(J.LocalVideoTrack);he.publish(this.store.sessionId,{eventElapse:xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d?.track.getTrackLabel(),videoName:l?.track.getTrackLabel(),screenshare:l?.track._hints.indexOf(pt.SCREEN_TRACK)!==-1,audio:!!d,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var c;n||(n=[]);let d=n.find(h=>h instanceof Ft),l=r?(c=this.localTrackMap.get(J.LocalVideoTrack))===null||c===void 0?void 0:c.track:n.find(h=>h instanceof vt);he.publish(this.store.sessionId,{eventElapse:xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d?.getTrackLabel(),videoName:l?.getTrackLabel(),screenshare:l?._hints.indexOf(pt.SCREEN_TRACK)!==-1,audio:!!d,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,r){let o=r===ce.VIDEO?n._videoSSRC:n._audioSSRC;o&&he.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===ce.VIDEO,audio:r===ce.AUDIO,peerid:n.uid,subscribeRequestid:o,p2pid:this.store.p2pId,eventElapse:xn.measureFromSubscribeStart(this.store.clientId,o),preSsrc:this.isPreSubScribe(o)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new kn("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=Bg(this.store),this.emit(me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(J.LocalAudioTrack);if(e?.track instanceof sn){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=$e.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(J.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(J.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof vt||t&&t.track instanceof Ft?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}hasRemoteMediaWithLock(e,t){return P(this,null,function*(){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))})}getRemoteMedia(e){var t;let n=Array.from(Yr(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(J.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=nh(e).call(e,(n,r)=>n.level-r.level),e}disconnectForReconnect(){return P(this,null,function*(){this.connection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=$e.Reconnecting,M("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=Bg(this.store),this.emit(me.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case J.LocalVideoTrack:ne(t=r._hints).call(t,pt.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case J.LocalAudioTrack:r instanceof sn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case J.LocalVideoLowTrack:}}),this.emit(me.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Yr(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(me.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Yr(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(t,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})}hasPendingRemoteDataChannel(e,t){for(let n of this.pendingRemoteDataChannels){let{user:r,id:o}=n;if((e instanceof ga?e.uid:e)===r.uid&&o===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let n of this.pendingRemoteTracks){let{user:r,kind:o}=n;if((e instanceof ga?e.uid:e)===r.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return ui(function*(){if(!t.connection||t.state!==$e.Connected)return;let n=yield Ue(t.mutex.lock("From P2PChannel.restartICE")),r;try{r=yield Ue(t.connection.restartICE(e));let c=yield Ue(r.next());if(c.done)return;let d=c.value,l=yield d;switch(fI(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case Vn.UDP_TCP_RELAY:t._pcStatsUploadType=bs.UDP_TCP_RESTART;break;case Vn.TCP_RELAY:t._pcStatsUploadType=bs.TCP_RESTART;break;case Vn.RELAY:t._pcStatsUploadType=bs.RELAY_RESTART;break;default:t._pcStatsUploadType=bs.OLD_RESTART}t._isTryConnecting=!0,r.next(l)}catch(c){var o;(o=r)===null||o===void 0||o.throw(c)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(J.LocalVideoTrack),n=this.localTrackMap.get(J.LocalAudioTrack),r=e.videoSend.find(v=>v.ssrc===t?.ssrcs[0].ssrcId),o=e.audioSend.find(v=>v.ssrc===n?.ssrcs[0].ssrcId);if(!r||!o)return 1;let c=qr(this,me.NeedSignalRTT),d=r?r.rttMs:void 0,l=o?o.rttMs:void 0,h=d&&l?(d+l)/2:d||l,f=(h&&c?(h+c)/2:h||c)||0,m=100*e.sendPacketLossRate*.7/50+.3*f/1500,E=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,_=t?.track;if(_&&_._encoderConfig&&_._hints.indexOf(pt.SCREEN_TRACK)===-1){let v=_._encoderConfig.bitrateMax,A=e.bitrate.actualEncoded;if(v&&A){let C=(1e3*v-A)/(1e3*v);return Wx[C<.15?0:C<.3?1:C<.45?2:C<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n,o=r._audioSSRC,c=r._videoSSRC,d=e.audioRecv.find(A=>A.ssrc===o),l=e.videoRecv.find(A=>A.ssrc===c);if(!d&&!l)return void(t+=1);let h=qr(this,me.NeedSignalRTT),f=e.rtt,m=(f&&h?(f+h)/2:f||h)||0,E=d?d.jitterMs:void 0,_=e.recvPacketLossRate,v=.7*_*100/50+.3*m/1500;E&&(v=.6*_*100/50+.2*m/1500+.2*E/400),t+=v<.1?1:v<.17?2:v<.36?3:v<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}muteLocalTrack(e){return P(this,null,function*(){return new ie((t,n)=>{this.handleMuteLocalTrack(e,t,n)})})}replaceTrack(e,t){return P(this,null,function*(){var n;if(T.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==$e.Connected)return;let r=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:d}]=c;return e===d});if(!r)return;let o=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:o}]),this.bindLocalTrackEvents([{track:t,type:o}]),r[1].track=t),yield(n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,r[1].id),this.isPlanB){let c=r[1];c.id=t._mediaStreamTrack.id,this.localTrackMap.set(o,c)}if(o===J.LocalVideoTrack&&!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&He().supportDualStreamEncoding){let c=this.localTrackMap.get(J.LocalVideoLowTrack);if(c){let d=e._mediaStreamTrack.clone();c.track._originMediaStreamTrack.stop(),c.track._mediaStreamTrack=d,c.track._originMediaStreamTrack=d,yield new ie((l,h)=>{this.handleReplaceTrack(c.track,l,h,!0)})}}})}filterTobePublishedTracks(e,t,n){let r=[],o=this.getAllTracks();e=Hd(e=e.filter(h=>o.indexOf(h)===-1));let c,d=!1,l=this.localTrackMap.get(J.LocalAudioTrack);for(let h of e){if(h instanceof vt&&(this.localTrackMap.has(J.LocalVideoTrack)||d?new K(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:h,type:J.LocalVideoTrack}),d=!0),t)){let f=this.getLowVideoTrack(h,n);r.push({track:f,type:J.LocalVideoLowTrack})}if(h instanceof Ft)if(l){let f=l.track;if(f instanceof sn)hI([h]),f.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0);else{let m=pI([f,h]);T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),this.replaceTrack(f,m)}}else c instanceof sn?(hI([h]),c.addAudioTrack(h)):c||!h._useAudioElement&&He().webAudioMediaStreamDest&&!h._bypassWebAudio?c=pI(c?[h,c]:[h]):c=h}return c&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(c.getTrackId(),"]")),r.push({track:c,type:J.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){let t=[],n=this.getAllTracks();e=Hd(e=e.filter(r=>n.indexOf(r)!==-1));for(let r of e){if(r instanceof Ft){let o=this.localTrackMap.get(J.LocalAudioTrack);if(!o)continue;o.track instanceof sn?(o.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),o.track.trackList.length===0&&(t.push([J.LocalAudioTrack,o]),o.track.close())):t.push([J.LocalAudioTrack,o])}if(r instanceof vt){let o=this.localTrackMap.get(J.LocalVideoTrack);if(!o)continue;t.push([J.LocalVideoTrack,o]);let c=this.localTrackMap.get(J.LocalVideoLowTrack);c&&t.push([J.LocalVideoLowTrack,c])}}return t}filterTobePublishedDataChannels(e){return e=(e=Hd(e)).filter(t=>this.localDataChannels.findIndex(n=>n.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Hd(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case J.LocalVideoTrack:n.addListener(de.GET_STATS,this.handleGetLocalVideoStats),n.addListener(de.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(de.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(de.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(de.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(de.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(de.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(de.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(de.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case J.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case J.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof sn?e.trackList.forEach(n=>{n.addListener(de.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(de.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(de.GET_STATS,this.handleGetLocalAudioStats),n.addListener(de.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(de.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(de.GET_STATS,this.handleGetLocalAudioStats),e.addListener(de.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(de.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(de.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(de.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(de.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(de.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case J.LocalVideoTrack:n.off(de.GET_STATS,this.handleGetLocalVideoStats),n.off(de.GET_RTC_STATS,this.handleGetRTCStats),n.off(de.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(de.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(de.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(de.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(de.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(de.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(de.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case J.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case J.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof sn?e.trackList.forEach(t=>{t.off(de.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(de.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(de.GET_STATS,this.handleGetLocalAudioStats),t.off(de.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(de.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(de.GET_STATS,this.handleGetLocalAudioStats),e.off(de.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(de.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(de.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(de.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(de.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(de.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof eu&&t.addListener(de.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof tu&&t.addListener(de.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(de.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(ce.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(ce.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var o;let c,d,{track:l,type:h}=n;switch(h){case J.LocalAudioTrack:c=Xe.Audio,d={dtx:l instanceof hg&&l._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case J.LocalVideoTrack:c=ne(o=l._hints).call(o,pt.SCREEN_TRACK)?Xe.Screen:Xe.High,d=es(es({},cU(l)),{},{codec:this.store.codec,svc_mode:Dg()});break;case J.LocalVideoLowTrack:c=Xe.Low,d=es(es({},cU(l)),{},{codec:this.store.codec,svc_mode:Dg()})}return{stream_type:c,attributes:d,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[o,{track:c,ssrcs:d,id:l}]=t;switch(o){case J.LocalVideoTrack:r=ne(n=c._hints).call(n,pt.SCREEN_TRACK)?Xe.Screen:Xe.High;break;case J.LocalAudioTrack:r=Xe.Audio;break;case J.LocalVideoLowTrack:r=Xe.Low}return{stream_type:r,ssrcs:d,mid:l}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:o,type:c}=n;this.localTrackMap.set(c,{track:o,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=t=>P(this,null,function*(){if(T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(me.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Os&&aF(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=bs.DISCONNECTED_OR_FAILED,qr(this,me.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){let n=this.pendingLocalTracks.map(o=>o.getTrackId()),r=this.pendingLocalDataChannels.map(o=>"dc_".concat(o.id));he.reportApiInvoke(this.store.sessionId,{name:tn.REPUB_AFTER_PC_CONNECTED,options:n.concat(r),tag:kt.TRACER}).onSuccess(),this.republish()}if(M("NEW_ICE_RESTART")&&e instanceof Os&&!xt()&&!this._forceTurn){if(ne(tU).call(tU,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let n=o=>{fI(e)&&(T.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(o)),qr(this,me.QueryClientConnectionState)==="CONNECTED"&&this.emit(me.RequestRestartICE,o))},r=()=>{fI(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),T.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(me.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{cF(e,n,r)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&M("ICE_RESTART")&&qr(this,me.QueryClientConnectionState)==="CONNECTED"&&this.emit(me.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(me.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(T.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(me.P2PLost),0),this.iceFailedCount+=1,yield this.requestReconnect())}}),e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),he.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:kt.TRACER}).onSuccess(),this.emit(me.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;let r=Array.from(Yr(n=this.remoteUserMap).call(n)).find(c=>c._audioSSRC===t);var o;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(o=r.audioTrack)===null||o===void 0||o.emit($d.FIRST_FRAME_DECODED),he.firstRemoteFrame(this.store.sessionId,hn.FIRST_AUDIO_DECODE,Rt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;let r=Array.from(Yr(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);r&&he.firstRemoteFrame(this.store.sessionId,hn.FIRST_AUDIO_RECEIVED,Rt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;let r=Array.from(Yr(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);r&&he.firstRemoteFrame(this.store.sessionId,hn.FIRST_VIDEO_RECEIVED,Rt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{let r=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&r===o||this.emit(me.ConnectionTypeChange,r),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(pa(n))," -> ").concat(JSON.stringify(pa(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(pa(n))," -> ").concat(JSON.stringify(pa(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return es(es({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Os&&function(t){gu.delete(t.id),aF(t)}(e),e.close(),this.emit(me.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let n=this.localTrackMap.get(J.LocalAudioTrack);if(e instanceof Ft&&n?.track instanceof sn)return n.track.isActive||t.push([J.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return e===c});if(r&&(t.push(r),r[0]===J.LocalVideoTrack)){let o=this.localTrackMap.get(J.LocalVideoLowTrack);o&&t.push([J.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){let t=[],n=this.localTrackMap.get(J.LocalAudioTrack);if(e instanceof Ft&&n?.track instanceof sn)return n.track.isActive&&t.push([J.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return e===c});if(r)if(r[0]===J.LocalVideoTrack){t.push(r);let o=this.localTrackMap.get(J.LocalVideoLowTrack);o&&t.push([J.LocalVideoLowTrack,o])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[o,{track:c,ssrcs:d,id:l}]=t;switch(o){case J.LocalAudioTrack:r=Xe.Audio;break;case J.LocalVideoTrack:r=ne(n=c._hints).call(n,pt.SCREEN_TRACK)?Xe.Screen:Xe.High;break;case J.LocalVideoLowTrack:r=Xe.Low}return{stream_type:r,ssrcs:d,mid:l}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[o,{track:c,ssrcs:d,id:l}]=t;switch(o){case J.LocalAudioTrack:r=Xe.Audio;break;case J.LocalVideoTrack:r=ne(n=c._hints).call(n,pt.SCREEN_TRACK)?Xe.Screen:Xe.High;break;case J.LocalVideoLowTrack:r=Xe.Low}return{stream_type:r,ssrcs:d,mid:l}})}filterTobeUnSubscribedTracks(e,t){let n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){let o=r.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(r.entries()).forEach(o=>{let[c,d]=o;n.push([e,{kind:c,id:d}])});return n}filterTobeUnSubscribedDataChannels(e,t){let n=[];return t.forEach(r=>{var o;(o=this.remoteDataChannelMap.get(e))!==null&&o!==void 0&&o.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(e){let t=[];return e.forEach(n=>{let[r,{kind:o,id:c}]=n;switch(o){case ce.VIDEO:return void(r._videoSSRC&&t.push({stream_type:ce.VIDEO,ssrcId:r._videoSSRC}));case ce.AUDIO:return void(r._audioSSRC&&t.push({stream_type:ce.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(n=>{let[r,{kind:o}]=n;if(t.has(r)){let c=t.get(r);o===ce.VIDEO?c|=pn.Video:c|=pn.Audio,t.set(r,c)}else o===ce.VIDEO?t.set(r,pn.Video):t.set(r,pn.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,o]=n;return{stream_id:r.uid,stream_type:o}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t,o=this.remoteUserMap.get(n);o&&(o.delete(r),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}updateBitrateLimit(e){return P(this,null,function*(){let t=this.localTrackMap.get(J.LocalVideoTrack),n=this.localTrackMap.get(J.LocalVideoLowTrack);t&&(yield t.track.setBitrateLimit(e.uplink),yield new ie((r,o)=>{this.handleUpdateVideoEncoder(t.track,r,o,!0)})),n&&e.low_stream_uplink&&(yield n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),yield new ie((r,o)=>{this.handleUpdateVideoEncoder(n.track,r,o,!0)}))})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t,n){return e.map((r,o)=>{var c;let{stream_type:d}=r,l=(c=t.find(h=>{let{stream_type:f}=h;return d===f}))===null||c===void 0?void 0:c.attributes;if(l&&M("DISABLE_SCREEN_SHARE_REMB")){let h=n[o]._hints;(ne(h).call(h,pt.SCREEN_TRACK)||ne(h).call(h,pt.SCREEN_LOW_TRACK))&&(l.remb=!1,T.debug("disable remb for screen share, hints:",h))}return l})}tryToUnmuteAudio(e){return P(this,null,function*(){for(let n=0;n<e.length;n++)if(e[n]instanceof Ft){var t;let r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;yield(t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(c=>{let[,{id:d}]=c;return d}));let o=this.createUnmuteMessage(r);return void(yield lt(this,me.RequestUnmuteLocal,o))}})}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(me.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(me.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){return P(this,null,function*(){this.dtlsFailedCount+=1,yield Sn(aC(this.dtlsFailedCount,nn)),this.emit(me.RequestReconnect)})}reconnectP2P(){return P(this,null,function*(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&(yield An(this,me.RequestUnpublishForReconnectPC,t)),this.disconnectForReconnect(),this.emit(me.RequestReconnectPC)})}canPublishLowStream(){return this.localTrackMap.has(J.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof vt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof vt).length>1)throw new K(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ft).length>1&&(e.some(t=>t instanceof Ft&&t._bypassWebAudio)||!He().webAudioMediaStreamDest))throw new K(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof vt&&this.pendingLocalTracks.some(n=>n instanceof vt))throw new K(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ft&&this.pendingLocalTracks.some(n=>n instanceof Ft)&&(!He().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Ft&&n._bypassWebAudio)))throw new K(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;let r=!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&He().supportDualStreamEncoding,o=es(es({},{width:160,height:120,framerate:15,bitrate:50}),t),c;c=r?e._mediaStreamTrack.clone():mI(e,o);let d=ht(8,"track-low-"),l=new vt(c,es(es({},r&&{scaleResolutionDownBy:JC(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,d);return l.on(lc.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,zd.LOW_STREAM)}),l._hints.push(pt.LOW_STREAM),ne(n=e._hints).call(n,pt.SCREEN_TRACK)&&l._hints.push(pt.SCREEN_LOW_TRACK),e.on("sei-to-send",h=>{l.emit("sei-to-send",h)}),e.addListener(de.NEED_CLOSE,()=>{l.close()}),l}globalLock(){return P(this,null,function*(){return this.mutex.lock("From P2PChannel.globalLock")})}reportPCStats(r,o,c){return P(this,arguments,function*(e,t,n){let d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Os){var l,h,f,m;let E=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:_,dtlsTransportState:v,peerConnectionState:A}=this.connection,{local:C,remote:I}=yield this.connection.getSelectedCandidatePair();he.pcStats(this.store.sessionId,{startTime:E,eventElapse:e-E||0,iceconnectionsate:_,dtlsstate:v,connectionstate:A,intSucc:t?1:2,error:this._iceError||d||"",selectedLocalCandidateProtocol:(l=C?.protocol)!==null&&l!==void 0?l:"",selectedLocalCandidateType:(h=C.candidateType)!==null&&h!==void 0?h:"",selectedLocalCandidateAddress:"".concat(C.address,":").concat(C.port),selectedRemoteCandidateProtocol:(f=I.protocol)!==null&&f!==void 0?f:"",selectedRemoteCandidateType:(m=I.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(I.address,":").concat(I.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}})}reportVideoFirstFrameDecoded(e,t,n,r){var o;let c=Array.from(Yr(o=this.remoteUserMap).call(o)).find(d=>d._videoSSRC===e);if(c){r||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());let d=this.store.keyMetrics,l=d.subscribe.find(h=>h.userId===c.uid&&h.type==="video");he.firstRemoteVideoDecode(this.store.sessionId,hn.FIRST_VIDEO_DECODE,Rt.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:n,subscribeElapse:xn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:l?.subscribeEnd||0,subscriberStart:l?.subscribeStart||0,videoAddNotify:l?.streamAdded||0,state:r?1:0,firstFrame:l?.firstFrame||0})}}remoteMediaSsrcChanged(e,t,n){return P(this,null,function*(){if(!this.connection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let o=r.get(t);if(!o)return!1;let c=yield this.connection.getRemoteSSRC(o);return c!==void 0&&c!==n})}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===J.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,zd.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},ue(Ae.prototype,"startP2PConnection",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"startP2PConnection"),Ae.prototype),ue(Ae.prototype,"connect",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"connect"),Ae.prototype),ue(Ae.prototype,"updateRemoteRTPCapabilities",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"updateRemoteRTPCapabilities"),Ae.prototype),ue(Ae.prototype,"publishDataChannel",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"publishDataChannel"),Ae.prototype),ue(Ae.prototype,"unpublish",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"unpublish"),Ae.prototype),ue(Ae.prototype,"unpublishDataChannel",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"unpublishDataChannel"),Ae.prototype),ue(Ae.prototype,"unpublishLowStream",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"unpublishLowStream"),Ae.prototype),ue(Ae.prototype,"subscribeDataChannel",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"subscribeDataChannel"),Ae.prototype),ue(Ae.prototype,"subscribe",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"subscribe"),Ae.prototype),ue(Ae.prototype,"massSubscribe",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"massSubscribe"),Ae.prototype),ue(Ae.prototype,"unsubscribe",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"unsubscribe"),Ae.prototype),ue(Ae.prototype,"unsubscribeDataChannel",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"unsubscribeDataChannel"),Ae.prototype),ue(Ae.prototype,"massUnsubscribe",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"massUnsubscribe"),Ae.prototype),ue(Ae.prototype,"muteRemote",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"muteRemote"),Ae.prototype),ue(Ae.prototype,"unmuteRemote",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"unmuteRemote"),Ae.prototype),ue(Ae.prototype,"hasRemoteMediaWithLock",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"hasRemoteMediaWithLock"),Ae.prototype),ue(Ae.prototype,"disconnectForReconnect",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"disconnectForReconnect"),Ae.prototype),ue(Ae.prototype,"updateBitrateLimit",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"updateBitrateLimit"),Ae.prototype),ue(Ae.prototype,"remoteMediaSsrcChanged",[Kn],Object.getOwnPropertyDescriptor(Ae.prototype,"remoteMediaSsrcChanged"),Ae.prototype),Ae);function Kn(e,t,n){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=function(){return P(this,arguments,function*(){let o=this.mutex,c=yield o.lock("From P2PChannel.".concat(t));try{for(var d=arguments.length,l=new Array(d),h=0;h<d;h++)l[h]=arguments[h];return yield r.apply(this,l)}finally{c()}})},n}function lF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function hF(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?lF(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lF(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Dte=Date.now(),EI=new Map,zg=new Map;function pF(e){return P(this,null,function*(){let t=EI.get(e),n=Array.isArray(t)&&t[t.length-1],r=zg.get(e);if(!n)return void(r.isSyncing=!1);let o={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);let c=n.sendTs-r.firstSendTs,d=c-(Date.now()-r.firstRecvTs);d>0&&(r.firstRecvTs=Date.now()-c);let l=n.mediaDelay+d;l<=0?(t.pop(),fF(n.context,o),l=0):l=Math.min(l,20),setTimeout(()=>t.length&&pF(e),l)})}function fF(e,t){e.safeEmit(Oe.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function Ote(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return fF(n,{uid:e.uid,payload:e.payload});let r="".concat(n.id,"-").concat(e.uid),o=EI.get(r)||[],c=o.findIndex(f=>e.sendTs>=f.sendTs),d=hF(hF({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});c===-1?o.push(d):o.splice(c,0,d),EI.set(r,o);let l=!1;var h;zg.has(r)?l=!((h=zg.get(r))===null||h===void 0||!h.isSyncing):zg.set(r,{isSyncing:l,firstRecvTs:0,firstSendTs:0}),l||pF(r)}let Nte=Be().name;function mF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function gF(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?mF(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mF(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Eu="websdk_ng_cache_parameter",Pte=M("MAX_PRELOAD_ASYNC_LENGTH"),Cc=new Map,Ic=[],_I=null,vI=0,yI=0,Yg=new Map,Mte=function(e,t){let n=[],r=0,o=()=>P(this,null,function*(){let c=n.shift();c&&(yield c()),n.length>0&&r<t?o():r--});return function(){return P(this,arguments,function*(){for(var c=arguments.length,d=new Array(c),l=0;l<c;l++)d[l]=arguments[l];return new ie((h,f)=>P(this,null,function*(){n.push(()=>P(this,null,function*(){try{let m=yield e(...d);h(m)}catch(m){f(m)}})),r<t&&(r++,o())}))})}}(EF,Pte),TI=pr.CancelToken.source();function EF(e,t,n,r,o,c){return P(this,null,function*(){try{if(!M("ENABLE_PRELOAD"))return;if(!He().supportWebCrypto)return void ca(()=>{T.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new K(D.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Tn(n,"token",1,2047),Tn(e,"appid",1,2047),Ig(t),r&&Rg(r);let d=dc();T.debug("preload channel ".concat(t,", uid is ").concat(r));let l={appId:e,cname:t,token:n||e,uid:typeof r!="string"?r:null,sid:d,proxyServer:o},h,f;typeof r=="string"?(l.stringUid=r,[f,h]=yield ie.all([gte(r,{sid:d,appId:e},TI.token),VU(gF(gF({},l),{},{token:n||e,uid:0}),TI.token)]),l.uid=f.uid,h.gatewayInfo.uid=l.uid,h.gatewayInfo.res.uid=l.uid):(c&&(l.stringUid=c),h=yield VU(l,TI.token));let m={sid:d,appId:e,cname:t,token:n||e,uid:l.stringUid||r,intUid:l.uid||h.gatewayInfo.uid,stringUid:l.stringUid,ts:Date.now(),sua:f,ap:h};yield function(E){return P(this,null,function*(){let _;try{E.uid&&vF({appId:E.appId,cname:E.cname,token:E.token,uid:E.uid,stringUid:E.stringUid});let v=CF(E),A=yield function(I,O){return P(this,null,function*(){try{let N=yield window.crypto.subtle.importKey("raw",mL(O),"AES-GCM",!1,["encrypt"]),x=yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},N,cc(window.btoa(JSON.stringify(I))));return da(new Uint8Array(x))}catch{return}})}(E,E.token||E.appId);if(!A)return;_=SF(Eu);let C=_?JSON.parse(_):[];C.push({[v]:A}),C.length>M("AP_CACHE_NUM")&&C.shift(),$g(Eu,JSON.stringify(C))}catch(v){T.warn("Error caching server parameters:",v.message),$g(Eu,"")}})}(m),vI++}catch(d){throw yI++,function(l){_I||(_I=window.setTimeout(()=>{let f="";Yg.forEach((m,E)=>{f+="".concat(E,": ").concat(m," ;")}),he.reportApiInvoke(null,{name:tn.PRELOAD,options:{success:vI,failed:yI,err:f}}).onError(l),vI=0,yI=0,Yg.clear(),_I=null},1e4));let h=Yg.get(l.code)||0;Yg.set(l.code,h+1)}(d),d}})}function _F(e){return P(this,null,function*(){try{if(M("AP_REQUEST_DETAIL")||M("ENABLE_ROLE_SELECT_EDGE"))return;let t=vF(e);if(!t||e.cloudProxyServer!=="disabled")return;let n=yield function(r,o){return P(this,null,function*(){try{let c=yield window.crypto.subtle.importKey("raw",mL(o),"AES-GCM",!1,["decrypt"]),d=yield window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},c,cc(r));return JSON.parse(window.atob(da(new Uint8Array(d))))}catch{return}})}(t,e.token||e.appId);if(!n||!function(r,o){return r.cname===o.cname&&r.appId===o.appId&&r.token===o.token?o.stringUid?r.stringUid===o.stringUid:typeof o.uid=="number"?r.uid===o.uid:r.uid==o.uid:!1}(n,e))return;if(n&&Date.now()-n.ts<M("AP_CACHE_LIFETIME"))return n}catch(t){T.warn("Error get preloadInfo",t.message)}})}function vF(e){let t;try{if(t=SF(Eu),!t)return;let n=JSON.parse(t),r=CF(e),o=function(d,l){for(let h=d.length-1;h>=0;h--)if(l(d[h]))return h;return-1}(n,d=>r in d);if(o===-1)return;let c=n.splice(o,1)[0];return $g(Eu,JSON.stringify(n)),c[r]}catch(n){T.warn("Error delete preload info: ".concat(t),n.message),$g(Eu,"")}}function SI(e){if(e){let t=Cc.get(e);t&&(window.clearTimeout(t),t=null,Cc.delete(e)),ne(Ic).call(Ic,e)||e.cloudProxyServer!=="disabled"||Ic.push(e)}if(Cc.size<M("AP_CACHE_NUM")&&Ic.length>0){let t=Ic.shift();Cc.set(t,window.setTimeout(()=>P(this,null,function*(){let{appId:n,cname:r,token:o,stringUid:c,uid:d,proxyServer:l}=t;try{yield Mte(n,r,o,d,l,c),Cc.has(t)&&SI(t)}catch(h){T.warn("update preload failed",h.message),yF(t)}}),M("AP_UPDATE_INTERVAL")))}}function yF(e){let t=Ic.indexOf(e);t!==-1&&Ic.splice(t,1);let n=Cc.get(e);n&&(window.clearTimeout(n),n=null,Cc.delete(e),SI())}function TF(e,t){let n=e.sua,r=e.ap;t&&n&&he.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),he.reportResourceTiming(e.ap.url,e.sid),he.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(o=>o.ip).join(","),eventType:"disabled",unilbsServerIds:[Xt.CHOOSE_SERVER,Xt.CLOUD_PROXY_FALLBACK].toString()}),he.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(o=>o.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[Xt.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function SF(e){return window.atob(window.localStorage.getItem(e)||"")}function $g(e,t){window.localStorage.setItem(e,window.btoa(t))}function CF(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),SL(t)}function kte(e){let t=function(){let n=Ute.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let o=n.appId;o!==void 0&&(Zt(r,10),_a(r,o));let c=n.cid;c!==void 0&&(Zt(r,16),Zt(r,c));let d=n.cname;d!==void 0&&(Zt(r,26),_a(r,d));let l=n.deviceId;l!==void 0&&(Zt(r,34),_a(r,l));let h=n.elapse;h!==void 0&&(Zt(r,40),va(r,h));let f=n.fileSize;f!==void 0&&(Zt(r,48),va(r,_u(f)));let m=n.height;m!==void 0&&(Zt(r,56),va(r,_u(m)));let E=n.jpg;E!==void 0&&(Zt(r,66),Zt(r,E.length),RF(r,E));let _=n.networkType;_!==void 0&&(Zt(r,72),va(r,_u(_)));let v=n.osType;v!==void 0&&(Zt(r,80),va(r,_u(v)));let A=n.requestId;A!==void 0&&(Zt(r,90),_a(r,A));let C=n.sdkVersion;C!==void 0&&(Zt(r,98),_a(r,C));let I=n.sequence;I!==void 0&&(Zt(r,104),va(r,_u(I)));let O=n.sid;O!==void 0&&(Zt(r,114),_a(r,O));let N=n.timestamp;N!==void 0&&(Zt(r,120),va(r,N));let x=n.uid;x!==void 0&&(Zt(r,128),Zt(r,x));let B=n.vid;B!==void 0&&(Zt(r,136),Zt(r,B));let j=n.width;j!==void 0&&(Zt(r,144),va(r,_u(j)));let F=n.service;F!==void 0&&(Zt(r,152),Zt(r,F));let W=n.callbackData;W!==void 0&&(Zt(r,162),Zt(r,W.length),RF(r,W));let X=n.ticket;X!==void 0&&(Zt(r,170),_a(r,X));let oe=n.vendorConfigs;oe!==void 0&&(Zt(r,178),_a(r,oe))}(e,t),function(n){let r=n.bytes,o=n.limit;return r.length===o?r:r.subarray(0,o)}(t)}function Lte(e){return function(n){let r={};e:for(;!Fte(n);){let o=Uh(n);switch(o>>>3){case 0:break e;case 1:r.code=Uh(n);break;case 2:r.msg=wF(n,Uh(n));break;case 3:r.requestId=wF(n,Uh(n));break;case 4:r.timestamp=Vte(n,!1);break;default:xte(n,7&o)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function xte(e,t){switch(t){case 0:for(;128&Yi(e););break;case 2:CI(e,Uh(e));break;case 5:CI(e,4);break;case 1:CI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function _u(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Ute=[];function CI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Fte(e){return e.offset>=e.limit}function Xg(e,t){let n=e.bytes,r=e.offset,o=e.limit,c=r+t;if(c>n.length){let d=new Uint8Array(2*c);d.set(n),e.bytes=d}return e.offset=c,c>o&&(e.limit=c),r}function IF(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function RF(e,t){let n=Xg(e,t.length);e.bytes.set(t,n)}function wF(e,t){let n=IF(e,t),r=String.fromCharCode,o=e.bytes,c="\uFFFD",d="";for(let l=0;l<t;l++){let h,f,m,E,_=o[l+n];128&_?(224&_)==192?l+1>=t?d+=c:(h=o[l+n+1],(192&h)!=128?d+=c:(E=(31&_)<<6|63&h,E<128?d+=c:(d+=r(E),l++))):(240&_)==224?l+2>=t?d+=c:(h=o[l+n+1],f=o[l+n+2],(49344&(h|f<<8))!=32896?d+=c:(E=(15&_)<<12|(63&h)<<6|63&f,E<2048||E>=55296&&E<=57343?d+=c:(d+=r(E),l+=2))):(248&_)==240?l+3>=t?d+=c:(h=o[l+n+1],f=o[l+n+2],m=o[l+n+3],(12632256&(h|f<<8|m<<16))!=8421504?d+=c:(E=(7&_)<<18|(63&h)<<12|(63&f)<<6|63&m,E<65536||E>1114111?d+=c:(E-=65536,d+=r(55296+(E>>10),56320+(1023&E)),l+=3))):d+=c:d+=r(_)}return d}function _a(e,t){let n=t.length,r=0;for(let d=0;d<n;d++){let l=t.charCodeAt(d);l>=55296&&l<=56319&&d+1<n&&(l=(l<<10)+t.charCodeAt(++d)-56613888),r+=l<128?1:l<2048?2:l<65536?3:4}Zt(e,r);let o=Xg(e,r),c=e.bytes;for(let d=0;d<n;d++){let l=t.charCodeAt(d);l>=55296&&l<=56319&&d+1<n&&(l=(l<<10)+t.charCodeAt(++d)-56613888),l<128?c[o++]=l:(l<2048?c[o++]=l>>6&31|192:(l<65536?c[o++]=l>>12&15|224:(c[o++]=l>>18&7|240,c[o++]=l>>12&63|128),c[o++]=l>>6&63|128),c[o++]=63&l|128)}}function Yi(e){return e.bytes[IF(e,1)]}function bF(e,t){let n=Xg(e,1);e.bytes[n]=t}function Uh(e){let t,n=0,r=0;do t=Yi(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Zt(e,t){for(t>>>=0;t>=128;)bF(e,127&t|128),t>>>=7;bF(e,t)}function Vte(e,t){let n,r=0,o=0,c=0;return n=Yi(e),r=127&n,128&n&&(n=Yi(e),r|=(127&n)<<7,128&n&&(n=Yi(e),r|=(127&n)<<14,128&n&&(n=Yi(e),r|=(127&n)<<21,128&n&&(n=Yi(e),o=127&n,128&n&&(n=Yi(e),o|=(127&n)<<7,128&n&&(n=Yi(e),o|=(127&n)<<14,128&n&&(n=Yi(e),o|=(127&n)<<21,128&n&&(n=Yi(e),c=127&n,128&n&&(n=Yi(e),c|=(127&n)<<7))))))))),{low:r|o<<28,high:o>>>4|c<<24,unsigned:t}}function va(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,c=o===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:o<128?9:10,d=Xg(e,c),l=e.bytes;switch(c){case 10:l[d+9]=o>>>7&1;case 9:l[d+8]=c!==9?128|o:127&o;case 8:l[d+7]=c!==8?r>>>21|128:r>>>21&127;case 7:l[d+6]=c!==7?r>>>14|128:r>>>14&127;case 6:l[d+5]=c!==6?r>>>7|128:r>>>7&127;case 5:l[d+4]=c!==5?128|r:127&r;case 4:l[d+3]=c!==4?n>>>21|128:n>>>21&127;case 3:l[d+2]=c!==3?n>>>14|128:n>>>14&127;case 2:l[d+1]=c!==2?n>>>7|128:n>>>7&127;case 1:l[d]=c!==1?128|n:127&n}}let AF={},DF={},OF=4294967296,NF=18446744073709552e3,PF=NF/2,II=kF(0,!0),MF=kF(0),jte=vu(0,-2147483648,!1),Bte=vu(-1,2147483647,!1),Hte=vu(-1,-1,!0);function kF(e,t){let n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=DF[e],r)?r:(n=vu(e,0,!0),o&&(DF[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=AF[e],r)?r:(n=vu(e,e<0?-1:0,!1),o&&(AF[e]=n),n)}function vu(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function LF(e,t){if(isNaN(e))return t?II:MF;if(t){if(e<0)return II;if(e>=NF)return Hte}else{if(e<=-PF)return jte;if(e+1>=PF)return Bte}return e<0?t?II:MF:vu(e%OF|0,e/OF|0,t)}function xF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}class RI extends Dt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let n=this._connectionState;this._connectionState=t,this.emit(To.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),b(this,"name","AgoraRTCImageModeration"),b(this,"_connectionState",fi.CONNECTING),b(this,"_sequence",0),b(this,"_moderationStartTime",void 0),b(this,"_workerConnection",void 0),b(this,"_workerMessageLengthLimit",void 0),b(this,"_qualityRatio",void 0),b(this,"_connectInfo",void 0),b(this,"_cancelTokenSource",pr.CancelToken.source()),b(this,"_retryConfig",void 0),b(this,"_moderationInterval",void 0),b(this,"_moderationTimer",null),b(this,"_moderationMode",1),b(this,"_quality",1),b(this,"_qualityTimer",null),b(this,"_ticket",void 0),b(this,"_moderationIntervalMinimum",void 0),b(this,"_uploadFailedNum",0),b(this,"_uploadNum",0),b(this,"_uploadTimer",null),b(this,"_extraInfo",void 0),b(this,"_vendor",""),b(this,"_encoder",new TextEncoder),b(this,"_moderationId",void 0),b(this,"inspectImage",()=>{if(this.connectionState!==fi.CONNECTED)throw new G(D.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===fi.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ht(5,"image-moderation-"),this._workerMessageLengthLimit=M("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=M("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=M("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Ah("worker-"+this._moderationId,nn),this.on(To.STATE_CHANGE,(r,o)=>{T.debug("[".concat(this._moderationId,"] Moderation operation :").concat(su[r]," ").concat(o||""))}),this.handleWorkerEvents()}init(t,n){return P(this,null,function*(){this.emit(To.STATE_CHANGE,su.CONNECT_AP),this._connectInfo=t;let r=this._cancelTokenSource.token;return this._retryConfig=n,new ie((o,c)=>{this.on(To.CONNECTION_STATE_CHANGE,(d,l)=>{d===fi.CONNECTED&&o()}),this.requestAP(t,r,n).then(d=>{this.connectWorker(d)}).catch(d=>{c(d)})})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),T.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===fi.CONNECTED&&this.inspectImage()}requestAP(t,n,r){return P(this,null,function*(){let o=M("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),c=yield function(h,f,m,E){let{appId:_,areaCode:v,cname:A,sid:C,token:I,uid:O}=f;pu++;let N="moderation_plugin",x={service_name:N,json_body:JSON.stringify({appId:_,areaCode:v,cname:A,command:"allocateEdge",requestId:pu,seq:pu,sid:C,appToken:I,ts:Date.now(),uid:O+""})},B,j,F=h[0];return Eo(()=>P(this,null,function*(){B=Date.now();let W=yield So(F,{data:x,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(j=Date.now()-B,W.code!==0){let te=new G(D.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+W.code,{retry:!0,responseTime:j});throw T.error(te.toString()),te}let X=JSON.parse(W.json_body);if(X.code!==200){let te=new G(D.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(X.code,", reason: ").concat(X.reason),{code:X.code,responseTime:j});throw T.error(te.toString()),te}if(!X.servers||!Array.isArray(X.servers)||X.servers.length===0){let te=new G(D.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:X.code,responseTime:j});throw T.error(te.toString()),te}if(!X.servers.some(te=>!!te.wss)){let te=new G(D.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:X.code,responseTime:j});throw T.error(te.toString()),te}let oe=M("IMAGE_MODERATION_WORKER_HOST");return{addressList:X.servers.map(te=>{let{address:Me,wss:ke}=te;if(Me&&ke)return"wss://".concat(Me.replace(/\./g,"-"),".").concat(oe,":").concat(ke,"/moderation")}).filter(te=>!!te),workerToken:X.workerToken,vid:X.vid,ticket:X.appTicket,responseTime:j}}),(W,X)=>(he.apworkerEvent(C,{success:!0,sc:200,serviceName:N,responseDetail:JSON.stringify(W.addressList),firstSuccess:X===0,responseTime:j,serverIp:h[X%h.length]}),!1),(W,X)=>(he.apworkerEvent(C,{success:!1,sc:W.data&&W.data.code||200,serviceName:N,responseTime:j,serverIp:h[X%h.length]}),!!(W.code!==D.OPERATION_ABORTED&&W.code!==D.UNEXPECTED_RESPONSE||W.data&&W.data.retry)&&(F=h[(X+1)%h.length],!0)),E)}(o,t,n,r);this.emit(To.STATE_CHANGE,su.AP_CONNECTED);let{addressList:d,ticket:l}=c;return this._ticket=l,d})}connectWorker(t){return P(this,null,function*(){this.emit(To.STATE_CHANGE,su.CONNECT_WORKER),yield this._workerConnection.init(t,1e4)})}handleWorkerEvents(){this._workerConnection.on(Re.CONNECTED,()=>P(this,null,function*(){this.emit(To.STATE_CHANGE,su.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=fi.CONNECTED})),this._workerConnection.on(Re.CLOSED,()=>{this.connectionState=fi.CLOSED}),this._workerConnection.on(Re.FAILED,()=>{this.connectionState=fi.CLOSED}),this._workerConnection.on(Re.RECONNECTING,()=>{this.connectionState=this.connectionState===fi.CONNECTED?fi.RECONNECTING:fi.CONNECTING}),this._workerConnection.on(Re.ON_MESSAGE,t=>P(this,null,function*(){if(t.data instanceof ArrayBuffer){let n=Lte(new Uint8Array(t.data));M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,T.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{he.reportApiInvoke(this._connectInfo.sid||null,{name:tn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:kt.TRACER}).onError(new G(D.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},M("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else T.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(Re.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this._workerConnection.on(Re.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}requestToInspectImage(){return P(this,null,function*(){let t=qr(this,To.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being played can be inspected"));this._sequence++;let r=yield this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being published can be inspected")})}generateRequestData(t,n){return P(this,null,function*(){let{appId:r,cname:o,cid:c,vid:d,sid:l,uid:h}=n,f=Date.now(),m=yield t.getCurrentFrameImage("image/jpeg",this.quality),E=yield d1(m,r,o),_=this._sequence+"-"+c+"-"+h+"-"+f+"-"+ht(12,""),v={appId:r,cid:c,cname:o,deviceId:"",elapse:RI.intToLong(Number(f-this._moderationStartTime)),fileSize:m.buffer.byteLength,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:_,sdkVersion:"4.23.1",sequence:this._sequence,sid:l,timestamp:LF(f),uid:h,vid:d,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete v.callbackData;let A=kte(v);if(A.byteLength<this._workerMessageLengthLimit){if(M("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let C=function(I){for(var O=1;O<arguments.length;O++){var N=arguments[O]!=null?arguments[O]:{};O%2?xF(Object(N),!0).forEach(function(x){b(I,x,N[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(N)):xF(Object(N)).forEach(function(x){Object.defineProperty(I,x,Object.getOwnPropertyDescriptor(N,x))})}return I}({},v);delete C.jpg,T.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(C))}return A}{let C=this.quality*this._qualityRatio;return this.quality=C,yield this.generateRequestData(t,{appId:r,cname:o,cid:c,vid:d,sid:l,uid:h})}})}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=pr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=fi.CLOSED,this.emit(To.STATE_CHANGE,su.CLOSED)}}function UF(e){if(st(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new G(D.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new G(D.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}let Gte={name:"ImageModeration",create:function(e){let{config:t}=e;return UF(t),new RI(t)}};var FF,VF,jF,BF,HF,GF,WF,KF,qF,zF,YF,$F,XF,JF,QF,ZF,eV,tV,nV,rV,iV,oV,sV,aV,cV,dV,uV,lV,hV,pV,fV,mV,gV,EV,_V,vV,yV,TV,SV,CV,IV,se;function RV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function $i(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?RV(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}kn.setLogger(T);let Wte=(FF=Ee(),VF=Ee({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Jd))return[t];t=[t]}return t.map(n=>n?Object(n).toString():"null")}}),jF=Ee({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==Xd.DATA?(Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId())):[t.getChannelId()])}),BF=Ee({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),HF=Ee({argsMap:(e,t,n)=>[t,n]}),GF=Ee({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:o}=n;return[r?.uid,o]})}),WF=Ee({argsMap:(e,t,n,r)=>[typeof t=="object"?t.uid:t,n,r]}),KF=Ee({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:o}=n;return{uid:r?.uid,mediaType:o}})}),qF=Ee(),zF=Ee(),YF=Ee(),$F=Ee(),XF=Ee(),JF=Ee(),QF=Ee(),ZF=Ee(),eV=Ee(),tV=Ee(),nV=Ee(),rV=Ee(),iV=Ee(),oV=Ee(),sV=Ee(),aV=Ee({argsMap:(e,t)=>[t]}),cV=Ee(),dV=Ee(),uV=Ee(),lV=Ee(),hV=Ee(),pV=Ee(),fV=Ee(),mV=Ee(),gV=Ee({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),EV=Ee(),_V=Ee(),vV=Ee(),yV=Ee(),TV=Ee(),SV=Ee(),CV=Ee({reportResult:!0}),IV=Ee(),se=class extends Dt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),b(this,"store",void 0),b(this,"_uid",void 0),b(this,"_channelName",void 0),b(this,"_uintUid",void 0),b(this,"_users",[]),b(this,"_config",void 0),b(this,"_clientId",void 0),b(this,"_appId",void 0),b(this,"_sessionId",null),b(this,"_key",void 0),b(this,"_rtmConfig",{}),b(this,"_joinInfo",void 0),b(this,"_gateway",void 0),b(this,"_statsCollector",void 0),b(this,"_configDistribute",void 0),b(this,"_leaveMutex",void 0),b(this,"_publishMutex",void 0),b(this,"_renewTokenMutex",void 0),b(this,"_subscribeMutex",void 0),b(this,"_encryptionMode","none"),b(this,"_encryptionSecret",null),b(this,"_encryptionSalt",null),b(this,"_encryptDataStream",!1),b(this,"_encryptDataStreamKey",null),b(this,"_encryptDataStreamIv",null),b(this,"_proxyServer",void 0),b(this,"_turnServer",{servers:[],mode:"auto"}),b(this,"_cloudProxyServerMode","disabled"),b(this,"_isDualStreamEnabled",!1),b(this,"_defaultStreamFallbackType",void 0),b(this,"_lowStreamParameter",void 0),b(this,"_streamFallbackTypeCacheMap",new Map),b(this,"_remoteStreamTypeCacheMap",new Map),b(this,"_axiosCancelSource",pr.CancelToken.source()),b(this,"_audioVolumeIndicationInterval",void 0),b(this,"_networkQualityInterval",void 0),b(this,"_userOfflineTimeout",void 0),b(this,"_streamRemovedTimeout",void 0),b(this,"_liveTranscodeStreamingClient",void 0),b(this,"_liveRawStreamingClient",void 0),b(this,"_channelMediaRelayClient",void 0),b(this,"_networkQualitySensitivity","normal"),b(this,"_p2pChannel",void 0),b(this,"_useLocalAccessPoint",!1),b(this,"_setLocalAPVersion",void 0),b(this,"_joinAndNotLeaveYet",!1),b(this,"_numberOfJoinCount",0),b(this,"_remoteDefaultVideoStreamType",void 0),b(this,"_inspect",void 0),b(this,"_moderation",void 0),b(this,"_license",void 0),b(this,"_pendingPublishedUsers",[]),b(this,"ntpAlignErrorCount",0),b(this,"remoteInboundOffset",0),b(this,"_peerConnectionState",void 0),b(this,"_handleLocalTrackEnable",(o,c,d)=>{this.publish(o,!1).then(c).catch(d)}),b(this,"_handleLocalTrackDisable",(o,c,d)=>{this.unpublish(o).then(c).catch(d)}),b(this,"_handleUserOnline",o=>{if(M("BLOCK_LOCAL_CLIENT")&&Ec(o.uid,this.channelName))return void T.debug("[".concat(o.uid,"] will be ignored in local"));this.isStringUID&&typeof o.uid!="string"&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let c=this._users.find(d=>d.uid===o.uid);if(c)c._trust_in_room_=!0,c._is_pre_created&&(c._is_pre_created=!1,this.safeEmit(Oe.USER_JOINED,c));else{let d=new ga(o.uid,o.uint_id||o.uid);this._users.push(d),T.debug("[".concat(this._clientId,"] user online"),o.uid),this.safeEmit(Oe.USER_JOINED,d)}}),b(this,"_handleUserOffline",o=>{if(M("BLOCK_LOCAL_CLIENT")&&Ec(o.uid,this.channelName))return;let c=this._users.find(d=>d.uid===o.uid);c&&(this._handleRemoveStream(o),this._handleRemoveDataChannels(o),c._audio_pre_subscribed||c._video_pre_subscribed?c._is_pre_created=!0:Qm(this._users,c),this._remoteStreamTypeCacheMap.delete(c.uid),this._streamFallbackTypeCacheMap.delete(c.uid),T.debug("[".concat(this._clientId,"] user offline"),o.uid,"reason:",o.reason),this.safeEmit(Oe.USER_LEAVED,c,o.reason))}),b(this,"_handleAddAudioOrVideoStream",(o,c,d,l,h,f,m)=>{if(M("BLOCK_LOCAL_CLIENT")&&Ec(c,this.channelName))return;let E=this._users.find(v=>v.uid===c);if(!E)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(c,", type ").concat(o)),this.store.subscribe(E.uid,o,void 0,void 0,void 0,Date.now());let _=o==="audio"?E.hasAudio:E.hasVideo;E._uintid||(E._uintid=h||c),o==="audio"?E._trust_audio_stream_added_state_=!0:E._trust_video_stream_added_state_=!0,o==="audio"?(E._audio_added_=!0,d!==void 0&&(E._audioSSRC=d),l!==void 0&&(E._cname=l),f&&(E._audioOrtc=f)):(E._video_added_=!0,d!==void 0&&(E._videoSSRC=d),l!==void 0&&(E._cname=l),m!==void 0&&(E._rtxSsrcId=m),f&&(E._videoOrtc=f)),(o==="audio"?E.hasAudio:E.hasVideo)&&!_&&(T.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published ").concat(o)),this.safeEmit(Oe.USER_PUBLISHED,E,o)),o==="video"?he.onGatewayStream(this._sessionId,hn.ON_ADD_VIDEO_STREAM,Rt.ON_ADD_VIDEO_STREAM,{peer:h||c,ssrc:E._videoSSRC}):he.onGatewayStream(this._sessionId,hn.ON_ADD_AUDIO_STREAM,Rt.ON_ADD_AUDIO_STREAM,{peer:h||c,ssrc:E._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(E,o,d).then(v=>{if(v&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(E.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof xh))return this._p2pChannel.unsubscribe(E,o,!0).then(()=>this._subscribe(E,o,!0).catch(A=>{T.error("[".concat(this._clientId,"] resubscribe error"),A.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(E,o)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(E.uid," after reconnect.")),this._subscribe(E,o,!0).catch(v=>{T.error("[".concat(this._clientId,"] resubscribe error"),v.toString())}))}),b(this,"_handleRemoveStream",o=>{if(M("BLOCK_LOCAL_CLIENT")&&Ec(o.uid,this.channelName))return;let c=this._users.find(l=>l.uid===o.uid);if(!c)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(o.uid));let d=()=>{};c.hasAudio&&c.hasVideo?d=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished audio track")),this.safeEmit(Oe.USER_UNPUBLISHED,c,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished video track")),this.safeEmit(Oe.USER_UNPUBLISHED,c,"video")}:c.hasVideo?d=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished video track")),this.safeEmit(Oe.USER_UNPUBLISHED,c,"video")}:c.hasAudio&&(d=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(c.uid," unpublished audio track")),this.safeEmit(Oe.USER_UNPUBLISHED,c,"audio")}),c._video_pre_subscribed||c._audio_pre_subscribed||(c._trust_audio_stream_added_state_=!0,c._trust_video_stream_added_state_=!0,c._audio_added_=!1,c._video_added_=!1,this._p2pChannel instanceof xh&&this._p2pChannel.unsubscribe(c).then(l=>{if(l)return this._gateway.unsubscribe(l,c.uid)}),c._audioSSRC=void 0,c._videoSSRC=void 0,c._audioOrtc=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),he.onGatewayStream(this._sessionId,hn.ON_REMOVE_STREAM,Rt.ON_REMOVE_STREAM,{peer:o.uint_id||o.uid}),d()}),b(this,"_handleSetStreamLocalEnable",(o,c,d)=>{if(M("BLOCK_LOCAL_CLIENT")&&Ec(c,this.channelName))return;let l=this._users.find(m=>m.uid===c);if(!l)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(o," ").concat(d?"enabled":"disabled"," with uid ").concat(c));let h=o==="audio"?l.hasAudio:l.hasVideo;if(o==="audio"){l._trust_audio_enabled_state_=!0;let m=l._audio_enabled_;if(l._audio_enabled_=d,l._audio_enabled_===m)return;{let E=l._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(c,", msg: ").concat(E)),this.safeEmit(Oe.USER_INFO_UPDATED,c,E)}}else{l._trust_video_enabled_state_=!0;let m=l._video_enabled_;if(l._video_enabled_=d,l._video_enabled_===m)return;{let E=l._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(E)),this.safeEmit(Oe.USER_INFO_UPDATED,c,E)}}let f=o==="audio"?l.hasAudio:l.hasVideo;return h!==f?!h&&f?(T.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(o)),void this.safeEmit(Oe.USER_PUBLISHED,l,o)):(o==="video"&&l._videoTrack&&l._videoTrack._destroy(),o==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,o),T.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(o)),void this.safeEmit(Oe.USER_UNPUBLISHED,l,o)):void 0}),b(this,"_handleMuteStream",(o,c,d)=>{if(M("BLOCK_LOCAL_CLIENT")&&Ec(o,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),o,c,d);let l=this._users.find(m=>m.uid===o);if(!l)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o));let h=c==="audio"?l.hasAudio:l.hasVideo;if(c==="audio"){l._trust_audio_mute_state_=!0;let m=l._audio_muted_;if(l._audio_muted_=d,l._audio_muted_===m)return;{let E=l._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(E)),this.safeEmit(Oe.USER_INFO_UPDATED,o,E)}}else{l._trust_video_mute_state_=!0;let m=l._video_muted_;if(l._video_muted_=d,l._video_muted_===m)return;{let E=l._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(E)),this.safeEmit(Oe.USER_INFO_UPDATED,o,E)}}let f=c==="audio"?l.hasAudio:l.hasVideo;if(h!==f){if(!h&&f)return(c==="audio"?l._audioSSRC:l._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(c)),void this.safeEmit(Oe.USER_PUBLISHED,l,c)):void T.warning("[".concat(this._clientId,"] remote user ").concat(o," receive ").concat(c," unmute message  before add stream message, ").concat(c," SSRC doesn't exist yet."));c==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),c==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,c),T.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(c)),this.safeEmit(Oe.USER_UNPUBLISHED,l,c)}}),b(this,"_handleP2PLost",o=>P(this,null,function*(){T.debug("[".concat(this._clientId,"] receive p2p lost"),o),parseInt(o.p2pid,10)===this.store.p2pId?yield this._p2pChannel.requestReconnect():T.warning("[".concat(this._clientId,"] P2PLost stream not found"),o)})),b(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Oe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),b(this,"_handleBeforeUnload",o=>{o.type==="beforeunload"&&o.returnValue!==void 0&&o.returnValue!==""||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),b(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Oe.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let o={downlinkNetworkQuality:0,uplinkNetworkQuality:0};o.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),o.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Oe.NETWORK_QUALITY,o)}),b(this,"_handleP2PAddAudioOrVideoStream",(o,c,d,l)=>{let h=this._users.find(m=>m.uid===c);if(!h)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(c,", type ").concat(o)),this.store.subscribe(h.uid,o,void 0,void 0,void 0,Date.now());let f=o==="audio"?h.hasAudio:h.hasVideo;o==="audio"?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,o==="audio"?(h._audio_added_=!0,d!==void 0&&(h._audioSSRC=d),l!==void 0&&(h._audioMid=l)):(h._video_added_=!0,d!==void 0&&(h._videoSSRC=d),l!==void 0&&(h._videoMid=l)),(o==="audio"?h.hasAudio:h.hasVideo)&&!f&&(T.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(o)),this.safeEmit(Oe.USER_PUBLISHED,h,o)),this._p2pChannel.hasPendingRemoteMedia(h,o)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(o," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,o,!0).catch(m=>{T.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=e,this._clientId=t||ht(5,"client-"),this.store=new FZ(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new kn("client-leave",this._clientId),this._publishMutex=new kn("client-publish",this._clientId),this._renewTokenMutex=new kn("client-renewtoken",this._clientId),this._subscribeMutex=new kn("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(li," build: ").concat(EC,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{iC(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(o){T.warning("[".concat(this._clientId,"] ").concat(o.toString()))}var r;this._statsCollector=new kh(this.store),this._statsCollector.onStatsException=(o,c,d)=>{T.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(o,", msg: ").concat(c,", uid: ").concat(d)),this.safeEmit(Oe.EXCEPTION,{code:o,msg:c,uid:d})},this._statsCollector.onUploadPublishDuration=(o,c,d,l)=>{let h=this._users.find(f=>f.uid===o);h&&he.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:c,videoPublishDuration:d,peer:h._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new lte(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||nn,httpRetryConfig:e.httpRetryConfig||nn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new yte(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(r={store:this.store,statsCollector:this._statsCollector},ma("P2PChannel").create(r)),this._handleP2PEvents()):this._p2pChannel=new xh(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(c,d,l,h,f){return P(this,arguments,function*(e,t,n,r,o){let m=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],E=arguments.length>6&&arguments[6]!==void 0&&arguments[6];nt("JOIN_GATEWAY_USE_443PORT_ONLY",m),nt("JOIN_GATEWAY_USE_DUAL_DOMAIN",E);let _=this._gateway.signal.websocket;return _ instanceof $C&&(_.use443PortOnly=m,_.tryDoubleDomain=E),function(I,O,N){return P(this,arguments,function*(v,A,C){zm.get(v)||zm.set(v,[]),Ym.get(v)||Ym.set(v,A),Wo.get(v)||Wo.set(v,0);let x=zm.get(v),B=Ym.get(v);if(!x||!B)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Wo.get(v)===B){let oe=ph();x.push(oe),yield oe.promise}Wo.set(v,Wo.get(v)+1);for(var j=arguments.length,F=new Array(j>3?j-3:0),W=3;W<j;W++)F[W-3]=arguments[W];let X=yield C(...F);return Wo.set(v,Wo.get(v)-1),Wo.get(v)===B-1&&x.length>0&&(x[0].resolve(),x.shift()),Wo.get(v)===0&&(zm.set(v,[]),Ym.set(v,0),Wo.set(v,0)),X})}("client.join",M("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,o)})}join(e,t,n,r,o){return P(this,null,function*(){let c=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);let d=(tg||tg||(tg=(window.location.protocol.split(":")[0]||"").toUpperCase(),tg))==="HTTPS",l=RL()?window.isSecureContext:"Browser Not Support";(!RL()&&!d||!window.isSecureContext)&&T.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),T.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),he.setAppId(e);try{if(!n&&n!==null)throw new G(D.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Tn(n,"token",1,2047),Tn(e,"appid",1,2047),Ig(t),r&&Rg(r),o&&Tn(o,"optionalInfo",1,2047)}catch(C){throw he.reportApiInvoke(dc(),{name:tn.JOIN,options:[e,t,n,r],states:{isHttps:d,isSecureContext:l},tag:kt.TRACER}).onError(C),C}if(this._leaveMutex.isLocked&&(T.debug("[".concat(this._clientId,"] join: waiting leave operation")),(yield this._leaveMutex.lock())(),T.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let C=new G(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw he.reportApiInvoke(dc(),{name:tn.JOIN,options:[e,t,n,r],states:{isHttps:d,isSecureContext:l},tag:kt.TRACER}).onError(C),C}this._gateway.state="CONNECTING";let h=yield _F({appId:e,cname:t,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new G(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let f=h?.sid||dc();T.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(c)),this._sessionId||(this._sessionId=f,this.store.sessionId=this._sessionId);let m=he.reportApiInvoke(f,{id:this._clientId,name:tn.JOIN,options:[e,t,n,r],states:{isHttps:d,isSecureContext:l},tag:kt.TRACER}),E=$i($i($i({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:o,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!h},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:M("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(E.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(E.stringUid=r,this._uintUid?(E.uid=this._uintUid,this._uintUid=void 0):E.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(E.aesmode=this._encryptionMode,E.aespassword=yield(C=>P(this,null,function*(){let I=function(){let B=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),j=new Uint8Array(new ArrayBuffer(B.length));for(let F=0;F<B.length;F+=1)j[F]=B.charCodeAt(F);return j}(),O=yield window.crypto.subtle.importKey("spki",I,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),N=nC(C),x=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},O,N);return function(B){let j="";for(let F=0;F<B.length;F+=1)j+=String.fromCharCode(B[F]);return window.btoa(j)}(new Uint8Array(x))}))(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new G(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(E.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let C=new TextEncoder,I=M("USE_PURE_ENCRYPTION_MASTER_KEY")?C.encode(E.appId+this._encryptionSecret+this._encryptionSecret):C.encode(E.appId+E.cname+this._encryptionSecret);this._encryptDataStreamIv=yield function(O,N,x){return P(this,null,function*(){let B=yield window.crypto.subtle.importKey("raw",N,"PBKDF2",!1,["deriveBits","deriveKey"]),j=O==="aes-128-gcm2"?128:256,F=yield window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:x},B,j+96);return new Uint8Array(F).subarray(j/8)})}(this._encryptionMode,I,cc(this._encryptionSalt)),this._encryptDataStreamKey=yield function(O,N,x){return P(this,null,function*(){let B=yield window.crypto.subtle.importKey("raw",N,"PBKDF2",!1,["deriveBits","deriveKey"]),j=O==="aes-128-gcm2"?128:256;return yield window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:1e3,hash:"SHA-256",salt:x},B,{name:"AES-GCM",length:j},!0,["encrypt","decrypt"])})}(this._encryptionMode,I,cc(this._encryptionSalt))}else l?T.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):T.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,T.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:E.stringUid});let _=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&_===this._sessionId&&he.joinChannelTimeout(this._sessionId,5)},5e3);try{var v;let C,I=E.cloudProxyServer;if(ne(v=["proxy3","proxy4","proxy5"]).call(v,I)){let j=M("PROXY_SERVER_TYPE3");Array.isArray(j)?E.proxyServer=j[0]:E.proxyServer=j}if(he.setProxyServer(E.proxyServer),T.setProxyServer(E.proxyServer),this.store.requestAPStart(),h){if(T.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(E.stringUid?", ".concat(E.stringUid," => ").concat(h.intUid):""," ")),E.stringUid&&!E.uid&&(E.uid=h.intUid),C={gatewayInfo:h.ap.gatewayInfo},M("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&E.turnServer.mode==="auto")if(h.ap.proxyInfo.addresses.length===0)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let j=(yield uU(h.ap.proxyInfo,h.ap.gatewayInfo.uid)).map(F=>({turnServerURL:F.address,tcpport:F.tcpport||Dn.tcpport,udpport:F.udpport||Dn.udpport,username:F.username||Dn.username,password:F.password||Dn.password,forceturn:!1,security:!0}));E.turnServer={mode:"manual",servers:j}}TF(h,E.stringUid)}else{if(E.stringUid&&!E.uid){let j;[j,C]=yield ie.all([FU(E.stringUid,E,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,this.store),UU(E,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,!0,this.store)]),T.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(E.stringUid," => ").concat(j)),E.uid=j,C.gatewayInfo.uid=j,C.gatewayInfo.res.uid=j}else C=yield UU(E,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new G(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(E,this._axiosCancelSource.token),this._configDistribute.on(wh.UPDATE_BITRATE_LIMIT,j=>{this._p2pChannel.updateBitrateLimit(j)}),this._configDistribute.on(wh.UPDATE_CLIENT_ROLE_OPTIONS,j=>{this._setClientRoleOptions(j)})},0),this._key=n||e;let O=C.gatewayInfo,N=E.uid?E.uid:O.uid;this._joinInfo=$i($i({},E),{},{cid:O.cid,uid:N,vid:O.vid,apResponse:O.res,apGatewayAddress:O.apGatewayAddress,uni_lbs_ip:O.uni_lbs_ip,gatewayAddrs:O.gatewayAddrs}),this.store.intUid=N,this.store.cid=O.cid;let x=yield this._joinGateway();if(!this._joinAndNotLeaveYet)throw new G(D.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));m.onSuccess(x),this._appId=e,this._channelName=E.cname,this._uid=x,this.store.uid=x,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(wn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let B=E.stringUid?"string uid: ".concat(E.stringUid,",uid: ").concat(E.uid):"uid: ".concat(this._uid);return T.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(B)),setTimeout(()=>{T.startUpload()},5e3),this.store.joinEnd(),A=this,ne(gc).call(gc,A)||gc.push(A),this._cloudProxyServerMode==="disabled"&&He().supportWebCrypto&&M("ENABLE_PRELOAD")&&SI(this._joinInfo),x}catch(C){let I=Array.isArray(C)?C[0]:C;throw I&&I.code===D.OPERATION_ABORTED?T.warning("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),I):T.error("[".concat(this._clientId,"] join number: ").concat(c,", Joining channel failed, rollback"),I),I.code!==D.OPERATION_ABORTED&&this._numberOfJoinCount===c&&(this._gateway.state="DISCONNECTED",this._reset()),m.onError(I),I}var A})}_joinGateway(){if(!this._joinInfo||!this._key)throw new G(D.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!M("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}leave(){return P(this,null,function*(){T.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(wn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){let n=gc.indexOf(t);n!==-1&&gc.splice(n,1)}(this),this._statsCollector.stopUpdateStats();let e=yield this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return T.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();yield this._gateway.leave(this.connectionState!=="CONNECTED",Ye.LEAVE),T.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()})}publish(t){return P(this,arguments,function*(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Jd))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new G(D.INVALID_PARAMS,"param list is empty");let r=e;if(this._gateway.role==="audience")throw new G(D.INVALID_OPERATION,"audience can not publish stream");for(let c of r){if(!(c instanceof Jd))throw new G(D.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&n)throw new G(D.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}T.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))));let o=yield this._publishMutex.lock();yield this._configDistribute.awaitConfigDistributeComplete(),n&&r.forEach(c=>{let d=this._configDistribute.getBitrateLimit();c instanceof vt&&d&&c.setBitrateLimit(d.uplink)});try{yield this._publishHighStream(r),T.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw T.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}})}_publishDataChannel(e){return P(this,null,function*(){st(e.id,"id",0,65535,!0),Cs(e.ordered,"ordered"),Tn(e.metadata,"metadata",0,512),T.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=yield this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(o=>o.id===e.id)!==-1)throw new G(D.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new G(D.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&M("FORCE_TURN")&&!M("TURN_ENABLE_TCP")&&!M("TURN_ENABLE_UDP"))throw new G(D.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let n=function(o){return AU(o,!1)}(e),r=yield this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new G(D.CREATE_DATACHANNEL_ERROR);try{yield ie.all(r.map(o=>this._uid&&this._gateway.publishDataChannel(this._uid,o,!0))),yield n._waitTillOpen()}catch(o){if(o.code!==D.DISCONNECT_P2P)throw o}}return T.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw T.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}})}unpublish(e){return P(this,null,function*(){if(!this._joinInfo||this._uid===void 0)throw new G(D.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Jd))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||(yield this._unpublishDataChannel()),t=this._p2pChannel.getAllTracks(!0);T.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(r=>"".concat(r.getTrackId()," "))," "));let n=yield this._publishMutex.lock();try{if(this.store.useP2P){let r=yield this._p2pChannel.unpublish(t);r&&(yield this._gateway.sendExtensionMessage(Gt.UNPUBLISH,{unpubMsg:r},!0))}else{let r=yield this._p2pChannel.unpublish(t);r&&(yield this._gateway.unpublish(r,this._uid)),T.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(o=>"".concat(o.getTrackId()))))}}catch(r){throw T.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}})}_unpublishDataChannel(e){return P(this,null,function*(){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),T.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(n=>"".concat(n.id," "))," "));let t=yield this._publishMutex.lock();try{let n=yield this._p2pChannel.unpublishDataChannel(e);n&&(yield this._gateway.unpublishDataChannel(n)),T.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(r=>"".concat(r.id))))}catch(n){throw T.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}})}subscribe(e,t,n){return P(this,null,function*(){if(!(e instanceof ga)){let r=this.remoteUsers.find(o=>o.uid===e);if(!r)throw new G(D.INVALID_REMOTE_USER,"user is not in the channel");e=r}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)})}presubscribe(e,t){return P(this,null,function*(){if(dn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new G(D.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new G(D.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let n=t===ce.AUDIO,r=t===ce.VIDEO,o=yield this._subscribeMutex.lock();try{let{ssrcId:c,ortc:d,rtxSsrcId:l,cname:h,uint_id:f}=yield this._gateway.presubscribe(e,t,!0);if(c==null)throw new G(D.UNEXPECTED_RESPONSE,"no ssrc id");let m=this._users.find(_=>_.uid===e);m||(m=new ga(e,f||e),m._is_pre_created=!0,this._users.push(m)),h&&(m._cname=h),m._uintid||(m._uintid=f||e),n&&(m._audioSSRC=c,m._audio_pre_subscribed=!0,d&&(m._audioOrtc=d)),r&&(m._videoSSRC=c,m._video_pre_subscribed=!0,d&&(m._videoOrtc=d),l!=null&&(m._rtxSsrcId=l)),T.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(c)),yield this._p2pChannel.subscribe(m,t,c,l,d);let E=n?m._audioTrack:m._videoTrack;if(!E)throw new G(D.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(m._trust_audio_stream_added_state_=!0,m._audio_added_=!0),r&&(m._trust_video_stream_added_state_=!0,m._video_added_=!0),E}catch(c){throw T.error("[".concat(this._clientId,"] presub user ").concat(e," error"),c),c}finally{o()}})}_subscribeDataChannel(e,t){return P(this,null,function*(){var n;if(st(t,"channelId",0,65535,!0),!this._joinInfo)throw new G(D.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e))throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new G(D.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new G(D.INVALID_REMOTE_USER,"user is not published");let o=(n=e._dataChannels)===null||n===void 0?void 0:n.find(l=>l.id===t);if(!o)throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new G(D.REMOTE_USER_IS_NOT_PUBLISHED);let c=yield this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let l=yield this._p2pChannel.subscribeDataChannel(e,[o]);if(l&&ne(l).call(l,o.id))try{var d;if(typeof o._originDataChannelId!="number")throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new G(D.CREATE_DATACHANNEL_ERROR);let h={id:o.id,datachannelId:o._originDataChannelId,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:(d=o.metadata)!==null&&d!==void 0?d:""};yield this._gateway.subscribeDataChannel(e.uid,h,!0),yield o._waitTillOpen()}catch(h){if(h?.code!==D.WS_ABORT)throw yield this._p2pChannel.unsubscribeDataChannel(e,[o]),h;yield this._p2pChannel.unsubscribeDataChannel(e,[o]),this._p2pChannel.setPendingRemoteDataChannel(e,o.id)}return T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),o}finally{c()}})}_p2pSubscribe(e,t,n){return P(this,null,function*(){if(dn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new G(D.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(c=>c===e)){let c=new G(D.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),c}if(!e.hasAudio&&!e.hasVideo){let c=new G(D.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),c}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let c=new G(D.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),c}let o=yield this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(yield this._p2pChannel.hasRemoteMediaWithLock(e,t))yield this._p2pChannel.unmuteRemote(e,t);else try{let d=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&(yield this._p2pChannel.subscribe(e,t,d,l))}catch(d){throw d}T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(d=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),d)});let c=t==="audio"?e._audioTrack:e._videoTrack;if(!c)throw new G(D.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(c){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),c),c}finally{o()}})}_subscribe(e,t,n){return P(this,null,function*(){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(dn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new G(D.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e)){let f=new G(D.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),f}if(!e.hasAudio&&!e.hasVideo){let f=new G(D.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),f}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let f=new G(D.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),f}let o=t==="audio"?e._audioSSRC:e._videoSSRC,c=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,l={stream_type:t==="audio"?ce.AUDIO:ce.VIDEO,ssrcId:o},h=yield this._subscribeMutex.lock();T.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(yield this._p2pChannel.hasRemoteMediaWithLock(e,t))yield this._p2pChannel.unmuteRemote(e,t);else try{let m=t==="audio"?e._audioSSRC:e._videoSSRC;m!==void 0&&m!==o&&(o=m,c=t==="audio"?e._audioOrtc:e._videoOrtc,d=t==="video"?e._rtxSsrcId:void 0,l={stream_type:t==="audio"?ce.AUDIO:ce.VIDEO,ssrcId:o}),xn.markSubscribeStart(this.store.clientId,o),this.store.subscribe(e.uid,t,Date.now()),yield this._p2pChannel.subscribe(e,t,o,d,c);try{this._p2pChannel.isPreSubScribe(o)||(yield this._gateway.subscribe(e.uid,l,!0))}catch(E){if(E?.code!==D.WS_ABORT)throw yield this._p2pChannel.unsubscribe(e,t),E;yield this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m?.code,e,t),m}T.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(m=>{T.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});let f=t==="audio"?e._audioTrack:e._videoTrack;if(!f)throw new G(D.UNEXPECTED_ERROR,"can not find remote track in user object");return f}catch(f){throw T.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),f),f}finally{h()}})}massSubscribe(e){return P(this,null,function*(){if(Is(e,"subscribeList"),!this._joinInfo)throw new G(D.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),n=new Map,r=yield this._subscribeMutex.lock();T.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(l=>{let{user:h,mediaType:f}=l;return"user: ".concat(h?.uid,", mediaType: ").concat(f)}).join("; ")));let o=(e=[...e]).map(l=>{let{user:h,mediaType:f}=l;return{user:h,mediaType:f}}),c=yield this._p2pChannel.globalLock();try{var d;for(let h=e.length-1;h>=0;h--){let f=e[h],{user:m,mediaType:E}=f;if(dn(E,"mediaType",["audio","video"]),!m){let C=new G(D.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),C}if(!this._users.find(C=>C===m)){let C=new G(D.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(this._clientId,"] can not massSubscribe ").concat(m.uid,", this user is not in the channel")),o[h].error=C,e.splice(h,1);continue}if(E==="audio"&&(!m.hasAudio||m._audioSSRC===void 0)||E==="video"&&(!m.hasVideo||m._videoSSRC===void 0)){let C=new G(D.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(this._clientId,"] can not subscribe ").concat(m.uid," with mediaType ").concat(E,", remote user is not published")),o[h].error=C,e.splice(h,1);continue}let v=pn.Video|pn.LwoVideo,A=n.get(m);if(A){if(E==="video"?A&v:A&pn.Audio){e.splice(h,1),T.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(m.uid,", mediaType:").concat(E," twice"));continue}n.set(m,A|(E==="video"?v:pn.Audio))}else n.set(m,E==="video"?v:pn.Audio)}for(let h=e.length-1;h>=0;h--){let f=e[h],{user:m,mediaType:E}=f,_=pn.Video|pn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(m,E)){yield this._p2pChannel.unmuteRemoteNoLock(m,E);let v=n.get(m);n.set(m,E==="video"?v^_:v^pn.Audio),e.splice(h,1)}}this.store.massSubscribe(e.map(h=>({userId:h.user.uid,type:h.mediaType})),t);let l=co(d=Array.from(n.entries())).call(d,(h,f)=>{let[m,E]=f;if(E===0)return h;let _={stream_id:m.uid,stream_type:E};return E&pn.Audio&&(_.audio_ssrc=m._audioSSRC),E&pn.Video&&(_.video_ssrc=m._videoSSRC),h.push(_),h},[]);try{e.length>0&&(yield this._p2pChannel.massSubscribeNoLock(e.map(f=>{let{user:m,mediaType:E}=f;return{user:m,mediaType:E,ssrcId:E===ce.VIDEO?m._videoSSRC:m._audioSSRC,rtxSsrcId:E===ce.VIDEO?m._rtxSsrcId:void 0}})));let h=new Map;if(l=l.filter(f=>f.video_ssrc&&!this._p2pChannel.isPreSubScribe(f.video_ssrc)||f.audio_ssrc&&!this._p2pChannel.isPreSubScribe(f.audio_ssrc)||!f.video_ssrc&&!f.audio_ssrc),l.length>0){let f=yield this._gateway.subscribeAll(l,!0);(f?.users||[]).forEach(m=>{let{stream_id:E,video_error_code:_,audio_error_code:v,error_code:A}=m;(_||v||A)&&h.set(E,{video_error_code:_,audio_error_code:v,error_code:A})})}if(Array.from(h.entries()).length>0){let f=[];Array.from(h.entries()).forEach(m=>{let[E,_]=m,v=this.remoteUsers.find(A=>A.uid===E);if(v){let A;_.error_code||_.video_error_code&&_.audio_error_code?A=void 0:_.video_error_code?A=ce.VIDEO:_.audio_error_code&&(A=ce.AUDIO),f.push({user:v,mediaType:A})}}),f.length>0&&(yield this._p2pChannel.massUnsubscribeNoLock(f))}for(let f of o){let m=h.get(f.user.uid);if(m){let E=m.error_code||f.mediaType==="audio"&&m.audio_error_code||f.mediaType==="video"&&m.video_error_code;if(E){let _=bh(E);T.error("user:".concat(f.user.uid," mediaType:").concat(f.mediaType," has massSubscribe error ").concat(_.desc)),f.error=new G(D.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(_.desc))}}f.error||(f.mediaType==="video"?f.track=f.user.videoTrack:f.track=f.user.audioTrack)}return this.store.massSubscribe(o.filter(f=>!f.error).map(f=>({userId:f.user.uid,type:f.mediaType})),void 0,Date.now()),o.forEach(f=>{var m;he.subscribe(this.store.sessionId,{succ:!!f.error,ec:((m=f.error)===null||m===void 0?void 0:m.code)||null,video:f.mediaType===ce.VIDEO,audio:f.mediaType===ce.AUDIO,peerid:f.user.uid,subscribeRequestid:f.mediaType===ce.VIDEO?f.user._videoSSRC:f.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(f.user._videoSSRC)},!0)}),T.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(f=>{let{user:m,mediaType:E}=f;return"user: ".concat(m?.uid,", mediaType: ").concat(E)}).join("; "))),o}catch(h){throw yield this._p2pChannel.massUnsubscribeNoLock(e),h}}finally{c(),r()}})}unsubscribe(e,t,n){return P(this,null,function*(){if(!(e instanceof ga)){let c=this.remoteUsers.find(d=>d.uid===e);if(!c)throw new G(D.INVALID_REMOTE_USER,"user is not in the channel");e=c}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else yield this._unsubscribeDataChannel(e,n);if(t&&dn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new G(D.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(c=>c===e)){let c=new G(D.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let o=yield this._subscribeMutex.lock();try{if(this.store.useP2P)yield this._p2pChannel.unsubscribe(e,t);else{let c=yield this._p2pChannel.unsubscribe(e,t);c&&(yield this._gateway.unsubscribe(c,e.uid)),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&Qm(this._users,e),T.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(c){if(c.code===D.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}finally{o()}})}_unsubscribeDataChannel(e,t){return P(this,null,function*(){if(t&&st(t,"id",0,65535,!0),!this._joinInfo)throw new G(D.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(o=>o===e)){let o=new G(D.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}let r;if(typeof t=="number"){let o=e._dataChannels.find(c=>c.id===t);o&&(r=[o])}else r=e._dataChannels;if(r===void 0){let o=new G(D.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),o}T.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(o=>o.id)));try{let o=yield this._p2pChannel.unsubscribeDataChannel(e,r);o&&(yield this._gateway.unsubscribeDataChannel(o,e.uid)),T.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o))}catch(o){if(o.code===D.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}})}massUnsubscribe(e){return P(this,null,function*(){if(Is(e,"unsubscribeList"),!this._joinInfo)throw new G(D.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:o}=n;return"user: ".concat(r?.uid,", mediaType: ").concat(o,";")}).join())),e=[...e];let t=new Map;for(let n=e.length-1;n>=0;n--){let{user:r,mediaType:o}=e[n];if(!r){let l=new G(D.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(dn(o,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===r)){T.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}let d=pn.Video|pn.LwoVideo;if(t.has(r)){let l=t.get(r),h;switch(o){case"video":h=l&d;break;case"audio":h=l&pn.Audio;break;default:h=l&(pn.Audio|d)}if(h){T.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(o," twice.")),e.splice(n,1);continue}o?o==="audio"?t.set(r,l|pn.Audio):o==="video"&&t.set(r,l|d):t.set(r,l|pn.Audio|d)}else o?o==="audio"?t.set(r,pn.Audio):o==="video"&&t.set(r,d):t.set(r,pn.Audio|d)}try{let n=yield this._p2pChannel.massUnsubscribe(e);n&&(yield this._gateway.massUnsubscribe(n)),T.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:o,mediaType:c}=r;return"user: ".concat(o?.uid,", mediaType: ").concat(c,";")}).join()))}catch(n){if(n.code===D.DISCONNECT_P2P)return void T.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw T.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}})}setLowStreamParameter(e){return P(this,null,function*(){(function(n){if(!n)throw new K(D.INVALID_PARAMS);Mt(n.width)||eC(n.width,"streamParameter.width"),Mt(n.height)||eC(n.height,"streamParameter.height"),Mt(n.framerate)||eC(n.framerate,"streamParameter.framerate"),Mt(n.bitrate)||st(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&T.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,J.LocalVideoLowTrack)})}enableDualStream(){return P(this,null,function*(){if(!He().supportDualStream)throw he.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new G(D.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new G(D.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{yield this._publishLowStream()}catch(e){throw he.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,he.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(this._clientId,"] enable dual stream"))})}disableDualStream(){return P(this,null,function*(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new G(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(J.LocalVideoLowTrack))try{let e=yield this._p2pChannel.unpublishLowStream();e&&(yield this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid))}catch(e){throw he.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,he.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(this._clientId,"] disable dual stream"))}})}setClientRole(e,t){return P(this,null,function*(){if(function(r){dn(r,"role",["audience","host"])}(e),t&&iC(t),this.mode==="rtc"||this.mode==="p2p")throw T.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new G(D.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new G(D.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new G(D.INVALID_OPERATION,"can not set client role to audience when publishing stream");let n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&M("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",bn.REGIONAL_DISTRIBUTION)):(yield this._gateway.setClientRole(e,t),this._config.role=e),T.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))})}_setClientRoleOptions(e){return P(this,null,function*(){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&iC(e),yield this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{T.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}})}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Tn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new G(D.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new G(D.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,he.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new G(D.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new G(D.INVALID_OPERATION,"You have already set the proxy")}if(Eh(e))return this._turnServer={servers:e,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>pL(n)),this._turnServer={servers:e,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new G(D.INVALID_OPERATION,"you should set license before join channel");if(Tn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new G(D.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,T.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new G(D.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new G(D.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new G(D.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new G(D.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new G(D.INVALID_OPERATION,"Stop proxy server after leave channel");he.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new G(D.INVALID_PARAMS,"accessPoints is required.");Is(e.accessPoints.serverList,"accessPoints.serverList"),Tn(e.accessPoints.domain,"accessPoints.domain");let t=(_,v)=>{st(_,v,0,65535,!0)},n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new G(D.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");M("CLOSE_AFB_FOR_LOCAL_AP")&&(nt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),nt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,o=e.accessPoints.domain,c=e.accessPoints.serverList.map(_=>r.test(_)?"".concat(_.replace(/\./g,"-"),".").concat(o):_),d=c.map(_=>"".concat(_,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,nt("WEBCS_DOMAIN",d),nt("WEBCS_DOMAIN_BACKUP_LIST",d),nt("GATEWAY_DOMAINS",[o]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Is(e.report.hostname,"report.hostname"),nt("EVENT_REPORT_DOMAIN",e.report.hostname[0]),nt("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(nt("EVENT_REPORT_DOMAIN",c[0]),nt("EVENT_REPORT_BACKUP_DOMAIN",c[1]||c[0]));let l=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),l=e.report.port),nt("STATS_COLLECTOR_PORT",l),e.report?nt("ENABLE_EVENT_REPORT",!0):nt("ENABLE_EVENT_REPORT",!1);let h="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Is(e.log.hostname,"log.hostname"),h=e.log.hostname[0]):h=c[0];let f=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),f=e.log.port),nt("LOG_UPLOAD_SERVER","".concat(h,":").concat(f));let m=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Is(e.cds.hostname,"cds.hostname"),m=e.cds.hostname):m=c;let E=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),E=e.cds.port),nt("CDS_AP",m.map(_=>"".concat(_,":").concat(E))),e.cds?nt("ENABLE_CONFIG_DISTRIBUTE",!0):nt("ENABLE_CONFIG_DISTRIBUTE",!1),T.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Is(e,"serverList"),Tn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new G(D.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,nt("WEBCS_DOMAIN",e),nt("WEBCS_DOMAIN_BACKUP_LIST",e),nt("GATEWAY_DOMAINS",[t]),nt("EVENT_REPORT_DOMAIN",e[0]),nt("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),nt("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),T.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(e){return P(this,null,function*(){if(dn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{yield this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw T.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else T.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))})}setRemoteVideoStreamType(e,t){return P(this,null,function*(){dn(t,"streamType",[0,1,4,5,6,7,8,9]);try{yield this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw T.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)})}setStreamFallbackOption(e,t){return P(this,null,function*(){dn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{yield this._gateway.setStreamFallbackOption(e,t)}catch(n){throw T.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}T.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)})}setEncryptionConfig(e,t,n,r){(function(c){dn(c,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Tn(t,"secret");let o=["aes-128-gcm2","aes-256-gcm2"];if(ne(o).call(o,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new G(D.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new G(D.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Cs(r,"encryptDataStream"),!ne(o).call(o,e))throw new G(D.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||T.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=da(n))}renewToken(e){return P(this,null,function*(){if(Tn(e,"token",1,2047),!this._key||!this._joinInfo)throw new G(D.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let n=yield this._renewTokenMutex.lock();try{if(M("USE_NEW_TOKEN")){T.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let r=yield vte(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||nn);T.debug("[".concat(this._clientId,"] get ticket from unilbs success")),yield this._gateway.renewToken({token:e,ticket:r})}else T.debug("[".concat(this._clientId,"] start renew token without ticket")),yield this._gateway.renewToken({token:e});T.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,T.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}})}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(Oe.VOLUME_INDICATOR,e)},M("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}startLiveStreaming(e,t){return P(this,null,function*(){if(!t){if(this.codec!=="h264")throw new G(D.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new G(D.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new G(D.LIVE_STREAMING_TASK_CONFLICT);let n=t?Xo.TRANSCODE:Xo.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)})}setLiveTranscoding(e){return this._createLiveStreamingClient(Xo.TRANSCODE).setTranscodingConfig(e)}stopLiveStreaming(e){return P(this,null,function*(){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new G(D.INVALID_PARAMS,"can not find live streaming url to stop");yield ie.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))})}startChannelMediaRelay(e){return P(this,null,function*(){KU(e),yield this._createChannelMediaRelayClient().startChannelMediaRelay(e)})}updateChannelMediaRelay(e){return P(this,null,function*(){KU(e),yield this._createChannelMediaRelayClient().updateChannelMediaRelay(e)})}stopChannelMediaRelay(){return P(this,null,function*(){yield this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)})}sendAudioMetadata(e){this._p2pChannel instanceof xh&&this._p2pChannel.addAudioMetadata(e)}sendStreamMessage(t){return P(this,arguments,function*(e){var n;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new G(D.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ne(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)&&(o=!0,e.payload=yield function(c,d,l){return P(this,null,function*(){var h;let f=co(h=Array.from(l)).call(h,(I,O)=>I+O,0),m={serverTs:0,seq:VZ++,length:l.length,checkSum:f},E=new Uint8Array(TL(f,2)),_=new ArrayBuffer(10),v=new DataView(_);v.setUint32(0,m.serverTs),v.setUint16(4,m.seq),v.setUint16(6,m.length),v.setUint16(8,m.checkSum);let A=16-l.length%16;l=gL(l,new Uint8Array(A));let C=yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:128,additionalData:E},d,l);return gL(new Uint8Array(_),new Uint8Array(C))})}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new G(D.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(ve.DATA_STREAM,{payload:da(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Dte},!r)})}sendMetadata(e){if(!this._joinInfo)throw new G(D.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new G(D.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ve.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:da(e)})}sendCustomReportMessage(e){return P(this,null,function*(){if(Array.isArray(e)||(e=[e]),e.forEach(YZ),!this._joinInfo)throw new G(D.INVALID_OPERATION,"can not send custom report, not joined");yield he.sendCustomReportMessage(this._joinInfo.sid,e)})}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(e,t){return P(this,null,function*(){dn(t.spatialLayer,"spatialLayer",[0,1,2,3]),dn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield this._gateway.pickSVCLayer(e,t)}catch(n){throw T.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}})}setRTMConfig(e){return P(this,null,function*(){let{apRTM:t=!1,rtmFlag:n}=e;if(Cs(t,"apRTM"),st(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,T.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)})}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),function(e){let t=iu.indexOf(e);t!==-1&&iu.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=pr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&yF(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&he.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new kn("client-publish",this._clientId),this._subscribeMutex=new kn("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;let r=e||dc();e?T.debug("[".concat(this._clientId,"] new Session ").concat(r)):T.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));let o=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,he.addSid(r);let c={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:o,clientRole:this.role==="audience"?2:1};he.sessionInit(this._sessionId,$i({cname:t.channel,appid:t.appId},c)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}_publishHighStream(e){return P(this,null,function*(){if(!this._joinInfo||this._uid===void 0)throw new G(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&M("FORCE_TURN")&&!M("TURN_ENABLE_TCP")&&!M("TURN_ENABLE_UDP"))throw new G(D.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(this._clientId,"] publish high stream"));try{let n=yield this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let r=(yield n.next()).value;if(r){try{yield this._gateway.sendExtensionMessage(Gt.PUBLISH,r,!0)}catch(o){throw n.throw(o),o}yield n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let r=(yield n.next()).value;if(r){var t;let o;try{o=yield this._gateway.publish(this._uid,r,!0)}catch(c){if(c.code!==D.DISCONNECT_P2P)throw n.throw(c),c}yield n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let o of e)o instanceof vt&&o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig).catch(c=>{T.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!o.muted&&o.enabled||(yield this._p2pChannel.muteLocalTrack(o))}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,e),n?.code===D.WS_ABORT)return;throw n}})}_publishLowStream(){return P(this,null,function*(){if(!this._joinInfo||this._uid===void 0)throw new G(D.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new G(D.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));T.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let n=yield this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(yield n.next()).value;if(r){var t;let o;try{o=yield this._gateway.publish(this._uid,r,!0)}catch(c){if(c.code!==D.DISCONNECT_P2P)throw n.throw(c),c}n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,void 0,!0),n?.code===D.WS_ABORT)return;throw n}})}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new G(D.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ma("LiveStreaming").create(r));var r;return n.onLiveStreamError=(o,c)=>{he.reportApiInvoke(this._sessionId,{name:tn.ON_LIVE_STREAM_ERROR,options:[o,c],tag:kt.TRACER}).onSuccess(),this.safeEmit(Oe.LIVE_STREAMING_ERROR,o,c)},n.onLiveStreamWarning=(o,c)=>{he.reportApiInvoke(this._sessionId,{name:tn.ON_LIVE_STREAM_WARNING,options:[o,c],tag:kt.TRACER}).onSuccess(),this.safeEmit(Oe.LIVE_STREAMING_WARNING,o,c)},n.on(zC.REQUEST_WORKER_MANAGER_LIST,(o,c,d)=>{if(!this._joinInfo)return d(new G(D.INVALID_OPERATION,"can not find join info to get worker manager"));(function(l,h,f,m){return P(this,null,function*(){let E=M("UAP_AP").slice(0,M("AJAX_REQUEST_CONCURRENT")).map(_=>h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(_+"/api/v1?action=uap"):"https://".concat(_,"/api/v1?action=uap"));return yield pte(E,l,h,f,m)})})(o,this._joinInfo,this._axiosCancelSource.token,nn).then(c).catch(d)}),n};return e===Xo.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new G(D.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},ma("ChannelMediaRelay").create(e));r.on("state",o=>{o===Rr.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(Oe.CHANNEL_MEDIA_RELAY_STATE,o)}),r.on("event",o=>{this.safeEmit(Oe.CHANNEL_MEDIA_RELAY_EVENT,o)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(o,c)=>{var d;o==="resolution"&&((d=this._channelMediaRelayClient)===null||d===void 0||d.setVideoProfile(c))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:n,deleted:r}=e,o=[];if(t){let c=[];this._users.forEach(d=>{d._dataChannels.forEach(l=>{n.every(h=>h.uid!==d._uintid||h.stream_id!==l.id)&&c.push({uid:d._uintid,stream_id:l.id,ordered:l.ordered,max_retrans_times:l.maxRetransmits,metadata:l.metadata})})}),c.length>0&&this._handleUpdateDataChannel({added:[],deleted:c})}Array.isArray(n)&&n.length>0&&n.forEach(c=>{let{uid:d,stream_id:l,ordered:h,max_retrans_times:f,metadata:m}=c,E=this._users.find(_=>_._uintid===d);if(!E)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(T.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(d)),ne(o).call(o,E)||o.push(E),E._uintid||(E._uintid=d),E._dataChannels.findIndex(_=>_.id===c.stream_id)===-1){let _={id:l,ordered:!!h,maxRetransmits:f,metadata:m},v=function(A){return AU(A,!0)}(_);E._dataChannels.push(v),T.info("[".concat(this._clientId,"] remote user ").concat(E.uid," published datachannel")),t||this.safeEmit(Oe.USER_PUBLISHED,E,"datachannel",_)}this._p2pChannel.hasPendingRemoteDataChannel(E,c.stream_id)&&(T.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(E.uid," after reconnect.")),this._subscribeDataChannel(E,c.stream_id).catch(_=>{T.error("[".concat(this._clientId,"] resubscribe datachannel error"),_.toString())}))}),t&&(this.safeEmit(Oe.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(c=>{let{uid:d,stream_id:l}=c,h=this._users.find(m=>m._uintid===d);if(!h)return void T.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let f=h._dataChannels.find(m=>m.id===c.stream_id);f&&(T.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(d)),this._p2pChannel.unsubscribeDataChannel(h,[f]).then(m=>{if(h._dataChannels=h._dataChannels.filter(E=>E!==f),m)return this._gateway.unsubscribeDataChannel(m,h.uid)}),T.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished datachannel ,id:").concat(f.id)),this.safeEmit(Oe.USER_UNPUBLISHED,h,"datachannel",f._config))})}_handleRemoveDataChannels(e){let t=this._users.find(n=>n.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){T.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let n=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(r=>{this.safeEmit(Oe.USER_UNPUBLISHED,t,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,t.uid)}),n()}}else T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(gn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void T.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach(r=>{let{value:o,type:c,expires:d}=t[r];d&&d<=n||c||jC()||!Object.prototype.hasOwnProperty.call(ig,r)||(_o[r]=o,Ot[r]=o,T.debug("Update gateway parameters from config distribute",r,o))})}catch(t){T.error("Error update config from local cache",t.message)}})()}),this._gateway.on(gn.DISCONNECT_P2P,()=>P(this,null,function*(){yield this._p2pChannel.disconnectForReconnect()})),this._gateway.on(gn.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===Ye.FALLBACK)return;let o=()=>{this.safeEmit(Oe.CONNECTION_STATE_CHANGE,e,t,n)};if(he.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:tn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:kt.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),T.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void o();if(e==="RECONNECTING")this._users.forEach(d=>{d._trust_in_room_=!1,d._trust_audio_enabled_state_=!1,d._trust_video_enabled_state_=!1,d._trust_audio_mute_state_=!1,d._trust_video_mute_state_=!1,d._trust_audio_stream_added_state_=!1,d._trust_video_stream_added_state_=!1,d._is_pre_created||(d._audio_pre_subscribed||(d._audioSSRC=void 0,d._audioOrtc=void 0),d._video_pre_subscribed||(d._videoSSRC=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),d._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var c;this._streamFallbackTypeCacheMap.forEach((d,l)=>{this._gateway.setStreamFallbackOption(l,d).catch(h=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),h)})}),this._remoteStreamTypeCacheMap.forEach((d,l)=>{this._gateway.setRemoteVideoStreamType(l,d).catch(h=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),h)})}),this._remoteDefaultVideoStreamType!==void 0&&((c=this._joinInfo)===null||c===void 0?void 0:c.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(d=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(d))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(d=>!d._trust_in_room_).forEach(d=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(d.uid)),this._handleUserOffline({uid:d.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(d=>{d._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,ce.AUDIO,!1)),d._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,ce.VIDEO,!1)),d._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(d.uid)),this._handleSetStreamLocalEnable("audio",d.uid,!0)),d._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(d.uid)),this._handleSetStreamLocalEnable("video",d.uid,!0)),d._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(d.uid)),this._handleResetAddStream(d,"video")),d._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(d.uid)),this._handleResetAddStream(d,"audio")),d._video_added_||d._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(d.uid)),this._handleRemoveStream({uid:d.uid,uint_id:d._uintid}))}))},1e3))}o()}),this._gateway.on(gn.REQUEST_NEW_GATEWAY_LIST,(e,t)=>P(this,null,function*(){if(!this._joinInfo)return t(new G(D.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n,r=yield _F($i($i({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(n=r.ap,TF(r),this._joinInfo.preload=!0):(n=yield dI(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);let o=[];n.gatewayInfo.gatewayAddrs.forEach(c=>{let{address:d}=c,[l,h]=d.split(":");this._joinInfo&&this._joinInfo.proxyServer?o.push({proxy:this._joinInfo.proxyServer,host:l,port:h}):o.push({host:l,port:h})}),e(o)}catch(n){t(n)}})),this._gateway.on(gn.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Oe.NETWORK_QUALITY,e)}),this._gateway.on(gn.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Oe.STREAM_TYPE_CHANGED,e,t),he.reportApiInvoke(this._sessionId,{name:tn.STREAM_TYPE_CHANGE,options:[e,t],tag:kt.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(gn.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(gn.REQUEST_P2P_CONNECTION_PARAMS,(e,t,n)=>P(this,null,function*(){try{let r=yield this._p2pChannel.getEstablishParams();M("ENABLE_PREALLOC_PC")&&r||(r=yield this._p2pChannel.startP2PConnection(e)),t(r)}catch(r){n(r)}})),this._gateway.on(gn.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let n;e.attributes?n=e.attributes.userAttributes.preSubSsrcs:T.debug("no attributes in joinResponse");let r=gU(e.ortc,t,n);this._p2pChannel.connect(r)}),this._gateway.on(gn.PRE_CONNECT_PC,e=>P(this,null,function*(){let{candidates:t,fingerprint:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var r;yield this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});let{cert:o,cid:c}=this._joinInfo.apResponse;yield this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(c,"_").concat(o),icePwd:"".concat(c,"_").concat(o)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(r=M("FINGERPRINT"))!==null&&r!==void 0?r:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(Pe.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Pe.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Pe.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(Pe.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Pe.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Pe.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Pe.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Pe.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Pe.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,ce.AUDIO,!0)),this._gateway.signal.on(Pe.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,ce.AUDIO,!1)),this._gateway.signal.on(Pe.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,ce.VIDEO,!0)),this._gateway.signal.on(Pe.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,ce.VIDEO,!1)),this._gateway.signal.on(Pe.RECEIVE_METADATA,e=>{let t=cc(e.metadata);this.safeEmit(Oe.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Pe.ON_DATA_STREAM,e=>P(this,null,function*(){var t;if(!e)return;let n=cc(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ne(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<10)throw new G(D.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(10));n=yield function(c,d,l){return P(this,null,function*(){let h=l.subarray(0,10),f=h.slice(8,10),m=(f[0]<<8)+f[1],E=(h[6]<<8)+h[7],_=yield window.crypto.subtle.decrypt({name:"AES-GCM",iv:c,tagLength:128,additionalData:new Uint8Array(TL(m,2))},d,l.subarray(10));return new Uint8Array(_).subarray(0,E)})}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(e.ordered||e.syncWithAudio){let o=this._p2pChannel.getStats(),c=this.remoteUsers.find(l=>l.uid===e.uid),d=o?.audioRecv.find(l=>l.ssrc===c?._audioSSRC);r=d?.jitterBufferMs}(r==null||Number.isNaN(r))&&(r=0),Ote($i($i({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(Pe.ON_CRYPT_ERROR,()=>{ca(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Oe.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Pe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ye.TOKEN_EXPIRE),this.safeEmit(Oe.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Pe.ON_STREAM_FALLBACK_UPDATE,e=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Oe.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Pe.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Pe.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Pe.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(ye.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ve.PUBLISH:{if(!t)return;let o=t.ortc;if(o){var n,r;let c=o.some(h=>{let{stream_type:f}=h;return f===Xe.Audio}),d=o.some(h=>{let{stream_type:f}=h;return f!==Xe.Audio}),l=o.some(h=>{let{stream_type:f}=h;return f===Xe.Screen||f===Xe.ScreenLow});t.state==="offer"&&he.publish(this._joinInfo.sid,{eventElapse:xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:D.TIMEOUT,audio:c,video:d,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:l,audioName:c?(n=o.find(h=>{let{stream_type:f}=h;return f===Xe.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:d?(r=o.find(h=>{let{stream_type:f}=h;return f!==Xe.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case ve.SUBSCRIBE:t&&he.subscribe(this._joinInfo.sid,{succ:!1,ec:D.TIMEOUT,audio:t.stream_type===ce.AUDIO,video:t.stream_type===ce.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:xn.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Pe.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Pe.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;M("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!Ec(r.string_id||r.stream_id,this.channelName)));let t=[],n=[];for(let r of e.users){let o=this._users.find(m=>m._uintid===r.stream_id);o?o._trust_in_room_=!0:(o=new ga(r.string_id||r.stream_id,r.stream_id),this._users.push(o),this.getListeners(Oe.PUBLISHED_USER_LIST).length===0&&(T.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Oe.USER_JOINED,o)));let c=pn.Audio&r.stream_type,d=(pn.Video|pn.LwoVideo)&r.stream_type,l=!!(65280&r.stream_type),h=c&&o.hasAudio,f=d&&o.hasVideo;d&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=r.video_ssrc,o._rtxSsrcId=r.video_rtx),c&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=r.audio_ssrc),c&&!h&&this.getListeners(Oe.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.safeEmit(Oe.USER_PUBLISHED,o,"audio")),d&&!f&&this.getListeners(Oe.PUBLISHED_USER_LIST).length===0&&(T.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.safeEmit(Oe.USER_PUBLISHED,o,"video")),(c&&!h||d&&!f||l)&&t.push(o),d&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&n.push({user:o,mediaType:"video"}),c&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&n.push({user:o,mediaType:"audio"})}n.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Oe.PUBLISHED_USER_LIST).length>0?M("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Oe.PUBLISHED_USER_LIST,t)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Pe.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof xh&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(n=>n.toLowerCase()).filter(n=>{var r;return ne(r=Object.keys(og)).call(r,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Pe.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Gt.PUBLISH,(e,t,n)=>{let{uid:r}=e;e.forEach(o=>{let{kind:c,ssrcs:d,mid:l,isMuted:h}=o;this._handleP2PAddAudioOrVideoStream(c,r,d[0].ssrcId,l);let f=this._users.find(m=>m.uid===r);return f&&this.store.useP2P?this._p2pChannel.mockSubscribe(f,c,d[0].ssrcId,l).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,c,!!h)})}),this._gateway.signal.on(Gt.CALL,(e,t,n)=>P(this,null,function*(){if(this.store.useP2P)try{var r;t(yield this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},e))}catch(o){n(o)}})),this._gateway.signal.on(ye.P2P_CONNECTION,e=>P(this,null,function*(){this.store.useP2P&&(yield this._p2pChannel).p2pConnect(e)})),this._gateway.signal.on(Gt.UNPUBLISH,(e,t,n)=>P(this,null,function*(){if(this.store.useP2P){let{unpubMsg:r,uid:o}=e,c=this._users.find(d=>d.uid===o);if(!c)return T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(o)),void t();try{r.forEach(d=>P(this,null,function*(){let{stream_type:l}=d,h=l===Xe.Audio?ce.AUDIO:ce.VIDEO;yield this._p2pChannel.unsubscribe(c,h),this._handleMuteStream(o,h,!0)})),t()}catch(d){n(d)}}})),this._gateway.signal.on(Gt.CONTROL,(e,t)=>P(this,null,function*(){let{action:n}=e;switch(n){case ha.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,ce.VIDEO,!0);break;case ha.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,ce.AUDIO,!0);break;case ha.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,ce.VIDEO,!1);break;case ha.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,ce.AUDIO,!1)}})),this._gateway.signal.on(Gt.RESTART_ICE,(e,t,n)=>P(this,null,function*(){if(this.store.useP2P)try{let{direction:r,iceParameter:o}=e;r!==or.SEND_ONLY||o?t(yield this._p2pChannel.restartICE(r,o)):(this._p2pChannel.handleDisconnect(r),t())}catch(r){n(r)}})),this._gateway.signal.on(Gt.CANDIDATE,e=>{if(this.store.useP2P){let{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(me.RequestP2PRestartICE,(e,t,n)=>P(this,null,function*(){try{let{direction:r}=e;t(yield this._gateway.sendExtensionMessage(Gt.RESTART_ICE,e,r===or.SEND_ONLY))}catch(r){n(r)}})),this._p2pChannel.on(me.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Gt.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(me.RequestP2PMuteLocal,(e,t,n)=>P(this,null,function*(){try{yield this._gateway.sendExtensionMessage(Gt.CONTROL,e,!0),t()}catch(r){n(r)}})),this._p2pChannel.on(me.RequestP2PUnmuteRemote,(e,t,n)=>P(this,null,function*(){if(this._joinInfo)try{yield this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===D.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(me.RequestP2PMuteRemote,(e,t,n)=>P(this,null,function*(){if(this._joinInfo)try{yield this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===D.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(me.StateChange,(e,t)=>{t===$e.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(me.PeerConnectionStateChange,e=>{let t=this._peerConnectionState;e!==t&&(this.safeEmit(Oe.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(me.RequestMuteLocal,(e,t,n)=>P(this,null,function*(){if(this._joinInfo)try{yield this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===D.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(me.RequestUnmuteLocal,(e,t,n)=>P(this,null,function*(){if(this._joinInfo)try{yield this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===D.DISCONNECT_P2P?t():n(r)}else t()})),this._p2pChannel.on(me.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(me.RequestRePublishDataChannel,(e,t,n)=>{ie.all(e.map(r=>P(this,null,function*(){let o=yield this._p2pChannel.publishDataChannel([r]);try{o.forEach(c=>{this._uid&&this._gateway.publishDataChannel(this._uid,c,!0)})}catch(c){if(c.code!==D.DISCONNECT_P2P)throw c}}))).then(t).catch(n)}),this._p2pChannel.on(me.RequestReSubscribe,(e,t,n)=>P(this,null,function*(){try{for(let{user:r,kind:o}of e)o===ce.VIDEO?yield this.subscribe(r,"video"):yield this.subscribe(r,"audio");t()}catch(r){n(r)}})),this._p2pChannel.on(me.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(me.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(me.MediaReconnectStart,e=>{this.safeEmit(Oe.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(me.MediaReconnectEnd,e=>{this.safeEmit(Oe.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(me.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(me.RequestRestartICE,e=>P(this,null,function*(){if(this.store.useP2P)return;let t=yield this._p2pChannel.restartICE(e),n=yield t.next();if(n.done)return;let r=n.value,o;try{o=yield this._gateway.restartICE({iceParameters:r})}catch(d){return void t.throw(d)}let{iceParameters:c}=function(d){let l=d.iceParameters;return{iceParameters:{iceUfrag:l.iceUfrag,icePwd:l.icePwd}}}(o);yield t.next({remoteIceParameters:c})})),this._p2pChannel.on(me.RequestReconnect,()=>P(this,null,function*(){this._gateway.reconnect()})),this._p2pChannel.on(me.RequestReconnectPC,()=>P(this,null,function*(){var e;let{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=yield this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:o,gatewayAddress:c}=yield this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),d=gU(o,c);yield this._p2pChannel.connect(d),yield this._p2pChannel.republish(),yield this._p2pChannel.reSubscribe()})),this._p2pChannel.on(me.RequestUnpublishForReconnectPC,(e,t,n)=>P(this,null,function*(){this._joinInfo&&this._uid!==void 0?(yield this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(me.P2PLost,()=>{this.safeEmit(Oe.P2P_LOST,this.store.uid)}),this._p2pChannel.on(me.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(me.ConnectionTypeChange,e=>{this.safeEmit(Oe.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(me.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(me.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(me.AudioMetadata,e=>{this.safeEmit(Oe.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(e){return P(this,null,function*(){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new G(D.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new G(D.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let n=(t={config:e},ma("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);let{appId:r,cname:o,sid:c,token:d,uid:l,cid:h,vid:f}=this._joinInfo;yield n.init({appId:r,areaCode:"",cname:o,sid:c,token:d,uid:l,cid:h,vid:f?Number(f):0},nn)}catch(n){throw Array.isArray(n)?n[0]:n}var t})}handleVideoInspectEvents(e){e.on(En.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Oe.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===Ki.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Oe.CONTENT_INSPECT_ERROR,new G(D.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(En.INSPECT_RESULT,(t,n)=>{var r;if(n?.code===D.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return T.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(Oe.CONTENT_INSPECT_RESULT,t,n)}),e.on(En.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}disableContentInspect(){return P(this,null,function*(){if(!this._inspect)throw new G(D.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}})}setImageModeration(e,t){return P(this,null,function*(){if(Cs(e,"enabled"),e){if(!t)throw new G(D.INVALID_PARAMS,"config is required");if(UF(t),!this._joinInfo)throw new G(D.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let r=(n={config:t},ma("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);let{appId:o,cname:c,sid:d,token:l,uid:h,cid:f,vid:m}=this._joinInfo;yield r.init({appId:o,areaCode:"",cname:c,sid:d,token:l,uid:h,cid:f,vid:m?Number(m):0},nn)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new G(D.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}})}handleImageModerationEvents(e){e.on(To.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(Oe.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===fi.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new G(D.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(To.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){dn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new G(D.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,T.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(e){return P(this,null,function*(){Cs(e,"enabled"),nt("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&(yield this._gateway.setPublishAudioFilterEnabled(e))})}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},ue(se.prototype,"leave",[FF],Object.getOwnPropertyDescriptor(se.prototype,"leave"),se.prototype),ue(se.prototype,"publish",[VF],Object.getOwnPropertyDescriptor(se.prototype,"publish"),se.prototype),ue(se.prototype,"unpublish",[jF],Object.getOwnPropertyDescriptor(se.prototype,"unpublish"),se.prototype),ue(se.prototype,"subscribe",[BF],Object.getOwnPropertyDescriptor(se.prototype,"subscribe"),se.prototype),ue(se.prototype,"presubscribe",[HF],Object.getOwnPropertyDescriptor(se.prototype,"presubscribe"),se.prototype),ue(se.prototype,"massSubscribe",[GF],Object.getOwnPropertyDescriptor(se.prototype,"massSubscribe"),se.prototype),ue(se.prototype,"unsubscribe",[WF],Object.getOwnPropertyDescriptor(se.prototype,"unsubscribe"),se.prototype),ue(se.prototype,"massUnsubscribe",[KF],Object.getOwnPropertyDescriptor(se.prototype,"massUnsubscribe"),se.prototype),ue(se.prototype,"setLowStreamParameter",[qF],Object.getOwnPropertyDescriptor(se.prototype,"setLowStreamParameter"),se.prototype),ue(se.prototype,"enableDualStream",[zF],Object.getOwnPropertyDescriptor(se.prototype,"enableDualStream"),se.prototype),ue(se.prototype,"disableDualStream",[YF],Object.getOwnPropertyDescriptor(se.prototype,"disableDualStream"),se.prototype),ue(se.prototype,"setClientRole",[$F],Object.getOwnPropertyDescriptor(se.prototype,"setClientRole"),se.prototype),ue(se.prototype,"_setClientRoleOptions",[XF],Object.getOwnPropertyDescriptor(se.prototype,"_setClientRoleOptions"),se.prototype),ue(se.prototype,"setProxyServer",[JF],Object.getOwnPropertyDescriptor(se.prototype,"setProxyServer"),se.prototype),ue(se.prototype,"setTurnServer",[QF],Object.getOwnPropertyDescriptor(se.prototype,"setTurnServer"),se.prototype),ue(se.prototype,"setLicense",[ZF],Object.getOwnPropertyDescriptor(se.prototype,"setLicense"),se.prototype),ue(se.prototype,"startProxyServer",[eV],Object.getOwnPropertyDescriptor(se.prototype,"startProxyServer"),se.prototype),ue(se.prototype,"stopProxyServer",[tV],Object.getOwnPropertyDescriptor(se.prototype,"stopProxyServer"),se.prototype),ue(se.prototype,"setLocalAccessPointsV2",[nV],Object.getOwnPropertyDescriptor(se.prototype,"setLocalAccessPointsV2"),se.prototype),ue(se.prototype,"setLocalAccessPoints",[rV],Object.getOwnPropertyDescriptor(se.prototype,"setLocalAccessPoints"),se.prototype),ue(se.prototype,"setRemoteDefaultVideoStreamType",[iV],Object.getOwnPropertyDescriptor(se.prototype,"setRemoteDefaultVideoStreamType"),se.prototype),ue(se.prototype,"setRemoteVideoStreamType",[oV],Object.getOwnPropertyDescriptor(se.prototype,"setRemoteVideoStreamType"),se.prototype),ue(se.prototype,"setStreamFallbackOption",[sV],Object.getOwnPropertyDescriptor(se.prototype,"setStreamFallbackOption"),se.prototype),ue(se.prototype,"setEncryptionConfig",[aV],Object.getOwnPropertyDescriptor(se.prototype,"setEncryptionConfig"),se.prototype),ue(se.prototype,"renewToken",[cV],Object.getOwnPropertyDescriptor(se.prototype,"renewToken"),se.prototype),ue(se.prototype,"enableAudioVolumeIndicator",[dV],Object.getOwnPropertyDescriptor(se.prototype,"enableAudioVolumeIndicator"),se.prototype),ue(se.prototype,"startLiveStreaming",[uV],Object.getOwnPropertyDescriptor(se.prototype,"startLiveStreaming"),se.prototype),ue(se.prototype,"setLiveTranscoding",[lV],Object.getOwnPropertyDescriptor(se.prototype,"setLiveTranscoding"),se.prototype),ue(se.prototype,"stopLiveStreaming",[hV],Object.getOwnPropertyDescriptor(se.prototype,"stopLiveStreaming"),se.prototype),ue(se.prototype,"startChannelMediaRelay",[pV],Object.getOwnPropertyDescriptor(se.prototype,"startChannelMediaRelay"),se.prototype),ue(se.prototype,"updateChannelMediaRelay",[fV],Object.getOwnPropertyDescriptor(se.prototype,"updateChannelMediaRelay"),se.prototype),ue(se.prototype,"stopChannelMediaRelay",[mV],Object.getOwnPropertyDescriptor(se.prototype,"stopChannelMediaRelay"),se.prototype),ue(se.prototype,"sendCustomReportMessage",[gV],Object.getOwnPropertyDescriptor(se.prototype,"sendCustomReportMessage"),se.prototype),ue(se.prototype,"pickSVCLayer",[EV],Object.getOwnPropertyDescriptor(se.prototype,"pickSVCLayer"),se.prototype),ue(se.prototype,"setRTMConfig",[_V],Object.getOwnPropertyDescriptor(se.prototype,"setRTMConfig"),se.prototype),ue(se.prototype,"enableContentInspect",[vV],Object.getOwnPropertyDescriptor(se.prototype,"enableContentInspect"),se.prototype),ue(se.prototype,"disableContentInspect",[yV],Object.getOwnPropertyDescriptor(se.prototype,"disableContentInspect"),se.prototype),ue(se.prototype,"setImageModeration",[TV],Object.getOwnPropertyDescriptor(se.prototype,"setImageModeration"),se.prototype),ue(se.prototype,"setP2PTransport",[SV],Object.getOwnPropertyDescriptor(se.prototype,"setP2PTransport"),se.prototype),ue(se.prototype,"getJoinChannelServiceRecords",[CV],Object.getOwnPropertyDescriptor(se.prototype,"getJoinChannelServiceRecords"),se.prototype),ue(se.prototype,"setPublishAudioFilterEnabled",[IV],Object.getOwnPropertyDescriptor(se.prototype,"setPublishAudioFilterEnabled"),se.prototype),se);class Fh{constructor(t,n){b(this,"id",0),b(this,"element",void 0),b(this,"peerPair",void 0),b(this,"context",void 0),b(this,"audioPlayerElement",void 0),b(this,"audioTrack",void 0),Fh.count+=1,this.id=Fh.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}switchSdp(){return P(this,null,function*(){if(!this.peerPair)return;let t=(r,o)=>P(this,null,function*(){let c=o==="offer"?yield r.createOffer():yield r.createAnswer();return yield r.setLocalDescription(c),r.iceGatheringState==="complete"?r.localDescription:new ie(d=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&d(r.localDescription)}})}),n=(r,o)=>P(this,null,function*(){return yield r.setRemoteDescription(o)});try{let r=yield t(this.peerPair[0],"offer");yield n(this.peerPair[1],r);let o=yield t(this.peerPair[1],"answer");yield n(this.peerPair[0],o)}catch(r){throw new G(D.LOCAL_AEC_ERROR,r.toString()).print()}})}getTracksFromMediaElement(t){return P(this,null,function*(){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(o){throw new G(D.LOCAL_AEC_ERROR,o.toString()).print()}if(!n)throw new G(D.LOCAL_AEC_ERROR,"no dest node when local aec").print();let r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r})}getElement(){return this.element}startEchoCancellation(){return P(this,null,function*(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,n=yield this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),yield this.switchSdp()})}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var wV,Jg;b(Fh,"count",0);let Kte=window.AudioContext||window.webkitAudioContext,qte=new(wV=Ee({report:he}),ue((Jg=class{constructor(){b(this,"units",[]),b(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Kte);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new Fh(e,this.context),this.units.push(t)),t.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Be().name!==ze.SAFARI}}).prototype,"processExternalMediaAEC",[wV],Object.getOwnPropertyDescriptor(Jg.prototype,"processExternalMediaAEC"),Jg.prototype),Jg);function bV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function AV(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?bV(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bV(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let wI=window||document;function DV(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!wI)return;let n=rn._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);let r=o=>{if(!(o&&o.blockedURI&&(rn.onSecurityPolicyViolation||rn.getListeners(Jo.SECURITY_POLICY_VIOLATION).length>0)))return;let c=o.blockedURI;M("CSP_DETECTED_HOSTNAME_LIST").some(d=>ne(c).call(c,d))&&(rn.onSecurityPolicyViolation&&typeof rn.onSecurityPolicyViolation=="function"&&rn.onSecurityPolicyViolation(o),rn.getListeners(Jo.SECURITY_POLICY_VIOLATION).length>0&&rn.safeEmit(Jo.SECURITY_POLICY_VIOLATION,o))};n&&wI.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||rn.getListeners(Jo.SECURITY_POLICY_VIOLATION).length>0)&&wI.addEventListener("securitypolicyviolation",r),rn._cspEventHandlerPointer=r}var zte=V,Yte=gk,OV=RegExp.prototype,$te=function(e){return e===OV||zte(OV,e)?Yte(e):e.flags},qn=a($te);function yu(e){let t=e.length;for(;--t>=0;)e[t]=0}let bI=256,NV=286,Vh=30,jh=15,AI=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Qg=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Xte=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),PV=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ns=new Array(576);yu(Ns);let Bh=new Array(60);yu(Bh);let Hh=new Array(512);yu(Hh);let Gh=new Array(256);yu(Gh);let DI=new Array(29);yu(DI);let Zg=new Array(Vh);function OI(e,t,n,r,o){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=o,this.has_stree=e&&e.length}let MV,kV,LV;function NI(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}yu(Zg);let xV=e=>e<256?Hh[e]:Hh[256+(e>>>7)],Wh=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ni=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Wh(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},ts=(e,t,n)=>{ni(e,n[2*t],n[2*t+1])},UV=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},FV=(e,t,n)=>{let r=new Array(16),o,c,d=0;for(o=1;o<=jh;o++)d=d+n[o-1]<<1,r[o]=d;for(c=0;c<=t;c++){let l=e[2*c+1];l!==0&&(e[2*c]=UV(r[l]++,l))}},VV=e=>{let t;for(t=0;t<NV;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Vh;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},jV=e=>{e.bi_valid>8?Wh(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},BV=(e,t,n,r)=>{let o=2*t,c=2*n;return e[o]<e[c]||e[o]===e[c]&&r[t]<=r[n]},PI=(e,t,n)=>{let r=e.heap[n],o=n<<1;for(;o<=e.heap_len&&(o<e.heap_len&&BV(t,e.heap[o+1],e.heap[o],e.depth)&&o++,!BV(t,r,e.heap[o],e.depth));)e.heap[n]=e.heap[o],n=o,o<<=1;e.heap[n]=r},HV=(e,t,n)=>{let r,o,c,d,l=0;if(e.sym_next!==0)do r=255&e.pending_buf[e.sym_buf+l++],r+=(255&e.pending_buf[e.sym_buf+l++])<<8,o=e.pending_buf[e.sym_buf+l++],r===0?ts(e,o,t):(c=Gh[o],ts(e,c+bI+1,t),d=AI[c],d!==0&&(o-=DI[c],ni(e,o,d)),r--,c=xV(r),ts(e,c,n),d=Qg[c],d!==0&&(r-=Zg[c],ni(e,r,d)));while(l<e.sym_next);ts(e,256,t)},MI=(e,t)=>{let n=t.dyn_tree,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,c=t.stat_desc.elems,d,l,h,f=-1;for(e.heap_len=0,e.heap_max=573,d=0;d<c;d++)n[2*d]!==0?(e.heap[++e.heap_len]=f=d,e.depth[d]=0):n[2*d+1]=0;for(;e.heap_len<2;)h=e.heap[++e.heap_len]=f<2?++f:0,n[2*h]=1,e.depth[h]=0,e.opt_len--,o&&(e.static_len-=r[2*h+1]);for(t.max_code=f,d=e.heap_len>>1;d>=1;d--)PI(e,n,d);h=c;do d=e.heap[1],e.heap[1]=e.heap[e.heap_len--],PI(e,n,1),l=e.heap[1],e.heap[--e.heap_max]=d,e.heap[--e.heap_max]=l,n[2*h]=n[2*d]+n[2*l],e.depth[h]=(e.depth[d]>=e.depth[l]?e.depth[d]:e.depth[l])+1,n[2*d+1]=n[2*l+1]=h,e.heap[1]=h++,PI(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((m,E)=>{let _=E.dyn_tree,v=E.max_code,A=E.stat_desc.static_tree,C=E.stat_desc.has_stree,I=E.stat_desc.extra_bits,O=E.stat_desc.extra_base,N=E.stat_desc.max_length,x,B,j,F,W,X,oe=0;for(F=0;F<=jh;F++)m.bl_count[F]=0;for(_[2*m.heap[m.heap_max]+1]=0,x=m.heap_max+1;x<573;x++)B=m.heap[x],F=_[2*_[2*B+1]+1]+1,F>N&&(F=N,oe++),_[2*B+1]=F,B>v||(m.bl_count[F]++,W=0,B>=O&&(W=I[B-O]),X=_[2*B],m.opt_len+=X*(F+W),C&&(m.static_len+=X*(A[2*B+1]+W)));if(oe!==0){do{for(F=N-1;m.bl_count[F]===0;)F--;m.bl_count[F]--,m.bl_count[F+1]+=2,m.bl_count[N]--,oe-=2}while(oe>0);for(F=N;F!==0;F--)for(B=m.bl_count[F];B!==0;)j=m.heap[--x],j>v||(_[2*j+1]!==F&&(m.opt_len+=(F-_[2*j+1])*_[2*j],_[2*j+1]=F),B--)}})(e,t),FV(n,f,e.bl_count)},GV=(e,t,n)=>{let r,o,c=-1,d=t[1],l=0,h=7,f=4;for(d===0&&(h=138,f=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)o=d,d=t[2*(r+1)+1],++l<h&&o===d||(l<f?e.bl_tree[2*o]+=l:o!==0?(o!==c&&e.bl_tree[2*o]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,c=o,d===0?(h=138,f=3):o===d?(h=6,f=3):(h=7,f=4))},WV=(e,t,n)=>{let r,o,c=-1,d=t[1],l=0,h=7,f=4;for(d===0&&(h=138,f=3),r=0;r<=n;r++)if(o=d,d=t[2*(r+1)+1],!(++l<h&&o===d)){if(l<f)do ts(e,o,e.bl_tree);while(--l!=0);else o!==0?(o!==c&&(ts(e,o,e.bl_tree),l--),ts(e,16,e.bl_tree),ni(e,l-3,2)):l<=10?(ts(e,17,e.bl_tree),ni(e,l-3,3)):(ts(e,18,e.bl_tree),ni(e,l-11,7));l=0,c=o,d===0?(h=138,f=3):o===d?(h=6,f=3):(h=7,f=4)}},KV=!1,qV=(e,t,n,r)=>{ni(e,0+(r?1:0),3),jV(e),Wh(e,n),Wh(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var Jte=e=>{KV||((()=>{let t,n,r,o,c,d=new Array(16);for(r=0,o=0;o<28;o++)for(DI[o]=r,t=0;t<1<<AI[o];t++)Gh[r++]=o;for(Gh[r-1]=o,c=0,o=0;o<16;o++)for(Zg[o]=c,t=0;t<1<<Qg[o];t++)Hh[c++]=o;for(c>>=7;o<Vh;o++)for(Zg[o]=c<<7,t=0;t<1<<Qg[o]-7;t++)Hh[256+c++]=o;for(n=0;n<=jh;n++)d[n]=0;for(t=0;t<=143;)Ns[2*t+1]=8,t++,d[8]++;for(;t<=255;)Ns[2*t+1]=9,t++,d[9]++;for(;t<=279;)Ns[2*t+1]=7,t++,d[7]++;for(;t<=287;)Ns[2*t+1]=8,t++,d[8]++;for(FV(Ns,287,d),t=0;t<Vh;t++)Bh[2*t+1]=5,Bh[2*t]=UV(t,5);MV=new OI(Ns,AI,257,NV,jh),kV=new OI(Bh,Qg,0,Vh,jh),LV=new OI(new Array(0),Xte,0,19,7)})(),KV=!0),e.l_desc=new NI(e.dyn_ltree,MV),e.d_desc=new NI(e.dyn_dtree,kV),e.bl_desc=new NI(e.bl_tree,LV),e.bi_buf=0,e.bi_valid=0,VV(e)},Qte=(e,t,n,r)=>{let o,c,d=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(l=>{let h,f=4093624447;for(h=0;h<=31;h++,f>>>=1)if(1&f&&l.dyn_ltree[2*h]!==0)return 0;if(l.dyn_ltree[18]!==0||l.dyn_ltree[20]!==0||l.dyn_ltree[26]!==0)return 1;for(h=32;h<bI;h++)if(l.dyn_ltree[2*h]!==0)return 1;return 0})(e)),MI(e,e.l_desc),MI(e,e.d_desc),d=(l=>{let h;for(GV(l,l.dyn_ltree,l.l_desc.max_code),GV(l,l.dyn_dtree,l.d_desc.max_code),MI(l,l.bl_desc),h=18;h>=3&&l.bl_tree[2*PV[h]+1]===0;h--);return l.opt_len+=3*(h+1)+5+5+4,h})(e),o=e.opt_len+3+7>>>3,c=e.static_len+3+7>>>3,c<=o&&(o=c)):o=c=n+5,n+4<=o&&t!==-1?qV(e,t,n,r):e.strategy===4||c===o?(ni(e,2+(r?1:0),3),HV(e,Ns,Bh)):(ni(e,4+(r?1:0),3),((l,h,f,m)=>{let E;for(ni(l,h-257,5),ni(l,f-1,5),ni(l,m-4,4),E=0;E<m;E++)ni(l,l.bl_tree[2*PV[E]+1],3);WV(l,l.dyn_ltree,h-1),WV(l,l.dyn_dtree,f-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),HV(e,e.dyn_ltree,e.dyn_dtree)),VV(e),r&&jV(e)},Zte=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Gh[n]+bI+1)]++,e.dyn_dtree[2*xV(t)]++),e.sym_next===e.sym_end),ene=e=>{ni(e,2,3),ts(e,256,Ns),(t=>{t.bi_valid===16?(Wh(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},tne={_tr_init:Jte,_tr_stored_block:qV,_tr_flush_block:Qte,_tr_tally:Zte,_tr_align:ene},Kh=(e,t,n,r)=>{let o=65535&e,c=e>>>16&65535,d=0;for(;n!==0;){d=n>2e3?2e3:n,n-=d;do o=o+t[r++]|0,c=c+o|0;while(--d);o%=65521,c%=65521}return o|c<<16};let nne=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var ar=(e,t,n,r)=>{let o=nne,c=r+n;e^=-1;for(let d=r;d<c;d++)e=e>>>8^o[255&(e^t[d])];return~e},Rc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Tu={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:rne,_tr_stored_block:kI,_tr_flush_block:ine,_tr_tally:ya,_tr_align:one}=tne,{Z_NO_FLUSH:Ta,Z_PARTIAL_FLUSH:sne,Z_FULL_FLUSH:ane,Z_FINISH:Xi,Z_BLOCK:zV,Z_OK:Er,Z_STREAM_END:YV,Z_STREAM_ERROR:ns,Z_DATA_ERROR:cne,Z_BUF_ERROR:LI,Z_DEFAULT_COMPRESSION:dne,Z_FILTERED:une,Z_HUFFMAN_ONLY:eE,Z_RLE:lne,Z_FIXED:hne,Z_DEFAULT_STRATEGY:pne,Z_UNKNOWN:fne,Z_DEFLATED:tE}=Tu,wc=258,rs=262,Su=42,bc=113,qh=666,Ac=(e,t)=>(e.msg=Rc[t],t),$V=e=>2*e-(e>4?9:0),Sa=e=>{let t=e.length;for(;--t>=0;)e[t]=0},mne=e=>{let t,n,r,o=e.w_size;t=e.hash_size,r=t;do n=e.head[--r],e.head[r]=n>=o?n-o:0;while(--t);t=o,r=t;do n=e.prev[--r],e.prev[r]=n>=o?n-o:0;while(--t)},Ca=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask,gi=e=>{let t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},Ei=(e,t)=>{ine(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,gi(e.strm)},jt=(e,t)=>{e.pending_buf[e.pending++]=t},zh=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},xI=(e,t,n,r)=>{let o=e.avail_in;return o>r&&(o=r),o===0?0:(e.avail_in-=o,t.set(e.input.subarray(e.next_in,e.next_in+o),n),e.state.wrap===1?e.adler=Kh(e.adler,t,o,n):e.state.wrap===2&&(e.adler=ar(e.adler,t,o,n)),e.next_in+=o,e.total_in+=o,o)},XV=(e,t)=>{let n,r,o=e.max_chain_length,c=e.strstart,d=e.prev_length,l=e.nice_match,h=e.strstart>e.w_size-rs?e.strstart-(e.w_size-rs):0,f=e.window,m=e.w_mask,E=e.prev,_=e.strstart+wc,v=f[c+d-1],A=f[c+d];e.prev_length>=e.good_match&&(o>>=2),l>e.lookahead&&(l=e.lookahead);do if(n=t,f[n+d]===A&&f[n+d-1]===v&&f[n]===f[c]&&f[++n]===f[c+1]){c+=2,n++;do;while(f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&f[++c]===f[++n]&&c<_);if(r=wc-(_-c),c=_-wc,r>d){if(e.match_start=t,d=r,r>=l)break;v=f[c+d-1],A=f[c+d]}}while((t=E[t&m])>h&&--o!=0);return d<=e.lookahead?d:e.lookahead},Cu=e=>{let t=e.w_size,n,r,o;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-rs)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),mne(e),r+=t),e.strm.avail_in===0)break;if(n=xI(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=Ca(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=Ca(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<rs&&e.strm.avail_in!==0)},JV=(e,t)=>{let n,r,o,c=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,d=0,l=e.strm.avail_in;do{if(n=65535,o=e.bi_valid+42>>3,e.strm.avail_out<o||(o=e.strm.avail_out-o,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>o&&(n=o),n<c&&(n===0&&t!==Xi||t===Ta||n!==r+e.strm.avail_in)))break;d=t===Xi&&n===r+e.strm.avail_in?1:0,kI(e,0,0,d),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,gi(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(xI(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(d===0);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),d?4:t!==Ta&&t!==Xi&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(o=e.window_size-e.strstart,e.strm.avail_in>o&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,o+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),o>e.strm.avail_in&&(o=e.strm.avail_in),o&&(xI(e.strm,e.window,e.strstart,o),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.high_water<e.strstart&&(e.high_water=e.strstart),o=e.bi_valid+42>>3,o=e.pending_buf_size-o>65535?65535:e.pending_buf_size-o,c=o>e.w_size?e.w_size:o,r=e.strstart-e.block_start,(r>=c||(r||t===Xi)&&t!==Ta&&e.strm.avail_in===0&&r<=o)&&(n=r>o?o:r,d=t===Xi&&e.strm.avail_in===0&&n===r?1:0,kI(e,e.block_start,n,d),e.block_start+=n,gi(e.strm)),d?3:1)},UI=(e,t)=>{let n,r;for(;;){if(e.lookahead<rs){if(Cu(e),e.lookahead<rs&&t===Ta)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Ca(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-rs&&(e.match_length=XV(e,n)),e.match_length>=3)if(r=ya(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Ca(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Ca(e,e.ins_h,e.window[e.strstart+1]);else r=ya(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Ei(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Xi?(Ei(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Ei(e,!1),e.strm.avail_out===0)?1:2},Iu=(e,t)=>{let n,r,o;for(;;){if(e.lookahead<rs){if(Cu(e),e.lookahead<rs&&t===Ta)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=Ca(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-rs&&(e.match_length=XV(e,n),e.match_length<=5&&(e.strategy===une||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-3,r=ya(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=o&&(e.ins_h=Ca(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(Ei(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(r=ya(e,0,e.window[e.strstart-1]),r&&Ei(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=ya(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Xi?(Ei(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Ei(e,!1),e.strm.avail_out===0)?1:2};function is(e,t,n,r,o){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=o}let Yh=[new is(0,0,0,0,JV),new is(4,4,8,4,UI),new is(4,5,16,8,UI),new is(4,6,32,32,UI),new is(4,4,16,16,Iu),new is(8,16,32,32,Iu),new is(8,16,128,128,Iu),new is(8,32,128,256,Iu),new is(32,128,258,1024,Iu),new is(32,258,258,4096,Iu)];function gne(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=tE,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Sa(this.dyn_ltree),Sa(this.dyn_dtree),Sa(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Sa(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Sa(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let $h=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==Su&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==bc&&t.status!==qh?1:0},QV=e=>{if($h(e))return Ac(e,ns);e.total_in=e.total_out=0,e.data_type=fne;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Su:bc,e.adler=t.wrap===2?0:1,t.last_flush=-2,rne(t),Er},ZV=e=>{let t=QV(e);return t===Er&&(n=>{n.window_size=2*n.w_size,Sa(n.head),n.max_lazy_match=Yh[n.level].max_lazy,n.good_match=Yh[n.level].good_length,n.nice_match=Yh[n.level].nice_length,n.max_chain_length=Yh[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},e2=(e,t,n,r,o,c)=>{if(!e)return ns;let d=1;if(t===dne&&(t=6),r<0?(d=0,r=-r):r>15&&(d=2,r-=16),o<1||o>9||n!==tE||r<8||r>15||t<0||t>9||c<0||c>hne||r===8&&d!==1)return Ac(e,ns);r===8&&(r=9);let l=new gne;return e.state=l,l.strm=e,l.status=Su,l.wrap=d,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=c,l.method=n,ZV(e)};var Ene=(e,t)=>{if($h(e)||t>zV||t<0)return e?Ac(e,ns):ns;let n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===qh&&t!==Xi)return Ac(e,e.avail_out===0?LI:ns);let r=n.last_flush;if(n.last_flush=t,n.pending!==0){if(gi(e),e.avail_out===0)return n.last_flush=-1,Er}else if(e.avail_in===0&&$V(t)<=$V(r)&&t!==Xi)return Ac(e,LI);if(n.status===qh&&e.avail_in!==0)return Ac(e,LI);if(n.status===Su&&n.wrap===0&&(n.status=bc),n.status===Su){let o=tE+(n.w_bits-8<<4)<<8,c=-1;if(c=n.strategy>=eE||n.level<2?0:n.level<6?1:n.level===6?2:3,o|=c<<6,n.strstart!==0&&(o|=32),o+=31-o%31,zh(n,o),n.strstart!==0&&(zh(n,e.adler>>>16),zh(n,65535&e.adler)),e.adler=1,n.status=bc,gi(e),n.pending!==0)return n.last_flush=-1,Er}if(n.status===57){if(e.adler=0,jt(n,31),jt(n,139),jt(n,8),n.gzhead)jt(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),jt(n,255&n.gzhead.time),jt(n,n.gzhead.time>>8&255),jt(n,n.gzhead.time>>16&255),jt(n,n.gzhead.time>>24&255),jt(n,n.level===9?2:n.strategy>=eE||n.level<2?4:0),jt(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(jt(n,255&n.gzhead.extra.length),jt(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=ar(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(jt(n,0),jt(n,0),jt(n,0),jt(n,0),jt(n,0),jt(n,n.level===9?2:n.strategy>=eE||n.level<2?4:0),jt(n,3),n.status=bc,gi(e),n.pending!==0)return n.last_flush=-1,Er}if(n.status===69){if(n.gzhead.extra){let o=n.pending,c=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+c>n.pending_buf_size;){let l=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+l),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>o&&(e.adler=ar(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex+=l,gi(e),n.pending!==0)return n.last_flush=-1,Er;o=0,c-=l}let d=new Uint8Array(n.gzhead.extra);n.pending_buf.set(d.subarray(n.gzindex,n.gzindex+c),n.pending),n.pending+=c,n.gzhead.hcrc&&n.pending>o&&(e.adler=ar(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let o,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(e.adler=ar(e.adler,n.pending_buf,n.pending-c,c)),gi(e),n.pending!==0)return n.last_flush=-1,Er;c=0}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,jt(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>c&&(e.adler=ar(e.adler,n.pending_buf,n.pending-c,c)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let o,c=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>c&&(e.adler=ar(e.adler,n.pending_buf,n.pending-c,c)),gi(e),n.pending!==0)return n.last_flush=-1,Er;c=0}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,jt(n,o)}while(o!==0);n.gzhead.hcrc&&n.pending>c&&(e.adler=ar(e.adler,n.pending_buf,n.pending-c,c))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(gi(e),n.pending!==0))return n.last_flush=-1,Er;jt(n,255&e.adler),jt(n,e.adler>>8&255),e.adler=0}if(n.status=bc,gi(e),n.pending!==0)return n.last_flush=-1,Er}if(e.avail_in!==0||n.lookahead!==0||t!==Ta&&n.status!==qh){let o=n.level===0?JV(n,t):n.strategy===eE?((c,d)=>{let l;for(;;){if(c.lookahead===0&&(Cu(c),c.lookahead===0)){if(d===Ta)return 1;break}if(c.match_length=0,l=ya(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++,l&&(Ei(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,d===Xi?(Ei(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(Ei(c,!1),c.strm.avail_out===0)?1:2})(n,t):n.strategy===lne?((c,d)=>{let l,h,f,m,E=c.window;for(;;){if(c.lookahead<=wc){if(Cu(c),c.lookahead<=wc&&d===Ta)return 1;if(c.lookahead===0)break}if(c.match_length=0,c.lookahead>=3&&c.strstart>0&&(f=c.strstart-1,h=E[f],h===E[++f]&&h===E[++f]&&h===E[++f])){m=c.strstart+wc;do;while(h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&h===E[++f]&&f<m);c.match_length=wc-(m-f),c.match_length>c.lookahead&&(c.match_length=c.lookahead)}if(c.match_length>=3?(l=ya(c,1,c.match_length-3),c.lookahead-=c.match_length,c.strstart+=c.match_length,c.match_length=0):(l=ya(c,0,c.window[c.strstart]),c.lookahead--,c.strstart++),l&&(Ei(c,!1),c.strm.avail_out===0))return 1}return c.insert=0,d===Xi?(Ei(c,!0),c.strm.avail_out===0?3:4):c.sym_next&&(Ei(c,!1),c.strm.avail_out===0)?1:2})(n,t):Yh[n.level].func(n,t);if(o!==3&&o!==4||(n.status=qh),o===1||o===3)return e.avail_out===0&&(n.last_flush=-1),Er;if(o===2&&(t===sne?one(n):t!==zV&&(kI(n,0,0,!1),t===ane&&(Sa(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),gi(e),e.avail_out===0))return n.last_flush=-1,Er}return t!==Xi?Er:n.wrap<=0?YV:(n.wrap===2?(jt(n,255&e.adler),jt(n,e.adler>>8&255),jt(n,e.adler>>16&255),jt(n,e.adler>>24&255),jt(n,255&e.total_in),jt(n,e.total_in>>8&255),jt(n,e.total_in>>16&255),jt(n,e.total_in>>24&255)):(zh(n,e.adler>>>16),zh(n,65535&e.adler)),gi(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Er:YV)},_ne=(e,t)=>{let n=t.length;if($h(e))return ns;let r=e.state,o=r.wrap;if(o===2||o===1&&r.status!==Su||r.lookahead)return ns;if(o===1&&(e.adler=Kh(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){o===0&&(Sa(r.head),r.strstart=0,r.block_start=0,r.insert=0);let h=new Uint8Array(r.w_size);h.set(t.subarray(n-r.w_size,n),0),t=h,n=r.w_size}let c=e.avail_in,d=e.next_in,l=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Cu(r);r.lookahead>=3;){let h=r.strstart,f=r.lookahead-2;do r.ins_h=Ca(r,r.ins_h,r.window[h+3-1]),r.prev[h&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=h,h++;while(--f);r.strstart=h,r.lookahead=2,Cu(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=d,e.input=l,e.avail_in=c,r.wrap=o,Er},Xh={deflateInit:(e,t)=>e2(e,t,tE,15,8,pne),deflateInit2:e2,deflateReset:ZV,deflateResetKeep:QV,deflateSetHeader:(e,t)=>$h(e)||e.state.wrap!==2?ns:(e.state.gzhead=t,Er),deflate:Ene,deflateEnd:e=>{if($h(e))return ns;let t=e.state.status;return e.state=null,t===bc?Ac(e,cne):Er},deflateSetDictionary:_ne,deflateInfo:"pako deflate (from Nodeca project)"};let vne=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var t2=function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(let r in n)vne(n,r)&&(e[r]=n[r])}}return e},n2=e=>{let t=0;for(let r=0,o=e.length;r<o;r++)t+=e[r].length;let n=new Uint8Array(t);for(let r=0,o=0,c=e.length;r<c;r++){let d=e[r];n.set(d,o),o+=d.length}return n};let r2=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r2=!1}let Jh=new Uint8Array(256);for(let e=0;e<256;e++)Jh[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Jh[254]=Jh[254]=1;var FI=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,r,o,c,d=e.length,l=0;for(o=0;o<d;o++)n=e.charCodeAt(o),(64512&n)==55296&&o+1<d&&(r=e.charCodeAt(o+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),o++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(l),c=0,o=0;c<l;o++)n=e.charCodeAt(o),(64512&n)==55296&&o+1<d&&(r=e.charCodeAt(o+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),o++)),n<128?t[c++]=n:n<2048?(t[c++]=192|n>>>6,t[c++]=128|63&n):n<65536?(t[c++]=224|n>>>12,t[c++]=128|n>>>6&63,t[c++]=128|63&n):(t[c++]=240|n>>>18,t[c++]=128|n>>>12&63,t[c++]=128|n>>>6&63,t[c++]=128|63&n);return t},yne=(e,t)=>{let n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let r,o,c=new Array(2*n);for(o=0,r=0;r<n;){let d=e[r++];if(d<128){c[o++]=d;continue}let l=Jh[d];if(l>4)c[o++]=65533,r+=l-1;else{for(d&=l===2?31:l===3?15:7;l>1&&r<n;)d=d<<6|63&e[r++],l--;l>1?c[o++]=65533:d<65536?c[o++]=d:(d-=65536,c[o++]=55296|d>>10&1023,c[o++]=56320|1023&d)}}return((d,l)=>{if(l<65534&&d.subarray&&r2)return String.fromCharCode.apply(null,d.length===l?d:d.subarray(0,l));let h="";for(let f=0;f<l;f++)h+=String.fromCharCode(d[f]);return h})(c,o)},Tne=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+Jh[e[n]]>t?n:t},i2=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let o2=Object.prototype.toString,{Z_NO_FLUSH:Sne,Z_SYNC_FLUSH:Cne,Z_FULL_FLUSH:Ine,Z_FINISH:Rne,Z_OK:nE,Z_STREAM_END:wne,Z_DEFAULT_COMPRESSION:bne,Z_DEFAULT_STRATEGY:Ane,Z_DEFLATED:Dne}=Tu;function Qh(e){this.options=t2({level:bne,method:Dne,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ane},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i2,this.strm.avail_out=0;let n=Xh.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==nE)throw new Error(Rc[n]);if(t.header&&Xh.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?FI(t.dictionary):o2.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=Xh.deflateSetDictionary(this.strm,r),n!==nE)throw new Error(Rc[n]);this._dict_set=!0}}function VI(e,t){let n=new Qh(t);if(n.push(e,!0),n.err)throw n.msg||Rc[n.err];return n.result}Qh.prototype.push=function(e,t){let n=this.strm,r=this.options.chunkSize,o,c;if(this.ended)return!1;for(c=t===~~t?t:t===!0?Rne:Sne,typeof e=="string"?n.input=FI(e):o2.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(c===Cne||c===Ine)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(o=Xh.deflate(n,c),o===wne)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),o=Xh.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===nE;if(n.avail_out!==0){if(c>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},Qh.prototype.onData=function(e){this.chunks.push(e)},Qh.prototype.onEnd=function(e){e===nE&&(this.result=n2(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var One={Deflate:Qh,deflate:VI,deflateRaw:function(e,t){return(t=t||{}).raw=!0,VI(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,VI(e,t)},constants:Tu};let rE=16209;var Nne=function(e,t){let n,r,o,c,d,l,h,f,m,E,_,v,A,C,I,O,N,x,B,j,F,W,X,oe,te=e.state;n=e.next_in,X=e.input,r=n+(e.avail_in-5),o=e.next_out,oe=e.output,c=o-(t-e.avail_out),d=o+(e.avail_out-257),l=te.dmax,h=te.wsize,f=te.whave,m=te.wnext,E=te.window,_=te.hold,v=te.bits,A=te.lencode,C=te.distcode,I=(1<<te.lenbits)-1,O=(1<<te.distbits)-1;e:do{v<15&&(_+=X[n++]<<v,v+=8,_+=X[n++]<<v,v+=8),N=A[_&I];t:for(;;){if(x=N>>>24,_>>>=x,v-=x,x=N>>>16&255,x===0)oe[o++]=65535&N;else{if(!(16&x)){if(64&x){if(32&x){te.mode=16191;break e}e.msg="invalid literal/length code",te.mode=rE;break e}N=A[(65535&N)+(_&(1<<x)-1)];continue t}for(B=65535&N,x&=15,x&&(v<x&&(_+=X[n++]<<v,v+=8),B+=_&(1<<x)-1,_>>>=x,v-=x),v<15&&(_+=X[n++]<<v,v+=8,_+=X[n++]<<v,v+=8),N=C[_&O];;){if(x=N>>>24,_>>>=x,v-=x,x=N>>>16&255,16&x){if(j=65535&N,x&=15,v<x&&(_+=X[n++]<<v,v+=8,v<x&&(_+=X[n++]<<v,v+=8)),j+=_&(1<<x)-1,j>l){e.msg="invalid distance too far back",te.mode=rE;break e}if(_>>>=x,v-=x,x=o-c,j>x){if(x=j-x,x>f&&te.sane){e.msg="invalid distance too far back",te.mode=rE;break e}if(F=0,W=E,m===0){if(F+=h-x,x<B){B-=x;do oe[o++]=E[F++];while(--x);F=o-j,W=oe}}else if(m<x){if(F+=h+m-x,x-=m,x<B){B-=x;do oe[o++]=E[F++];while(--x);if(F=0,m<B){x=m,B-=x;do oe[o++]=E[F++];while(--x);F=o-j,W=oe}}}else if(F+=m-x,x<B){B-=x;do oe[o++]=E[F++];while(--x);F=o-j,W=oe}for(;B>2;)oe[o++]=W[F++],oe[o++]=W[F++],oe[o++]=W[F++],B-=3;B&&(oe[o++]=W[F++],B>1&&(oe[o++]=W[F++]))}else{F=o-j;do oe[o++]=oe[F++],oe[o++]=oe[F++],oe[o++]=oe[F++],B-=3;while(B>2);B&&(oe[o++]=oe[F++],B>1&&(oe[o++]=oe[F++]))}break}if(64&x){e.msg="invalid distance code",te.mode=rE;break e}N=C[(65535&N)+(_&(1<<x)-1)]}}break}}while(n<r&&o<d);B=v>>3,n-=B,v-=B<<3,_&=(1<<v)-1,e.next_in=n,e.next_out=o,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=o<d?d-o+257:257-(o-d),te.hold=_,te.bits=v};let iE=15,Pne=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Mne=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),kne=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Lne=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Zh=(e,t,n,r,o,c,d,l)=>{let h=l.bits,f,m,E,_,v,A,C=0,I=0,O=0,N=0,x=0,B=0,j=0,F=0,W=0,X=0,oe=null,te=new Uint16Array(16),Me=new Uint16Array(16),ke,ft,Wt,Vt=null;for(C=0;C<=iE;C++)te[C]=0;for(I=0;I<r;I++)te[t[n+I]]++;for(x=h,N=iE;N>=1&&te[N]===0;N--);if(x>N&&(x=N),N===0)return o[c++]=20971520,o[c++]=20971520,l.bits=1,0;for(O=1;O<N&&te[O]===0;O++);for(x<O&&(x=O),F=1,C=1;C<=iE;C++)if(F<<=1,F-=te[C],F<0)return-1;if(F>0&&(e===0||N!==1))return-1;for(Me[1]=0,C=1;C<iE;C++)Me[C+1]=Me[C]+te[C];for(I=0;I<r;I++)t[n+I]!==0&&(d[Me[t[n+I]]++]=I);if(e===0?(oe=Vt=d,A=20):e===1?(oe=Pne,Vt=Mne,A=257):(oe=kne,Vt=Lne,A=0),X=0,I=0,C=O,v=c,B=x,j=0,E=-1,W=1<<x,_=W-1,e===1&&W>852||e===2&&W>592)return 1;for(;;){ke=C-j,d[I]+1<A?(ft=0,Wt=d[I]):d[I]>=A?(ft=Vt[d[I]-A],Wt=oe[d[I]-A]):(ft=96,Wt=0),f=1<<C-j,m=1<<B,O=m;do m-=f,o[v+(X>>j)+m]=ke<<24|ft<<16|Wt;while(m!==0);for(f=1<<C-1;X&f;)f>>=1;if(f!==0?(X&=f-1,X+=f):X=0,I++,--te[C]==0){if(C===N)break;C=t[n+d[I]]}if(C>x&&(X&_)!==E){for(j===0&&(j=x),v+=O,B=C-j,F=1<<B;B+j<N&&(F-=te[B+j],!(F<=0));)B++,F<<=1;if(W+=1<<B,e===1&&W>852||e===2&&W>592)return 1;E=X&_,o[E]=x<<24|B<<16|v-c}}return X!==0&&(o[v+X]=C-j<<24|64<<16),l.bits=x,0};let{Z_FINISH:s2,Z_BLOCK:xne,Z_TREES:oE,Z_OK:Dc,Z_STREAM_END:Une,Z_NEED_DICT:Fne,Z_STREAM_ERROR:Ji,Z_DATA_ERROR:a2,Z_MEM_ERROR:c2,Z_BUF_ERROR:Vne,Z_DEFLATED:d2}=Tu,sE=16180,aE=16190,Ps=16191,jI=16192,BI=16194,cE=16199,dE=16200,HI=16206,_n=16209,u2=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function jne(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let Oc=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<sE||t.mode>16211?1:0},l2=e=>{if(Oc(e))return Ji;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=sE,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Dc},h2=e=>{if(Oc(e))return Ji;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,l2(e)},p2=(e,t)=>{let n;if(Oc(e))return Ji;let r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Ji:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,h2(e))},f2=(e,t)=>{if(!e)return Ji;let n=new jne;e.state=n,n.strm=e,n.window=null,n.mode=sE;let r=p2(e,t);return r!==Dc&&(e.state=null),r},GI,WI,m2=!0,Bne=e=>{if(m2){GI=new Int32Array(512),WI=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Zh(1,e.lens,0,288,GI,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Zh(2,e.lens,0,32,WI,0,e.work,{bits:5}),m2=!1}e.lencode=GI,e.lenbits=9,e.distcode=WI,e.distbits=5},g2=(e,t,n,r)=>{let o,c=e.state;return c.window===null&&(c.wsize=1<<c.wbits,c.wnext=0,c.whave=0,c.window=new Uint8Array(c.wsize)),r>=c.wsize?(c.window.set(t.subarray(n-c.wsize,n),0),c.wnext=0,c.whave=c.wsize):(o=c.wsize-c.wnext,o>r&&(o=r),c.window.set(t.subarray(n-r,n-r+o),c.wnext),(r-=o)?(c.window.set(t.subarray(n-r,n),0),c.wnext=r,c.whave=c.wsize):(c.wnext+=o,c.wnext===c.wsize&&(c.wnext=0),c.whave<c.wsize&&(c.whave+=o))),0};var Hne=(e,t)=>{let n,r,o,c,d,l,h,f,m,E,_,v,A,C,I,O,N,x,B,j,F,W,X=0,oe=new Uint8Array(4),te,Me,ke=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Oc(e)||!e.output||!e.input&&e.avail_in!==0)return Ji;n=e.state,n.mode===Ps&&(n.mode=jI),d=e.next_out,o=e.output,h=e.avail_out,c=e.next_in,r=e.input,l=e.avail_in,f=n.hold,m=n.bits,E=l,_=h,W=Dc;e:for(;;)switch(n.mode){case sE:if(n.wrap===0){n.mode=jI;break}for(;m<16;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}if(2&n.wrap&&f===35615){n.wbits===0&&(n.wbits=15),n.check=0,oe[0]=255&f,oe[1]=f>>>8&255,n.check=ar(n.check,oe,2,0),f=0,m=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",n.mode=_n;break}if((15&f)!==d2){e.msg="unknown compression method",n.mode=_n;break}if(f>>>=4,m-=4,F=8+(15&f),n.wbits===0&&(n.wbits=F),F>15||F>n.wbits){e.msg="invalid window size",n.mode=_n;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&f?16189:Ps,f=0,m=0;break;case 16181:for(;m<16;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}if(n.flags=f,(255&qn(n))!==d2){e.msg="unknown compression method",n.mode=_n;break}if(57344&qn(n)){e.msg="unknown header flags set",n.mode=_n;break}n.head&&(n.head.text=f>>8&1),512&qn(n)&&4&n.wrap&&(oe[0]=255&f,oe[1]=f>>>8&255,n.check=ar(n.check,oe,2,0)),f=0,m=0,n.mode=16182;case 16182:for(;m<32;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}n.head&&(n.head.time=f),512&qn(n)&&4&n.wrap&&(oe[0]=255&f,oe[1]=f>>>8&255,oe[2]=f>>>16&255,oe[3]=f>>>24&255,n.check=ar(n.check,oe,4,0)),f=0,m=0,n.mode=16183;case 16183:for(;m<16;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}n.head&&(n.head.xflags=255&f,n.head.os=f>>8),512&qn(n)&&4&n.wrap&&(oe[0]=255&f,oe[1]=f>>>8&255,n.check=ar(n.check,oe,2,0)),f=0,m=0,n.mode=16184;case 16184:if(1024&qn(n)){for(;m<16;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}n.length=f,n.head&&(n.head.extra_len=f),512&qn(n)&&4&n.wrap&&(oe[0]=255&f,oe[1]=f>>>8&255,n.check=ar(n.check,oe,2,0)),f=0,m=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&qn(n)&&(v=n.length,v>l&&(v=l),v&&(n.head&&(F=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(c,c+v),F)),512&qn(n)&&4&n.wrap&&(n.check=ar(n.check,r,v,c)),l-=v,c+=v,n.length-=v),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&qn(n)){if(l===0)break e;v=0;do F=r[c+v++],n.head&&F&&n.length<65536&&(n.head.name+=String.fromCharCode(F));while(F&&v<l);if(512&qn(n)&&4&n.wrap&&(n.check=ar(n.check,r,v,c)),l-=v,c+=v,F)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&qn(n)){if(l===0)break e;v=0;do F=r[c+v++],n.head&&F&&n.length<65536&&(n.head.comment+=String.fromCharCode(F));while(F&&v<l);if(512&qn(n)&&4&n.wrap&&(n.check=ar(n.check,r,v,c)),l-=v,c+=v,F)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&qn(n)){for(;m<16;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}if(4&n.wrap&&f!==(65535&n.check)){e.msg="header crc mismatch",n.mode=_n;break}f=0,m=0}n.head&&(n.head.hcrc=qn(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Ps;break;case 16189:for(;m<32;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}e.adler=n.check=u2(f),f=0,m=0,n.mode=aE;case aE:if(n.havedict===0)return e.next_out=d,e.avail_out=h,e.next_in=c,e.avail_in=l,n.hold=f,n.bits=m,Fne;e.adler=n.check=1,n.mode=Ps;case Ps:if(t===xne||t===oE)break e;case jI:if(n.last){f>>>=7&m,m-=7&m,n.mode=HI;break}for(;m<3;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}switch(n.last=1&f,f>>>=1,m-=1,3&f){case 0:n.mode=16193;break;case 1:if(Bne(n),n.mode=cE,t===oE){f>>>=2,m-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=_n}f>>>=2,m-=2;break;case 16193:for(f>>>=7&m,m-=7&m;m<32;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",n.mode=_n;break}if(n.length=65535&f,f=0,m=0,n.mode=BI,t===oE)break e;case BI:n.mode=16195;case 16195:if(v=n.length,v){if(v>l&&(v=l),v>h&&(v=h),v===0)break e;o.set(r.subarray(c,c+v),d),l-=v,c+=v,h-=v,d+=v,n.length-=v;break}n.mode=Ps;break;case 16196:for(;m<14;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}if(n.nlen=257+(31&f),f>>>=5,m-=5,n.ndist=1+(31&f),f>>>=5,m-=5,n.ncode=4+(15&f),f>>>=4,m-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=_n;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;m<3;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}n.lens[ke[n.have++]]=7&f,f>>>=3,m-=3}for(;n.have<19;)n.lens[ke[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,te={bits:n.lenbits},W=Zh(0,n.lens,0,19,n.lencode,0,n.work,te),n.lenbits=te.bits,W){e.msg="invalid code lengths set",n.mode=_n;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;X=n.lencode[f&(1<<n.lenbits)-1],I=X>>>24,O=X>>>16&255,N=65535&X,!(I<=m);){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}if(N<16)f>>>=I,m-=I,n.lens[n.have++]=N;else{if(N===16){for(Me=I+2;m<Me;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}if(f>>>=I,m-=I,n.have===0){e.msg="invalid bit length repeat",n.mode=_n;break}F=n.lens[n.have-1],v=3+(3&f),f>>>=2,m-=2}else if(N===17){for(Me=I+3;m<Me;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}f>>>=I,m-=I,F=0,v=3+(7&f),f>>>=3,m-=3}else{for(Me=I+7;m<Me;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}f>>>=I,m-=I,F=0,v=11+(127&f),f>>>=7,m-=7}if(n.have+v>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=_n;break}for(;v--;)n.lens[n.have++]=F}}if(n.mode===_n)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=_n;break}if(n.lenbits=9,te={bits:n.lenbits},W=Zh(1,n.lens,0,n.nlen,n.lencode,0,n.work,te),n.lenbits=te.bits,W){e.msg="invalid literal/lengths set",n.mode=_n;break}if(n.distbits=6,n.distcode=n.distdyn,te={bits:n.distbits},W=Zh(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,te),n.distbits=te.bits,W){e.msg="invalid distances set",n.mode=_n;break}if(n.mode=cE,t===oE)break e;case cE:n.mode=dE;case dE:if(l>=6&&h>=258){e.next_out=d,e.avail_out=h,e.next_in=c,e.avail_in=l,n.hold=f,n.bits=m,Nne(e,_),d=e.next_out,o=e.output,h=e.avail_out,c=e.next_in,r=e.input,l=e.avail_in,f=n.hold,m=n.bits,n.mode===Ps&&(n.back=-1);break}for(n.back=0;X=n.lencode[f&(1<<n.lenbits)-1],I=X>>>24,O=X>>>16&255,N=65535&X,!(I<=m);){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}if(O&&!(240&O)){for(x=I,B=O,j=N;X=n.lencode[j+((f&(1<<x+B)-1)>>x)],I=X>>>24,O=X>>>16&255,N=65535&X,!(x+I<=m);){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}f>>>=x,m-=x,n.back+=x}if(f>>>=I,m-=I,n.back+=I,n.length=N,O===0){n.mode=16205;break}if(32&O){n.back=-1,n.mode=Ps;break}if(64&O){e.msg="invalid literal/length code",n.mode=_n;break}n.extra=15&O,n.mode=16201;case 16201:if(n.extra){for(Me=n.extra;m<Me;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;X=n.distcode[f&(1<<n.distbits)-1],I=X>>>24,O=X>>>16&255,N=65535&X,!(I<=m);){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}if(!(240&O)){for(x=I,B=O,j=N;X=n.distcode[j+((f&(1<<x+B)-1)>>x)],I=X>>>24,O=X>>>16&255,N=65535&X,!(x+I<=m);){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}f>>>=x,m-=x,n.back+=x}if(f>>>=I,m-=I,n.back+=I,64&O){e.msg="invalid distance code",n.mode=_n;break}n.offset=N,n.extra=15&O,n.mode=16203;case 16203:if(n.extra){for(Me=n.extra;m<Me;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=_n;break}n.mode=16204;case 16204:if(h===0)break e;if(v=_-h,n.offset>v){if(v=n.offset-v,v>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=_n;break}v>n.wnext?(v-=n.wnext,A=n.wsize-v):A=n.wnext-v,v>n.length&&(v=n.length),C=n.window}else C=o,A=d-n.offset,v=n.length;v>h&&(v=h),h-=v,n.length-=v;do o[d++]=C[A++];while(--v);n.length===0&&(n.mode=dE);break;case 16205:if(h===0)break e;o[d++]=n.length,h--,n.mode=dE;break;case HI:if(n.wrap){for(;m<32;){if(l===0)break e;l--,f|=r[c++]<<m,m+=8}if(_-=h,e.total_out+=_,n.total+=_,4&n.wrap&&_&&(e.adler=n.check=qn(n)?ar(n.check,o,_,d-_):Kh(n.check,o,_,d-_)),_=h,4&n.wrap&&(qn(n)?f:u2(f))!==n.check){e.msg="incorrect data check",n.mode=_n;break}f=0,m=0}n.mode=16207;case 16207:if(n.wrap&&qn(n)){for(;m<32;){if(l===0)break e;l--,f+=r[c++]<<m,m+=8}if(4&n.wrap&&f!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=_n;break}f=0,m=0}n.mode=16208;case 16208:W=Une;break e;case _n:W=a2;break e;case 16210:return c2;default:return Ji}return e.next_out=d,e.avail_out=h,e.next_in=c,e.avail_in=l,n.hold=f,n.bits=m,(n.wsize||_!==e.avail_out&&n.mode<_n&&(n.mode<HI||t!==s2))&&g2(e,e.output,e.next_out,_-e.avail_out),E-=e.avail_in,_-=e.avail_out,e.total_in+=E,e.total_out+=_,n.total+=_,4&n.wrap&&_&&(e.adler=n.check=qn(n)?ar(n.check,o,_,e.next_out-_):Kh(n.check,o,_,e.next_out-_)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Ps?128:0)+(n.mode===cE||n.mode===BI?256:0),(E===0&&_===0||t===s2)&&W===Dc&&(W=Vne),W},Ms={inflateReset:h2,inflateReset2:p2,inflateResetKeep:l2,inflateInit:e=>f2(e,15),inflateInit2:f2,inflate:Hne,inflateEnd:e=>{if(Oc(e))return Ji;let t=e.state;return t.window&&(t.window=null),e.state=null,Dc},inflateGetHeader:(e,t)=>{if(Oc(e))return Ji;let n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,Dc):Ji},inflateSetDictionary:(e,t)=>{let n=t.length,r,o,c;return Oc(e)?Ji:(r=e.state,r.wrap!==0&&r.mode!==aE?Ji:r.mode===aE&&(o=1,o=Kh(o,t,n,0),o!==r.check)?a2:(c=g2(e,t,n,n),c?(r.mode=16210,c2):(r.havedict=1,Dc)))},inflateInfo:"pako inflate (from Nodeca project)"},Gne=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let E2=Object.prototype.toString,{Z_NO_FLUSH:Wne,Z_FINISH:Kne,Z_OK:ep,Z_STREAM_END:KI,Z_NEED_DICT:qI,Z_STREAM_ERROR:qne,Z_DATA_ERROR:_2,Z_MEM_ERROR:zne}=Tu;function tp(e){this.options=t2({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i2,this.strm.avail_out=0;let n=Ms.inflateInit2(this.strm,t.windowBits);if(n!==ep)throw new Error(Rc[n]);if(this.header=new Gne,Ms.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=FI(t.dictionary):E2.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Ms.inflateSetDictionary(this.strm,t.dictionary),n!==ep)))throw new Error(Rc[n])}function zI(e,t){let n=new tp(t);if(n.push(e),n.err)throw n.msg||Rc[n.err];return n.result}tp.prototype.push=function(e,t){let n=this.strm,r=this.options.chunkSize,o=this.options.dictionary,c,d,l;if(this.ended)return!1;for(d=t===~~t?t:t===!0?Kne:Wne,E2.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),c=Ms.inflate(n,d),c===qI&&o&&(c=Ms.inflateSetDictionary(n,o),c===ep?c=Ms.inflate(n,d):c===_2&&(c=qI));n.avail_in>0&&c===KI&&n.state.wrap>0&&e[n.next_in]!==0;)Ms.inflateReset(n),c=Ms.inflate(n,d);switch(c){case qne:case _2:case qI:case zne:return this.onEnd(c),this.ended=!0,!1}if(l=n.avail_out,n.next_out&&(n.avail_out===0||c===KI))if(this.options.to==="string"){let h=Tne(n.output,n.next_out),f=n.next_out-h,m=yne(n.output,h);n.next_out=f,n.avail_out=r-f,f&&n.output.set(n.output.subarray(h,h+f),0),this.onData(m)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(c!==ep||l!==0){if(c===KI)return c=Ms.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},tp.prototype.onData=function(e){this.chunks.push(e)},tp.prototype.onEnd=function(e){e===ep&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n2(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Yne={Inflate:tp,inflate:zI,inflateRaw:function(e,t){return(t=t||{}).raw=!0,zI(e,t)},ungzip:zI,constants:Tu};let{Deflate:Gfe,deflate:$ne,deflateRaw:Wfe,gzip:Kfe}=One,{Inflate:qfe,inflate:Xne,inflateRaw:zfe,ungzip:Yfe}=Yne;var Jne=$ne,Qne=Xne,v2=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(v2||{});class Zne{constructor(){b(this,"_sequence",0),b(this,"_startTime",Date.now()),b(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let l=new Uint8Array(4);l.set([1,0,0,0]);let h={id:0,length:4,data:l.buffer},f={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[h]};n.commonPacketHeader.extension=1,n.extension=f,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;M("SHOW_DATASTREAM2_LOG")&&T.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));let r=new ArrayBuffer(n.commonPacketHeader.length),o=new Uint8Array(r),c=new DataView(r),d=0;if(c.setUint16(d,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),d+=2,c.setUint32(d,n.commonPacketHeader.sequence,!0),d+=4,c.setUint16(d,n.commonStreamHeader,!0),d+=2,n.extension){let l=this.serializeExtension(n.extension);o.set(new Uint8Array(l),d),d+=l.byteLength}if(o.set(new Uint8Array(n.payload),d),d+=n.payload.byteLength,d!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let n=new DataView(t),r=0,o=n.getUint16(r,!0);r+=2;let c={length:16383&o,reserved:(16384&o)>>14,extension:(32768&o)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)},d,l;if(r+=4,M("SHOW_DATASTREAM2_LOG")&&T.debug("receive data header: ".concat(JSON.stringify(c))),n.getUint16(r,!0),r+=2,c.extension){l=this.deserializeExtension(t.slice(r)),r+=2+l.length,d=t.slice(r);let h=!1;if(l.datas.length>0){let f=l.datas.find(m=>m.id===0);f&&(h=!(1&~new DataView(f.data).getUint32(0,!0)))}d=h?this.decompress(d):d}else d=t.slice(8);return d}serializeExtension(t){let{profile:n,length:r,datas:o}=t,c=new ArrayBuffer(r+2),d=new Uint8Array(c),l=new DataView(c),h=0;if(l.setUint8(h++,n),l.setUint8(h++,r),o.forEach(f=>{n?(l.setUint8(h++,f.id),l.setUint8(h++,f.length),d.set(new Uint8Array(f.data),h),h+=f.data.byteLength):(l.setUint8(h++,f.id|f.length<<4),d.set(new Uint8Array(f.data),h),h+=f.data.byteLength)}),h!==r+2)throw Error("serialize extension error, is ".concat(h,"!==").concat(r+2));return c}deserializeExtension(t){let n=new DataView(t),r=0,o=n.getUint8(r);r++;let c=n.getUint8(r);r++;let d=o===v2.TWO_BYTE,l=[],h=new DataView(t,2),f=0;for(;f<c;){let m=0,E=0,_=new ArrayBuffer(0);d?(m=h.getUint8(f),f++,E=h.getUint8(f),f++):(m=15&h.getUint8(f),E=h.getUint8(f)>>4,f++),E>0&&(_=h.buffer.slice(f+2,f+2+E),f+=_.byteLength),l.push({id:m,length:E,data:_})}if(f!==c)throw Error("parse error");return{profile:o,length:c,datas:l}}decompress(t){return Qne(new Uint8Array(t))}compress(t){return Jne(new Uint8Array(t))}}let ere={name:"DataStream",create:(e,t)=>{let n=t?new lee(e):new hee(e);return n.useDataStream(new Zne),n}};class tre extends Dt{constructor(t,n,r){super(),b(this,"ws",void 0),b(this,"requestId",1),b(this,"heartBeatTimer",void 0),b(this,"joinInfo",void 0),b(this,"clientId",void 0),b(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),b(this,"onClose",o=>{this.emit("close"),this.dispose()}),b(this,"onMessage",o=>{let c=JSON.parse(o.data);if(!c||c.command!=="serverResponse"||!c.requestId)return c&&c.command==="serverStatus"&&c.serverStatus&&c.serverStatus.command?(this.emit("status",c.serverStatus),void this.emit(c.serverStatus.command,c.serverStatus)):void 0;this.emit("req_".concat(c.requestId),c)}),this.joinInfo=t,this.clientId=n,this.ws=new Ah("cross-channel-".concat(this.clientId),r),this.ws.on(Re.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Re.CONNECTED,this.onOpen),this.ws.on(Re.ON_MESSAGE,this.onMessage),this.ws.on(Re.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new ie((n,r)=>{let o=window.setTimeout(()=>{r(new G(D.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,c=>{window.clearTimeout(o),c.state&&c.state!==0?r(new G(D.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),r(new G(D.WS_ABORT))})})}request(t){return P(this,null,function*(){if(this.ws.state==="closed")throw new G(D.WS_DISCONNECT);let n=()=>new ie((d,l)=>{this.ws.once(Re.CLOSED,()=>l(new G(D.WS_ABORT))),this.ws.once(Re.CONNECTED,d)});this.ws.state!=="connected"&&(yield n());let r=this.sendMessage(t),o=new ie((d,l)=>{let h=()=>{l(new G(D.WS_ABORT))};this.ws.once(Re.RECONNECTING,h),this.ws.once(Re.CLOSED,h),this.once("req_".concat(r),d),Sn(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(Re.RECONNECTING,h),this.ws.off(Re.CLOSED,h),l(new G(D.TIMEOUT,"cross channel ws request timeout"))})}),c=yield o;if(!c||c.code!==200)throw new G(D.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(c)));return c})}connect(t){return P(this,null,function*(){this.ws.removeAllListeners(Re.REQUEST_NEW_URLS),this.ws.on(Re.REQUEST_NEW_URLS,n=>{n(t)}),yield this.ws.init(t)})}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class nre extends Dt{set state(t){t!==this._state&&(t!==Rr.RELAY_STATE_FAILURE&&(this.errorCode=ou.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,o,c){super(),b(this,"joinInfo",void 0),b(this,"sid",void 0),b(this,"clientId",void 0),b(this,"cancelToken",pr.CancelToken.source()),b(this,"workerToken",void 0),b(this,"requestId",0),b(this,"signal",void 0),b(this,"prevChannelMediaConfig",void 0),b(this,"httpRetryConfig",void 0),b(this,"_resolution",void 0),b(this,"_state",Rr.RELAY_STATE_IDLE),b(this,"errorCode",ou.RELAY_OK),b(this,"onStatus",d=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(d))),d&&d.command&&(d.command==="onAudioPacketReceived"&&this.emit("event",ws.PACKET_RECEIVED_AUDIO_FROM_SRC),d.command==="onVideoPacketReceived"&&this.emit("event",ws.PACKET_RECEIVED_VIDEO_FROM_SRC),d.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=ou.SRC_TOKEN_EXPIRED,this.state=Rr.RELAY_STATE_FAILURE),d.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=ou.DEST_TOKEN_EXPIRED,this.state=Rr.RELAY_STATE_FAILURE))}),b(this,"onReconnect",()=>P(this,null,function*(){T.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",ws.NETWORK_DISCONNECTED),this.state=Rr.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(d=>{this.state!==Rr.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",d.toString()),this.errorCode=ou.SERVER_CONNECTION_LOST,this.state=Rr.RELAY_STATE_FAILURE)})})),this.joinInfo=t,this.clientId=n,this.sid=dc(),this.signal=new tre(this.joinInfo,this.clientId,r),this.httpRetryConfig=o,this._resolution=c}startChannelMediaRelay(t){return P(this,null,function*(){if(this.state!==Rr.RELAY_STATE_IDLE)throw new G(D.INVALID_OPERATION);this.state=Rr.RELAY_STATE_CONNECTING,yield this.connect(),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{yield this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new G(D.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new G(D.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new G(D.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t})}updateChannelMediaRelay(t){return P(this,null,function*(){if(this.state!==Rr.RELAY_STATE_RUNNING)throw new G(D.INVALID_OPERATION);yield this.sendUpdateMessage(t),this.prevChannelMediaConfig=t})}setVideoProfile(t){return P(this,null,function*(){if(this._resolution=t,this.state!==Rr.RELAY_STATE_RUNNING)throw new G(D.INVALID_OPERATION);let n=this.genMessage(sr.SetVideoProfile);yield this.signal.request(n),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))})}stopChannelMediaRelay(){return P(this,null,function*(){yield this.sendStopRelayMessage(),T.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Rr.RELAY_STATE_IDLE,this.dispose()})}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=pr.CancelToken.source(),this.state=Rr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){return P(this,null,function*(){let t=yield _te(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,yield this.signal.connect(t.addressList),this.emit("event",ws.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)})}sendStartRelayMessage(t){return P(this,null,function*(){let n=this.genMessage(sr.StopPacketTransfer);yield this.signal.request(n),yield this.signal.waitStatus("Normal Quit"),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let r=this.genMessage(sr.SetSdkProfile,t);yield this.signal.request(r),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let o=this.genMessage(sr.SetSourceChannel,t);yield this.signal.request(o),yield this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",ws.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let c=this.genMessage(sr.SetSourceUserId,t);yield this.signal.request(c),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let d=this.genMessage(sr.SetDestChannel,t);yield this.signal.request(d),yield this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",ws.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let l=this.genMessage(sr.StartPacketTransfer,t);yield this.signal.request(l),this.emit("event",ws.PACKET_SENT_TO_DEST_CHANNEL),this.state=Rr.RELAY_STATE_RUNNING,T.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)})}sendUpdateMessage(t){return P(this,null,function*(){let n=this.genMessage(sr.UpdateDestChannel,t);yield this.signal.request(n),this.emit("event",ws.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})}sendStopRelayMessage(){return P(this,null,function*(){let t=this.genMessage(sr.StopPacketTransfer);yield this.signal.request(t),T.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})}genMessage(t,n){let r=[],o=[],c=[];this.requestId+=1;let d={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:li,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};d.sdkVersion==="4.23.1"&&(d.sdkVersion="0.0.1");let l=null,h=null;switch(t){case sr.SetSdkProfile:return d.clientRequest={command:"SetSdkProfile",type:"multi_channel"},d;case sr.SetSourceChannel:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new G(D.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceChannel",uid:"0",channelName:h.channelName,token:h.token||this.joinInfo.appId},d;case sr.SetSourceUserId:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new G(D.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceUserId",uid:h.uid+""},d;case sr.SetDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new G(D.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(f=>{r.push(f.channelName),o.push(f.uid+""),c.push(f.token||this.joinInfo.appId)}),d.clientRequest={command:"SetDestChannel",channelName:r,uid:o,token:c},d;case sr.StartPacketTransfer:return d.clientRequest={command:"StartPacketTransfer"},d;case sr.Reconnect:return d.clientRequest={command:"Reconnect"},d;case sr.StopPacketTransfer:return d.clientRequest={command:"StopPacketTransfer"},d;case sr.UpdateDestChannel:if(l=n&&n.getDestChannelMediaInfo(),!l)throw new G(D.UNEXPECTED_ERROR,"can not find dest config");return l.forEach(f=>{r.push(f.channelName),o.push(f.uid+""),c.push(f.token||this.joinInfo.appId)}),d.clientRequest={command:"UpdateDestChannel",channelName:r,uid:o,token:c},d;case sr.SetVideoProfile:d.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return d}}let rre={name:"ChannelMediaRelay",create:function(e){return new nre(e.joinInfo,e.clientId,e.websocketRetryConfig||nn,e.httpRetryConfig||nn,e.resolution)}};function y2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function np(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?y2(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class ire extends Dt{constructor(t,n,r,o){super(),b(this,"spec",void 0),b(this,"token",void 0),b(this,"websocket",void 0),b(this,"pingpongTimer",void 0),b(this,"reconnectMode","retry"),b(this,"serviceMode",void 0),b(this,"reqId",0),b(this,"commandReqId",0),b(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),b(this,"handleWebSocketMessage",c=>{if(!c.data)return;let d=JSON.parse(c.data);d.requestId?this.emit("@".concat(d.requestId,"-").concat(d.sid),d):(he.workerEvent(this.spec.sid,{actionType:"status",serverCode:d.code,workerType:this.serviceMode===Xo.TRANSCODE?1:2}),this.emit(la.PUBLISH_STREAM_STATUS,d))}),this.spec=n,this.token=t,this.serviceMode=o,this.websocket=new Ah("live-streaming",r),this.websocket.on(Re.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Re.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Re.REQUEST_NEW_URLS,(c,d)=>{An(this,la.REQUEST_NEW_ADDRESS).then(c).catch(d)}),this.websocket.on(Re.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}request(t,n,r,o){return P(this,null,function*(){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let c=this.commandReqId,d=this.reqId;if(!d||!this.websocket)throw new G(D.UNEXPECTED_ERROR);let l=np({command:t,sdkVersion:li==="4.23.1"?"0.0.1":li,seq:d,requestId:d,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new G(D.WS_DISCONNECT);let h=()=>new ie((_,v)=>{this.websocket.once(Re.CLOSED,()=>v(new G(D.WS_ABORT))),this.websocket.once(Re.CONNECTED,_)});this.websocket.state!=="connected"&&(yield h()),l.clientRequest&&(l.clientRequest.workerToken=this.token);let f=new ie((_,v)=>{let A=()=>{v(new G(D.WS_ABORT))};this.websocket.once(Re.RECONNECTING,A),this.websocket.once(Re.CLOSED,A),this.once("@".concat(d,"-").concat(this.spec.sid),C=>{_(C)})});o&&he.workerEvent(this.spec.sid,np(np({},o),{},{requestId:c,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));let m=Date.now();this.websocket.sendMessage(l);let E=null;try{E=yield f}catch(_){if(this.websocket.state==="closed")throw _;return yield h(),yield this.request(t,n,r)}return o&&he.workerEvent(this.spec.sid,np(np({},o),{},{requestId:c,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-m})),E.code!==200&&this.handleResponseError(E),E})}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=li==="4.23.1"?"0.0.1":li;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case an.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case an.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case an.LIVE_STREAM_RESPONSE_BAD_STREAM:case an.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new G(D.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case an.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new G(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case an.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new G(D.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case an.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let n=new G(D.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(la.WARNING,n,t.serverResponse.url)}case an.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let n=new G(D.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(la.WARNING,n,t.serverResponse.url)}case an.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new G(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case an.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new G(D.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case an.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let n=new G(D.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(la.WARNING,n,t.serverResponse.url)}case an.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new G(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case an.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new G(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case an.LIVE_STREAM_RESPONSE_WORKER_LOST:case an.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new G(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case an.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new G(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new G(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case an.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case an.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case an.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case an.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new G(D.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(eg)},6e3)}}function T2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function br(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?T2(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class ore extends Dt{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nn,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:nn;super(),b(this,"onLiveStreamWarning",void 0),b(this,"onLiveStreamError",void 0),b(this,"spec",void 0),b(this,"retryTimeout",1e4),b(this,"connection",void 0),b(this,"httpRetryConfig",void 0),b(this,"wsRetryConfig",void 0),b(this,"streamingTasks",new Map),b(this,"isStartingStreamingTask",!1),b(this,"taskMutex",new kn("live-streaming")),b(this,"cancelToken",pr.CancelToken.source()),b(this,"transcodingConfig",void 0),b(this,"uapResponse",void 0),b(this,"lastTaskId",1),b(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}setTranscodingConfig(t){return P(this,null,function*(){let n=br(br({},Qee),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(T.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(d=>br(br(br({},Jee),d),{},{zOrder:d.zOrder?d.zOrder+1:1}))),function(d){Mt(d.width)||st(d.width,"config.width",0,1e4),Mt(d.height)||st(d.height,"config.height",0,1e4),Mt(d.videoBitrate)||st(d.videoBitrate,"config.videoBitrate",1,1e6),Mt(d.videoFrameRate)||st(d.videoFrameRate,"config.videoFrameRate"),Mt(d.lowLatency)||Cs(d.lowLatency,"config.lowLatency"),Mt(d.audioSampleRate)||dn(d.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Mt(d.audioBitrate)||st(d.audioBitrate,"config.audioBitrate",1,128),Mt(d.audioChannels)||dn(d.audioChannels,"config.audioChannels",[1,2,3,4,5]),Mt(d.videoGop)||st(d.videoGop,"config.videoGop"),Mt(d.videoCodecProfile)||dn(d.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Mt(d.userCount)||st(d.userCount,"config.userCount",0,17),Mt(d.backgroundColor)||st(d.backgroundColor,"config.backgroundColor",0,16777215),Mt(d.userConfigExtraInfo)||Tn(d.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),d.transcodingUsers&&!Mt(d.transcodingUsers)&&(Is(d.transcodingUsers,"config.transcodingUsers"),d.transcodingUsers.forEach((l,h)=>{Rg(l.uid),Mt(l.x)||st(l.x,"transcodingUser[".concat(h,"].x"),0,1e4),Mt(l.y)||st(l.y,"transcodingUser[".concat(h,"].y"),0,1e4),Mt(l.width)||st(l.width,"transcodingUser[".concat(h,"].width"),0,1e4),Mt(l.height)||st(l.height,"transcodingUser[".concat(h,"].height"),0,1e4),Mt(l.zOrder)||st(l.zOrder-1,"transcodingUser[".concat(h,"].zOrder"),0,100),Mt(l.alpha)||st(l.alpha,"transcodingUser[".concat(h,"].alpha"),0,1,!1)})),Mt(d.watermark)||qC(d.watermark,"watermark"),Mt(d.backgroundImage)||qC(d.backgroundImage,"backgroundImage"),d.images&&!Mt(d.images)&&(Is(d.images,"config.images"),d.images.forEach((l,h)=>{qC(l,"images[".concat(h,"]"))}))}(n);let r=[];n.images&&r.push(...n.images.map(d=>br(br(br({},KC),d),{},{zOrder:255}))),n.backgroundImage&&(r.push(br(br(br({},KC),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(br(br(br({},KC),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(d=>br({},d)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);let o=(n.userConfigs||[]).map(d=>typeof d.uid=="number"?ie.resolve(d.uid):FU(d.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((yield ie.all(o)).forEach((d,l)=>{n.userConfigs&&n.userConfigs[l]&&(n.userConfigs[l].uid=d)}),this.transcodingConfig=n,this.connection)try{var c;let d=yield this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Wr(c=this.streamingTasks).call(c)).map(l=>l.taskId).join("#")});T.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(d.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(d){if(!d.data||!d.data.retry)throw d;d.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(l=>{T.warning("[".concat(this.spec.clientId,"] live streaming receive error"),d.toString(),"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,d).then(()=>{T.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(l.url," success"))}).catch(h=>{T.error("[".concat(this.spec.clientId,"] live streaming republish failed"),l.url,h.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,h)})})}})}startLiveStreamingTask(t,n,r){return P(this,null,function*(){if(!this.transcodingConfig&&n===Xo.TRANSCODE)throw new G(D.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let o={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));let c=yield this.taskMutex.lock();if(!this.connection&&r)return void c();if(this.streamingTasks.get(t)&&!r)return c(),new G(D.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=yield this.connect(n))}catch(l){throw c(),l}switch(n){case Xo.TRANSCODE:o.transcodingConfig=br({},this.transcodingConfig);case Xo.RAW:}this.uapResponse&&this.uapResponse.vid&&(o.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let d=this.lastTaskId++;try{let l=new ie((f,m)=>{Sn(this.retryTimeout).then(()=>{if(r)return m(r);let E=this.statusError.get(t);return E?(this.statusError.delete(t),m(E)):void 0})}),h=yield ie.race([this.connection.request("request",{clientRequest:o},!0,{url:t,command:"PublishStream",workerType:n===Xo.TRANSCODE?1:2,requestByUser:!r,tid:d.toString()}),l]);this.isStartingStreamingTask=!1,T.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(h.code)),this.streamingTasks.set(t,{clientRequest:o,mode:n,url:t,taskId:d}),c()}catch(l){if(c(),this.isStartingStreamingTask=!1,!l.data||!l.data.retry||r)throw l;return l.data.changeAddress?(this.connection.tryNextAddress(),yield this.startLiveStreamingTask(t,n,l)):yield this.startLiveStreamingTask(t,n,l)}})}stopLiveStreamingTask(t){return new ie((n,r)=>{let o=this.streamingTasks.get(t);if(!o||!this.connection)return new G(D.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let c=o.mode;o.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:o.url}},!1,{url:t,command:"UnPublishStream",workerType:c===Xo.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(d=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(d.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(r)})}resetAllTask(){var t;let n=Array.from(Wr(t=this.streamingTasks).call(t));this.terminate();for(let r of n)this.startLiveStreamingTask(r.url,r.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=pr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(t){return P(this,null,function*(){if(this.connection)throw new G(D.UNEXPECTED_ERROR,"live streaming connection has already connected");let n=yield An(this,zC.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new ire(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(la.WARNING,(r,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,r)),this.connection.on(la.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(la.REQUEST_NEW_ADDRESS,(r,o)=>{if(!this.connection)return o(new G(D.UNEXPECTED_ERROR,"can not get new live streaming address list"));An(this,zC.REQUEST_WORKER_MANAGER_LIST,t).then(c=>{this.uapResponse=c,r(c.addressList)}).catch(o)}),yield this.connection.init(n.addressList),this.connection})}handlePublishStreamServer(t){let n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),o=t.reason;switch(t.code){case an.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case an.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case an.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case an.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let d=new G(D.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return T.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,d);if(!this.isStartingStreamingTask)return;this.statusError.set(n,d)}case an.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let d=new G(D.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,d)}case an.LIVE_STREAM_RESPONSE_WORKER_LOST:case an.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var c;if(!this.connection)return;this.connection.tryNextAddress();let d=Array.from(Wr(c=this.streamingTasks).call(c));for(let l of d)l.abortTask?l.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",l.url),this.startLiveStreamingTask(l.url,l.mode,new G(D.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),l.url)}).catch(h=>{T.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(l.url,h)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}let sre={name:"LiveStreaming",create:function(e){return new ore(e.joinInfo,e.websocketRetryConfig||nn,e.httpRetryConfig||nn)}};function are(e){let t=I2();return function(n,r){let o=n.appId;o!==void 0&&(Qe(r,10),os(r,o));let c=n.cid;c!==void 0&&(Qe(r,16),Qe(r,c));let d=n.cname;d!==void 0&&(Qe(r,26),os(r,d));let l=n.deviceId;l!==void 0&&(Qe(r,34),os(r,l));let h=n.elapse;h!==void 0&&(Qe(r,40),Ia(r,h));let f=n.fileSize;f!==void 0&&(Qe(r,48),Ia(r,Ru(f)));let m=n.height;m!==void 0&&(Qe(r,56),Ia(r,Ru(m)));let E=n.jpg;E!==void 0&&(Qe(r,66),Qe(r,E.length),function(_r,z){let ee=wu(_r,z.length);_r.bytes.set(z,ee)}(r,E));let _=n.networkType;_!==void 0&&(Qe(r,72),Ia(r,Ru(_)));let v=n.osType;v!==void 0&&(Qe(r,80),Ia(r,Ru(v)));let A=n.requestId;A!==void 0&&(Qe(r,90),os(r,A));let C=n.sdkVersion;C!==void 0&&(Qe(r,98),os(r,C));let I=n.sequence;I!==void 0&&(Qe(r,104),Ia(r,Ru(I)));let O=n.sid;O!==void 0&&(Qe(r,114),os(r,O));let N=n.timestamp;N!==void 0&&(Qe(r,120),Ia(r,N));let x=n.uid;x!==void 0&&(Qe(r,128),Qe(r,x));let B=n.vid;B!==void 0&&(Qe(r,136),Qe(r,B));let j=n.width;j!==void 0&&(Qe(r,144),Ia(r,Ru(j)));let F=n.service;F!==void 0&&(Qe(r,152),Qe(r,F));let W=n.callbackData;W!==void 0&&(Qe(r,162),os(r,W));let X=n.jpgEncryption;X!==void 0&&(Qe(r,168),Qe(r,X));let oe=n.requestType;oe!==void 0&&(Qe(r,176),Qe(r,oe));let te=n.scorePorn;te!==void 0&&(Qe(r,185),QI(r,te));let Me=n.scoreSexy;Me!==void 0&&(Qe(r,193),QI(r,Me));let ke=n.scoreNeutral;ke!==void 0&&(Qe(r,201),QI(r,ke));let ft=n.scene;ft!==void 0&&(Qe(r,208),Qe(r,ft));let Wt=n.ossFilePrefix;Wt!==void 0&&(Qe(r,218),os(r,Wt));let Vt=n.serviceVendor;if(Vt!==void 0)for(let _r of Vt){Qe(r,226);let z=I2();ure(_r,z),Qe(r,z.limit),fre(r,z),pre(z)}}(e,t),function(n){let r=n.bytes,o=n.limit;return r.length===o?r:r.subarray(0,o)}(t)}function cre(e){return function(n){let r={};e:for(;!R2(n);){let o=ss(n);switch(o>>>3){case 0:break e;case 1:r.code=ss(n);break;case 2:r.msg=w2(n,ss(n));break;case 3:{let c=lre(n);r.data=dre(n),n.limit=c;break}default:S2(n,7&o)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function dre(e){let t={};e:for(;!R2(e);){let n=ss(e);switch(n>>>3){case 0:break e;case 1:t.requestId=w2(e,ss(e));break;case 2:t.requestType=ss(e)>>>0;break;case 3:t.scorePorn=JI(e);break;case 4:t.scoreSexy=JI(e);break;case 5:t.scoreNeutral=JI(e);break;case 6:t.requestScene=ss(e)>>>0;break;case 7:t.scene=ss(e)>>>0;break;default:S2(e,7&n)}}return t}function ure(e,t){let n=e.service;n!==void 0&&(Qe(t,8),Qe(t,n));let r=e.vendor;r!==void 0&&(Qe(t,16),Qe(t,r));let o=e.token;o!==void 0&&(Qe(t,26),os(t,o));let c=e.callbackUrl;c!==void 0&&(Qe(t,34),os(t,c))}function lre(e){let t=ss(e),n=e.limit;return e.limit=e.offset+t,n}function S2(e,t){switch(t){case 0:for(;128&b2(e););break;case 2:$I(e,ss(e));break;case 5:$I(e,4);break;case 1:$I(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let hre=new Float32Array(1);new Uint8Array(hre.buffer);let YI=new Float64Array(1),Ar=new Uint8Array(YI.buffer);function Ru(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let C2=[];function I2(){let e=C2.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function pre(e){C2.push(e)}function $I(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function R2(e){return e.offset>=e.limit}function wu(e,t){let n=e.bytes,r=e.offset,o=e.limit,c=r+t;if(c>n.length){let d=new Uint8Array(2*c);d.set(n),e.bytes=d}return e.offset=c,c>o&&(e.limit=c),r}function XI(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function w2(e,t){let n=XI(e,t),r=String.fromCharCode,o=e.bytes,c="\uFFFD",d="";for(let l=0;l<t;l++){let h,f,m,E,_=o[l+n];128&_?(224&_)==192?l+1>=t?d+=c:(h=o[l+n+1],(192&h)!=128?d+=c:(E=(31&_)<<6|63&h,E<128?d+=c:(d+=r(E),l++))):(240&_)==224?l+2>=t?d+=c:(h=o[l+n+1],f=o[l+n+2],(49344&(h|f<<8))!=32896?d+=c:(E=(15&_)<<12|(63&h)<<6|63&f,E<2048||E>=55296&&E<=57343?d+=c:(d+=r(E),l+=2))):(248&_)==240?l+3>=t?d+=c:(h=o[l+n+1],f=o[l+n+2],m=o[l+n+3],(12632256&(h|f<<8|m<<16))!=8421504?d+=c:(E=(7&_)<<18|(63&h)<<12|(63&f)<<6|63&m,E<65536||E>1114111?d+=c:(E-=65536,d+=r(55296+(E>>10),56320+(1023&E)),l+=3))):d+=c:d+=r(_)}return d}function os(e,t){let n=t.length,r=0;for(let d=0;d<n;d++){let l=t.charCodeAt(d);l>=55296&&l<=56319&&d+1<n&&(l=(l<<10)+t.charCodeAt(++d)-56613888),r+=l<128?1:l<2048?2:l<65536?3:4}Qe(e,r);let o=wu(e,r),c=e.bytes;for(let d=0;d<n;d++){let l=t.charCodeAt(d);l>=55296&&l<=56319&&d+1<n&&(l=(l<<10)+t.charCodeAt(++d)-56613888),l<128?c[o++]=l:(l<2048?c[o++]=l>>6&31|192:(l<65536?c[o++]=l>>12&15|224:(c[o++]=l>>18&7|240,c[o++]=l>>12&63|128),c[o++]=l>>6&63|128),c[o++]=63&l|128)}}function fre(e,t){let n=wu(e,t.limit),r=e.bytes,o=t.bytes;for(let c=0,d=t.limit;c<d;c++)r[c+n]=o[c]}function b2(e){return e.bytes[XI(e,1)]}function A2(e,t){let n=wu(e,1);e.bytes[n]=t}function JI(e){let t=XI(e,8),n=e.bytes;return Ar[0]=n[t++],Ar[1]=n[t++],Ar[2]=n[t++],Ar[3]=n[t++],Ar[4]=n[t++],Ar[5]=n[t++],Ar[6]=n[t++],Ar[7]=n[t++],YI[0]}function QI(e,t){let n=wu(e,8),r=e.bytes;YI[0]=t,r[n++]=Ar[0],r[n++]=Ar[1],r[n++]=Ar[2],r[n++]=Ar[3],r[n++]=Ar[4],r[n++]=Ar[5],r[n++]=Ar[6],r[n++]=Ar[7]}function ss(e){let t,n=0,r=0;do t=b2(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Qe(e,t){for(t>>>=0;t>=128;)A2(e,127&t|128),t>>>=7;A2(e,t)}function Ia(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,c=o===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:o<128?9:10,d=wu(e,c),l=e.bytes;switch(c){case 10:l[d+9]=o>>>7&1;case 9:l[d+8]=c!==9?128|o:127&o;case 8:l[d+7]=c!==8?r>>>21|128:r>>>21&127;case 7:l[d+6]=c!==7?r>>>14|128:r>>>14&127;case 6:l[d+5]=c!==6?r>>>7|128:r>>>7&127;case 5:l[d+4]=c!==5?128|r:127&r;case 4:l[d+3]=c!==4?n>>>21|128:n>>>21&127;case 3:l[d+2]=c!==3?n>>>14|128:n>>>14&127;case 2:l[d+1]=c!==2?n>>>7|128:n>>>7&127;case 1:l[d]=c!==1?128|n:127&n}}function D2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}let mre=new Map([["moderation",1],["supervise",2]]);class gre extends Dt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let n=this._connectionState;this._connectionState=t,this.emit(En.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=co(n=t.map(r=>mre.get(r)||0)).call(n,(r,o)=>r+o),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),b(this,"name","AgoraRTCVideoContentInspect"),b(this,"_connectionState",Ki.CONNECTING),b(this,"_innerConnectionState",void 0),b(this,"sequence",0),b(this,"inspectStartTime",void 0),b(this,"workerManagerConnection",void 0),b(this,"workerConnection",void 0),b(this,"workerMessageLengthLimit",void 0),b(this,"inspectIntervalMinimum",void 0),b(this,"qualityRatio",void 0),b(this,"_connectInfo",void 0),b(this,"_cancelTokenSource",pr.CancelToken.source()),b(this,"_retryConfig",void 0),b(this,"wmSequence",0),b(this,"inspectInterval",void 0),b(this,"inspectTimer",null),b(this,"ossFilePrefix",void 0),b(this,"extraInfo",void 0),b(this,"_inspectType",void 0),b(this,"_inspectMode",void 0),b(this,"_quality",1),b(this,"qualityTimer",null),b(this,"_inspectId",void 0),b(this,"_needWorkUrlOnly",!1),b(this,"inspectImage",()=>{if(this.connectionState!==Ki.CONNECTED)throw new G(D.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ki.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ht(5,"inspect-"),this.workerMessageLengthLimit=M("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=M("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=M("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Ah("worker-manager-"+this._inspectId,nn),this.on(En.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(qi[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Ah("worker-"+this._inspectId,nn),this.handleWorkerEvents()}init(t,n){return P(this,null,function*(){this.emit(En.STATE_CHANGE,qi.CONNECT_AP),this._connectInfo=t;let r=this._cancelTokenSource.token;return this._retryConfig=n,new ie((o,c)=>{this.on(En.CONNECTION_STATE_CHANGE,(d,l)=>{l===Ki.CONNECTED&&o()}),this.requestAP(t,r,n).then(d=>{this.connectWorkerManager(d)}).catch(d=>{c(d)})})})}requestAP(t,n,r){return P(this,null,function*(){let o=M("WEBCS_DOMAIN").map(l=>"https://".concat(l,"/api/v1")),c=yield function(l,h,f,m){let{appId:E,areaCode:_,cname:v,sid:A,token:C,uid:I}=h;pu++;let O="image_moderation_api",N={service_name:O,json_body:JSON.stringify({appId:E,areaCode:_,cname:v,command:"allocateEdge",requestId:pu,seq:pu,sid:A,token:C,ts:Date.now(),uid:I+""})},x,B,j=l[0];return Eo(()=>P(this,null,function*(){x=Date.now();let F=yield So(j,{data:N,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(B=Date.now()-x,F.code!==0){let te=new G(D.UNEXPECTED_RESPONSE,"image inspect ap error, code"+F.code,{retry:!0,responseTime:B});throw T.error(te.toString()),te}let W=JSON.parse(F.json_body);if(W.code!==200){let te=new G(D.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(W.code,", reason: ").concat(W.reason),{code:W.code,responseTime:B});throw T.error(te.toString()),te}if(!W.servers||!Array.isArray(W.servers)||W.servers.length===0){let te=new G(D.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:W.code,responseTime:B});throw T.error(te.toString()),te}let X=M("VIDEO_INSPECT_WORKER_MANAGER_HOST"),oe=M("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:W.servers.map(te=>{let{address:Me,wss:ke}=te;if(Me&&ke)return"wss://".concat(Me.replace(/\./g,"-"),".").concat(X,":").concat(oe||ke)}).filter(te=>!!te),workerToken:W.workerToken,vid:W.vid,responseTime:B}}),(F,W)=>(he.apworkerEvent(A,{success:!0,sc:200,serviceName:O,responseDetail:JSON.stringify(F.addressList),firstSuccess:W===0,responseTime:B,serverIp:l[W%l.length]}),!1),(F,W)=>(he.apworkerEvent(A,{success:!1,sc:F.data&&F.data.code||200,serviceName:O,responseTime:B,serverIp:l[W%l.length]}),!!(F.code!==D.OPERATION_ABORTED&&F.code!==D.UNEXPECTED_RESPONSE||F.data&&F.data.retry)&&(j=l[(W+1)%l.length],!0)),m)}(o,t,n,r);this.emit(En.STATE_CHANGE,qi.AP_CONNECTED);let{addressList:d}=c;return this.wmSequence++,d})}connectWorkerManager(n){return P(this,arguments,function*(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(En.STATE_CHANGE,qi.CONNECT_WORKER_MANAGER),yield this.workerManagerConnection.init(t,1e4)})}connectWorker(t){return P(this,null,function*(){yield this.workerConnection.init([t])})}handleWorkerManagerEvents(){this.workerManagerConnection.on(Re.CONNECTED,()=>P(this,null,function*(){this.emit(En.STATE_CHANGE,qi.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Re.CLOSED,()=>{this._innerConnectionState<qi.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Re.FAILED,()=>{this._innerConnectionState<qi.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Re.RECONNECTING,()=>{this._innerConnectionState<qi.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Re.ON_MESSAGE,t=>P(this,null,function*(){this.emit(En.STATE_CHANGE,qi.GET_WORKER_MANAGER_RESPONSE);let n=this.workerManagerConnection.url;this.workerManagerConnection.close();let r=JSON.parse(t.data);if(r.code!==200)throw T.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new G(D.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw T.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new G(D.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{let o=M("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,c=n.replace(/:\d+\/?$/,":".concat(o));this.emit(En.STATE_CHANGE,qi.CONNECT_WORKER,c),this._needWorkUrlOnly?this.emit(En.REQUEST_NEW_WORKER_URL,c):yield this.connectWorker(c)}})),this.workerManagerConnection.on(Re.WILL_RECONNECT,(t,n,r)=>{r(t)}),this.workerManagerConnection.on(Re.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Re.CONNECTED,()=>P(this,null,function*(){this.emit(En.STATE_CHANGE,qi.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ki.CONNECTED})),this.workerConnection.on(Re.ON_MESSAGE,t=>P(this,null,function*(){if(t.data instanceof ArrayBuffer){let r=cre(new Uint8Array(t.data));if(M("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(En.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;let o={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},c=co(n=Object.keys(o)).call(n,(l,h)=>o[l]>o[h]?l:h,"porn"),d=Object.keys(o).find(l=>l===c);this.emit(En.INSPECT_RESULT,d)}else this.emit(En.INSPECT_RESULT,void 0,new G(D.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(En.INSPECT_RESULT,void 0,new G(D.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else T.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(En.INSPECT_RESULT,void 0,new G(D.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(Re.CLOSED,()=>{this.connectionState=Ki.CLOSED}),this.workerConnection.on(Re.FAILED,()=>{this.connectionState=Ki.CLOSED}),this.workerConnection.on(Re.RECONNECTING,()=>{this.connectionState=this.connectionState===Ki.CONNECTED?Ki.RECONNECTING:Ki.CONNECTING}),this.workerConnection.on(Re.WILL_RECONNECT,(t,n,r)=>{t==="recover"&&r(t),r("tryNext")}),this.workerConnection.on(Re.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(En.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}requestToInspectImage(){return P(this,null,function*(){this.sequence++;let t=qr(this,En.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(En.INSPECT_RESULT,void 0,new G(D.INVALID_OPERATION,"Only the track being played can be inspected"));let r=yield this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(En.INSPECT_RESULT,void 0,new G(D.INVALID_OPERATION,"Only the track being published can be inspected"))})}generateRequestData(t,n){return P(this,null,function*(){let{appId:r,cname:o,cid:c,vid:d,sid:l,uid:h}=n,f=Date.now(),m=yield t.getCurrentFrameImage("image/jpeg",this.quality),E=yield d1(m,r,o),_=this.sequence+"-"+c+"-"+h+"-"+f+"-"+ht(12,""),v={appId:r,cid:c,cname:o,deviceId:"",elapse:(A=Number(f-this.inspectStartTime),{low:A|=0,high:A>>31,unsigned:A>=0}),fileSize:E.byteLength,jpgEncryption:2,height:m.height,width:m.width,jpg:E,networkType:6,osType:7,requestId:_,sdkVersion:"4.23.1",sequence:this.sequence,sid:l,timestamp:LF(f),uid:h,vid:d,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var A;this.extraInfo===void 0&&delete v.callbackData,this.ossFilePrefix===void 0&&delete v.ossFilePrefix;let C=are(v);if(C.byteLength<this.workerMessageLengthLimit){if(M("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let I=function(O){for(var N=1;N<arguments.length;N++){var x=arguments[N]!=null?arguments[N]:{};N%2?D2(Object(x),!0).forEach(function(B){b(O,B,x[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O,Object.getOwnPropertyDescriptors(x)):D2(Object(x)).forEach(function(B){Object.defineProperty(O,B,Object.getOwnPropertyDescriptor(x,B))})}return O}({},v);delete I.jpg,T.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(I))}return C}{let I=this.quality*this.qualityRatio;return this.quality=I,yield this.generateRequestData(t,{appId:r,cname:o,cid:c,vid:d,sid:l,uid:h})}})}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=pr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ki.CLOSED,this.emit(En.STATE_CHANGE,qi.CLOSED)}}let Ere={name:"ContentInspect",create:function(e){let{config:t}=e;return function(n){if(!n)throw new G(D.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new G(D.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let r=[...new Set(n.inspectType)];r.forEach(o=>{var c;if(!ne(c=["supervise","moderation"]).call(c,o))throw new G(D.INVALID_PARAMS,"".concat(o," is not a valid inspect type."))}),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new G(D.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new gre(t)}};var O2=a(ai.Object.getOwnPropertySymbols),_re=Je,vre=hy.indexOf,yre=Rf,ZI=Pl([].indexOf),N2=!!ZI&&1/ZI([1],1,-0)<0;_re({target:"Array",proto:!0,forced:N2||!yre("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return N2?ZI(this,e,t)||0:vre(this,e,t)}});var Tre=ki("Array","indexOf"),Sre=V,Cre=Tre,eR=Array.prototype,Ire=function(e){var t=e.indexOf;return e===eR||Sre(eR,e)&&t===eR.indexOf?Cre:t},P2=a(Ire);function Rre(e,t){if(e==null)return{};var n,r,o=function(d,l){if(d==null)return{};var h,f,m={},E=zx(d);for(f=0;f<E.length;f++)h=E[f],P2(l).call(l,h)>=0||(m[h]=d[h]);return m}(e,t);if(O2){var c=O2(e);for(r=0;r<c.length;r++)n=c[r],P2(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}let M2=class{get localCapabilities(){return Ut(this._localCapabilities)}get rtpCapabilities(){return Ut(this._rtpCapabilities)}get candidates(){return Ut(this._candidates)}get iceParameters(){return Ut(this._iceParameters)}get dtlsParameters(){return Ut(this._dtlsParameters)}constructor(e){b(this,"sessionDesc",void 0),b(this,"_localCapabilities",void 0),b(this,"_rtpCapabilities",void 0),b(this,"_candidates",void 0),b(this,"_iceParameters",void 0),b(this,"_dtlsParameters",void 0),b(this,"setup",void 0),b(this,"currentMidIndex",void 0),b(this,"cname","o/i14u9pJrxRKAsu"),b(this,"firefoxSsrcMidMap",new Map),e=Ut(e);let{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:o,localCapabilities:c,direction:d,setup:l,videoCodec:h,audioCodec:f}=e,m;this.setup=l,m=d===or.RECEIVE_ONLY?Ir(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Ir(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=o,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=c;let E=d===or.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,_=d===or.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,v=d===or.RECEIVE_ONLY?o.send.videoCodecs:Nh(ce.VIDEO,E,_,h),A=d===or.RECEIVE_ONLY?o.send.audioCodecs:Nh(ce.AUDIO,E,_,f);for(let C of m.mediaDescriptions)C.attributes.iceUfrag=t.iceUfrag,C.attributes.icePwd=t.icePwd,C.attributes.fingerprints=n.fingerprints,C.attributes.candidates=r,C.attributes.setup=this.setup,C.media.mediaType==="application"&&(C.attributes.sctpPort="5000"),C.media.mediaType==="video"&&(C.media.fmts=v.map(I=>I.payloadType.toString(10)),C.attributes.payloads=v,C.attributes.extmaps=E.videoExtensions),C.media.mediaType==="audio"&&(C.media.fmts=A.map(I=>I.payloadType.toString(10)),C.attributes.payloads=A,C.attributes.extmaps=E.audioExtensions,hu(C));this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return ua(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,o){n=n.replace(/ /g,"-");let{ssrcs:c,ssrcGroups:d}=_c(t,this.cname,M("SYNC_GROUP")?n:void 0),l=this.findPreloadMediaDesc(c);if(l){if(xt()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,l.attributes.mid),o&&(o.twcc||o.remb)){let h=this.sessionDesc.mediaDescriptions.indexOf(l);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(l,o),{mid:l.attributes.mid,needExchangeSDP:!0}}return{mid:l.attributes.mid,needExchangeSDP:!1}}{let h=this.findAvailableMediaIndex(e,c,r),f;return h===-1?(f=this.createOrRecycleSendMedia(e,c,d,"sendonly",r,o),this.updateBundleMids()):(f=Ut(this.sessionDesc.mediaDescriptions[h]),f.attributes.direction="sendonly",f.attributes.ssrcs=c,f.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(f,o)),xt()&&this.firefoxSsrcMidMap.set(c[0].ssrcId,f.attributes.mid),{needExchangeSDP:!0,mid:f.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){let r=[];return e.forEach(o=>{let c=o._mediaStreamTrack.kind,d=this.findAvailableRecvMediaIndex(c),l,h=!1;d===-1?(h=!0,l=this.createOrRecycleRecvMedia(o,[],"recvonly",t,n),this.updateBundleMids()):(l=Ut(this.sessionDesc.mediaDescriptions[d]),l.attributes.direction="recvonly"),r.push({mid:l.attributes.mid,needCreateTransceiver:h})}),r}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>e.indexOf(n.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:n,address:r,port:o,type:c,relatedAddress:d,relatedPort:l,priority:h}=new RTCIceCandidate(e),f={foundation:t??"",componentId:"1",transport:n??"",priority:h?h+"":"",connectionAddress:r??"",port:o?o+"":"",type:c?c+"":"",relAddr:d??"",relPort:l?l+"":"",extension:{}};this.candidates.some(m=>m.priority===f.priority&&m.connectionAddress===f.connectionAddress&&m.port===f.port)||(this._candidates.push(f),this.sessionDesc.mediaDescriptions.forEach(m=>{m.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,o){let c=e._mediaStreamTrack.kind,d=this.rtpCapabilities.recv,l=Nh(c,d,this.localCapabilities.send,c===ce.AUDIO?o:r),h=c===ce.VIDEO?d.videoExtensions:d.audioExtensions,f="".concat(++this.currentMidIndex),m={media:{mediaType:c,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(_=>_.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};m=this.mungRecvMediaDsec(m,e);let E=this.findFirstClosedMedia(c);if(E){let _=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[_]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>ne(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(n=>ne(e).call(e,n.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let o=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(xt()){if(o){let c=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(c||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!c||c!==r.attributes.mid)}return!1}return o&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n})}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=Ut(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,o,c){let d=this.rtpCapabilities.send,l=e===ce.VIDEO?d.videoCodecs:d.audioCodecs,h=e===ce.VIDEO?d.videoExtensions:d.audioExtensions;xt()&&(o="".concat(++this.currentMidIndex));let f={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(E=>E.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:o}};f=this.mungSendMediaDesc(f,c);let m=this.findFirstClosedMedia(e);if(m){let E=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[E]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}mungRecvMediaDsec(e,t,n){let r=Ut(e);return QC(r),lu(r,t),ZC(r,t),_U(r),Pg(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){let n=Ut(e);return Pg(n,t,this.localCapabilities.recv),hu(n),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===e);if(n!==-1){let r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>xt()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},wre=["sdp"];var Et;function k2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Ra(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?k2(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let L2=(Et=class wl extends Zx{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),b(this,"direction",void 0),b(this,"name",void 0),b(this,"store",void 0),b(this,"spec",void 0),b(this,"peerConnection",void 0),b(this,"initialOffer",void 0),b(this,"transport",void 0),b(this,"statsFilter",void 0),b(this,"localCandidateCount",0),b(this,"_isInRestartIce",!1),b(this,"mutex",void 0),b(this,"onLocalCandidate",void 0),b(this,"remoteSDP",void 0),b(this,"pendingCandidates",[]),b(this,"localCapabilities",void 0),b(this,"isReady",!1),b(this,"restartCnt",0),b(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new kn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(wl.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??or.SEND_ONLY,this.name=this.direction===or.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=pC(this.peerConnection,M("STATS_UPDATE_INTERVAL"),void 0,xt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(t){return P(this,null,function*(){try{let n=yield yU();if(this.localCapabilities=Mg(n),t){let{sdp:r}=t,o=Rre(t,wre),c=function(){let m={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},E=Oh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(zi(E,m,"videoExtensions",_,v,A),zi(E,m,"videoCodecs",_,v,A),zi(E,m,"audioExtensions",_,v,A),zi(E,m,"audioCodecs",_,v,A),M("RAISE_H264_BASELINE_PRIORITY")){let C=A.videoCodecs.findIndex(I=>I.rtpMap&&I.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&I.fmtp&&I.fmtp.parameters["profile-level-id"]==="42001f");if(C!==-1){let I=A.videoCodecs.findIndex(O=>O.rtpMap&&O.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(I<C){T.debug("raising H264 baseline profile priority");let O=A.videoCodecs[C];A.videoCodecs.splice(C,1),A.videoCodecs.splice(I,0,O)}I!==-1&&M("FILTER_SEND_H264_BASELINE")&&(_.videoCodecs=_.videoCodecs.filter(O=>!(O.rtpMap&&O.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&O.fmtp&&O.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:_,recv:v,sendrecv:A}}({},{},r);this.remoteSDP=new M2({remoteIceParameters:o.iceParameters,remoteDtlsParameters:o.dtlsParameters,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),yield this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let d=yield this.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let l=fa(d.sdp);yield this.peerConnection.setLocalDescription(d);let h=yield TU({},{},d.sdp);this.localCapabilities=Mg(h);let f=this.peerConnection.getTransceivers()[0];return f!=null&&f.receiver&&f.receiver.transport&&this.tryBindTransportEvents(f.receiver.transport),Ra(Ra({},l),{},{sdp:d.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let r=yield this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let o=fa(r.sdp);return this.initialOffer=r,Ra(Ra({},o),{},{sdp:r.sdp})}}catch(n){throw new K(D.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}})}connect(t){return P(this,null,function*(){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");yield this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:n,iceParameters:r,dtlsParameters:o}=t,c=yield TU({},{},n);this.remoteSDP=new M2({remoteIceParameters:r,remoteDtlsParameters:o,candidates:[],remoteRTPCapabilities:c,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),yield this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let d=this.peerConnection.getTransceivers()[0];d!=null&&d.sender&&d.sender.transport&&this.tryBindTransportEvents(d.sender.transport)}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}})}addRemoteCandidate(t){return P(this,null,function*(){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new K(D.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}})}send(t,n,r){var o=this;return ui(function*(){let c=yield Ue(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let d=[],l=o.remoteSDP.receive(t,n,r);t.forEach((I,O)=>{if(l[O].needCreateTransceiver){let N=o.peerConnection.addTransceiver(I._mediaStreamTrack,{direction:"sendonly"});d.push(N),I._updateRtpTransceiver(N)}else{let N=o.peerConnection.getTransceivers().find(x=>x.mid===l[O].mid);if(!N)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(l[O].mid));d.push(N),I._updateRtpTransceiver(N)}}),xt()&&M("SIMULCAST")===!0&&(yield Ue(o.applySimulcastForFirefox(d,t)));let h=l.map(I=>I.mid),f=yield Ue(o.peerConnection.createOffer()),m=o.mungSendOfferSDP(f.sdp,t,h),E=Ir(m),_=h.map(I=>{let O=E.mediaDescriptions.find(N=>N.attributes.mid===I);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return mU(O,M("USE_PUB_RTX"))}),v=d.map((I,O)=>{let N=h[O];return{localSSRC:_[O],id:N}});yield Ue(o.peerConnection.setLocalDescription({type:"offer",sdp:m}));try{yield v}catch(I){let O=o.remoteSDP.toString();throw yield Ue(o.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Ue(o.peerConnection.setRemoteDescription({type:"answer",sdp:O})),yield Ue(o.stopSending(h,!0)),I}yield Ue(o.applySimulcastEncodings(d,t)),yield Ue(o.applySendEncodings(d,t));let A=o.remoteSDP.toString(),C=o.logSDPExchange(m,"offer","local","send");return C?.(A),yield Ue(o.setRemoteDescription({type:"answer",sdp:A})),d.map((I,O)=>{let N=h[O];return{localSSRC:_[O],id:N}})}catch(d){throw d instanceof K?d:new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}stopSending(t,n){return P(this,null,function*(){let r=n?void 0:yield this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let o=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length (".concat(o.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));o.map(h=>{var f;h.direction="inactive",(f=h.stop)===null||f===void 0||f.call(h)});let c=yield this.peerConnection.createOffer(),d=this.logSDPExchange(c.sdp||"","offer","local","stopSending");yield this.peerConnection.setLocalDescription(c),this.remoteSDP.stopReceiving(t);let l=this.remoteSDP.toString();d?.(l),yield this.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{r&&r()}})}receive(t,n,r,o){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:c,needExchangeSDP:d}=this.remoteSDP.send(t,n,r,o);if(d){let h=this.remoteSDP.toString(),f=this.logSDPExchange(h,"offer","remote","receive");yield this.setRemoteDescription({type:"offer",sdp:h});let m=yield this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(m.sdp,c,t);f?.(E||""),yield this.peerConnection.setLocalDescription({type:"answer",sdp:E}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let l=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!l||l.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,mid:l.mid,transceiver:l}}catch(c){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}})}mockReceive(t,n,r,o){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:c,needExchangeSDP:d}=this.remoteSDP.send(t,n,r,o);if(d){let l=this.remoteSDP.toString(),h=this.logSDPExchange(l,"offer","remote","receive");yield this.setRemoteDescription({type:"offer",sdp:l});let f=yield this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(f.sdp,c,t);h?.(m||""),yield this.peerConnection.setLocalDescription({type:"answer",sdp:m}),T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else T.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(c){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}})}stopReceiving(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");yield this.setRemoteDescription({type:"offer",sdp:n});let o=yield this.peerConnection.createAnswer();r?.(o.sdp||""),yield this.peerConnection.setLocalDescription(o)}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}})}restartICE(t){return P(this,null,function*(){try{if(this.store.p2pTransport===uc.Auto&&(this.store.p2pTransport=uc.SdRtn,He().supportPCSetConfiguration&&this.peerConnection.setConfiguration(wl.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,He().supportPCSetConfiguration&&this.peerConnection.setConfiguration(wl.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let n=yield this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:r}=fa(n.sdp);return this.store.descriptionStart(),this.direction===or.SEND_ONLY&&(yield this.peerConnection.setLocalDescription(n)),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===or.RECEIVE_ONLY){this.restartCnt++,yield this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let n=yield this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:r}=fa(n.sdp);return yield this.peerConnection.setLocalDescription(n),r}yield this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}})}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}updateEncoderConfig(t,n){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=yield this.peerConnection.createOffer(),o=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);let c=this.remoteSDP.toString(),d=this.logSDPExchange(o,"offer","local","updateEncoderConfig");yield this.peerConnection.setLocalDescription({type:"offer",sdp:o}),d?.(c),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new K(D.EXCHANGE_SDP_FAILED,r.toString())}})}updateSendParameters(t,n){return P(this,null,function*(){let r=this.peerConnection.getTransceivers().filter(o=>o.mid===t);r.length===1&&(this.isVP8Simulcast(n)?xt()||(yield this.applySimulcastEncodings(r,[n])):yield this.applySendEncodings(r,[n]))})}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}replaceTrack(t,n){return P(this,null,function*(){let r=this.peerConnection.getTransceivers().find(o=>o.mid===n);r&&(yield r.sender.replaceTrack(t._mediaStreamTrack))})}getSelectedCandidatePair(){return P(this,null,function*(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let n=t[0].transport.iceTransport,{local:r,remote:o}=n.getSelectedCandidatePair();return{local:Ra(Ra({},qo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Ra(Ra({},qo),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;ne(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o={iceServers:[]};var c;return t.iceServers?o.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Eh(t.turnServer.servers)?o.iceServers=t.turnServer.servers:(o.iceServers&&o.iceServers.push(...wl.turnServerConfigToIceServers(t.turnServer.servers,n,r)),M("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&t.turnServer.serversFromGateway&&o.iceServers.push(...wl.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),ne(c=[uc.Relay,uc.SdRtn]).call(c,n)&&(o.iceTransportPolicy="relay"),M("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(d=>{d.forceturn&&(o.iceTransportPolicy="relay")}))),M("ENABLE_ENCODED_TRANSFORM")&&He().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),T.debug("P2PConnection p2pTransport is ".concat(n)),o}static turnServerConfigToIceServers(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=[],c=t.filter(l=>l.tcpport);T.debug("P2PConnection turnServers is ".concat(c,", current index is ").concat(r));let d=c.length>r?c[r]:c[0];switch(n){case uc.SdRtn:let l=t.filter(f=>{var m;return ne(m=f.username).call(m,"glb:")&&f.turnServerURL==f.turnServerURL}),h=l.length>r?l[r]:l[0];h&&(o.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(du(h.turnServerURL),":").concat(h.tcpport,"?transport=udp")}),o.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(du(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;case uc.Relay:d&&(o.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),o.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(du(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;default:d&&(o.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),o.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(du(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}),o.push({username:d.username,credential:d.password,credentialType:"password",urls:"stun:".concat(d.turnServerURL,":").concat(d.tcpport)}))}return o}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var r;t!=null&&t.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,t.state))},t.onerror=r=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in r?r.error:r)};let n=t.iceTransport;n&&(n.onstatechange=()=>{let r=t?.iceTransport.state;var o;r&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){let{local:r,remote:o}=n.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(t,n){return P(this,null,function*(){var r;if(n||(n=this.peerConnection.getSenders().find(m=>m.track===t._mediaStreamTrack)),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!He().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let o={},c={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(t._encoderConfig){var d;let{bitrateMax:m,frameRate:E,scaleResolutionDownBy:_}=t._encoderConfig;m&&(c.maxBitrate=1e3*m),ne(d=t._hints).call(d,pt.LOW_STREAM)&&(E&&(c.maxFramerate=xr(E)),_&&_>=1&&(c.scaleResolutionDownBy=_))}if(M("DSCP_TYPE")&&Ss()){var l;let m=M("DSCP_TYPE");ne(l=["very-low","low","medium","high"]).call(l,m)&&(c.networkPriority=m)}let h=n.getParameters(),f=(r=h.encodings)===null||r===void 0?void 0:r[0];xt()&&!f&&(o.encodings=[c]),f&&Object.assign(f,c),Object.assign(h,o),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),yield n.setParameters(h)})}applySendEncodings(t,n){return P(this,null,function*(){try{if(!He().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){let o=t[r],c=n[r];c instanceof vt&&!this.isVP8Simulcast(c)&&(yield this.updateRtpSenderEncodings(c,o.sender))}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}})}mungSendOfferSDP(t,n,r){let o=Ir(t);return n.forEach((c,d)=>{let l=r[d],h=o.mediaDescriptions.find(f=>f.attributes.mid===l);h&&(lu(h,c),vU(h,c,this.store.codec))}),ua(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(t,n){return P(this,null,function*(){if(t.length===n.length)for(let h=0;h<t.length;h++){var r,o,c,d,l;let f=t[h],m=n[h];if(m instanceof vt&&!ne(r=m._hints).call(r,pt.LOW_STREAM)&&(o=m._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=m._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=m._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((l=m._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1&&this.store.codec==="vp8"){let E={},_={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{rid:"m",active:!0,maxBitrate:_.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_.high}];let v=f.sender.getParameters();yield f.sender.setParameters(Object.assign(v,E))}}})}applySimulcastEncodings(t,n){return P(this,null,function*(){if(!xt()&&t.length===n.length)for(let r=0;r<t.length;r++){let o=n[r];if(o instanceof vt&&this.isVP8Simulcast(o)){let c=t[r],d={},l={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:l.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:l.medium,scaleResolutionDownBy:4}];let h=c.sender.getParameters();yield c.sender.setParameters(Object.assign(h,d))}}})}isVP8Simulcast(t){var n,r,o,c,d;return!!(t instanceof vt&&M("SIMULCAST")&&this.store.codec==="vp8"&&!ne(n=t._hints).call(n,pt.LOW_STREAM)&&(r=t._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((o=t._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=t._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=t._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(t,n,r,o){if(M("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?c=>{this.logSDPExchange(c,"answer",r==="local"?"remote":"local",o)}:void 0}muteLocal(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});let r=yield this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");yield this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);let c=this.remoteSDP.toString();o?.(c),yield this.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}})}unmuteLocal(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>P(this,null,function*(){d.direction="sendonly"}));let r=yield this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");yield this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);let c=this.remoteSDP.toString();o?.(c),yield this.setRemoteDescription({type:"answer",sdp:c})}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}})}getRemoteSSRC(t,n){return P(this,null,function*(){var r,o;if(n=(r=n)!==null&&r!==void 0?r:(o=this.currentRemoteDescription)===null||o===void 0?void 0:o.sdp){var c;let d=(c=Ir(n).mediaDescriptions.find(l=>l.attributes.mid===t))===null||c===void 0?void 0:c.attributes.ssrcs;return d?.[0].ssrcId}})}setRemoteDescription(t){return P(this,null,function*(){var n;yield this.peerConnection.setRemoteDescription(t),ne(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())})}mungReceiveAnswerSDP(t,n,r){let o=Ir(t),c=o.mediaDescriptions.find(d=>d.attributes.mid===n);return c&&r===ce.AUDIO&&c.media.mediaType==="audio"&&hu(c),ua(o)}},ue(Et.prototype,"establish",[Qi],Object.getOwnPropertyDescriptor(Et.prototype,"establish"),Et.prototype),ue(Et.prototype,"connect",[Qi],Object.getOwnPropertyDescriptor(Et.prototype,"connect"),Et.prototype),ue(Et.prototype,"receive",[Qi],Object.getOwnPropertyDescriptor(Et.prototype,"receive"),Et.prototype),ue(Et.prototype,"mockReceive",[Qi],Object.getOwnPropertyDescriptor(Et.prototype,"mockReceive"),Et.prototype),ue(Et.prototype,"stopReceiving",[Qi],Object.getOwnPropertyDescriptor(Et.prototype,"stopReceiving"),Et.prototype),ue(Et.prototype,"restartICE",[Qi],Object.getOwnPropertyDescriptor(Et.prototype,"restartICE"),Et.prototype),ue(Et.prototype,"close",[Qi],Object.getOwnPropertyDescriptor(Et.prototype,"close"),Et.prototype),ue(Et.prototype,"updateEncoderConfig",[Qi],Object.getOwnPropertyDescriptor(Et.prototype,"updateEncoderConfig"),Et.prototype),ue(Et.prototype,"updateSendParameters",[Qi],Object.getOwnPropertyDescriptor(Et.prototype,"updateSendParameters"),Et.prototype),ue(Et.prototype,"replaceTrack",[Qi],Object.getOwnPropertyDescriptor(Et.prototype,"replaceTrack"),Et.prototype),ue(Et.prototype,"muteLocal",[Qi],Object.getOwnPropertyDescriptor(Et.prototype,"muteLocal"),Et.prototype),ue(Et.prototype,"unmuteLocal",[Qi],Object.getOwnPropertyDescriptor(Et.prototype,"unmuteLocal"),Et.prototype),Et);function Qi(e,t,n){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=function(){return P(this,arguments,function*(){let o=this.mutex,c=yield o.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,l=new Array(d),h=0;h<d;h++)l[h]=arguments[h];return yield r.apply(this,l)}finally{c()}})},n}let Io=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var x2,U2,F2,V2,j2,B2,H2,G2,W2,K2,q2,bt;function z2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function uE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?z2(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let bre=(x2=Ro(Io.SEND_ONLY),U2=Ro(Io.SEND_ONLY),F2=Ro(),V2=Ro(Io.RECEIVE_ONLY),j2=Ro(Io.RECEIVE_ONLY),B2=Ro(Io.RECEIVE_ONLY),H2=Ro(Io.RECEIVE_ONLY),G2=Ro(Io.RECEIVE_ONLY),W2=Ro(Io.RECEIVE_ONLY),K2=Ro(),q2=Ro(Io.RECEIVE_ONLY),bt=class extends Dt{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(me.StateChange,t,this._state)}constructor(e,t){super(),b(this,"isPlanB",!1),b(this,"store",void 0),b(this,"statsUploader",void 0),b(this,"sendConnection",void 0),b(this,"recvConnection",void 0),b(this,"localTrackMap",new Map),b(this,"remoteUserMap",new Map),b(this,"localDataChannels",[]),b(this,"pendingLocalTracks",[]),b(this,"pendingRemoteTracks",[]),b(this,"statsCollector",void 0),b(this,"dtlsFailedCount",0),b(this,"sendMutex",void 0),b(this,"recvMutex",void 0),b(this,"_state",$e.Disconnected),b(this,"_restartStates",["disconnected","failed"]),b(this,"reconnectInterval",void 0),b(this,"uploadUnplinkStarted",!1),b(this,"uploadDownlinkStarted",!1),b(this,"uplinkStateUploadInterval",void 0),b(this,"downlinkStatsUploadInterval",void 0),b(this,"handleMuteLocalTrack",(n,r,o)=>P(this,null,function*(){let c=yield this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==$e.Connected)return void o(new K(D.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let h=this.filterTobeMutedTracks(n);if(h.length===0)return void r();let f=h.find(v=>v[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),yield this.sendConnection.muteLocal(h.map(v=>{let[,{id:A}]=v;return A}));let m=!1;var d,l;n.trackMediaType==="video"?m=!((d=this.localTrackMap.get(J.LocalAudioTrack))===null||d===void 0||!d.track._muted):m=((l=this.localTrackMap.get(J.LocalVideoTrack))===null||l===void 0?void 0:l.id)===void 0;let E=this.createMuteMessage(h);yield lt(this,me.RequestMuteLocal,E);let _=n.trackMediaType==="video"?ha.MUTE_LOCAL_VIDEO:ha.MUTE_LOCAL_AUDIO;yield lt(this,me.RequestP2PMuteLocal,{action:_,message:E,isMuteAll:m}),r()}catch(h){o(h)}finally{c()}})),b(this,"handleUnmuteLocalTrack",(n,r,o)=>P(this,null,function*(){let c=yield this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==$e.Connected)return void o(new K(D.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void r();yield this.sendConnection.unmuteLocal(d.map(f=>{let[,{id:m}]=f;return m}));let l=this.createUnmuteMessage(d),h=n.trackMediaType==="video"?ha.UNMUTE_LOCAL_VIDEO:ha.UNMUTE_LOCAL_AUDIO;yield lt(this,me.RequestP2PMuteLocal,{action:h,message:l}),r()}catch(d){o(d)}finally{c()}})),b(this,"handleUpdateVideoEncoder",(n,r,o,c)=>P(this,null,function*(){let d;typeof c=="boolean"&&c||(d=yield this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let h=this.localTrackMap.get(J.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==n||this.state!==$e.Connected)return void r();let{id:f,track:m}=h;f&&(yield this.sendConnection.updateSendParameters(f,m),yield this.sendConnection.updateEncoderConfig(f,m),this.emit(me.UpdateVideoEncoder,m)),r()}catch(h){o(h)}finally{var l;(l=d)===null||l===void 0||l()}})),b(this,"handleUpdateVideoSendParameters",(n,r,o)=>P(this,null,function*(){let c=yield this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let d=this.localTrackMap.get(J.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==n||this.state!==$e.Connected)return void r();let{id:l,track:h}=d;l&&(yield this.sendConnection.updateSendParameters(l,h)),r()}catch(d){o(d)}finally{c()}})),b(this,"handleReplaceTrack",(n,r,o,c)=>P(this,null,function*(){let d;T.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof c=="boolean"&&c||(d=yield this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var l;let f=Array.from(this.localTrackMap.entries()).find(m=>{let[,{track:E}]=m;return n===E});if(!this.sendConnection||!f||f[1].id===void 0||this.state!==$e.Connected)return void r();if(yield(l=this.sendConnection)===null||l===void 0?void 0:l.replaceTrack(n,f[1].id),f[0]===J.LocalVideoTrack&&He().supportDualStreamEncoding){let m=this.localTrackMap.get(J.LocalVideoLowTrack);if(m){let E=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=E,m.track._originMediaStreamTrack=E,yield new ie((_,v)=>{this.handleReplaceTrack(m.track,_,v,!0)})}}r()}catch(f){o(f)}finally{var h;(h=d)===null||h===void 0||h()}})),b(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),b(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),b(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),b(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new sF(e),this.bindStatsUploaderEvents(),this.sendMutex=new kn("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new kn("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},M("ICE_RESTART_INTERVAL"))}startP2PConnection(e,t){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})}connect(e){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED,"p2p mode does not support connect.")})}startP2P(e,t){return P(this,null,function*(){let n;try{if(t){this.recvConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=yield this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new L2(e,this.store,or.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let r=yield this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=$e.New,this.sendConnection&&(T.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=yield this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new L2(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let r=yield this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}})}p2pConnect(e){return P(this,null,function*(){if(!this.sendConnection)throw new K(D.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),yield this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=$e.Connected})}addRemoteCandidate(e,t){return P(this,null,function*(){if(t===or.RECEIVE_ONLY){if(!this.sendConnection)throw new K(D.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new K(D.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield this.recvConnection.addRemoteCandidate(e)}})}publish(e,t,n){var r=this;return ui(function*(){let o=yield Ue(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==$e.Connected){r.throwIfTrackTypeNotMatch(e);let f=e.filter(m=>r.pendingLocalTracks.indexOf(m)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(f))}r.store.pubId=r.store.pubId+1,xn.markPublishStart(r.store.clientId,r.store.pubId);let c=r.filterTobePublishedTracks(e,t,n);if(c.length===0)return void(yield Ue(r.tryToUnmuteAudio(e)));c.forEach(f=>{let{track:m,type:E}=f,_=Date.now();r.store.publish(m.getTrackId(),E===J.LocalAudioTrack?"audio":"video",_)}),r.bindLocalTrackEvents(c);let d=yield Ue(r.sendConnection.send(c.map(f=>{let{track:m}=f;return m}),r.store.codec,r.store.audioCodec)),l=(yield Ue(d.next())).value,h=r.createGatewayPublishMessage(c,l);try{yield h}catch(f){throw d.throw(f),f?.code===D.WS_ABORT&&c.forEach(m=>{let{track:E}=m;r.pendingLocalTracks.indexOf(E)===-1&&r.pendingLocalTracks.push(E)}),r.unbindLocalTrackEvents(c),f}yield Ue(d.next()),c.forEach(f=>{let{type:m}=f;r.statsCollector.addLocalStats(m)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(c,l),c.forEach(f=>{let{track:m,type:E}=f,_=Date.now();r.store.publish(m.getTrackId(),E===J.LocalAudioTrack?"audio":"video",void 0,_)}),r.startUploadUplinkState()}finally{o()}})()}unpublish(e){return P(this,null,function*(){if(!this.sendConnection||this.state!==$e.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(o=>!ne(e).call(e,o)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let n=t.find(o=>o[0]==="videoLowTrack");n&&n[1].track.close();let r=this.createGatewayUnpublishMessage(t);if(yield this.sendConnection.stopSending(t.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(o=>{let[c,{track:d}]=o;return{type:c,track:d}})),t.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===$e.Connected)return n&&n[1].track.close(),r;e.forEach(o=>{let c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)})})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[o,{track:c,ssrcs:d}]=r,l={stream_type:Rte(c,o),ssrcs:d};c._muted||!c._enabled?t.push(l):n.push(l)}),t.length>0&&t.forEach(r=>{lt(this,me.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{lt(this,me.RequestUnmuteLocal,[r])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return ui(function*(){throw new K(D.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){return P(this,null,function*(){this.pendingLocalTracks.length>0&&(T.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield An(this,me.RequestRePublish,this.pendingLocalTracks),this.emit(me.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])})}unpublishLowStream(){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})}subscribe(e,t,n,r){return P(this,null,function*(){var o;if(!this.recvConnection)throw new K(D.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;let{track:c,mid:d,transceiver:l}=yield this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===ce.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new tu(c,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),l&&e._audioTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new eu(c,e.uid,e._uintid,this.store),T.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),l&&e._videoTrack._updateRtpTransceiver(l),this.bindRemoteTrackEvents(e,e._videoTrack));let h=this.remoteUserMap.get(e);h?h.set(t,d):this.remoteUserMap.set(e,new Map([[t,d]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let f=this.pendingRemoteTracks.findIndex(m=>{let{user:E,kind:_}=m;return E.uid===e.uid&&t===_});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(me.MediaReconnectEnd,e.uid))})}mockSubscribe(e,t,n,r){return P(this,null,function*(){if(!this.recvConnection)throw new K(D.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");yield this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)})}unsubscribe(e,t,n){return P(this,null,function*(){let r=this.pendingRemoteTracks.filter(c=>{let{user:d,kind:l}=c;return t!==void 0?d.uid===e.uid&&t===l:d.uid===e.uid});if(r.forEach(c=>{let d=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(d,1)}),this.recvConnection||n||r.forEach(c=>{let{kind:d}=c;var l;if(d===ce.AUDIO)(l=e._audioTrack)===null||l===void 0||l._destroy(),e._audioTrack=void 0;else if(d===ce.VIDEO){var h;(h=e._videoTrack)===null||h===void 0||h._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let o=this.filterTobeUnSubscribedTracks(e,t);o.length!==0&&(yield this.recvConnection.stopReceiving(o.map(c=>{let[,{id:d}]=c;return d})),this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),o.forEach(c=>{let[d,{kind:l}]=c;var h,f;if(l===ce.VIDEO&&d._videoSSRC&&((h=this.recvConnection)===null||h===void 0||h.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),l===ce.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),n||((f=d._videoTrack)===null||f===void 0||f._destroy(),d._videoTrack=void 0);else if(l===ce.AUDIO){var m;this.unbindRemoteTrackEvents(d._audioTrack),!n&&((m=d._audioTrack)===null||m===void 0||m._destroy(),d._audioTrack=void 0)}}),o.forEach(c=>{let[,{kind:d}]=c;lt(this,me.RequestP2PMuteRemote,d)}))})}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,n]=t;[ce.VIDEO,ce.AUDIO].forEach(r=>{n.has(r)?lt(this,me.RequestP2PUnmuteRemote,r):lt(this,me.RequestP2PMuteRemote,r)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}massSubscribe(e){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})}massSubscribeNoLock(e){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})}massUnsubscribe(e){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})}massUnsubscribeNoLock(e){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})}muteRemote(e,t){return P(this,null,function*(){if(!this.recvConnection)return;let n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let r=t===ce.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)})}unmuteRemote(e,t){return P(this,null,function*(){return this.unmuteRemoteNoLock(e,t)})}unmuteRemoteNoLock(e,t){return P(this,null,function*(){if(!this.recvConnection)return;let n=this.remoteUserMap.get(e);if(!n)return void T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||T.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))})}getAllTracks(e){let t=this.localTrackMap.get(J.LocalAudioTrack);if(t?.track instanceof sn){let n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[o]=r;return o!==J.LocalAudioTrack}).filter(r=>{let[o]=r;return!(e&&o===J.LocalVideoLowTrack)}).map(r=>{let[,{track:o}]=r;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===J.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,o){if(e){let d=this.localTrackMap.get(J.LocalAudioTrack),l=r?this.localTrackMap.get(J.LocalVideoLowTrack):this.localTrackMap.get(J.LocalVideoTrack);he.publish(this.store.sessionId,{eventElapse:xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d?.track.getTrackLabel(),videoName:l?.track.getTrackLabel(),screenshare:l?.track._hints.indexOf(pt.SCREEN_TRACK)!==-1,audio:!!d,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var c;n||(n=[]);let d=n.find(h=>h instanceof Ft),l=r?(c=this.localTrackMap.get(J.LocalVideoTrack))===null||c===void 0?void 0:c.track:n.find(h=>h instanceof vt);he.publish(this.store.sessionId,{eventElapse:xn.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d?.getTrackLabel(),videoName:l?.getTrackLabel(),screenshare:l?._hints.indexOf(pt.SCREEN_TRACK)!==-1,audio:!!d,video:!!l,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,r){let o=r===ce.VIDEO?n._videoSSRC:n._audioSSRC;o&&he.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===ce.VIDEO,audio:r===ce.AUDIO,peerid:n.uid,subscribeRequestid:r===ce.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:xn.measureFromSubscribeStart(this.store.clientId,o)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new kn("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new kn("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(J.LocalAudioTrack);if(e?.track instanceof sn){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=$e.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(J.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(J.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof vt||t&&t.track instanceof Ft?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}hasRemoteMediaWithLock(e,t){return P(this,null,function*(){if(!e)return this.remoteUserMap.size>0;let n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))})}getRemoteMedia(e){var t;let n=Array.from(Yr(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(J.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=nh(e).call(e,(n,r)=>n.level-r.level),e}disconnectForReconnect(){return P(this,null,function*(){this.sendConnection&&this.recvConnection&&(T.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=$e.Reconnecting,M("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case J.LocalVideoTrack:ne(t=r._hints).call(t,pt.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case J.LocalAudioTrack:r instanceof sn?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case J.LocalVideoLowTrack:}}),this.emit(me.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Yr(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(me.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),T.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})}hasPendingRemoteMedia(e,t){for(let n of this.pendingRemoteTracks){let{user:r,kind:o}=n;if((e instanceof ga?e.uid:e)===r.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e,t){return P(this,null,function*(){let n,r;if(e===or.SEND_ONLY){if(!this.sendConnection)throw new K(D.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=yield this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new K(D.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=yield this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){let o=yield r.restartICE(t);return r.isInRestartIce=!1,o}{let o=yield r.restartICE();if(o){let c=yield An(this,me.RequestP2PRestartICE,{direction:or.RECEIVE_ONLY,iceParameter:o});yield r.restartICE(c),r.isInRestartIce=!1}}}finally{n()}})}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(J.LocalVideoTrack),n=this.localTrackMap.get(J.LocalAudioTrack),r=e.videoSend.find(v=>{var A;return v.ssrc===(t==null||(A=t.ssrcs)===null||A===void 0?void 0:A[0].ssrcId)}),o=e.audioSend.find(v=>{var A;return v.ssrc===(n==null||(A=n.ssrcs)===null||A===void 0?void 0:A[0].ssrcId)});if(!r||!o)return 1;let c=qr(this,me.NeedSignalRTT),d=r?r.rttMs:void 0,l=o?o.rttMs:void 0,h=d&&l?(d+l)/2:d||l,f=(h&&c?(h+c)/2:h||c)||0,m=100*e.sendPacketLossRate*.7/50+.3*f/1500,E=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,_=t?.track;if(_&&_._encoderConfig&&_._hints.indexOf(pt.SCREEN_TRACK)===-1){let v=_._encoderConfig.bitrateMax,A=e.bitrate.actualEncoded;if(v&&A){let C=(1e3*v-A)/(1e3*v);return Wx[C<.15?0:C<.3?1:C<.45?2:C<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n,o=r._audioSSRC,c=r._videoSSRC,d=e.audioRecv.find(A=>A.ssrc===o),l=e.videoRecv.find(A=>A.ssrc===c);if(!d&&!l)return void(t+=1);let h=qr(this,me.NeedSignalRTT),f=e.rtt,m=(f&&h?(f+h)/2:f||h)||0,E=d?d.jitterMs:void 0,_=e.recvPacketLossRate,v=.7*_*100/50+.3*m/1500;E&&(v=.6*_*100/50+.2*m/1500+.2*E/400),t+=v<.1?1:v<.17?2:v<.36?3:v<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}muteLocalTrack(e){return P(this,null,function*(){return new ie((t,n)=>{this.handleMuteLocalTrack(e,t,n)})})}filterTobePublishedTracks(e,t,n){let r=[],o=He(),c=this.getAllTracks();e=Hd(e=e.filter(h=>c.indexOf(h)===-1));let d=!1,l=!1;for(let h of e){if(h instanceof vt&&(this.localTrackMap.has(J.LocalVideoTrack)||d?new K(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:h,type:J.LocalVideoTrack}),d=!0),t)){let f=this.getLowVideoTrack(h,n);r.push({track:f,type:J.LocalVideoLowTrack})}if(h instanceof Ft){let f=this.localTrackMap.get(J.LocalAudioTrack);if(f){if(!(f.track instanceof sn))throw new K(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new K(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0)}else if(l){let m=r.find(E=>{let{type:_}=E;return _===J.LocalAudioTrack});if(!(m.track instanceof sn))throw new K(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new K(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(h)}else{if(!o.webAudioMediaStreamDest||h instanceof sn||h._bypassWebAudio)r.push({track:h,type:J.LocalAudioTrack});else{let m=new sn;m.addAudioTrack(h),r.push({track:m,type:J.LocalAudioTrack})}l=!0}}}return r}filterTobeUnpublishedTracks(e){let t=[],n=this.getAllTracks();e=Hd(e=e.filter(r=>n.indexOf(r)!==-1));for(let r of e){if(r instanceof Ft){let o=this.localTrackMap.get(J.LocalAudioTrack);if(!o)continue;o.track instanceof sn?(o.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),o.track.trackList.length===0&&(t.push([J.LocalAudioTrack,o]),o.track.close())):t.push([J.LocalAudioTrack,o])}if(r instanceof vt){let o=this.localTrackMap.get(J.LocalVideoTrack);if(!o)continue;t.push([J.LocalVideoTrack,o]);let c=this.localTrackMap.get(J.LocalVideoLowTrack);c&&t.push([J.LocalVideoLowTrack,c])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case J.LocalVideoTrack:n.addListener(de.GET_STATS,this.handleGetLocalVideoStats),n.addListener(de.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(de.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(de.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(de.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(de.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(de.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(de.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case J.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case J.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof sn?e.trackList.forEach(n=>{n.addListener(de.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(de.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(de.GET_STATS,this.handleGetLocalAudioStats),n.addListener(de.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(de.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(de.GET_STATS,this.handleGetLocalAudioStats),e.addListener(de.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(de.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(de.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(de.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(de.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case J.LocalVideoTrack:n.off(de.GET_STATS,this.handleGetLocalVideoStats),n.off(de.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(de.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(de.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(de.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(de.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(de.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(de.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case J.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case J.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof sn?e.trackList.forEach(t=>{t.off(de.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(de.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(de.GET_STATS,this.handleGetLocalAudioStats),t.off(de.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(de.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(de.GET_STATS,this.handleGetLocalAudioStats),e.off(de.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(de.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(de.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(de.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(de.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof eu&&t.addListener(de.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof tu&&t.addListener(de.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(de.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(ce.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(ce.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{var o;let c,{track:d,type:l}=n;switch(l){case J.LocalAudioTrack:c=Xe.Audio;break;case J.LocalVideoTrack:c=ne(o=d._hints).call(o,pt.SCREEN_TRACK)?Xe.Screen:Xe.High;break;case J.LocalVideoLowTrack:c=Xe.Low}return{kind:l===J.LocalAudioTrack?ce.AUDIO:ce.VIDEO,stream_type:c,mid:t[r].id,ssrcs:t[r].localSSRC,isMuted:d.muted||!d.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var n;let r,[o,{track:c,ssrcs:d,id:l}]=t;switch(o){case J.LocalVideoTrack:r=ne(n=c._hints).call(n,pt.SCREEN_TRACK)?Xe.Screen:Xe.High;break;case J.LocalAudioTrack:r=Xe.Audio;break;case J.LocalVideoLowTrack:r=Xe.Low}return{stream_type:r,ssrcs:d,mid:l}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:o,type:c}=n;this.localTrackMap.set(c,{track:o,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=t=>P(this,null,function*(){var n;T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(me.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ne(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&(yield Sn(800)),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))}),e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),he.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:kt.TRACER}).onSuccess(),this.emit(me.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;let r=Array.from(Yr(n=this.remoteUserMap).call(n)).find(c=>c._audioSSRC===t);var o;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(o=r.audioTrack)===null||o===void 0||o.emit($d.FIRST_FRAME_DECODED),he.firstRemoteFrame(this.store.sessionId,hn.FIRST_AUDIO_DECODE,Rt.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;let r=Array.from(Yr(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);r&&he.firstRemoteFrame(this.store.sessionId,hn.FIRST_AUDIO_RECEIVED,Rt.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;let r=Array.from(Yr(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);r&&he.firstRemoteFrame(this.store.sessionId,hn.FIRST_VIDEO_RECEIVED,Rt.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:xn.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{let r=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&r===o||this.emit(me.ConnectionTypeChange,r),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(pa(n))," -> ").concat(JSON.stringify(pa(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(pa(n))," -> ").concat(JSON.stringify(pa(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(me.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}handleDisconnect(e){return P(this,null,function*(){let t=e===or.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,T.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===or.SEND_ONLY?this.restartICE(e):An(this,me.RequestP2PRestartICE,{direction:or.SEND_ONLY}))})}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let n=this.localTrackMap.get(J.LocalAudioTrack);if(e instanceof Ft&&n?.track instanceof sn)return n.track.isActive||t.push([J.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return e===c});if(r&&(t.push(r),r[0]===J.LocalVideoTrack)){let o=this.localTrackMap.get(J.LocalVideoLowTrack);o&&t.push([J.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){let t=[],n=this.localTrackMap.get(J.LocalAudioTrack);if(e instanceof Ft&&n?.track instanceof sn)return n.track.isActive&&t.push([J.LocalAudioTrack,n]),t;let r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:c}]=o;return e===c});if(r)if(r[0]===J.LocalVideoTrack){t.push(r);let o=this.localTrackMap.get(J.LocalVideoLowTrack);o&&t.push([J.LocalVideoLowTrack,o])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{var n;let r,[o,{track:c,ssrcs:d,id:l}]=t;switch(o){case J.LocalAudioTrack:r=Xe.Audio;break;case J.LocalVideoTrack:r=ne(n=c._hints).call(n,pt.SCREEN_TRACK)?Xe.Screen:Xe.High;break;case J.LocalVideoLowTrack:r=Xe.Low}return{stream_type:r,ssrcs:d,mid:l}})}createUnmuteMessage(e){return e.map(t=>{var n;let r,[o,{track:c,ssrcs:d,id:l}]=t;switch(o){case J.LocalAudioTrack:r=Xe.Audio;break;case J.LocalVideoTrack:r=ne(n=c._hints).call(n,pt.SCREEN_TRACK)?Xe.Screen:Xe.High;break;case J.LocalVideoLowTrack:r=Xe.Low}return{stream_type:r,ssrcs:d,mid:l}})}filterTobeUnSubscribedTracks(e,t){let n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){let o=r.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(r.entries()).forEach(o=>{let[c,d]=o;n.push([e,{kind:c,id:d}])});return n}createUnsubscribeMessage(e){let t=[];return e.forEach(n=>{let[r,{kind:o,id:c}]=n;switch(o){case ce.VIDEO:return void(r._videoSSRC&&t.push({stream_type:ce.VIDEO,ssrcId:r._videoSSRC}));case ce.AUDIO:return void(r._audioSSRC&&t.push({stream_type:ce.AUDIO,ssrcId:r._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t,o=this.remoteUserMap.get(n);o&&(o.delete(r),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}updateBitrateLimit(e){return P(this,null,function*(){let t=this.localTrackMap.get(J.LocalVideoTrack),n=this.localTrackMap.get(J.LocalVideoLowTrack);t&&(yield t.track.setBitrateLimit(e.uplink),yield new ie((r,o)=>{this.handleUpdateVideoEncoder(t.track,r,o,!0)})),n&&e.low_stream_uplink&&(yield n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),yield new ie((r,o)=>{this.handleUpdateVideoEncoder(n.track,r,o,!0)}))})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}tryToUnmuteAudio(e){return P(this,null,function*(){for(let t=0;t<e.length;t++)if(e[t]instanceof Ft){let n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;let r=this.createUnmuteMessage(n);return void(yield lt(this,me.RequestUnmuteLocal,r))}})}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(me.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(me.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){return P(this,null,function*(){this.dtlsFailedCount+=1,yield Sn(aC(this.dtlsFailedCount,nn)),this.emit(me.RequestReconnect)})}reconnectP2P(){return P(this,null,function*(){})}canPublishLowStream(){return this.localTrackMap.has(J.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof vt)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof vt).length>1)throw new K(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Ft).length>1&&(e.some(t=>t instanceof Ft&&t._bypassWebAudio)||!He().webAudioMediaStreamDest))throw new K(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof vt&&this.pendingLocalTracks.some(n=>n instanceof vt))throw new K(D.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Ft&&this.pendingLocalTracks.some(n=>n instanceof Ft)&&(!He().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof Ft&&n._bypassWebAudio)))throw new K(D.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let n=!M("DISABLE_DUAL_STREAM_USE_ENCODING")&&He().supportDualStreamEncoding,r=uE(uE({},{width:160,height:120,framerate:15,bitrate:50}),t),o;o=n?e._mediaStreamTrack.clone():mI(e,r);let c=ht(8,"track-low-"),d=new vt(o,uE(uE({},n&&{scaleResolutionDownBy:JC(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,c);return d.on(lc.TRANSCEIVER_UPDATED,l=>{e._updateRtpTransceiver(l,zd.LOW_STREAM)}),d._hints.push(pt.LOW_STREAM),e.addListener(de.NEED_CLOSE,()=>{d.close()}),d}globalLock(){return P(this,null,function*(){return this.recvMutex.lock("From P2PChannel2.globalLock")})}reportVideoFirstFrameDecoded(e,t,n,r){var o;let c=Array.from(Yr(o=this.remoteUserMap).call(o)).find(d=>d._videoSSRC===e);if(c){r||this.store.subscribe(c.uid,"video",void 0,void 0,void 0,void 0,Date.now());let d=this.store.keyMetrics,l=d.subscribe.find(h=>h.userId===c.uid&&h.type==="video");he.firstRemoteVideoDecode(this.store.sessionId,hn.FIRST_VIDEO_DECODE,Rt.FIRST_VIDEO_DECODE,{peer:c._uintid,videowidth:t,videoheight:n,subscribeElapse:xn.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:l?.subscribeEnd||0,subscriberStart:l?.subscribeStart||0,videoAddNotify:l?.streamAdded||0,state:r?1:0})}}remoteMediaSsrcChanged(e,t,n){return P(this,null,function*(){if(!this.recvConnection)return!1;let r=this.remoteUserMap.get(e);if(!r)return!1;let o=r.get(t);if(!o)return!1;let c=yield this.recvConnection.getRemoteSSRC(o);return c!==void 0&&c!==n})}isPreSubScribe(e){return!1}publishDataChannel(e){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED)})}unpublishDataChannel(e){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED)})}subscribeDataChannel(e,t){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED)})}unsubscribeDataChannel(e,t){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED)})}hasPendingRemoteDataChannel(e,t){throw new K(D.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new K(D.NOT_SUPPORTED)}preConnect(e){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED)})}getEstablishParams(){throw new K(D.NOT_SUPPORTED)}reSubscribe(e){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED)})}updateVideoStreamParameter(e,t){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED)})}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===J.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,zd.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},ue(bt.prototype,"p2pConnect",[x2],Object.getOwnPropertyDescriptor(bt.prototype,"p2pConnect"),bt.prototype),ue(bt.prototype,"unpublish",[U2],Object.getOwnPropertyDescriptor(bt.prototype,"unpublish"),bt.prototype),ue(bt.prototype,"unpublishLowStream",[F2],Object.getOwnPropertyDescriptor(bt.prototype,"unpublishLowStream"),bt.prototype),ue(bt.prototype,"subscribe",[V2],Object.getOwnPropertyDescriptor(bt.prototype,"subscribe"),bt.prototype),ue(bt.prototype,"mockSubscribe",[j2],Object.getOwnPropertyDescriptor(bt.prototype,"mockSubscribe"),bt.prototype),ue(bt.prototype,"unsubscribe",[B2],Object.getOwnPropertyDescriptor(bt.prototype,"unsubscribe"),bt.prototype),ue(bt.prototype,"muteRemote",[H2],Object.getOwnPropertyDescriptor(bt.prototype,"muteRemote"),bt.prototype),ue(bt.prototype,"unmuteRemote",[G2],Object.getOwnPropertyDescriptor(bt.prototype,"unmuteRemote"),bt.prototype),ue(bt.prototype,"hasRemoteMediaWithLock",[W2],Object.getOwnPropertyDescriptor(bt.prototype,"hasRemoteMediaWithLock"),bt.prototype),ue(bt.prototype,"disconnectForReconnect",[K2],Object.getOwnPropertyDescriptor(bt.prototype,"disconnectForReconnect"),bt.prototype),ue(bt.prototype,"remoteMediaSsrcChanged",[q2],Object.getOwnPropertyDescriptor(bt.prototype,"remoteMediaSsrcChanged"),bt.prototype),bt);function Ro(e){return function(t,n,r){let o=t[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return r.value=function(){return P(this,arguments,function*(){for(var c=arguments.length,d=new Array(c),l=0;l<c;l++)d[l]=arguments[l];switch(e){case Io.SEND_ONLY:{let h=yield this.sendMutex.lock("From P2PChannel2.".concat(n));try{return yield o.apply(this,d)}finally{h()}}case Io.RECEIVE_ONLY:{let h=yield this.recvMutex.lock("From P2PChannel2.".concat(n));try{return yield o.apply(this,d)}finally{h()}}default:{let h=yield this.sendMutex.lock("From P2PChannel2.".concat(n)),f=yield this.recvMutex.lock("From P2PChannel2.".concat(n));try{return yield o.apply(this,d)}finally{h(),f()}}}})},r}}class Nc extends Dt{constructor(t,n){super(),b(this,"signal",void 0),b(this,"token",void 0),b(this,"tokenTimeout",void 0),b(this,"tokenInterval",void 0),b(this,"_sequence",0),b(this,"userMap",new Map),b(this,"encoder",new TextEncoder),this.signal=t,this.token=n;let r=()=>{this.signal.connectionState===mt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*M("P2P_TOKEN_INTERVAL"))};r()}send(t,n,r,o,c){return P(this,null,function*(){var d,l,h;if(this.userMap.size===0)return;let f=Array.from(Wr(d=this.userMap).call(d))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),o=(l=o)!==null&&l!==void 0?l:ht(6,""),c=(h=c)!==null&&h!==void 0?h:this._sequence++;let m={_id:o,_type:t,_seq:c,_message:n,token:"".concat(this.token,"_").concat(f)};M("SHOW_P2P_LOG")&&T.debug("send message",m,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(m)).forEach(_=>{this.signal.request(ve.DATA_STREAM,{payload:da(this.encoder.encode(_))})});let E=new ie((_,v)=>{let A=window.setTimeout(()=>{this.off("res-@".concat(o,"_ack"),C),this.off("res-@".concat(o),O),this.off(au.ABORT,I),T.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(o)),this.userMap.size===0?v(new K(D.INVALID_REMOTE_USER)):v(new K(D.TIMEOUT))},M("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),C=()=>{A&&window.clearTimeout(A),this.off(au.ABORT,I),r&&_()},I=()=>{A&&window.clearTimeout(A),this.off("res-@".concat(o,"_ack"),C),this.off("res-@".concat(o),O),v(new K(D.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(o)))};this.once(au.ABORT,I),this.once("res-@".concat(o,"_ack"),C);let O=(x,B)=>{N=!0,A&&window.clearTimeout(A),this.off("res-@".concat(o,"_ack"),C),this.off(au.ABORT,I),x==="success"?_(B):v(new K(D.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(o)))},N=!1;r||(this.once("res-@".concat(o),O),Sn(M("SIGNAL_REQUEST_TIMEOUT")).then(()=>{N||T.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(o,", ").concat(m))}))});try{return yield E}catch(_){if(_.code===D.TIMEOUT)return yield this.send(t,n,r,o,c);throw _}})}onMessage(t){var n;let{_uid:r}=t,o,c=this.userMap.get(r);if(c)o=c.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Gt.CHECK)return;let{token:f}=t;o=new Map,c={uid:r,isStart:!0,token:f,splitMessageMap:o,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,c),this.signal.emit(Pe.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in t&&"total"in t){var d;let{id:f,total:m}=t,E=(d=o.get(f))!==null&&d!==void 0?d:[];if(E.push(t),o.has(f)||o.set(f,E),E.length!==m)return;{let _=nh(E).call(E,(v,A)=>v.index-A.index).map(v=>v.payload).join("");o.delete(f),(t=JSON.parse(_))._uid=r}}let{_type:l,token:h}=t;if(ne(n=[Gt.ACK,Gt.CHECK]).call(n,l))return l===Gt.CHECK&&this.handleCheckToken(c,h),void this.receiveMessage(t);h==="".concat(c.token,"_").concat(this.token)?this.handleReceivedMessage(t):T.debug('Receive unexpected message", '.concat(h,", cur_token: ").concat(c.token,"_").concat(this.token),t)}check(){let t={_id:ht(6,""),token:this.token,_type:Gt.CHECK};M("SHOW_P2P_LOG")&&T.debug("send message",t),this.signal.request(ve.DATA_STREAM,{payload:da(this.encoder.encode(JSON.stringify(t)))})}ack(t){let n={_id:t,_type:Gt.ACK,token:this.token};M("SHOW_P2P_LOG")&&T.debug("send message",n),this.signal.request(ve.DATA_STREAM,{payload:da(this.encoder.encode(JSON.stringify(n)))})}response(t,n,r){this.send(Gt.RESPONSE,JSON.stringify({success:!r,message:n}),!0,t)}handleReceivedMessage(t){let n=()=>{this.userMap.forEach(f=>{let{receivedMessagesMap:m,nextExpectedSequenceNumber:E}=f;for(;m.has(E);){let _=m.get(E);m.delete(E),this.receiveMessage(_),f.nextExpectedSequenceNumber++}})};if(!t)return void n();let{_uid:r,_seq:o}=t,c=this.userMap.get(r),{receivedMessagesMap:d,isStart:l,nextExpectedSequenceNumber:h}=c;if(o<h)return this.ack(t._id),void T.debug("[external-signal] receive old message, seq: ".concat(o,", ").concat(t._message));d.set(o,t),l&&o===h&&(this.receiveMessage(t),d.delete(h),c.nextExpectedSequenceNumber++,n())}receiveMessage(t){let{_id:n,_type:r,_message:o,_uid:c}=t;if(M("SHOW_P2P_LOG")&&T.debug("receive message",t),n){let d;switch(t._type!==Gt.ACK&&(o&&(d=JSON.parse(o)),this.ack(t._id)),t._type){case Gt.CANDIDATE:case Gt.CONTROL:this.signal.emit(r,d,c);break;case Gt.PUBLISH:case Gt.UNPUBLISH:case Gt.RESTART_ICE:case Gt.CALL:d.uid=c,An(this.signal,r,d).then(l=>{this.response(t._id,l)}).catch(()=>{this.response(t._id,void 0,!0)});break;case Gt.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Gt.RESPONSE:{let{success:l,message:h}=d;this.emit("res-@".concat(n),l?"success":"failed",h);break}}}}splitMessage(t){if(t.length<Nc.MAX_MESSAGE_SIZE)return[t];let n=[],{remoteToken:r}=JSON.parse(t),o=ht(6,""),c=0,d=800,l=Math.ceil(t.length/d);for(;t.length>0;){c++;let h={id:o,index:c,total:l,payload:t.slice(0,d),token:"".concat(this.token,"_").concat(r)};JSON.stringify(h).length>Nc.MAX_MESSAGE_SIZE?d-=50:(n.push(h),t=t.slice(d))}return n.map(h=>JSON.stringify(h))}handleCheckToken(t,n){return t.token!==n?(T.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{T.debug("token timeout, ".concat(n)),this.reset(t.uid)},M("MAX_P2P_TIMEOUT")),!0)}handleUserOnline(){return P(this,null,function*(){let t=yield An(this.signal,Gt.CALL,void 0),n=yield this.send(Gt.CALL,t);this.signal.emit(ye.P2P_CONNECTION,n,!0)})}reset(t,n){return P(this,null,function*(){let r=this.userMap.get(t);r&&(this.emit(au.ABORT),this.signal.emit(Pe.ON_USER_OFFLINE,{uid:r.uid,reason:Zee.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(T.debug("change local token from ".concat(n," to ").concat(n)),this.token=ht(6,"")))})}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(au.ABORT)}}b(Nc,"MAX_SIZE",1),b(Nc,"MAX_MESSAGE_SIZE",1024);class Are extends Dt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===mt.CONNECTED?this.emit(ye.WS_CONNECTED):t===mt.RECONNECTING?this.emit(ye.WS_RECONNECTING,this._websocketReconnectReason):t===mt.CLOSED&&this.emit(ye.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),b(this,"_disconnectedReason",void 0),b(this,"_websocketReconnectReason",void 0),b(this,"_connectionState",mt.CLOSED),b(this,"reconnectToken",void 0),b(this,"p2pToken",void 0),b(this,"websocket",void 0),b(this,"openConnectionTime",void 0),b(this,"clientId",void 0),b(this,"lastMsgTime",Date.now()),b(this,"uploadCache",[]),b(this,"uploadCacheInterval",void 0),b(this,"rttRolling",new IL(5)),b(this,"pingpongTimer",void 0),b(this,"pingpongTimeoutCount",0),b(this,"joinResponse",void 0),b(this,"multiIpOption",void 0),b(this,"initError",void 0),b(this,"spec",void 0),b(this,"store",void 0),b(this,"_external_signal",void 0),b(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ye.ON_BINARY_DATA,r.data);let o=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){let c="res-@".concat(o._id);this.emit(c,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){switch(o._type){case Pe.ON_DATA_STREAM:return void this.handleDataStream(o._message);case Pe.MUTE_AUDIO:case Pe.MUTE_VIDEO:case Pe.ON_P2P_LOST:case Pe.ON_USER_ONLINE:return;case Pe.ON_USER_OFFLINE:let{uid:c}=o._message;return T.debug("[".concat(this.clientId,"] user-offline uid: ").concat(c)),void this._external_signal.reset(c)}if(this.emit(o._type,o._message),o._type===Pe.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===Pe.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}if(o._type===Pe.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case ge.ERR_LICENSE_MISSING:this.close(Ye.LICENSE_MISSING);break;case ge.ERR_LICENSE_EXPIRED:this.close(Ye.LICENSE_EXPIRED);break;case ge.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ye.LICENSE_MINUTES_EXCEEDED);break;case ge.ERR_LICENSE_PERIOD_INVALID:this.close(Ye.LICENSE_PERIOD_INVALID);break;case ge.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ye.LICENSE_MULTIPLE_SDK_SERVICE);break;case ge.ERR_LICENSE_ILLEGAL:this.close(Ye.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new $C("gateway-".concat(this.clientId),this.spec.retryConfig,!0,M("JOIN_GATEWAY_USE_DUAL_DOMAIN"),M("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===mt.CONNECTED&&this.reconnect("retry",bn.OFFLINE)}),this.p2pToken=ht(6,""),this._external_signal=new Nc(this,this.p2pToken)}request(t,n,r,o){return P(this,null,function*(){let c=ht(6,""),d={_id:c,_type:t,_message:n},l=this.websocket.connectionID,h=()=>new ie((A,C)=>{if(this.connectionState===mt.CONNECTED)return A();let I=()=>{this.off(ye.WS_CLOSED,O),A()},O=()=>{this.off(ye.WS_CONNECTED,I),C(new K(D.WS_ABORT))};this.once(ye.WS_CONNECTED,I),this.once(ye.WS_CLOSED,O)});if(this.connectionState!==mt.CONNECTING&&this.connectionState!==mt.RECONNECTING||t===ve.JOIN||t===ve.REJOIN||(yield h()),this.websocket.sendMessage(d,!0),o)return;let f=new ie((A,C)=>{let I=!1,O=(x,B)=>{I=!0,A({isSuccess:x==="success",message:B||{}}),this.off(ye.WS_CLOSED,N),this.off(ye.WS_RECONNECTING,N),this.emit(ye.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(c),O);let N=()=>{C(new K(D.WS_ABORT,"type: ".concat(t))),this.off(ye.WS_CLOSED,N),this.off(ye.WS_RECONNECTING,N),this.off("res-@".concat(c),O)};this.once(ye.WS_CLOSED,N),this.once(ye.WS_RECONNECTING,N),Sn(M("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==l||I||(T.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(ye.REQUEST_TIMEOUT,t,n))})}),m=null;try{m=yield f}catch(A){if(this.connectionState===mt.CLOSED||t===ve.LEAVE)throw new K(D.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?A.throw():t===ve.JOIN||t===ve.REJOIN?null:(yield h(),yield this.request(t,n))}if(m.isSuccess)return m.message;let E=Number(m.message.error_code||m.message.code),_=bh(E),v=new K(D.UNEXPECTED_RESPONSE,"".concat(_.desc,": ").concat(m.message.error_str),{code:E,data:m.message,desc:_.desc});return _.action==="success"?m.message:(T.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(_.desc,", action: ").concat(_.action)),E===ge.ERR_TOO_MANY_BROADCASTERS?((t===ve.JOIN||t===ve.REJOIN)&&(this.initError=v,this.close()),v.throw()):_.action==="failed"?v.throw():_.action==="quit"?(this.initError=v,this.close(),v.throw()):(E===ge.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,T.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",bn.MULTI_IP)):this.reconnect(_.action,bn.SERVER_ERROR),t===ve.JOIN||t===ve.REJOIN?null:yield this.request(t,n)))})}waitMessage(t,n){return new ie(r=>{let o=c=>{(!n||n(c))&&(this.off(t,o),r(c))};this.on(t,o)})}uploadWRTCStats(t){if(!this.store.sessionId)return void T.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Rh.WRTC_STATS,n)}upload(t,n){let r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{let c=M("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>c&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==mt.CONNECTED)return;let d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},M("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){let r={_type:t,_message:n};this.websocket.sendMessage(r)}sendExtensionMessage(t,n,r){return P(this,null,function*(){return yield this._external_signal.send(t,n,r)})}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ie((n,r)=>{this.once(ye.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ye.WS_CLOSED,()=>r(this.initError||new K(D.WS_ABORT))),this.connectionState=mt.CONNECTING,this.websocket.init(t).catch(r)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Ye.LEAVE,this.connectionState=mt.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=ht(6,""),this._external_signal.clear(),this._external_signal=new Nc(this,this.p2pToken)}join(){return P(this,null,function*(){if(!this.joinResponse){this.emit(ye.ABORT_P2P_EXECUTION);let t=yield An(this,ye.REQUEST_JOIN_INFO),n=yield this.request(ve.JOIN,t);if(!n)return this.emit(ye.REPORT_JOIN_GATEWAY,D.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ye.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=mt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0})}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleDataStream(t){try{var n;let r=cc(t.payload),o=new TextDecoder().decode(r),c=JSON.parse(o);"total"in c&&"id"in c||ne(n=Object.values(Gt)).call(n,c._type)?(c._uid=t.uid,this._external_signal.onMessage(c)):this.emit(Pe.ON_DATA_STREAM,t)}catch{this.emit(Pe.ON_DATA_STREAM,t)}}handleNotification(t){T.debug("[".concat(this.clientId,"] receive notification: "),t);let n=bh(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(n.action,bn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=M("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(T.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>M("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",bn.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let r=Date.now()-n;this.rttRolling.add(r),M("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(Re.RECONNECT_CREATE_CONNECTION,t=>{this.emit(ye.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Re.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Re.CLOSED,()=>{this.connectionState=mt.CLOSED}),this.websocket.on(Re.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=mt.CLOSED}),this.websocket.on(Re.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===mt.CONNECTED?this.connectionState=mt.RECONNECTING:this.connectionState=mt.CONNECTING}),this.websocket.on(Re.WILL_RECONNECT,(t,n,r)=>{t!=="retry"?(T.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):T.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(t)}),this.websocket.on(Re.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(ye.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof K&&t.code===D.UNEXPECTED_RESPONSE&&t.data.code===ge.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",bn.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",bn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Re.REQUEST_NEW_URLS,(t,n)=>{An(this,ye.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Re.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let Dre={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new bre(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new Are(n,t)}};function Y2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function $2(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Y2(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Ore{constructor(t){b(this,"sessionDesc",void 0),b(this,"localCapabilities",void 0),b(this,"rtpCapabilities",void 0),b(this,"candidates",void 0),b(this,"_originCandidates",void 0),b(this,"iceParameters",void 0),b(this,"dtlsParameters",void 0),b(this,"setup",void 0),b(this,"currentMidIndex",void 0),b(this,"cname",void 0),t=Ut(t);let{iceParameters:n,dtlsParameters:r,candidates:o,rtpCapabilities:c,setup:d,localCapabilities:l,sdkCodec:h,cname:f}=t,m=Ir(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=c,this.candidates=o,this._originCandidates=Ut(o),this.iceParameters=n,this.dtlsParameters=r,this.setup=d,this.localCapabilities=l,this.cname=f;for(let E=0;E<m.mediaDescriptions.length;E++){let _=m.mediaDescriptions[E];if(_.attributes.iceUfrag=n.iceUfrag,_.attributes.icePwd=n.icePwd,_.attributes.fingerprints=r.fingerprints,_.attributes.candidates=o,_.attributes.setup=d,_.media.mediaType==="video"){_.media.fmts=c.videoCodecs.map(A=>A.payloadType.toString(10));let v=c.videoCodecs.filter(A=>{var C,I;return(C=A.rtpMap)===null||C===void 0?void 0:ne(I=C.encodingName.toLowerCase()).call(I,h)});v.length===0&&(v=c.videoCodecs),_.attributes.payloads=v,_.attributes.extmaps=c.videoExtensions}_.media.mediaType==="audio"&&(_.media.fmts=c.audioCodecs.map(v=>v.payloadType.toString(10)),_.attributes.payloads=c.audioCodecs,_.attributes.extmaps=c.audioExtensions),m.mediaDescriptions[E]=this.mungMediaDesc(_)}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return ua(this.sessionDesc)}send(t,n,r){let{ssrcs:o,ssrcGroups:c}=_c(n,this.cname),d=this.sessionDesc.mediaDescriptions.find(f=>t===ce.VIDEO?f.media.mediaType==="video":f.media.mediaType==="audio"),l=o[0].attributes.label,h=o[0].attributes.mslabel;return d.attributes.ssrcs=d.attributes.ssrcs.concat(o),d.attributes.ssrcGroups=d.attributes.ssrcGroups.concat(c),{id:l,mslabel:h}}batchSend(t){return t.map(n=>{let{kind:r,ssrcMsg:o}=n;return this.send(r,o,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{let r=[],o=[],c=[];n.attributes.ssrcs.forEach(d=>{ne(t).call(t,d.attributes.label||"")?c.push(d):r.push(d)}),n.attributes.ssrcGroups.forEach(d=>{var l;ne(l=c.map(h=>h.ssrcId)).call(l,d.ssrcIds[0])||o.push(d)}),n.attributes.ssrcs=r,n.attributes.ssrcGroups=o})}mute(t){let n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){let n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach((o,c)=>{let d=o._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===d.kind),h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],o);this.sessionDesc.mediaDescriptions[l]=h})}stopReceiving(t){}updateCandidates(t){let n=this._originCandidates.filter(o=>o.transport==="udp"),r=[];if(n.forEach(o=>{r.push($2($2({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}),n.length!==0){switch(t){case Vn.TCP_RELAY:this.candidates=r;break;case Vn.UDP_TCP_RELAY:case Vn.RELAY:this.candidates=[...n,...r];break;default:this.candidates=n}for(let o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}}restartICE(t){t=Ut(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){let r=Ut(t);return lu(r,n),ZC(r,n),r}updateRecvMedia(t,n){let r=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(r!==-1){let o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=o}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){let o=this.sessionDesc.mediaDescriptions.find(d=>t===ce.VIDEO?d.attributes.mid==="video":d.attributes.mid==="audio");if(o){let d=o.attributes.ssrcs.find(l=>l.attributes.label===n);var c;d&&(d.attributes.label=r,(c=d.attributes.msid)===null||c===void 0||c.replace(n,r))}}mungMediaDesc(t){let n=Ut(t);return QC(n),function(r){let o=r.attributes.extmaps.find(c=>Ng(c.extensionName));o&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(o),1),r.attributes.payloads.forEach(c=>{let d=c.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");d!==-1&&c.rtcpFeedbacks.splice(d,1)})}(n),n}getSSRC(t){for(let n of this.sessionDesc.mediaDescriptions)for(let r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}var dt;function X2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function lE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?X2(Object(n),!0).forEach(function(r){b(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X2(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Nre=(dt=class cf extends eU{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var n;return ne(n=Object.keys(og)).call(n,t)}))]}constructor(t,n){super(t,n),b(this,"store",void 0),b(this,"peerConnection",void 0),b(this,"remoteSDP",void 0),b(this,"initialOffer",void 0),b(this,"statsFilter",void 0),b(this,"useRTX",!1),b(this,"localCapabilities",void 0),b(this,"localCandidateCount",0),b(this,"allCandidatesReceived",!1),b(this,"establishPromise",void 0),b(this,"mutex",void 0),this.store=n,this.mutex=new kn("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(cf.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=pC(this.peerConnection,M("STATS_UPDATE_INTERVAL"),void 0,xt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){return P(this,null,function*(){try{let t=yield this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let n=fa(t.sdp),r=Oh(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:M("FILTER_VIDEO_FEC"),filterAudioFec:M("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=t,lE(lE({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new K(D.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}})}updateRemoteConnect(){return P(this,null,function*(){})}connect(t){return P(this,null,function*(){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Ore(lE(lE({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let n=this.remoteSDP.toString();yield this.peerConnection.setLocalDescription(this.initialOffer),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}})}updateRemoteRTPCapabilities(t,n){return P(this,null,function*(){throw new K(D.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")})}getPreMedia(t){}send(t,n){var r=this;return ui(function*(){let o=yield Ue(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let c=t.map(_=>r.peerConnection.addTrack(_._mediaStreamTrack)),d=yield Ue(r.peerConnection.createOffer()),l=Ir(d.sdp),h=t.map(_=>{let v=_._mediaStreamTrack,A=l.mediaDescriptions.find(C=>C.attributes.mid===v.kind);if(!A)throw new Error("Cannot extract ssrc from mediaDescription.");return function(C,I,O){let N=C.attributes.ssrcs.filter(B=>B.attributes.label===I),x=C.attributes.ssrcGroups;if(N.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(x&&N.length>1){let B=x.find(j=>j.ssrcIds.indexOf(N[0].ssrcId)!==-1);return B?[{ssrcId:B.ssrcIds[0],rtx:O?B.ssrcIds[1]:void 0}]:[{ssrcId:N[0].ssrcId}]}return[{ssrcId:N[0].ssrcId}]}(A,v.id,r.useRTX)}),f;try{f=yield h}catch(_){throw c.forEach(v=>{wn()&&v.replaceTrack(null),r.peerConnection.removeTrack(v)}),_}let m=r.mungSendOfferSDP(d.sdp,t);r.remoteSDP.receive(t,n,f);let E=r.remoteSDP.toString();return yield Ue(r.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Ue(r.applySendEncodings(c,t)),yield Ue(r.peerConnection.setRemoteDescription({type:"answer",sdp:E})),t.map((_,v)=>{let A=_._mediaStreamTrack.id;return{localSSRC:h[v],id:A}})}catch(c){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{o()}})()}stopSending(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let n=this.peerConnection.getSenders().filter(c=>{var d;return t.indexOf(((d=c.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(c=>{wn()&&c.replaceTrack(null),this.peerConnection.removeTrack(c)});let r=yield this.peerConnection.createOffer();yield this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);let o=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}})}receive(t,n,r,o){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:c,mslabel:d}=this.remoteSDP.send(t,n,o),l=new ie((m,E)=>{let _=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(c)))},1e4),v=A=>{let C=Be();if((C.name==="Safari"&&Number(C.version)===11||nr())&&A.track.id!==c&&A.streams[0].id===d){var I;let O=A.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(t,c,A.track.id),this.peerConnection.removeEventListener("track",v),clearTimeout(_),void m(O)}if(A.track.id===c)return this.peerConnection.removeEventListener("track",v),clearTimeout(_),void m(A.track)};this.peerConnection.addEventListener("track",v)}),h=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"offer",sdp:h});let f=yield this.peerConnection.createAnswer();return yield this.peerConnection.setLocalDescription(f),{track:yield l,id:c}}catch(c){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(c.toString()))}})}stopReceiving(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let n=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let r=yield this.peerConnection.createAnswer();yield this.peerConnection.setLocalDescription(r)}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}})}muteRemote(t){return P(this,null,function*(){})}unmuteRemote(t){return P(this,null,function*(){})}muteLocal(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let n=this.peerConnection.getSenders().filter(r=>{var o;return t.indexOf(((o=r.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(wn()&&r.track)r.track.enabled=!1;else{let o=r.getParameters();o.encodings.forEach(c=>c.active=!1),r.setParameters(o)}})}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}})}unmuteLocal(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let n=this.peerConnection.getSenders().filter(c=>{var d;return t.indexOf(((d=c.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(c=>P(this,null,function*(){if(wn()&&c.track)c.track.enabled=!0;else{let d=c.getParameters();d.encodings.forEach(l=>l.active=!0),yield c.setParameters(d)}}));let r=yield this.peerConnection.createOffer();yield this.peerConnection.setLocalDescription(r);let o=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}})}restartICE(t){var n=this;return ui(function*(){let r=yield Ue(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let o=He().supportPCSetConfiguration;if(t===Vn.RELAY&&!o)return;if(o){let f=n.peerConnection.getConfiguration(),m=t===Vn.RELAY?"relay":"all";f.iceTransportPolicy!==m&&(T.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(m,"]")),f.iceTransportPolicy=m,n.peerConnection.setConfiguration(f))}t!==Vn.RELAY&&n.remoteSDP.updateCandidates(t);let c=yield Ue(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let d=fa(c.sdp),{remoteIceParameters:l}=yield d.iceParameters;n.remoteSDP.restartICE(l);let h=n.remoteSDP.toString();yield Ue(n.peerConnection.setLocalDescription(c)),yield Ue(n.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(o){T.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}updateEncoderConfig(t,n){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let r=yield this.peerConnection.createOffer(),o=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);let c=this.remoteSDP.toString();yield this.peerConnection.setLocalDescription({type:"offer",sdp:o}),yield this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(r){throw new K(D.EXCHANGE_SDP_FAILED,r.toString())}})}updateSendParameters(t,n){return P(this,null,function*(){let r=this.peerConnection.getSenders().filter(o=>{var c;return((c=o.track)===null||c===void 0?void 0:c.id)===t});r.length===1&&(yield this.applySendEncodings(r,[n]))})}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}replaceTrack(t,n){return P(this,null,function*(){let r=this.peerConnection.getSenders().find(o=>{var c;return((c=o.track)===null||c===void 0?void 0:c.id)===n});r&&(yield r.replaceTrack(t._mediaStreamTrack))})}createDataChannels(t,n){throw new K(D.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new K(D.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},M("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Eh(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...cf.turnServerConfigToIceServers(t.turnServer.servers)),M("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...cf.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){let n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}updateRtpSenderEncodings(t,n){return P(this,null,function*(){var r;if(n||(n=this.peerConnection.getSenders().find(f=>{var m;return((m=f.track)===null||m===void 0?void 0:m.id)===t._mediaStreamTrack.id})),!n)return T.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!He().supportSetRtpSenderParameters)return T.warn("Browser not support set rtp-sender parameters");let o={},c={};if(t instanceof vt)switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;default:o.degradationPreference="balanced"}if(M("DSCP_TYPE")&&Ss()){var d;let f=M("DSCP_TYPE");ne(d=["very-low","low","medium","high"]).call(d,f)&&(c.networkPriority=f)}let l=n.getParameters(),h=(r=l.encodings)===null||r===void 0?void 0:r[0];h&&Object.assign(h,c),Object.assign(l,o),T.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(l.encodings))),yield n.setParameters(l)})}applySendEncodings(t,n){return P(this,null,function*(){try{if(!He().supportSetRtpSenderParameters||t.length!==n.length)return;for(let r=0;r<t.length;r++){let o=t[r],c=n[r];o&&c&&(yield this.updateRtpSenderEncodings(c,o))}}catch{T.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}})}mungSendOfferSDP(t,n){let r=Ir(t);return n.forEach((o,c)=>{let d=o._mediaStreamTrack,l=r.mediaDescriptions.find(h=>h.attributes.mid===d.kind);l&&lu(l,o)}),ua(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(t){return P(this,null,function*(){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let n=this.remoteSDP.batchSend(t).map((c,d)=>{let{id:l,mslabel:h}=c,{kind:f}=t[d];return new ie((m,E)=>{let _=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(l)))},1e4),v=A=>{let C=Be();if(C.name==="Safari"&&Number(C.version)===11&&A.track.id!==l&&A.streams[0].id===h){var I;let O=A.streams[0].getTracks()[0];return(I=this.remoteSDP)===null||I===void 0||I.updateTrackLabel(f,l,A.track.id),this.peerConnection.removeEventListener("track",v),clearTimeout(_),void m({track:O,id:l})}if(A.track.id===l)return this.peerConnection.removeEventListener("track",v),clearTimeout(_),void m({track:A.track,id:l})};this.peerConnection.addEventListener("track",v)})}),r=this.remoteSDP.toString();yield this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let o=yield this.peerConnection.createAnswer();return yield this.peerConnection.setLocalDescription(o),yield ie.all(n)}catch(n){throw new K(D.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}})}getRemoteSSRC(t){return P(this,null,function*(){if(!this.remoteSDP)return;let n=this.remoteSDP.getSSRC(t);return n?.[0].ssrcId})}setConfiguration(t){if(He().supportPCSetConfiguration){let n=cf.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},ue(dt.prototype,"connect",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"connect"),dt.prototype),ue(dt.prototype,"stopSending",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"stopSending"),dt.prototype),ue(dt.prototype,"receive",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"receive"),dt.prototype),ue(dt.prototype,"stopReceiving",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"stopReceiving"),dt.prototype),ue(dt.prototype,"muteRemote",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"muteRemote"),dt.prototype),ue(dt.prototype,"unmuteRemote",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"unmuteRemote"),dt.prototype),ue(dt.prototype,"muteLocal",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"muteLocal"),dt.prototype),ue(dt.prototype,"unmuteLocal",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"unmuteLocal"),dt.prototype),ue(dt.prototype,"close",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"close"),dt.prototype),ue(dt.prototype,"updateEncoderConfig",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"updateEncoderConfig"),dt.prototype),ue(dt.prototype,"updateSendParameters",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"updateSendParameters"),dt.prototype),ue(dt.prototype,"replaceTrack",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"replaceTrack"),dt.prototype),ue(dt.prototype,"getRemoteSSRC",[_i],Object.getOwnPropertyDescriptor(dt.prototype,"getRemoteSSRC"),dt.prototype),dt);function _i(e,t,n){let r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=function(){return P(this,arguments,function*(){let o=this.mutex,c=yield o.lock("Locking from P2PConnection.".concat(t));try{for(var d=arguments.length,l=new Array(d),h=0;h<d;h++)l[h]=arguments[h];return yield r.apply(this,l)}finally{c()}})},n}let Pre={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new Nre(n,t)}};fC(),nt("PROCESS_ID","process-".concat(ht(8,""),"-").concat(ht(4,""),"-").concat(ht(4,""),"-").concat(ht(4,""),"-").concat(ht(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void T.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),n=Date.now();T.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(Ot,r)){let{value:o,expires:c}=t[r];if(c&&c<=n)return;_o[r]=o,Ot[r]=o}})}catch(t){T.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(_o.AREAS)&&_o.AREAS.length>0&&iI(_o.AREAS,!0);let J2=(e,t,n)=>{T.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),nt(e,t,n)};vc(rre,!1),vc(sre,!1),vc(Gte,!1),vc(Ere,!1),vc(ere,!1),vc(Dre,!1),vc(Pre,!1);let rn=function(e){let t=new Dt,n=e,r={getListeners:t.getListeners.bind(t),on:(o,c)=>(function(d,l){d===Jo.SECURITY_POLICY_VIOLATION&&DV(l,!0)}(o,c),t.on.bind(t)(o,c)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return AV(AV({},n),r)}({__TRACK_LIST__:qd,VERSION:li,BUILD:EC,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:J2,getParameter:M,getSupportedCodec:function(){return P(this,null,function*(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,n=yield function(r){return P(this,null,function*(){let o;return He().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),o=(yield r.createOffer()).sdp):o=(yield r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,o})}(t);if(!n)return e;t.close(),t=null,e=function(r){let o={video:[],audio:[]};return r.match(/ VP8/i)&&o.video.push("VP8"),r.match(/ VP9/i)&&o.video.push("VP9"),r.match(/ AV1/i)&&o.video.push("AV1"),r.match(/ H264/i)&&o.video.push("H264"),r.match(/ H265/i)&&o.video.push("H265"),r.match(/ opus/i)&&o.audio.push("OPUS"),r.match(/ PCMU/i)&&o.audio.push("PCMU"),r.match(/ PCMA/i)&&o.audio.push("PCMA"),r.match(/ G722/i)&&o.audio.push("G722"),o}(n)}catch(t){throw new G(D.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e})},checkSystemRequirements:function(){let e=he.reportApiInvoke(null,{name:tn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:kt.TRACER}),t=!1;try{let c=window.RTCPeerConnection,d=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,l=window.WebSocket;t=!!(c&&d&&l),t&&ZS()&&Zk(75)&&new c().close()}catch(c){return T.error("check system requirement failed: ",c),!1}let n=!1,r=Be();r.name===ze.CHROME&&Number(r.version)>=58&&(go.engine.name!=="WebKit"||function(){let c=Be();if(Xm()){if(c.os===ln.MAC_OS)return!0;if(c.os===ln.IOS){let d=go.os.version&&go.os.version.split(".");if(d&&Number(d[0])===14&&d[1]&&Number(d[1])>=3||d&&Number(d[0])>14)return!0}}return!1}())&&(n=!0),(r.name===ze.FIREFOX&&Number(r.version)>=56||r.name===ze.OPERA&&Number(r.version)>=45||r.name===ze.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(nr()||Bi())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||oL()||Be().name===ze.QQ)&&(n=!0),T.debug("checkSystemRequirements, api:",t,"browser",n);let o=t&&n;return e.onSuccess(o),o},getDevices:function(e){return Zr.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Zr.getRecordingDevices(e)},getCameras:function(e){return Zr.getCamerasDevices(e)},getElectronScreenSources:JL,getPlaybackDevices:function(e){return Zr.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},n=ht(5,"client-"),r=he.reportApiInvoke(null,{id:n,name:tn.CREATE_CLIENT,options:[t],tag:kt.TRACER});try{(function(o){dn(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),dn(o.mode,"config.mode",["rtc","live","p2p"]),o.audioCodec!==void 0&&dn(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&Tn(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&pL(o.turnServer),o.httpRetryConfig!==void 0&&hL(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&hL(o.websocketRetryConfig)})(t)}catch(o){throw r.onError(o),o}return(tL(16,0,!0)||nL(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",T.debug("browser not support vp9, force use vp8")),nt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),r.onSuccess(),new Wte($i($i({forceWaitGatewayResponse:!0},t),{},{role:ne(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:function(){return P(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=M("CAMERA_CAPTURE_CONFIG"),n=ht(8,"track-cam-"),r=he.reportApiInvoke(null,{id:n,tag:kt.TRACER,name:tn.CREATE_CAM_VIDEO_TRACK,options:[wt({},e),t]});t&&(e.encoderConfig=t);let o=lg(e),c=null;T.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{c=(yield Qr({video:o},n)).getVideoTracks()[0]||null}catch(l){throw r.onError(l),l}if(!c){let l=new K(D.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(l),l.throw(T)}e.optimizationMode&&kC(n,c,e,zo(e.encoderConfig));let d=new MC(c,e,o,e.scalabiltyMode?ag(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return r.onSuccess(d.getTrackId()),T.info("create camera video success, trackId:",n),d})},createCustomVideoTrack:function(e){let t=ht(8,"track-cus-"),n=he.reportApiInvoke(null,{id:t,tag:kt.TRACER,name:tn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),r=new vt(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?ag(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[pt.CUSTOM_TRACK]);return n.onSuccess(r.getTrackId()),T.info("create custom video track success with config",e,"trackId",r.getTrackId()),r},createScreenVideoTrack:function(){return P(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",n=typeof t=="object"?function(_){return a1(_)}(t):void 0;n&&(t="auto");let r=ht(8,"track-scr-v-"),o=he.reportApiInvoke(null,{id:r,tag:kt.TRACER,name:tn.CREATE_SCREEN_VIDEO_TRACK,options:[wt({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let c=function(_){let v={};_.screenSourceType&&(v.mediaSource=_.screenSourceType),_.extensionId&&Ts()&&(v.extensionId=_.extensionId);let{displaySurface:A,selfBrowserSurface:C,surfaceSwitching:I,systemAudio:O,preferCurrentTab:N}=_;(Vd(107)||XS(107)||JS(93))&&(A&&(dn(A,"displaySurface",["browser","window","monitor"]),v.displaySurface=A),C?(dn(C,"selfBrowserSurface",["exclude","include"]),v.selfBrowserSurface=C):v.selfBrowserSurface="include",I&&(dn(I,"surfaceSwitching",["exclude","include"]),v.surfaceSwitching=I)),(Vd(105)||XS(105)||JS(91))&&O&&(dn(O,"systemAudio",["exclude","include"]),v.systemAudio=O),(Vd(94)||XS(94)||JS(80))&&N&&(v.preferCurrentTab=!0),_.electronScreenSourceId&&(v.sourceId=_.electronScreenSourceId);let x=_.encoderConfig?SC(_.encoderConfig):null;return v.mandatory={chromeMediaSource:"desktop",maxWidth:x?x.width:void 0,maxHeight:x?x.height:void 0},x&&(x.frameRate&&(typeof x.frameRate=="number"?(v.mandatory.maxFrameRate=x.frameRate,v.mandatory.minFrameRate=x.frameRate):(v.mandatory.maxFrameRate=x.frameRate.max||x.frameRate.ideal||x.frameRate.exact||void 0,v.mandatory.minFrameRate=x.frameRate.min||x.frameRate.ideal||x.frameRate.exact||void 0),v.frameRate=x.frameRate),x.width&&(v.width=x.width),x.height&&(v.height=x.height)),v}(e),d=null,l=null,h=He();if(!h.supportShareAudio&&t==="enable"){let _=new K(D.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return o.onError(_),_.throw(T)}T.info("start create screen video track with config",e,"withAudio",t,"trackId",r);let f=h.supportShareAudio&&t!=="disable";try{let _=yield Qr({screen:c,screenAudio:f?n||!0:void 0},r);d=_.getVideoTracks()[0]||null,l=_.getAudioTracks()[0]||null}catch(_){throw o.onError(_),_}if(!d){let _=new K(D.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(_),_.throw(T)}if(!l&&t==="enable"){d&&d.stop();let _=new K(D.SHARE_AUDIO_NOT_ALLOWED);return o.onError(_),_.throw(T)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(kC(r,d,e,e.encoderConfig&&SC(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let m=new vt(d,e.encoderConfig?SC(e.encoderConfig):{},e.scalabiltyMode?ag(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[pt.SCREEN_TRACK]);if(!l)return o.onSuccess(m.getTrackId()),T.info("create screen video track success","video:",m.getTrackId()),m;let E=new Ft(l,void 0,ht(8,"track-scr-a-"),!1);return o.onSuccess([m.getTrackId(),E.getTrackId()]),T.info("create screen video track success","video:",m.getTrackId(),"audio:",E.getTrackId()),[m,E]})},createMicrophoneAndCameraTracks:function(){return P(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=M("CAMERA_CAPTURE_CONFIG"),r=ht(8,"track-mic-"),o=ht(8,"track-cam-"),c=he.reportApiInvoke(null,{id:"".concat(r,"-").concat(o),tag:kt.TRACER,name:tn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);let d=lg(t),l=c1(e),h=null,f=null;T.info("start create camera video track(".concat(o,") and microphone audio track(").concat(r,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let _=yield Qr({audio:l,video:d},"".concat(r,"-").concat(o));h=_.getAudioTracks()[0],f=_.getVideoTracks()[0]}catch(_){throw c.onError(_),_}if(!h||!f){let _=new K(D.UNEXPECTED_ERROR,"can not find tracks in media stream");return c.onError(_),_.throw(T)}t.optimizationMode&&kC(o,f,t,zo(t.encoderConfig));let m=new hg(h,e,l,r),E=new MC(f,t,d,t.scalabiltyMode?ag(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,o);return c.onSuccess([m.getTrackId(),E.getTrackId()]),T.info("create camera video track(".concat(o,") and microphone audio track(").concat(r,") success")),[m,E]})},createMicrophoneAudioTrack:function(){return P(this,arguments,function*(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=ht(8,"track-mic-"),n=he.reportApiInvoke(null,{id:t,tag:kt.TRACER,name:tn.CREATE_MIC_AUDIO_TRACK,options:[e]}),r=c1(e),o=null;T.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{o=(yield Qr({audio:r},t)).getAudioTracks()[0]||null}catch(d){throw n.onError(d),d}if(!o){let d=new K(D.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(d),d.throw(T)}let c=new hg(o,e,r,t);return n.onSuccess(c.getTrackId()),T.info("create microphone audio track success, trackId:",t),c})},createCustomAudioTrack:function(e){let t=ht(8,"track-cus-"),n=he.reportApiInvoke(null,{id:t,tag:kt.TRACER,name:tn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),r=new Ft(e.mediaStreamTrack,e.encoderConfig?cg(e.encoderConfig):{},t,!1);return T.info("create custom audio track success with config",e,"trackId",r.getTrackId()),n.onSuccess(r.getTrackId()),r},createBufferSourceAudioTrack:function(e){return P(this,null,function*(){var t;let{cacheOnlineFile:n,encoderConfig:r}=e,{source:o}=e,c={source:o instanceof AudioBuffer?"AudioBuffer":o instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":o,cacheOnlineFile:n,encoderConfig:r},d=ht(8,"track-buf-"),l=he.reportApiInvoke(null,{id:d,tag:kt.TRACER,name:tn.CREATE_BUFFER_AUDIO_TRACK,options:[c]});if(M("DISABLE_WEBAUDIO"))throw new K(D.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");T.info("start create buffer source audio track with config",JSON.stringify(c),"trackId",d);let h=o;if(!(o instanceof AudioBuffer))try{o=yield function(E,_){return P(this,null,function*(){let v=null;if(typeof E=="string"){let C=Y1.get(E);if(C)return T.debug("use cached audio resource: ",E),C;try{v=(yield Eo(()=>pr.get(E,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(I){throw new K(D.FETCH_AUDIO_FILE_FAILED,I.toString())}}else v=yield new ie((I,O)=>{let N=new FileReader;N.onload=x=>{x.target?I(x.target.result):O(new K(D.READ_LOCAL_AUDIO_FILE_ERROR))},N.onerror=()=>{O(new K(D.READ_LOCAL_AUDIO_FILE_ERROR))},N.readAsArrayBuffer(E)});let A=yield function(C){let I=Qd();return new ie((O,N)=>{I.decodeAudioData(C,x=>{O(x)},x=>{N(new K(D.DECODE_AUDIO_FILE_FAILED,x.toString()))})})}(v);return typeof E=="string"&&_&&Y1.set(E,A),A})}(o,n)}catch(E){return l.onError(E),E.throw(T)}let f=new uee(o),m=new dee(h,f,r?cg(r):{},d);return T.info("create buffer source audio track success, trackId:",d),l.onSuccess(m.getTrackId()),m})},setAppType:function(e){if(T.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw T.debug("Invalid appType"),new G(D.INVALID_PARAMS,"invalid app type",e);nt("APP_TYPE",Math.floor(e))},setLogLevel:function(e){T.setLogLevel(e)},enableLogUpload:function(){M("USE_NEW_LOG")?nt("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){M("USE_NEW_LOG")?nt("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new WU},checkAudioTrackIsActive:function(t){return P(this,arguments,function*(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=he.reportApiInvoke(null,{tag:kt.TRACER,name:tn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof Ft||e instanceof tu)){let f=new G(D.INVALID_TRACK,"the parameter is not a audio track");return r.onError(f),f.throw()}n&&n<1e3&&(n=1e3);let o=e instanceof Ft?e.getTrackLabel():"remote_track",c=e.getVolumeLevel(),d=c,l=c,h=Date.now();return new ie(f=>{let m=setInterval(()=>{let E=e.getVolumeLevel();d=E>d?E:d,l=E<l?E:l;let _=d-l>1e-4,v=Date.now()-h;if(_||v>n){clearInterval(m);let A=_,C={duration:v,deviceLabel:o,maxVolumeLevel:d,result:A};T.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(C))),r.onSuccess(C),f(A)}},200)})})},checkVideoTrackIsActive:function(t){return P(this,arguments,function*(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=he.reportApiInvoke(null,{tag:kt.TRACER,name:tn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof vt||e instanceof eu)){let _=new G(D.INVALID_TRACK,"the parameter is not a video track");return r.onError(_),_.throw()}n&&n<1e3&&(n=1e3);let o=e instanceof vt?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(wn()||Xm())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();let l=document.createElement("canvas");l.width=160,l.height=120;let h=0,f=0;try{let _=Date.now();h=yield function(v,A,C,I){let O,N=0,x=null;return new ie((B,j)=>{function F(){N>I&&O&&(O(),B(N));let W=C.getContext("2d");if(!W){let te=new G(D.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(te.toString()),void j(te)}W.drawImage(v,0,0,160,120);let X=W.getImageData(0,0,C.width,C.height),oe=Math.floor(X.data.length/3);if(x){for(let te=0;te<oe;te+=3)if(X.data[te]!==x[te])return N+=1,void(x=X.data);x=X.data}else x=X.data}setTimeout(()=>{O&&(O(),B(N))},A),O=bC(()=>{F()},30)})}(d,n,l,4),f=Date.now()-_}catch(_){throw r.onError(_),_}Nte===ze.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;let m=h>4,E={duration:f,changedPicNum:h,deviceLabel:o,result:m};return T.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(E))),r.onSuccess(E),m})},setArea:iI,audioElementPlayCenter:fr,resumeAudioContext:function(){fr.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){qte.processExternalMediaAEC(e)},registerExtensions:function(e){let t=M("PLUGIN_INFO")||[];e.forEach(n=>{"name"in n&&!ne(t).call(t,n.name)&&t.push(n.name);let r=n;r.__registered__=!0,r.logger.hookLog=T.extLog,r.reporter.hookApiInvoke=he.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(o=>{r.parameters[o]=M(o)})}),J2("PLUGIN_INFO",t)},ChannelMediaRelayError:ou,ChannelMediaRelayEvent:ws,ChannelMediaRelayState:Rr,RemoteStreamFallbackType:nee,RemoteStreamType:tee,ConnectionDisconnectedReason:Ye,AudienceLatencyLevelType:PZ,AREAS:Ke,preload:function(e,t,n,r){return P(this,null,function*(){return EF(e,t,n,r)})}});return Object.defineProperties(rn,{onAudioAutoplayFailed:{get:()=>ei.onAudioAutoplayFailed,set:e=>{ei.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>ei.onAutoplayFailed,set:e=>{ei.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>rn._onSecurityPolicyViolation,set(e){rn._onSecurityPolicyViolation=e,DV(e)}},__CLIENT_LIST__:{get:()=>M("SHOW_GLOBAL_CLIENT_LIST")?gc:[]}}),Zr.on(hc.CAMERA_DEVICE_CHANGED,e=>{T.info("camera device changed",JSON.stringify(e)),rn.onCameraChanged&&rn.onCameraChanged(e),rn.safeEmit(Jo.CAMERA_CHANGED,e)}),Zr.on(hc.RECORDING_DEVICE_CHANGED,e=>{T.info("microphone device changed",JSON.stringify(e)),rn.onMicrophoneChanged&&rn.onMicrophoneChanged(e),rn.safeEmit(Jo.MICROPHONE_CHANGED,e)}),Zr.on(hc.PLAYOUT_DEVICE_CHANGED,e=>{T.debug("playout device changed",JSON.stringify(e)),rn.onPlaybackDeviceChanged&&rn.onPlaybackDeviceChanged(e),rn.safeEmit(Jo.PLAYBACK_DEVICE_CHANGED,e)}),fr.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),ei.onAudioAutoplayFailed&&ei.onAudioAutoplayFailed()},rt.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),ei.onAudioAutoplayFailed&&ei.onAudioAutoplayFailed(),rn.safeEmit(Jo.AUTOPLAY_FAILED)}),rt.on(In.STATE_CHANGE,(e,t)=>{T.info("audio context state changed: ".concat(t," => ").concat(e)),rn.onAudioContextStateChanged&&rn.onAudioContextStateChanged(e,t),rn.safeEmit(Jo.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),$t.on(Bd.NETWORK_STATE_CHANGE,(e,t)=>{T.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=rn),rn})});function ij(i,s){return Object.is(i,s)}var zn=null,mE=!1,aR=1,yi=Symbol("SIGNAL");function St(i){let s=zn;return zn=i,s}function oj(){return zn}var sp={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function EE(i){if(mE)throw new Error("");if(zn===null)return;zn.consumerOnSignalRead(i);let s=zn.nextProducerIndex++;if(yE(zn),s<zn.producerNode.length&&zn.producerNode[s]!==i&&op(zn)){let a=zn.producerNode[s];vE(a,zn.producerIndexOfThis[s])}zn.producerNode[s]!==i&&(zn.producerNode[s]=i,zn.producerIndexOfThis[s]=op(zn)?dj(i,zn,s):0),zn.producerLastReadVersion[s]=i.version}function Wre(){aR++}function sj(i){if(!(op(i)&&!i.dirty)&&!(!i.dirty&&i.lastCleanEpoch===aR)){if(!i.producerMustRecompute(i)&&!dR(i)){rj(i);return}i.producerRecomputeValue(i),rj(i)}}function aj(i){if(i.liveConsumerNode===void 0)return;let s=mE;mE=!0;try{for(let a of i.liveConsumerNode)a.dirty||Kre(a)}finally{mE=s}}function cj(){return zn?.consumerAllowSignalWrites!==!1}function Kre(i){i.dirty=!0,aj(i),i.consumerMarkedDirty?.(i)}function rj(i){i.dirty=!1,i.lastCleanEpoch=aR}function _E(i){return i&&(i.nextProducerIndex=0),St(i)}function cR(i,s){if(St(s),!(!i||i.producerNode===void 0||i.producerIndexOfThis===void 0||i.producerLastReadVersion===void 0)){if(op(i))for(let a=i.nextProducerIndex;a<i.producerNode.length;a++)vE(i.producerNode[a],i.producerIndexOfThis[a]);for(;i.producerNode.length>i.nextProducerIndex;)i.producerNode.pop(),i.producerLastReadVersion.pop(),i.producerIndexOfThis.pop()}}function dR(i){yE(i);for(let s=0;s<i.producerNode.length;s++){let a=i.producerNode[s],u=i.producerLastReadVersion[s];if(u!==a.version||(sj(a),u!==a.version))return!0}return!1}function uR(i){if(yE(i),op(i))for(let s=0;s<i.producerNode.length;s++)vE(i.producerNode[s],i.producerIndexOfThis[s]);i.producerNode.length=i.producerLastReadVersion.length=i.producerIndexOfThis.length=0,i.liveConsumerNode&&(i.liveConsumerNode.length=i.liveConsumerIndexOfThis.length=0)}function dj(i,s,a){if(uj(i),i.liveConsumerNode.length===0&&lj(i))for(let u=0;u<i.producerNode.length;u++)i.producerIndexOfThis[u]=dj(i.producerNode[u],i,u);return i.liveConsumerIndexOfThis.push(a),i.liveConsumerNode.push(s)-1}function vE(i,s){if(uj(i),i.liveConsumerNode.length===1&&lj(i))for(let u=0;u<i.producerNode.length;u++)vE(i.producerNode[u],i.producerIndexOfThis[u]);let a=i.liveConsumerNode.length-1;if(i.liveConsumerNode[s]=i.liveConsumerNode[a],i.liveConsumerIndexOfThis[s]=i.liveConsumerIndexOfThis[a],i.liveConsumerNode.length--,i.liveConsumerIndexOfThis.length--,s<i.liveConsumerNode.length){let u=i.liveConsumerIndexOfThis[s],p=i.liveConsumerNode[s];yE(p),p.producerIndexOfThis[u]=s}}function op(i){return i.consumerIsAlwaysLive||(i?.liveConsumerNode?.length??0)>0}function yE(i){i.producerNode??=[],i.producerIndexOfThis??=[],i.producerLastReadVersion??=[]}function uj(i){i.liveConsumerNode??=[],i.liveConsumerIndexOfThis??=[]}function lj(i){return i.producerNode!==void 0}function hj(i){let s=Object.create(qre);s.computation=i;let a=()=>{if(sj(s),EE(s),s.value===gE)throw s.error;return s.value};return a[yi]=s,a}var oR=Symbol("UNSET"),sR=Symbol("COMPUTING"),gE=Symbol("ERRORED"),qre=At(Se({},sp),{value:oR,dirty:!0,error:null,equal:ij,kind:"computed",producerMustRecompute(i){return i.value===oR||i.value===sR},producerRecomputeValue(i){if(i.value===sR)throw new Error("Detected cycle in computations.");let s=i.value;i.value=sR;let a=_E(i),u,p=!1;try{u=i.computation(),St(null),p=s!==oR&&s!==gE&&u!==gE&&i.equal(s,u)}catch(g){u=gE,i.error=g}finally{cR(i,a)}if(p){i.value=s;return}i.value=u,i.version++}});function zre(){throw new Error}var pj=zre;function fj(i){pj(i)}function mj(i){pj=i}var Yre=null;function gj(i){let s=Object.create(lR);s.value=i;let a=()=>(EE(s),s.value);return a[yi]=s,a}function TE(i,s){cj()||fj(i),i.equal(i.value,s)||(i.value=s,$re(i))}function Ej(i,s){cj()||fj(i),TE(i,s(i.value))}var lR=At(Se({},sp),{equal:ij,value:void 0,kind:"signal"});function $re(i){i.version++,Wre(),aj(i),Yre?.()}function it(i){return typeof i=="function"}function bu(i){let a=i(u=>{Error.call(u),u.stack=new Error().stack});return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a}var SE=bu(i=>function(a){i(this),this.message=a?`${a.length} errors occurred during unsubscription:
${a.map((u,p)=>`${p+1}) ${u.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=a});function ap(i,s){if(i){let a=i.indexOf(s);0<=a&&i.splice(a,1)}}var jn=class i{constructor(s){this.initialTeardown=s,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let s;if(!this.closed){this.closed=!0;let{_parentage:a}=this;if(a)if(this._parentage=null,Array.isArray(a))for(let g of a)g.remove(this);else a.remove(this);let{initialTeardown:u}=this;if(it(u))try{u()}catch(g){s=g instanceof SE?g.errors:[g]}let{_finalizers:p}=this;if(p){this._finalizers=null;for(let g of p)try{_j(g)}catch(y){s=s??[],y instanceof SE?s=[...s,...y.errors]:s.push(y)}}if(s)throw new SE(s)}}add(s){var a;if(s&&s!==this)if(this.closed)_j(s);else{if(s instanceof i){if(s.closed||s._hasParent(this))return;s._addParent(this)}(this._finalizers=(a=this._finalizers)!==null&&a!==void 0?a:[]).push(s)}}_hasParent(s){let{_parentage:a}=this;return a===s||Array.isArray(a)&&a.includes(s)}_addParent(s){let{_parentage:a}=this;this._parentage=Array.isArray(a)?(a.push(s),a):a?[a,s]:s}_removeParent(s){let{_parentage:a}=this;a===s?this._parentage=null:Array.isArray(a)&&ap(a,s)}remove(s){let{_finalizers:a}=this;a&&ap(a,s),s instanceof i&&s._removeParent(this)}};jn.EMPTY=(()=>{let i=new jn;return i.closed=!0,i})();var hR=jn.EMPTY;function CE(i){return i instanceof jn||i&&"closed"in i&&it(i.remove)&&it(i.add)&&it(i.unsubscribe)}function _j(i){it(i)?i():i.unsubscribe()}var bo={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Au={setTimeout(i,s,...a){let{delegate:u}=Au;return u?.setTimeout?u.setTimeout(i,s,...a):setTimeout(i,s,...a)},clearTimeout(i){let{delegate:s}=Au;return(s?.clearTimeout||clearTimeout)(i)},delegate:void 0};function IE(i){Au.setTimeout(()=>{let{onUnhandledError:s}=bo;if(s)s(i);else throw i})}function cp(){}var vj=pR("C",void 0,void 0);function yj(i){return pR("E",void 0,i)}function Tj(i){return pR("N",i,void 0)}function pR(i,s,a){return{kind:i,value:s,error:a}}var kc=null;function Du(i){if(bo.useDeprecatedSynchronousErrorHandling){let s=!kc;if(s&&(kc={errorThrown:!1,error:null}),i(),s){let{errorThrown:a,error:u}=kc;if(kc=null,a)throw u}}else i()}function Sj(i){bo.useDeprecatedSynchronousErrorHandling&&kc&&(kc.errorThrown=!0,kc.error=i)}var Lc=class extends jn{constructor(s){super(),this.isStopped=!1,s?(this.destination=s,CE(s)&&s.add(this)):this.destination=Qre}static create(s,a,u){return new Ou(s,a,u)}next(s){this.isStopped?mR(Tj(s),this):this._next(s)}error(s){this.isStopped?mR(yj(s),this):(this.isStopped=!0,this._error(s))}complete(){this.isStopped?mR(vj,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(s){this.destination.next(s)}_error(s){try{this.destination.error(s)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Xre=Function.prototype.bind;function fR(i,s){return Xre.call(i,s)}var gR=class{constructor(s){this.partialObserver=s}next(s){let{partialObserver:a}=this;if(a.next)try{a.next(s)}catch(u){RE(u)}}error(s){let{partialObserver:a}=this;if(a.error)try{a.error(s)}catch(u){RE(u)}else RE(s)}complete(){let{partialObserver:s}=this;if(s.complete)try{s.complete()}catch(a){RE(a)}}},Ou=class extends Lc{constructor(s,a,u){super();let p;if(it(s)||!s)p={next:s??void 0,error:a??void 0,complete:u??void 0};else{let g;this&&bo.useDeprecatedNextContext?(g=Object.create(s),g.unsubscribe=()=>this.unsubscribe(),p={next:s.next&&fR(s.next,g),error:s.error&&fR(s.error,g),complete:s.complete&&fR(s.complete,g)}):p=s}this.destination=new gR(p)}};function RE(i){bo.useDeprecatedSynchronousErrorHandling?Sj(i):IE(i)}function Jre(i){throw i}function mR(i,s){let{onStoppedNotification:a}=bo;a&&Au.setTimeout(()=>a(i,s))}var Qre={closed:!0,next:cp,error:Jre,complete:cp};var Nu=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Ti(i){return i}function ER(...i){return _R(i)}function _R(i){return i.length===0?Ti:i.length===1?i[0]:function(a){return i.reduce((u,p)=>p(u),a)}}var Bt=(()=>{class i{constructor(a){a&&(this._subscribe=a)}lift(a){let u=new i;return u.source=this,u.operator=a,u}subscribe(a,u,p){let g=eie(a)?a:new Ou(a,u,p);return Du(()=>{let{operator:y,source:R}=this;g.add(y?y.call(g,R):R?this._subscribe(g):this._trySubscribe(g))}),g}_trySubscribe(a){try{return this._subscribe(a)}catch(u){a.error(u)}}forEach(a,u){return u=Cj(u),new u((p,g)=>{let y=new Ou({next:R=>{try{a(R)}catch(w){g(w),y.unsubscribe()}},error:g,complete:p});this.subscribe(y)})}_subscribe(a){var u;return(u=this.source)===null||u===void 0?void 0:u.subscribe(a)}[Nu](){return this}pipe(...a){return _R(a)(this)}toPromise(a){return a=Cj(a),new a((u,p)=>{let g;this.subscribe(y=>g=y,y=>p(y),()=>u(g))})}}return i.create=s=>new i(s),i})();function Cj(i){var s;return(s=i??bo.Promise)!==null&&s!==void 0?s:Promise}function Zre(i){return i&&it(i.next)&&it(i.error)&&it(i.complete)}function eie(i){return i&&i instanceof Lc||Zre(i)&&CE(i)}function vR(i){return it(i?.lift)}function Pt(i){return s=>{if(vR(s))return s.lift(function(a){try{return i(a,this)}catch(u){this.error(u)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ct(i,s,a,u,p){return new yR(i,s,a,u,p)}var yR=class extends Lc{constructor(s,a,u,p,g,y){super(s),this.onFinalize=g,this.shouldUnsubscribe=y,this._next=a?function(R){try{a(R)}catch(w){s.error(w)}}:super._next,this._error=p?function(R){try{p(R)}catch(w){s.error(w)}finally{this.unsubscribe()}}:super._error,this._complete=u?function(){try{u()}catch(R){s.error(R)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var s;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:a}=this;super.unsubscribe(),!a&&((s=this.onFinalize)===null||s===void 0||s.call(this))}}};function Pu(){return Pt((i,s)=>{let a=null;i._refCount++;let u=Ct(s,void 0,void 0,void 0,()=>{if(!i||i._refCount<=0||0<--i._refCount){a=null;return}let p=i._connection,g=a;a=null,p&&(!g||p===g)&&p.unsubscribe(),s.unsubscribe()});i.subscribe(u),u.closed||(a=i.connect())})}var Mu=class extends Bt{constructor(s,a){super(),this.source=s,this.subjectFactory=a,this._subject=null,this._refCount=0,this._connection=null,vR(s)&&(this.lift=s.lift)}_subscribe(s){return this.getSubject().subscribe(s)}getSubject(){let s=this._subject;return(!s||s.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:s}=this;this._subject=this._connection=null,s?.unsubscribe()}connect(){let s=this._connection;if(!s){s=this._connection=new jn;let a=this.getSubject();s.add(this.source.subscribe(Ct(a,void 0,()=>{this._teardown(),a.complete()},u=>{this._teardown(),a.error(u)},()=>this._teardown()))),s.closed&&(this._connection=null,s=jn.EMPTY)}return s}refCount(){return Pu()(this)}};var Ij=bu(i=>function(){i(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var cr=(()=>{class i extends Bt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(a){let u=new wE(this,this);return u.operator=a,u}_throwIfClosed(){if(this.closed)throw new Ij}next(a){Du(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let u of this.currentObservers)u.next(a)}})}error(a){Du(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=a;let{observers:u}=this;for(;u.length;)u.shift().error(a)}})}complete(){Du(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:a}=this;for(;a.length;)a.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var a;return((a=this.observers)===null||a===void 0?void 0:a.length)>0}_trySubscribe(a){return this._throwIfClosed(),super._trySubscribe(a)}_subscribe(a){return this._throwIfClosed(),this._checkFinalizedStatuses(a),this._innerSubscribe(a)}_innerSubscribe(a){let{hasError:u,isStopped:p,observers:g}=this;return u||p?hR:(this.currentObservers=null,g.push(a),new jn(()=>{this.currentObservers=null,ap(g,a)}))}_checkFinalizedStatuses(a){let{hasError:u,thrownError:p,isStopped:g}=this;u?a.error(p):g&&a.complete()}asObservable(){let a=new Bt;return a.source=this,a}}return i.create=(s,a)=>new wE(s,a),i})(),wE=class extends cr{constructor(s,a){super(),this.destination=s,this.source=a}next(s){var a,u;(u=(a=this.destination)===null||a===void 0?void 0:a.next)===null||u===void 0||u.call(a,s)}error(s){var a,u;(u=(a=this.destination)===null||a===void 0?void 0:a.error)===null||u===void 0||u.call(a,s)}complete(){var s,a;(a=(s=this.destination)===null||s===void 0?void 0:s.complete)===null||a===void 0||a.call(s)}_subscribe(s){var a,u;return(u=(a=this.source)===null||a===void 0?void 0:a.subscribe(s))!==null&&u!==void 0?u:hR}};var vr=class extends cr{constructor(s){super(),this._value=s}get value(){return this.getValue()}_subscribe(s){let a=super._subscribe(s);return!a.closed&&s.next(this._value),a}getValue(){let{hasError:s,thrownError:a,_value:u}=this;if(s)throw a;return this._throwIfClosed(),u}next(s){super.next(this._value=s)}};var ri=new Bt(i=>i.complete());function Rj(i){return i&&it(i.schedule)}function wj(i){return i[i.length-1]}function bE(i){return it(wj(i))?i.pop():void 0}function Aa(i){return Rj(wj(i))?i.pop():void 0}function Aj(i,s,a,u){function p(g){return g instanceof a?g:new a(function(y){y(g)})}return new(a||(a=Promise))(function(g,y){function R(V){try{L(u.next(V))}catch(q){y(q)}}function w(V){try{L(u.throw(V))}catch(q){y(q)}}function L(V){V.done?g(V.value):p(V.value).then(R,w)}L((u=u.apply(i,s||[])).next())})}function bj(i){var s=typeof Symbol=="function"&&Symbol.iterator,a=s&&i[s],u=0;if(a)return a.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&u>=i.length&&(i=void 0),{value:i&&i[u++],done:!i}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function xc(i){return this instanceof xc?(this.v=i,this):new xc(i)}function Dj(i,s,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u=a.apply(i,s||[]),p,g=[];return p=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),R("next"),R("throw"),R("return",y),p[Symbol.asyncIterator]=function(){return this},p;function y($){return function(pe){return Promise.resolve(pe).then($,q)}}function R($,pe){u[$]&&(p[$]=function(Ie){return new Promise(function(ct,We){g.push([$,Ie,ct,We])>1||w($,Ie)})},pe&&(p[$]=pe(p[$])))}function w($,pe){try{L(u[$](pe))}catch(Ie){Z(g[0][3],Ie)}}function L($){$.value instanceof xc?Promise.resolve($.value.v).then(V,q):Z(g[0][2],$)}function V($){w("next",$)}function q($){w("throw",$)}function Z($,pe){$(pe),g.shift(),g.length&&w(g[0][0],g[0][1])}}function Oj(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=i[Symbol.asyncIterator],a;return s?s.call(i):(i=typeof bj=="function"?bj(i):i[Symbol.iterator](),a={},u("next"),u("throw"),u("return"),a[Symbol.asyncIterator]=function(){return this},a);function u(g){a[g]=i[g]&&function(y){return new Promise(function(R,w){y=i[g](y),p(R,w,y.done,y.value)})}}function p(g,y,R,w){Promise.resolve(w).then(function(L){g({value:L,done:R})},y)}}var AE=i=>i&&typeof i.length=="number"&&typeof i!="function";function DE(i){return it(i?.then)}function OE(i){return it(i[Nu])}function NE(i){return Symbol.asyncIterator&&it(i?.[Symbol.asyncIterator])}function PE(i){return new TypeError(`You provided ${i!==null&&typeof i=="object"?"an invalid object":`'${i}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function tie(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ME=tie();function kE(i){return it(i?.[ME])}function LE(i){return Dj(this,arguments,function*(){let a=i.getReader();try{for(;;){let{value:u,done:p}=yield xc(a.read());if(p)return yield xc(void 0);yield yield xc(u)}}finally{a.releaseLock()}})}function xE(i){return it(i?.getReader)}function Bn(i){if(i instanceof Bt)return i;if(i!=null){if(OE(i))return nie(i);if(AE(i))return rie(i);if(DE(i))return iie(i);if(NE(i))return Nj(i);if(kE(i))return oie(i);if(xE(i))return sie(i)}throw PE(i)}function nie(i){return new Bt(s=>{let a=i[Nu]();if(it(a.subscribe))return a.subscribe(s);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function rie(i){return new Bt(s=>{for(let a=0;a<i.length&&!s.closed;a++)s.next(i[a]);s.complete()})}function iie(i){return new Bt(s=>{i.then(a=>{s.closed||(s.next(a),s.complete())},a=>s.error(a)).then(null,IE)})}function oie(i){return new Bt(s=>{for(let a of i)if(s.next(a),s.closed)return;s.complete()})}function Nj(i){return new Bt(s=>{aie(i,s).catch(a=>s.error(a))})}function sie(i){return Nj(LE(i))}function aie(i,s){var a,u,p,g;return Aj(this,void 0,void 0,function*(){try{for(a=Oj(i);u=yield a.next(),!u.done;){let y=u.value;if(s.next(y),s.closed)return}}catch(y){p={error:y}}finally{try{u&&!u.done&&(g=a.return)&&(yield g.call(a))}finally{if(p)throw p.error}}s.complete()})}function ii(i,s,a,u=0,p=!1){let g=s.schedule(function(){a(),p?i.add(this.schedule(null,u)):this.unsubscribe()},u);if(i.add(g),!p)return g}function UE(i,s=0){return Pt((a,u)=>{a.subscribe(Ct(u,p=>ii(u,i,()=>u.next(p),s),()=>ii(u,i,()=>u.complete(),s),p=>ii(u,i,()=>u.error(p),s)))})}function FE(i,s=0){return Pt((a,u)=>{u.add(i.schedule(()=>a.subscribe(u),s))})}function Pj(i,s){return Bn(i).pipe(FE(s),UE(s))}function Mj(i,s){return Bn(i).pipe(FE(s),UE(s))}function kj(i,s){return new Bt(a=>{let u=0;return s.schedule(function(){u===i.length?a.complete():(a.next(i[u++]),a.closed||this.schedule())})})}function Lj(i,s){return new Bt(a=>{let u;return ii(a,s,()=>{u=i[ME](),ii(a,s,()=>{let p,g;try{({value:p,done:g}=u.next())}catch(y){a.error(y);return}g?a.complete():a.next(p)},0,!0)}),()=>it(u?.return)&&u.return()})}function VE(i,s){if(!i)throw new Error("Iterable cannot be null");return new Bt(a=>{ii(a,s,()=>{let u=i[Symbol.asyncIterator]();ii(a,s,()=>{u.next().then(p=>{p.done?a.complete():a.next(p.value)})},0,!0)})})}function xj(i,s){return VE(LE(i),s)}function Uj(i,s){if(i!=null){if(OE(i))return Pj(i,s);if(AE(i))return kj(i,s);if(DE(i))return Mj(i,s);if(NE(i))return VE(i,s);if(kE(i))return Lj(i,s);if(xE(i))return xj(i,s)}throw PE(i)}function Nn(i,s){return s?Uj(i,s):Bn(i)}function Ze(...i){let s=Aa(i);return Nn(i,s)}function ku(i,s){let a=it(i)?i:()=>i,u=p=>p.error(a());return new Bt(s?p=>s.schedule(u,0,p):u)}function TR(i){return!!i&&(i instanceof Bt||it(i.lift)&&it(i.subscribe))}var Ls=bu(i=>function(){i(this),this.name="EmptyError",this.message="no elements in sequence"});function yt(i,s){return Pt((a,u)=>{let p=0;a.subscribe(Ct(u,g=>{u.next(i.call(s,g,p++))}))})}var{isArray:cie}=Array;function die(i,s){return cie(s)?i(...s):i(s)}function jE(i){return yt(s=>die(i,s))}var{isArray:uie}=Array,{getPrototypeOf:lie,prototype:hie,keys:pie}=Object;function BE(i){if(i.length===1){let s=i[0];if(uie(s))return{args:s,keys:null};if(fie(s)){let a=pie(s);return{args:a.map(u=>s[u]),keys:a}}}return{args:i,keys:null}}function fie(i){return i&&typeof i=="object"&&lie(i)===hie}function HE(i,s){return i.reduce((a,u,p)=>(a[u]=s[p],a),{})}function GE(...i){let s=Aa(i),a=bE(i),{args:u,keys:p}=BE(i);if(u.length===0)return Nn([],s);let g=new Bt(mie(u,s,p?y=>HE(p,y):Ti));return a?g.pipe(jE(a)):g}function mie(i,s,a=Ti){return u=>{Fj(s,()=>{let{length:p}=i,g=new Array(p),y=p,R=p;for(let w=0;w<p;w++)Fj(s,()=>{let L=Nn(i[w],s),V=!1;L.subscribe(Ct(u,q=>{g[w]=q,V||(V=!0,R--),R||u.next(a(g.slice()))},()=>{--y||u.complete()}))},u)},u)}}function Fj(i,s,a){i?ii(a,i,s):s()}function Vj(i,s,a,u,p,g,y,R){let w=[],L=0,V=0,q=!1,Z=()=>{q&&!w.length&&!L&&s.complete()},$=Ie=>L<u?pe(Ie):w.push(Ie),pe=Ie=>{g&&s.next(Ie),L++;let ct=!1;Bn(a(Ie,V++)).subscribe(Ct(s,We=>{p?.(We),g?$(We):s.next(We)},()=>{ct=!0},void 0,()=>{if(ct)try{for(L--;w.length&&L<u;){let We=w.shift();y?ii(s,y,()=>pe(We)):pe(We)}Z()}catch(We){s.error(We)}}))};return i.subscribe(Ct(s,$,()=>{q=!0,Z()})),()=>{R?.()}}function Yn(i,s,a=1/0){return it(s)?Yn((u,p)=>yt((g,y)=>s(u,g,p,y))(Bn(i(u,p))),a):(typeof s=="number"&&(a=s),Pt((u,p)=>Vj(u,p,i,a)))}function SR(i=1/0){return Yn(Ti,i)}function jj(){return SR(1)}function Lu(...i){return jj()(Nn(i,Aa(i)))}function WE(i){return new Bt(s=>{Bn(i()).subscribe(s)})}function CR(...i){let s=bE(i),{args:a,keys:u}=BE(i),p=new Bt(g=>{let{length:y}=a;if(!y){g.complete();return}let R=new Array(y),w=y,L=y;for(let V=0;V<y;V++){let q=!1;Bn(a[V]).subscribe(Ct(g,Z=>{q||(q=!0,L--),R[V]=Z},()=>w--,void 0,()=>{(!w||!q)&&(L||g.next(u?HE(u,R):R),g.complete())}))}});return s?p.pipe(jE(s)):p}function Zi(i,s){return Pt((a,u)=>{let p=0;a.subscribe(Ct(u,g=>i.call(s,g,p++)&&u.next(g)))})}function Da(i){return Pt((s,a)=>{let u=null,p=!1,g;u=s.subscribe(Ct(a,void 0,void 0,y=>{g=Bn(i(y,Da(i)(s))),u?(u.unsubscribe(),u=null,g.subscribe(a)):p=!0})),p&&(u.unsubscribe(),u=null,g.subscribe(a))})}function Bj(i,s,a,u,p){return(g,y)=>{let R=a,w=s,L=0;g.subscribe(Ct(y,V=>{let q=L++;w=R?i(w,V,q):(R=!0,V),u&&y.next(w)},p&&(()=>{R&&y.next(w),y.complete()})))}}function Uc(i,s){return it(s)?Yn(i,s,1):Yn(i,1)}function Oa(i){return Pt((s,a)=>{let u=!1;s.subscribe(Ct(a,p=>{u=!0,a.next(p)},()=>{u||a.next(i),a.complete()}))})}function xs(i){return i<=0?()=>ri:Pt((s,a)=>{let u=0;s.subscribe(Ct(a,p=>{++u<=i&&(a.next(p),i<=u&&a.complete())}))})}function KE(i=gie){return Pt((s,a)=>{let u=!1;s.subscribe(Ct(a,p=>{u=!0,a.next(p)},()=>u?a.complete():a.error(i())))})}function gie(){return new Ls}function xu(i){return Pt((s,a)=>{try{s.subscribe(a)}finally{a.add(i)}})}function Us(i,s){let a=arguments.length>=2;return u=>u.pipe(i?Zi((p,g)=>i(p,g,u)):Ti,xs(1),a?Oa(s):KE(()=>new Ls))}function Uu(i){return i<=0?()=>ri:Pt((s,a)=>{let u=[];s.subscribe(Ct(a,p=>{u.push(p),i<u.length&&u.shift()},()=>{for(let p of u)a.next(p);a.complete()},void 0,()=>{u=null}))})}function IR(i,s){let a=arguments.length>=2;return u=>u.pipe(i?Zi((p,g)=>i(p,g,u)):Ti,Uu(1),a?Oa(s):KE(()=>new Ls))}function RR(i,s){return Pt(Bj(i,s,arguments.length>=2,!0))}function wR(...i){let s=Aa(i);return Pt((a,u)=>{(s?Lu(i,a,s):Lu(i,a)).subscribe(u)})}function eo(i,s){return Pt((a,u)=>{let p=null,g=0,y=!1,R=()=>y&&!p&&u.complete();a.subscribe(Ct(u,w=>{p?.unsubscribe();let L=0,V=g++;Bn(i(w,V)).subscribe(p=Ct(u,q=>u.next(s?s(w,q,V,L++):q),()=>{p=null,R()}))},()=>{y=!0,R()}))})}function bR(i){return Pt((s,a)=>{Bn(i).subscribe(Ct(a,()=>a.complete(),cp)),!a.closed&&s.subscribe(a)})}function $n(i,s,a){let u=it(i)||s||a?{next:i,error:s,complete:a}:i;return u?Pt((p,g)=>{var y;(y=u.subscribe)===null||y===void 0||y.call(u);let R=!0;p.subscribe(Ct(g,w=>{var L;(L=u.next)===null||L===void 0||L.call(u,w),g.next(w)},()=>{var w;R=!1,(w=u.complete)===null||w===void 0||w.call(u),g.complete()},w=>{var L;R=!1,(L=u.error)===null||L===void 0||L.call(u,w),g.error(w)},()=>{var w,L;R&&((w=u.unsubscribe)===null||w===void 0||w.call(u)),(L=u.finalize)===null||L===void 0||L.call(u)}))}):Ti}var PR={JSACTION:"jsaction"},MR={JSACTION:"__jsaction",OWNER:"__owner"},Kj={};function Eie(i){return i[MR.JSACTION]}function Hj(i,s){i[MR.JSACTION]=s}function _ie(i){return Kj[i]}function vie(i,s){Kj[i]=s}var je={AUXCLICK:"auxclick",CHANGE:"change",CLICK:"click",CLICKMOD:"clickmod",CLICKONLY:"clickonly",DBLCLICK:"dblclick",FOCUS:"focus",FOCUSIN:"focusin",BLUR:"blur",FOCUSOUT:"focusout",SUBMIT:"submit",KEYDOWN:"keydown",KEYPRESS:"keypress",KEYUP:"keyup",MOUSEUP:"mouseup",MOUSEDOWN:"mousedown",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",MOUSEMOVE:"mousemove",POINTERUP:"pointerup",POINTERDOWN:"pointerdown",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERMOVE:"pointermove",POINTERCANCEL:"pointercancel",GOTPOINTERCAPTURE:"gotpointercapture",LOSTPOINTERCAPTURE:"lostpointercapture",ERROR:"error",LOAD:"load",UNLOAD:"unload",TOUCHSTART:"touchstart",TOUCHEND:"touchend",TOUCHMOVE:"touchmove",INPUT:"input",SCROLL:"scroll",TOGGLE:"toggle",CUSTOM:"_custom"},yie=[je.MOUSEENTER,je.MOUSELEAVE,"pointerenter","pointerleave"],lye=[je.CLICK,je.DBLCLICK,je.FOCUSIN,je.FOCUSOUT,je.KEYDOWN,je.KEYUP,je.KEYPRESS,je.MOUSEOVER,je.MOUSEOUT,je.SUBMIT,je.TOUCHSTART,je.TOUCHEND,je.TOUCHMOVE,"touchcancel","auxclick","change","compositionstart","compositionupdate","compositionend","beforeinput","input","select","copy","cut","paste","mousedown","mouseup","wheel","contextmenu","dragover","dragenter","dragleave","drop","dragstart","dragend","pointerdown","pointermove","pointerup","pointercancel","pointerover","pointerout","gotpointercapture","lostpointercapture","ended","loadedmetadata","pagehide","pageshow","visibilitychange","beforematch"],Tie=[je.FOCUS,je.BLUR,je.ERROR,je.LOAD,je.TOGGLE],kR=i=>Tie.indexOf(i)>=0;var Sie=3,Cie=13,Iie=32,Si={MAC_ENTER:Sie,ENTER:Cie,SPACE:Iie};function Rie(i){return i===je.MOUSEENTER?je.MOUSEOVER:i===je.MOUSELEAVE?je.MOUSEOUT:i===je.POINTERENTER?je.POINTEROVER:i===je.POINTERLEAVE?je.POINTEROUT:i}function wie(i,s,a,u){let p=!1;kR(s)&&(p=!0);let g=typeof u=="boolean"?{capture:p,passive:u}:p;return i.addEventListener(s,a,g),{eventType:s,handler:a,capture:p,passive:u}}function bie(i,s){if(i.removeEventListener){let a=typeof s.passive=="boolean"?{capture:s.capture}:s.capture;i.removeEventListener(s.eventType,s.handler,a)}else i.detachEvent&&i.detachEvent(`on${s.eventType}`,s.handler)}function Aie(i){i.preventDefault?i.preventDefault():i.returnValue=!1}var Gj=typeof navigator<"u"&&/Macintosh/.test(navigator.userAgent);function Die(i){return i.which===2||i.which==null&&i.button===4}function Oie(i){return Gj&&i.metaKey||!Gj&&i.ctrlKey||Die(i)||i.shiftKey}var hye=typeof navigator<"u"&&!/Opera/.test(navigator.userAgent)&&/WebKit/.test(navigator.userAgent),pye=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident/.test(navigator.userAgent)),fye=typeof navigator<"u"&&!/Opera|WebKit/.test(navigator.userAgent)&&/Gecko/.test(navigator.product);function Nie(i,s,a){let u=i.relatedTarget;return(i.type===je.MOUSEOVER&&s===je.MOUSEENTER||i.type===je.MOUSEOUT&&s===je.MOUSELEAVE||i.type===je.POINTEROVER&&s===je.POINTERENTER||i.type===je.POINTEROUT&&s===je.POINTERLEAVE)&&(!u||u!==a&&!a.contains(u))}function Pie(i,s){let a={};for(let u in i){if(u==="srcElement"||u==="target")continue;let p=u,g=i[p];typeof g!="function"&&(a[p]=g)}return i.type===je.MOUSEOVER?a.type=je.MOUSEENTER:i.type===je.MOUSEOUT?a.type=je.MOUSELEAVE:i.type===je.POINTEROVER?a.type=je.POINTERENTER:a.type=je.POINTERLEAVE,a.target=a.srcElement=s,a.bubbles=!1,a._originalEvent=i,a}var mye={Enter:Si.ENTER," ":Si.SPACE},gye={A:Si.ENTER,BUTTON:0,CHECKBOX:Si.SPACE,COMBOBOX:Si.ENTER,FILE:0,GRIDCELL:Si.ENTER,LINK:Si.ENTER,LISTBOX:Si.ENTER,MENU:0,MENUBAR:0,MENUITEM:0,MENUITEMCHECKBOX:0,MENUITEMRADIO:0,OPTION:0,RADIO:Si.SPACE,RADIOGROUP:Si.SPACE,RESET:0,SUBMIT:0,SWITCH:Si.SPACE,TAB:0,TREE:Si.ENTER,TREEITEM:Si.ENTER};var Mie=typeof navigator<"u"&&/iPhone|iPad|iPod/.test(navigator.userAgent),$E=class{element;handlerInfos=[];constructor(s){this.element=s}addEventListener(s,a,u){Mie&&(this.element.style.cursor="pointer"),this.handlerInfos.push(wie(this.element,s,a(this.element),u))}cleanUp(){for(let s=0;s<this.handlerInfos.length;s++)bie(this.element,this.handlerInfos[s]);this.handlerInfos=[]}},kie={NAMESPACE_ACTION_SEPARATOR:".",EVENT_ACTION_SEPARATOR:":"};function Na(i){return i.eventType}function LR(i,s){i.eventType=s}function zE(i){return i.event}function qj(i,s){i.event=s}function zj(i){return i.targetElement}function Yj(i,s){i.targetElement=s}function $j(i){return i.eic}function Lie(i,s){i.eic=s}function xie(i){return i.timeStamp}function Uie(i,s){i.timeStamp=s}function YE(i){return i.eia}function Xj(i,s,a){i.eia=[s,a]}function AR(i){i.eia=void 0}function qE(i){return i[1]}function Fie(i){return i.eirp}function Jj(i,s){i.eirp=s}function Qj(i){return i.eir}function Zj(i,s){i.eir=s}function eB(i){return{eventType:i.eventType,event:i.event,targetElement:i.targetElement,eic:i.eic,eia:i.eia,timeStamp:i.timeStamp,eirp:i.eirp,eiack:i.eiack,eir:i.eir}}function Vie(i,s,a,u,p,g,y,R){return{eventType:i,event:s,targetElement:a,eic:u,timeStamp:p,eia:g,eirp:y,eiack:R}}var DR=class i{eventInfo;constructor(s){this.eventInfo=s}getEventType(){return Na(this.eventInfo)}setEventType(s){LR(this.eventInfo,s)}getEvent(){return zE(this.eventInfo)}setEvent(s){qj(this.eventInfo,s)}getTargetElement(){return zj(this.eventInfo)}setTargetElement(s){Yj(this.eventInfo,s)}getContainer(){return $j(this.eventInfo)}setContainer(s){Lie(this.eventInfo,s)}getTimestamp(){return xie(this.eventInfo)}setTimestamp(s){Uie(this.eventInfo,s)}getAction(){let s=YE(this.eventInfo);if(s)return{name:s[0],element:s[1]}}setAction(s){if(!s){AR(this.eventInfo);return}Xj(this.eventInfo,s.name,s.element)}getIsReplay(){return Fie(this.eventInfo)}setIsReplay(s){Jj(this.eventInfo,s)}getResolved(){return Qj(this.eventInfo)}setResolved(s){Zj(this.eventInfo,s)}clone(){return new i(eB(this.eventInfo))}},jie={},Bie=/\s*;\s*/,Hie=je.CLICK,OR=class{a11yClickSupport=!1;clickModSupport=!0;syntheticMouseEventSupport;updateEventInfoForA11yClick=void 0;preventDefaultForA11yClick=void 0;populateClickOnlyAction=void 0;constructor({syntheticMouseEventSupport:s=!1,clickModSupport:a=!0}={}){this.syntheticMouseEventSupport=s,this.clickModSupport=a}resolveEventType(s){this.clickModSupport&&Na(s)===je.CLICK&&Oie(zE(s))?LR(s,je.CLICKMOD):this.a11yClickSupport&&this.updateEventInfoForA11yClick(s)}resolveAction(s){Qj(s)||(this.populateAction(s,zj(s)),Zj(s,!0))}resolveParentAction(s){let a=YE(s),u=a&&qE(a);AR(s);let p=u&&this.getParentNode(u);p&&this.populateAction(s,p)}populateAction(s,a){let u=a;for(;u&&u!==$j(s)&&(u.nodeType===Node.ELEMENT_NODE&&this.populateActionOnElement(u,s),!YE(s));)u=this.getParentNode(u);let p=YE(s);if(p&&(this.a11yClickSupport&&this.preventDefaultForA11yClick(s),this.syntheticMouseEventSupport&&(Na(s)===je.MOUSEENTER||Na(s)===je.MOUSELEAVE||Na(s)===je.POINTERENTER||Na(s)===je.POINTERLEAVE)))if(Nie(zE(s),Na(s),qE(p))){let g=Pie(zE(s),qE(p));qj(s,g),Yj(s,qE(p))}else AR(s)}getParentNode(s){let a=s[MR.OWNER];if(a)return a;let u=s.parentNode;return u?.nodeName==="#document-fragment"?u?.host??null:u}populateActionOnElement(s,a){let u=this.parseActions(s),p=u[Na(a)];p!==void 0&&Xj(a,p,s),this.a11yClickSupport&&this.populateClickOnlyAction(s,a,u)}parseActions(s){let a=Eie(s);if(!a){let u=s.getAttribute(PR.JSACTION);if(!u)a=jie,Hj(s,a);else{if(a=_ie(u),!a){a={};let p=u.split(Bie);for(let g=0;g<p.length;g++){let y=p[g];if(!y)continue;let R=y.indexOf(kie.EVENT_ACTION_SEPARATOR),w=R!==-1,L=w?y.substr(0,R).trim():Hie,V=w?y.substr(R+1).trim():y;a[L]=V}vie(u,a)}Hj(s,a)}}return a}addA11yClickSupport(s,a,u){this.a11yClickSupport=!0,this.updateEventInfoForA11yClick=s,this.preventDefaultForA11yClick=a,this.populateClickOnlyAction=u}},tB=function(i){return i[i.I_AM_THE_JSACTION_FRAMEWORK=0]="I_AM_THE_JSACTION_FRAMEWORK",i}(tB||{}),NR=class{dispatchDelegate;actionResolver;eventReplayer;eventReplayScheduled=!1;replayEventInfoWrappers=[];constructor(s,{actionResolver:a,eventReplayer:u}={}){this.dispatchDelegate=s,this.actionResolver=a,this.eventReplayer=u}dispatch(s){let a=new DR(s);this.actionResolver?.resolveEventType(s),this.actionResolver?.resolveAction(s);let u=a.getAction();if(u&&Gie(u.element,a)&&Aie(a.getEvent()),this.eventReplayer&&a.getIsReplay()){this.scheduleEventInfoWrapperReplay(a);return}this.dispatchDelegate(a)}scheduleEventInfoWrapperReplay(s){this.replayEventInfoWrappers.push(s),!this.eventReplayScheduled&&(this.eventReplayScheduled=!0,Promise.resolve().then(()=>{this.eventReplayScheduled=!1,this.eventReplayer(this.replayEventInfoWrappers)}))}};function Gie(i,s){return i.tagName==="A"&&(s.getEventType()===je.CLICK||s.getEventType()===je.CLICKMOD)}var nB=Symbol.for("propagationStopped"),xR={REPLAY:101};var Wie="`preventDefault` called during event replay.";var Kie="`composedPath` called during event replay.",XE=class{dispatchDelegate;clickModSupport;actionResolver;dispatcher;constructor(s,a=!0){this.dispatchDelegate=s,this.clickModSupport=a,this.actionResolver=new OR({clickModSupport:a}),this.dispatcher=new NR(u=>{this.dispatchToDelegate(u)},{actionResolver:this.actionResolver})}dispatch(s){this.dispatcher.dispatch(s)}dispatchToDelegate(s){for(s.getIsReplay()&&Yie(s),qie(s);s.getAction();){if($ie(s),kR(s.getEventType())&&s.getAction().element!==s.getTargetElement()||(this.dispatchDelegate(s.getEvent(),s.getAction().name),zie(s)))return;this.actionResolver.resolveParentAction(s.eventInfo)}}};function qie(i){let s=i.getEvent(),a=i.getEvent().stopPropagation.bind(s),u=()=>{s[nB]=!0,a()};Fc(s,"stopPropagation",u),Fc(s,"stopImmediatePropagation",u)}function zie(i){return!!i.getEvent()[nB]}function Yie(i){let s=i.getEvent(),a=i.getTargetElement(),u=s.preventDefault.bind(s);Fc(s,"target",a),Fc(s,"eventPhase",xR.REPLAY),Fc(s,"preventDefault",()=>{throw u(),new Error(Wie+"")}),Fc(s,"composedPath",()=>{throw new Error(Kie+"")})}function $ie(i){let s=i.getEvent(),a=i.getAction()?.element;a&&Fc(s,"currentTarget",a,{configurable:!0})}function Fc(i,s,a,{configurable:u=!1}={}){Object.defineProperty(i,s,{value:a,configurable:u})}function rB(i,s){i.ecrd(a=>{s.dispatch(a)},tB.I_AM_THE_JSACTION_FRAMEWORK)}function Xie(i){return i?.q??[]}function Jie(i){i&&(Wj(i.c,i.et,i.h),Wj(i.c,i.etc,i.h,!0))}function Wj(i,s,a,u){for(let p=0;p<s.length;p++)i.removeEventListener(s[p],a,u)}var Qie=!1,iB=(()=>{class i{static MOUSE_SPECIAL_SUPPORT=Qie;containerManager;eventHandlers={};browserEventTypeToExtraEventTypes={};dispatcher=null;queuedEventInfos=[];constructor(a){this.containerManager=a}handleEvent(a,u,p){let g=Vie(a,u,u.target,p,Date.now());this.handleEventInfo(g)}handleEventInfo(a){if(!this.dispatcher){Jj(a,!0),this.queuedEventInfos?.push(a);return}this.dispatcher(a)}addEvent(a,u,p){if(a in this.eventHandlers||!this.containerManager||!i.MOUSE_SPECIAL_SUPPORT&&yie.indexOf(a)>=0)return;let g=(R,w,L)=>{this.handleEvent(R,w,L)};this.eventHandlers[a]=g;let y=Rie(u||a);if(y!==a){let R=this.browserEventTypeToExtraEventTypes[y]||[];R.push(a),this.browserEventTypeToExtraEventTypes[y]=R}this.containerManager.addEventListener(y,R=>w=>{g(a,w,R)},p)}replayEarlyEvents(a=window._ejsa){a&&(this.replayEarlyEventInfos(a.q),Jie(a),delete window._ejsa)}replayEarlyEventInfos(a){for(let u=0;u<a.length;u++){let p=a[u],g=this.getEventTypesForBrowserEventType(p.eventType);for(let y=0;y<g.length;y++){let R=eB(p);LR(R,g[y]),this.handleEventInfo(R)}}}getEventTypesForBrowserEventType(a){let u=[];return this.eventHandlers[a]&&u.push(a),this.browserEventTypeToExtraEventTypes[a]&&u.push(...this.browserEventTypeToExtraEventTypes[a]),u}handler(a){return this.eventHandlers[a]}cleanUp(){this.containerManager?.cleanUp(),this.containerManager=null,this.eventHandlers={},this.browserEventTypeToExtraEventTypes={},this.dispatcher=null,this.queuedEventInfos=[]}registerDispatcher(a,u){this.ecrd(a,u)}ecrd(a,u){if(this.dispatcher=a,this.queuedEventInfos?.length){for(let p=0;p<this.queuedEventInfos.length;p++)this.handleEventInfo(this.queuedEventInfos[p]);this.queuedEventInfos=null}}}return i})();function oB(i,s=window){return Xie(s._ejsas?.[i])}function UR(i,s=window){s._ejsas&&(s._ejsas[i]=void 0)}var Zie="https://g.co/ng/security#xss",De=class extends Error{code;constructor(s,a){super(M_(s,a)),this.code=s}};function M_(i,s){return`${`NG0${Math.abs(i)}`}${s?": "+s:""}`}var iH=Symbol("InputSignalNode#UNSET"),eoe=At(Se({},lR),{transformFn:void 0,applyValueToInputSignal(i,s){TE(i,s)}});function oH(i,s){let a=Object.create(eoe);a.value=i,a.transformFn=s?.transform;function u(){if(EE(a),a.value===iH)throw new De(-950,!1);return a.value}return u[yi]=a,u}function k_(i){return{toString:i}.toString()}function cn(i){for(let s in i)if(i[s]===cn)return s;throw Error("Could not find renamed property on target object.")}function toe(i,s){for(let a in s)s.hasOwnProperty(a)&&!i.hasOwnProperty(a)&&(i[a]=s[a])}function Vr(i){if(typeof i=="string")return i;if(Array.isArray(i))return`[${i.map(Vr).join(", ")}]`;if(i==null)return""+i;let s=i.overriddenName||i.name;if(s)return`${s}`;let a=i.toString();if(a==null)return""+a;let u=a.indexOf(`
`);return u>=0?a.slice(0,u):a}function sB(i,s){return i?s?`${i} ${s}`:i:s||""}var noe=cn({__forward_ref__:cn});function rl(i){return i.__forward_ref__=rl,i.toString=function(){return Vr(this())},i}function Fr(i){return sH(i)?i():i}function sH(i){return typeof i=="function"&&i.hasOwnProperty(noe)&&i.__forward_ref__===rl}function Ge(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function il(i){return{providers:i.providers||[],imports:i.imports||[]}}function L_(i){return aB(i,cH)||aB(i,dH)}function aH(i){return L_(i)!==null}function aB(i,s){return i.hasOwnProperty(s)?i[s]:null}function roe(i){let s=i&&(i[cH]||i[dH]);return s||null}function cB(i){return i&&(i.hasOwnProperty(dB)||i.hasOwnProperty(ioe))?i[dB]:null}var cH=cn({\u0275prov:cn}),dB=cn({\u0275inj:cn}),dH=cn({ngInjectableDef:cn}),ioe=cn({ngInjectorDef:cn}),be=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(s,a){this._desc=s,this.\u0275prov=void 0,typeof a=="number"?this.__NG_ELEMENT_ID__=a:a!==void 0&&(this.\u0275prov=Ge({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function uH(i){return i&&!!i.\u0275providers}var ooe=cn({\u0275cmp:cn}),soe=cn({\u0275dir:cn}),aoe=cn({\u0275pipe:cn}),coe=cn({\u0275mod:cn}),a_=cn({\u0275fac:cn}),hp=cn({__NG_ELEMENT_ID__:cn}),uB=cn({__NG_ENV_ID__:cn});function lH(i){return typeof i=="string"?i:i==null?"":String(i)}function doe(i){return typeof i=="function"?i.name||i.toString():typeof i=="object"&&i!=null&&typeof i.type=="function"?i.type.name||i.type.toString():lH(i)}function uoe(i,s){throw new De(-200,i)}function Ww(i,s){throw new De(-201,!1)}var gt=function(i){return i[i.Default=0]="Default",i[i.Host=1]="Host",i[i.Self=2]="Self",i[i.SkipSelf=4]="SkipSelf",i[i.Optional=8]="Optional",i}(gt||{}),tw;function hH(){return tw}function to(i){let s=tw;return tw=i,s}function pH(i,s,a){let u=L_(i);if(u&&u.providedIn=="root")return u.value===void 0?u.value=u.factory():u.value;if(a&gt.Optional)return null;if(s!==void 0)return s;Ww(i,"Injector")}var loe={},pp=loe,hoe="__NG_DI_FLAG__",c_="ngTempTokenPath",poe="ngTokenPath",foe=/\n/gm,moe="\u0275",lB="__source",Gu;function goe(){return Gu}function Pa(i){let s=Gu;return Gu=i,s}function Eoe(i,s=gt.Default){if(Gu===void 0)throw new De(-203,!1);return Gu===null?pH(i,void 0,s):Gu.get(i,s&gt.Optional?null:void 0,s)}function It(i,s=gt.Default){return(hH()||Eoe)(Fr(i),s)}function fe(i,s=gt.Default){return It(i,x_(s))}function x_(i){return typeof i>"u"||typeof i=="number"?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function nw(i){let s=[];for(let a=0;a<i.length;a++){let u=Fr(i[a]);if(Array.isArray(u)){if(u.length===0)throw new De(900,!1);let p,g=gt.Default;for(let y=0;y<u.length;y++){let R=u[y],w=_oe(R);typeof w=="number"?w===-1?p=R.token:g|=w:p=R}s.push(It(p,g))}else s.push(It(u))}return s}function _oe(i){return i[hoe]}function voe(i,s,a,u){let p=i[c_];throw s[lB]&&p.unshift(s[lB]),i.message=yoe(`
`+i.message,p,a,u),i[poe]=p,i[c_]=null,i}function yoe(i,s,a,u=null){i=i&&i.charAt(0)===`
`&&i.charAt(1)==moe?i.slice(2):i;let p=Vr(s);if(Array.isArray(s))p=s.map(Vr).join(" -> ");else if(typeof s=="object"){let g=[];for(let y in s)if(s.hasOwnProperty(y)){let R=s[y];g.push(y+":"+(typeof R=="string"?JSON.stringify(R):Vr(R)))}p=`{${g.join(", ")}}`}return`${a}${u?"("+u+")":""}[${p}]: ${i.replace(foe,`
  `)}`}function Yu(i,s){let a=i.hasOwnProperty(a_);return a?i[a_]:null}function Kw(i,s){i.forEach(a=>Array.isArray(a)?Kw(a,s):s(a))}function fH(i,s,a){s>=i.length?i.push(a):i.splice(s,0,a)}function d_(i,s){return s>=i.length-1?i.pop():i.splice(s,1)[0]}function Toe(i,s,a,u){let p=i.length;if(p==s)i.push(a,u);else if(p===1)i.push(u,i[0]),i[0]=a;else{for(p--,i.push(i[p-1],i[p]);p>s;){let g=p-2;i[p]=i[g],p--}i[s]=a,i[s+1]=u}}function Soe(i,s,a){let u=Cp(i,s);return u>=0?i[u|1]=a:(u=~u,Toe(i,u,s,a)),u}function FR(i,s){let a=Cp(i,s);if(a>=0)return i[a|1]}function Cp(i,s){return Coe(i,s,1)}function Coe(i,s,a){let u=0,p=i.length>>a;for(;p!==u;){let g=u+(p-u>>1),y=i[g<<a];if(s===y)return g<<a;y>s?p=g:u=g+1}return~(p<<a)}var jc={},no=[],ka=new be(""),mH=new be("",-1),gH=new be(""),u_=class{get(s,a=pp){if(a===pp){let u=new Error(`NullInjectorError: No provider for ${Vr(s)}!`);throw u.name="NullInjectorError",u}return a}};function EH(i,s){let a=i[coe]||null;if(!a&&s===!0)throw new Error(`Type ${Vr(i)} does not have '\u0275mod' property.`);return a}function La(i){return i[ooe]||null}function qw(i){return i[soe]||null}function zw(i){return i[aoe]||null}function _H(i){let s=La(i)||qw(i)||zw(i);return s!==null&&s.standalone}function zc(i){return{\u0275providers:i}}function Ioe(...i){return{\u0275providers:Yw(!0,i),\u0275fromNgModule:!0}}function Yw(i,...s){let a=[],u=new Set,p,g=y=>{a.push(y)};return Kw(s,y=>{let R=y;rw(R,g,[],u)&&(p||=[],p.push(R))}),p!==void 0&&vH(p,g),a}function vH(i,s){for(let a=0;a<i.length;a++){let{ngModule:u,providers:p}=i[a];$w(p,g=>{s(g,u)})}}function rw(i,s,a,u){if(i=Fr(i),!i)return!1;let p=null,g=cB(i),y=!g&&La(i);if(!g&&!y){let w=i.ngModule;if(g=cB(w),g)p=w;else return!1}else{if(y&&!y.standalone)return!1;p=i}let R=u.has(p);if(y){if(R)return!1;if(u.add(p),y.dependencies){let w=typeof y.dependencies=="function"?y.dependencies():y.dependencies;for(let L of w)rw(L,s,a,u)}}else if(g){if(g.imports!=null&&!R){u.add(p);let L;try{Kw(g.imports,V=>{rw(V,s,a,u)&&(L||=[],L.push(V))})}finally{}L!==void 0&&vH(L,s)}if(!R){let L=Yu(p)||(()=>new p);s({provide:p,useFactory:L,deps:no},p),s({provide:gH,useValue:p,multi:!0},p),s({provide:ka,useValue:()=>It(p),multi:!0},p)}let w=g.providers;if(w!=null&&!R){let L=i;$w(w,V=>{s(V,L)})}}else return!1;return p!==i&&i.providers!==void 0}function $w(i,s){for(let a of i)uH(a)&&(a=a.\u0275providers),Array.isArray(a)?$w(a,s):s(a)}var Roe=cn({provide:String,useValue:cn});function yH(i){return i!==null&&typeof i=="object"&&Roe in i}function woe(i){return!!(i&&i.useExisting)}function boe(i){return!!(i&&i.useFactory)}function $u(i){return typeof i=="function"}function Aoe(i){return!!i.useClass}var U_=new be(""),e_={},Doe={},VR;function Xw(){return VR===void 0&&(VR=new u_),VR}var Ri=class{},fp=class extends Ri{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(s,a,u,p){super(),this.parent=a,this.source=u,this.scopes=p,ow(s,y=>this.processProvider(y)),this.records.set(mH,Fu(void 0,this)),p.has("environment")&&this.records.set(Ri,Fu(void 0,this));let g=this.records.get(U_);g!=null&&typeof g.value=="string"&&this.scopes.add(g.value),this.injectorDefTypes=new Set(this.get(gH,no,gt.Self))}destroy(){up(this),this._destroyed=!0;let s=St(null);try{for(let u of this._ngOnDestroyHooks)u.ngOnDestroy();let a=this._onDestroyHooks;this._onDestroyHooks=[];for(let u of a)u()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),St(s)}}onDestroy(s){return up(this),this._onDestroyHooks.push(s),()=>this.removeOnDestroy(s)}runInContext(s){up(this);let a=Pa(this),u=to(void 0),p;try{return s()}finally{Pa(a),to(u)}}get(s,a=pp,u=gt.Default){if(up(this),s.hasOwnProperty(uB))return s[uB](this);u=x_(u);let p,g=Pa(this),y=to(void 0);try{if(!(u&gt.SkipSelf)){let w=this.records.get(s);if(w===void 0){let L=koe(s)&&L_(s);L&&this.injectableDefInScope(L)?w=Fu(iw(s),e_):w=null,this.records.set(s,w)}if(w!=null)return this.hydrate(s,w)}let R=u&gt.Self?Xw():this.parent;return a=u&gt.Optional&&a===pp?null:a,R.get(s,a)}catch(R){if(R.name==="NullInjectorError"){if((R[c_]=R[c_]||[]).unshift(Vr(s)),g)throw R;return voe(R,s,"R3InjectorError",this.source)}else throw R}finally{to(y),Pa(g)}}resolveInjectorInitializers(){let s=St(null),a=Pa(this),u=to(void 0),p;try{let g=this.get(ka,no,gt.Self);for(let y of g)y()}finally{Pa(a),to(u),St(s)}}toString(){let s=[],a=this.records;for(let u of a.keys())s.push(Vr(u));return`R3Injector[${s.join(", ")}]`}processProvider(s){s=Fr(s);let a=$u(s)?s:Fr(s&&s.provide),u=Noe(s);if(!$u(s)&&s.multi===!0){let p=this.records.get(a);p||(p=Fu(void 0,e_,!0),p.factory=()=>nw(p.multi),this.records.set(a,p)),a=s,p.multi.push(s)}this.records.set(a,u)}hydrate(s,a){let u=St(null);try{return a.value===e_&&(a.value=Doe,a.value=a.factory()),typeof a.value=="object"&&a.value&&Moe(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}finally{St(u)}}injectableDefInScope(s){if(!s.providedIn)return!1;let a=Fr(s.providedIn);return typeof a=="string"?a==="any"||this.scopes.has(a):this.injectorDefTypes.has(a)}removeOnDestroy(s){let a=this._onDestroyHooks.indexOf(s);a!==-1&&this._onDestroyHooks.splice(a,1)}};function iw(i){let s=L_(i),a=s!==null?s.factory:Yu(i);if(a!==null)return a;if(i instanceof be)throw new De(204,!1);if(i instanceof Function)return Ooe(i);throw new De(204,!1)}function Ooe(i){if(i.length>0)throw new De(204,!1);let a=roe(i);return a!==null?()=>a.factory(i):()=>new i}function Noe(i){if(yH(i))return Fu(void 0,i.useValue);{let s=TH(i);return Fu(s,e_)}}function TH(i,s,a){let u;if($u(i)){let p=Fr(i);return Yu(p)||iw(p)}else if(yH(i))u=()=>Fr(i.useValue);else if(boe(i))u=()=>i.useFactory(...nw(i.deps||[]));else if(woe(i))u=()=>It(Fr(i.useExisting));else{let p=Fr(i&&(i.useClass||i.provide));if(Poe(i))u=()=>new p(...nw(i.deps));else return Yu(p)||iw(p)}return u}function up(i){if(i.destroyed)throw new De(205,!1)}function Fu(i,s,a=!1){return{factory:i,value:s,multi:a?[]:void 0}}function Poe(i){return!!i.deps}function Moe(i){return i!==null&&typeof i=="object"&&typeof i.ngOnDestroy=="function"}function koe(i){return typeof i=="function"||typeof i=="object"&&i instanceof be}function ow(i,s){for(let a of i)Array.isArray(a)?ow(a,s):a&&uH(a)?ow(a.\u0275providers,s):s(a)}function ro(i,s){i instanceof fp&&up(i);let a,u=Pa(i),p=to(void 0);try{return s()}finally{Pa(u),to(p)}}function SH(){return hH()!==void 0||goe()!=null}function CH(i){if(!SH())throw new De(-203,!1)}function Loe(i){return typeof i=="function"}var wi=0,tt=1,et=2,lr=3,Do=4,Mo=5,No=6,l_=7,ur=8,xa=9,Ua=10,vn=11,mp=12,hB=13,ol=14,bi=15,Xu=16,Vu=17,Ju=18,F_=19,IH=20,Ma=21,jR=22,h_=23,Ii=24,Wu=25,Qn=26,RH=1,Fs=6,Vs=7,p_=8,f_=9,Nr=10;function Oo(i){return Array.isArray(i)&&typeof i[RH]=="object"}function hs(i){return Array.isArray(i)&&i[RH]===!0}function wH(i){return(i.flags&4)!==0}function Yc(i){return i.componentOffset>-1}function Jw(i){return(i.flags&1)===1}function ds(i){return!!i.template}function gp(i){return(i[et]&512)!==0}function sl(i){return(i[et]&256)===256}var sw=class{previousValue;currentValue;firstChange;constructor(s,a,u){this.previousValue=s,this.currentValue=a,this.firstChange=u}isFirstChange(){return this.firstChange}};function bH(i,s,a,u){s!==null?s.applyValueToInputSignal(s,u):i[a]=u}var Ip=(()=>{let i=()=>AH;return i.ngInherit=!0,i})();function AH(i){return i.type.prototype.ngOnChanges&&(i.setInput=Uoe),xoe}function xoe(){let i=OH(this),s=i?.current;if(s){let a=i.previous;if(a===jc)i.previous=s;else for(let u in s)a[u]=s[u];i.current=null,this.ngOnChanges(s)}}function Uoe(i,s,a,u,p){let g=this.declaredInputs[u],y=OH(i)||Foe(i,{previous:jc,current:null}),R=y.current||(y.current={}),w=y.previous,L=w[g];R[g]=new sw(L&&L.currentValue,a,w===jc),bH(i,s,p,a)}var DH="__ngSimpleChanges__";function OH(i){return i[DH]||null}function Foe(i,s){return i[DH]=s}var pB=null;var qt=function(i,s=null,a){pB?.(i,s,a)},Voe="svg",joe="math";function Po(i){for(;Array.isArray(i);)i=i[wi];return i}function NH(i,s){return Po(s[i])}function ps(i,s){return Po(s[i.index])}function Rp(i,s){return i.data[s]}function Boe(i,s){return i[s]}function us(i,s){let a=s[i];return Oo(a)?a:a[wi]}function Qw(i){return(i[et]&128)===128}function Hoe(i){return hs(i[lr])}function Qu(i,s){return s==null?null:i[s]}function PH(i){i[Vu]=0}function Zw(i){i[et]&1024||(i[et]|=1024,Qw(i)&&wp(i))}function Goe(i,s){for(;i>0;)s=s[ol],i--;return s}function V_(i){return!!(i[et]&9216||i[Ii]?.dirty)}function aw(i){i[Ua].changeDetectionScheduler?.notify(8),i[et]&64&&(i[et]|=1024),V_(i)&&wp(i)}function wp(i){i[Ua].changeDetectionScheduler?.notify(0);let s=Bc(i);for(;s!==null&&!(s[et]&8192||(s[et]|=8192,!Qw(s)));)s=Bc(s)}function MH(i,s){if(sl(i))throw new De(911,!1);i[Ma]===null&&(i[Ma]=[]),i[Ma].push(s)}function Woe(i,s){if(i[Ma]===null)return;let a=i[Ma].indexOf(s);a!==-1&&i[Ma].splice(a,1)}function Bc(i){let s=i[lr];return hs(s)?s[lr]:s}function Koe(i){return i[l_]??=[]}function qoe(i){return i.cleanup??=[]}var _t={lFrame:GH(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var cw=!1;function zoe(){return _t.lFrame.elementDepthCount}function Yoe(){_t.lFrame.elementDepthCount++}function $oe(){_t.lFrame.elementDepthCount--}function kH(){return _t.bindingsEnabled}function bp(){return _t.skipHydrationRootTNode!==null}function Xoe(i){return _t.skipHydrationRootTNode===i}function Joe(i){_t.skipHydrationRootTNode=i}function Qoe(){_t.skipHydrationRootTNode=null}function un(){return _t.lFrame.lView}function Ai(){return _t.lFrame.tView}function LH(i){return _t.lFrame.contextLView=i,i[ur]}function xH(i){return _t.lFrame.contextLView=null,i}function Di(){let i=UH();for(;i!==null&&i.type===64;)i=i.parent;return i}function UH(){return _t.lFrame.currentTNode}function Zoe(){let i=_t.lFrame,s=i.currentTNode;return i.isParent?s:s.parent}function Ap(i,s){let a=_t.lFrame;a.currentTNode=i,a.isParent=s}function FH(){return _t.lFrame.isParent}function ese(){_t.lFrame.isParent=!1}function tse(){return _t.lFrame.contextLView}function VH(){return cw}function fB(i){let s=cw;return cw=i,s}function nse(i){return _t.lFrame.bindingIndex=i}function j_(){return _t.lFrame.bindingIndex++}function rse(i){let s=_t.lFrame,a=s.bindingIndex;return s.bindingIndex=s.bindingIndex+i,a}function ise(){return _t.lFrame.inI18n}function ose(i,s){let a=_t.lFrame;a.bindingIndex=a.bindingRootIndex=i,dw(s)}function sse(){return _t.lFrame.currentDirectiveIndex}function dw(i){_t.lFrame.currentDirectiveIndex=i}function ase(i){let s=_t.lFrame.currentDirectiveIndex;return s===-1?null:i[s]}function jH(i){_t.lFrame.currentQueryIndex=i}function cse(i){let s=i[tt];return s.type===2?s.declTNode:s.type===1?i[Mo]:null}function BH(i,s,a){if(a&gt.SkipSelf){let p=s,g=i;for(;p=p.parent,p===null&&!(a&gt.Host);)if(p=cse(g),p===null||(g=g[ol],p.type&10))break;if(p===null)return!1;s=p,i=g}let u=_t.lFrame=HH();return u.currentTNode=s,u.lView=i,!0}function eb(i){let s=HH(),a=i[tt];_t.lFrame=s,s.currentTNode=a.firstChild,s.lView=i,s.tView=a,s.contextLView=i,s.bindingIndex=a.bindingStartIndex,s.inI18n=!1}function HH(){let i=_t.lFrame,s=i===null?null:i.child;return s===null?GH(i):s}function GH(i){let s={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return i!==null&&(i.child=s),s}function WH(){let i=_t.lFrame;return _t.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}var KH=WH;function tb(){let i=WH();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function dse(i){return(_t.lFrame.contextLView=Goe(i,_t.lFrame.contextLView))[ur]}function $c(){return _t.lFrame.selectedIndex}function Hc(i){_t.lFrame.selectedIndex=i}function qH(){let i=_t.lFrame;return Rp(i.tView,i.selectedIndex)}function zH(){return _t.lFrame.currentNamespace}var YH=!0;function nb(){return YH}function Va(i){YH=i}function use(i,s,a){let{ngOnChanges:u,ngOnInit:p,ngDoCheck:g}=s.type.prototype;if(u){let y=AH(s);(a.preOrderHooks??=[]).push(i,y),(a.preOrderCheckHooks??=[]).push(i,y)}p&&(a.preOrderHooks??=[]).push(0-i,p),g&&((a.preOrderHooks??=[]).push(i,g),(a.preOrderCheckHooks??=[]).push(i,g))}function $H(i,s){for(let a=s.directiveStart,u=s.directiveEnd;a<u;a++){let g=i.data[a].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:R,ngAfterViewInit:w,ngAfterViewChecked:L,ngOnDestroy:V}=g;y&&(i.contentHooks??=[]).push(-a,y),R&&((i.contentHooks??=[]).push(a,R),(i.contentCheckHooks??=[]).push(a,R)),w&&(i.viewHooks??=[]).push(-a,w),L&&((i.viewHooks??=[]).push(a,L),(i.viewCheckHooks??=[]).push(a,L)),V!=null&&(i.destroyHooks??=[]).push(a,V)}}function t_(i,s,a){XH(i,s,3,a)}function n_(i,s,a,u){(i[et]&3)===a&&XH(i,s,a,u)}function BR(i,s){let a=i[et];(a&3)===s&&(a&=16383,a+=1,i[et]=a)}function XH(i,s,a,u){let p=u!==void 0?i[Vu]&65535:0,g=u??-1,y=s.length-1,R=0;for(let w=p;w<y;w++)if(typeof s[w+1]=="number"){if(R=s[w],u!=null&&R>=u)break}else s[w]<0&&(i[Vu]+=65536),(R<g||g==-1)&&(lse(i,a,s,w),i[Vu]=(i[Vu]&4294901760)+w+2),w++}function mB(i,s){qt(4,i,s);let a=St(null);try{s.call(i)}finally{St(a),qt(5,i,s)}}function lse(i,s,a,u){let p=a[u]<0,g=a[u+1],y=p?-a[u]:a[u],R=i[y];p?i[et]>>14<i[Vu]>>16&&(i[et]&3)===s&&(i[et]+=16384,mB(R,g)):mB(R,g)}var Ku=-1,Gc=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(s,a,u){this.factory=s,this.canSeeViewProviders=a,this.injectImpl=u}};function hse(i){return i instanceof Gc}function pse(i){return(i.flags&8)!==0}function fse(i){return(i.flags&16)!==0}function mse(i,s,a){let u=0;for(;u<a.length;){let p=a[u];if(typeof p=="number"){if(p!==0)break;u++;let g=a[u++],y=a[u++],R=a[u++];i.setAttribute(s,y,R,g)}else{let g=p,y=a[++u];Ese(g)?i.setProperty(s,g,y):i.setAttribute(s,g,y),u++}}return u}function gse(i){return i===3||i===4||i===6}function Ese(i){return i.charCodeAt(0)===64}function Ep(i,s){if(!(s===null||s.length===0))if(i===null||i.length===0)i=s.slice();else{let a=-1;for(let u=0;u<s.length;u++){let p=s[u];typeof p=="number"?a=p:a===0||(a===-1||a===2?gB(i,a,p,null,s[++u]):gB(i,a,p,null,null))}}return i}function gB(i,s,a,u,p){let g=0,y=i.length;if(s===-1)y=-1;else for(;g<i.length;){let R=i[g++];if(typeof R=="number"){if(R===s){y=-1;break}else if(R>s){y=g-1;break}}}for(;g<i.length;){let R=i[g];if(typeof R=="number")break;if(R===a){if(u===null){p!==null&&(i[g+1]=p);return}else if(u===i[g+1]){i[g+2]=p;return}}g++,u!==null&&g++,p!==null&&g++}y!==-1&&(i.splice(y,0,s),g=y+1),i.splice(g++,0,a),u!==null&&i.splice(g++,0,u),p!==null&&i.splice(g++,0,p)}var HR={},qu=class{injector;parentInjector;constructor(s,a){this.injector=s,this.parentInjector=a}get(s,a,u){u=x_(u);let p=this.injector.get(s,HR,u);return p!==HR||a===HR?p:this.parentInjector.get(s,a,u)}};function JH(i){return i!==Ku}function m_(i){return i&32767}function _se(i){return i>>16}function g_(i,s){let a=_se(i),u=s;for(;a>0;)u=u[ol],a--;return u}var uw=!0;function EB(i){let s=uw;return uw=i,s}var vse=256,QH=vse-1,ZH=5,yse=0,cs={};function Tse(i,s,a){let u;typeof a=="string"?u=a.charCodeAt(0)||0:a.hasOwnProperty(hp)&&(u=a[hp]),u==null&&(u=a[hp]=yse++);let p=u&QH,g=1<<p;s.data[i+(p>>ZH)]|=g}function E_(i,s){let a=eG(i,s);if(a!==-1)return a;let u=s[tt];u.firstCreatePass&&(i.injectorIndex=s.length,GR(u.data,i),GR(s,null),GR(u.blueprint,null));let p=rb(i,s),g=i.injectorIndex;if(JH(p)){let y=m_(p),R=g_(p,s),w=R[tt].data;for(let L=0;L<8;L++)s[g+L]=R[y+L]|w[y+L]}return s[g+8]=p,g}function GR(i,s){i.push(0,0,0,0,0,0,0,0,s)}function eG(i,s){return i.injectorIndex===-1||i.parent&&i.parent.injectorIndex===i.injectorIndex||s[i.injectorIndex+8]===null?-1:i.injectorIndex}function rb(i,s){if(i.parent&&i.parent.injectorIndex!==-1)return i.parent.injectorIndex;let a=0,u=null,p=s;for(;p!==null;){if(u=oG(p),u===null)return Ku;if(a++,p=p[ol],u.injectorIndex!==-1)return u.injectorIndex|a<<16}return Ku}function lw(i,s,a){Tse(i,s,a)}function tG(i,s,a){if(a&gt.Optional||i!==void 0)return i;Ww(s,"NodeInjector")}function nG(i,s,a,u){if(a&gt.Optional&&u===void 0&&(u=null),(a&(gt.Self|gt.Host))===0){let p=i[xa],g=to(void 0);try{return p?p.get(s,u,a&gt.Optional):pH(s,u,a&gt.Optional)}finally{to(g)}}return tG(u,s,a)}function rG(i,s,a,u=gt.Default,p){if(i!==null){if(s[et]&2048&&!(u&gt.Self)){let y=wse(i,s,a,u,cs);if(y!==cs)return y}let g=iG(i,s,a,u,cs);if(g!==cs)return g}return nG(s,a,u,p)}function iG(i,s,a,u,p){let g=Ise(a);if(typeof g=="function"){if(!BH(s,i,u))return u&gt.Host?tG(p,a,u):nG(s,a,u,p);try{let y;if(y=g(u),y==null&&!(u&gt.Optional))Ww(a);else return y}finally{KH()}}else if(typeof g=="number"){let y=null,R=eG(i,s),w=Ku,L=u&gt.Host?s[bi][Mo]:null;for((R===-1||u&gt.SkipSelf)&&(w=R===-1?rb(i,s):s[R+8],w===Ku||!vB(u,!1)?R=-1:(y=s[tt],R=m_(w),s=g_(w,s)));R!==-1;){let V=s[tt];if(_B(g,R,V.data)){let q=Sse(R,s,a,y,u,L);if(q!==cs)return q}w=s[R+8],w!==Ku&&vB(u,s[tt].data[R+8]===L)&&_B(g,R,s)?(y=V,R=m_(w),s=g_(w,s)):R=-1}}return p}function Sse(i,s,a,u,p,g){let y=s[tt],R=y.data[i+8],w=u==null?Yc(R)&&uw:u!=y&&(R.type&3)!==0,L=p&gt.Host&&g===R,V=Cse(R,y,a,w,L);return V!==null?__(s,y,V,R):cs}function Cse(i,s,a,u,p){let g=i.providerIndexes,y=s.data,R=g&1048575,w=i.directiveStart,L=i.directiveEnd,V=g>>20,q=u?R:R+V,Z=p?R+V:L;for(let $=q;$<Z;$++){let pe=y[$];if($<w&&a===pe||$>=w&&pe.type===a)return $}if(p){let $=y[w];if($&&ds($)&&$.type===a)return w}return null}function __(i,s,a,u){let p=i[a],g=s.data;if(hse(p)){let y=p;y.resolving&&uoe(doe(g[a]));let R=EB(y.canSeeViewProviders);y.resolving=!0;let w,L=y.injectImpl?to(y.injectImpl):null,V=BH(i,u,gt.Default);try{p=i[a]=y.factory(void 0,g,i,u),s.firstCreatePass&&a>=u.directiveStart&&use(a,g[a],s)}finally{L!==null&&to(L),EB(R),y.resolving=!1,KH()}}return p}function Ise(i){if(typeof i=="string")return i.charCodeAt(0)||0;let s=i.hasOwnProperty(hp)?i[hp]:void 0;return typeof s=="number"?s>=0?s&QH:Rse:s}function _B(i,s,a){let u=1<<i;return!!(a[s+(i>>ZH)]&u)}function vB(i,s){return!(i&gt.Self)&&!(i&gt.Host&&s)}var Vc=class{_tNode;_lView;constructor(s,a){this._tNode=s,this._lView=a}get(s,a,u){return rG(this._tNode,this._lView,s,x_(u),a)}};function Rse(){return new Vc(Di(),un())}function Dp(i){return k_(()=>{let s=i.prototype.constructor,a=s[a_]||hw(s),u=Object.prototype,p=Object.getPrototypeOf(i.prototype).constructor;for(;p&&p!==u;){let g=p[a_]||hw(p);if(g&&g!==a)return g;p=Object.getPrototypeOf(p)}return g=>new g})}function hw(i){return sH(i)?()=>{let s=hw(Fr(i));return s&&s()}:Yu(i)}function wse(i,s,a,u,p){let g=i,y=s;for(;g!==null&&y!==null&&y[et]&2048&&!gp(y);){let R=iG(g,y,a,u|gt.Self,cs);if(R!==cs)return R;let w=g.parent;if(!w){let L=y[IH];if(L){let V=L.get(a,cs,u);if(V!==cs)return V}w=oG(y),y=y[ol]}g=w}return p}function oG(i){let s=i[tt],a=s.type;return a===2?s.declTNode:a===1?i[Mo]:null}function yB(i,s=null,a=null,u){let p=sG(i,s,a,u);return p.resolveInjectorInitializers(),p}function sG(i,s=null,a=null,u,p=new Set){let g=[a||no,Ioe(i)];return u=u||(typeof i=="object"?void 0:Vr(i)),new fp(g,s||Xw(),u||null,p)}var jr=class i{static THROW_IF_NOT_FOUND=pp;static NULL=new u_;static create(s,a){if(Array.isArray(s))return yB({name:""},a,s,"");{let u=s.name??"";return yB({name:u},s.parent,s.providers,u)}}static \u0275prov=Ge({token:i,providedIn:"any",factory:()=>It(mH)});static __NG_ELEMENT_ID__=-1};var bse=new be("");bse.__NG_ELEMENT_ID__=i=>{let s=Di();if(s===null)throw new De(204,!1);if(s.type&2)return s.value;if(i&gt.Optional)return null;throw new De(204,!1)};var aG=!1,Op=(()=>{class i{static __NG_ELEMENT_ID__=Ase;static __NG_ENV_ID__=a=>a}return i})(),pw=class extends Op{_lView;constructor(s){super(),this._lView=s}onDestroy(s){return MH(this._lView,s),()=>Woe(this._lView,s)}};function Ase(){return new pw(un())}var Zu=class{},B_=new be("",{providedIn:"root",factory:()=>!1});var cG=new be(""),dG=new be(""),Hs=(()=>{class i{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new vr(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let a=this.taskId++;return this.pendingTasks.add(a),a}has(a){return this.pendingTasks.has(a)}remove(a){this.pendingTasks.delete(a),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=Ge({token:i,providedIn:"root",factory:()=>new i})}return i})();var fw=class extends cr{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(s=!1){super(),this.__isAsync=s,SH()&&(this.destroyRef=fe(Op,{optional:!0})??void 0,this.pendingTasks=fe(Hs,{optional:!0})??void 0)}emit(s){let a=St(null);try{super.next(s)}finally{St(a)}}subscribe(s,a,u){let p=s,g=a||(()=>null),y=u;if(s&&typeof s=="object"){let w=s;p=w.next?.bind(w),g=w.error?.bind(w),y=w.complete?.bind(w)}this.__isAsync&&(g=this.wrapInTimeout(g),p&&(p=this.wrapInTimeout(p)),y&&(y=this.wrapInTimeout(y)));let R=super.subscribe({next:p,error:g,complete:y});return s instanceof jn&&s.add(R),R}wrapInTimeout(s){return a=>{let u=this.pendingTasks?.add();setTimeout(()=>{s(a),u!==void 0&&this.pendingTasks?.remove(u)})}}},dr=fw;function v_(...i){}function uG(i){let s,a;function u(){i=v_;try{a!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(a),s!==void 0&&clearTimeout(s)}catch{}}return s=setTimeout(()=>{i(),u()}),typeof requestAnimationFrame=="function"&&(a=requestAnimationFrame(()=>{i(),u()})),()=>u()}function TB(i){return queueMicrotask(()=>i()),()=>{i=v_}}var ib="isAngularZone",y_=ib+"_ID",Dse=0,Jn=class i{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new dr(!1);onMicrotaskEmpty=new dr(!1);onStable=new dr(!1);onError=new dr(!1);constructor(s){let{enableLongStackTrace:a=!1,shouldCoalesceEventChangeDetection:u=!1,shouldCoalesceRunChangeDetection:p=!1,scheduleInRootZone:g=aG}=s;if(typeof Zone>"u")throw new De(908,!1);Zone.assertZonePatched();let y=this;y._nesting=0,y._outer=y._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(y._inner=y._inner.fork(new Zone.TaskTrackingZoneSpec)),a&&Zone.longStackTraceZoneSpec&&(y._inner=y._inner.fork(Zone.longStackTraceZoneSpec)),y.shouldCoalesceEventChangeDetection=!p&&u,y.shouldCoalesceRunChangeDetection=p,y.callbackScheduled=!1,y.scheduleInRootZone=g,Pse(y)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(ib)===!0}static assertInAngularZone(){if(!i.isInAngularZone())throw new De(909,!1)}static assertNotInAngularZone(){if(i.isInAngularZone())throw new De(909,!1)}run(s,a,u){return this._inner.run(s,a,u)}runTask(s,a,u,p){let g=this._inner,y=g.scheduleEventTask("NgZoneEvent: "+p,s,Ose,v_,v_);try{return g.runTask(y,a,u)}finally{g.cancelTask(y)}}runGuarded(s,a,u){return this._inner.runGuarded(s,a,u)}runOutsideAngular(s){return this._outer.run(s)}},Ose={};function ob(i){if(i._nesting==0&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function Nse(i){if(i.isCheckStableRunning||i.callbackScheduled)return;i.callbackScheduled=!0;function s(){uG(()=>{i.callbackScheduled=!1,mw(i),i.isCheckStableRunning=!0,ob(i),i.isCheckStableRunning=!1})}i.scheduleInRootZone?Zone.root.run(()=>{s()}):i._outer.run(()=>{s()}),mw(i)}function Pse(i){let s=()=>{Nse(i)},a=Dse++;i._inner=i._inner.fork({name:"angular",properties:{[ib]:!0,[y_]:a,[y_+a]:!0},onInvokeTask:(u,p,g,y,R,w)=>{if(Mse(w))return u.invokeTask(g,y,R,w);try{return SB(i),u.invokeTask(g,y,R,w)}finally{(i.shouldCoalesceEventChangeDetection&&y.type==="eventTask"||i.shouldCoalesceRunChangeDetection)&&s(),CB(i)}},onInvoke:(u,p,g,y,R,w,L)=>{try{return SB(i),u.invoke(g,y,R,w,L)}finally{i.shouldCoalesceRunChangeDetection&&!i.callbackScheduled&&!kse(w)&&s(),CB(i)}},onHasTask:(u,p,g,y)=>{u.hasTask(g,y),p===g&&(y.change=="microTask"?(i._hasPendingMicrotasks=y.microTask,mw(i),ob(i)):y.change=="macroTask"&&(i.hasPendingMacrotasks=y.macroTask))},onHandleError:(u,p,g,y)=>(u.handleError(g,y),i.runOutsideAngular(()=>i.onError.emit(y)),!1)})}function mw(i){i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&i.callbackScheduled===!0?i.hasPendingMicrotasks=!0:i.hasPendingMicrotasks=!1}function SB(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function CB(i){i._nesting--,ob(i)}var gw=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new dr;onMicrotaskEmpty=new dr;onStable=new dr;onError=new dr;run(s,a,u){return s.apply(a,u)}runGuarded(s,a,u){return s.apply(a,u)}runOutsideAngular(s){return s()}runTask(s,a,u,p){return s.apply(a,u)}};function Mse(i){return lG(i,"__ignore_ng_zone__")}function kse(i){return lG(i,"__scheduler_tick__")}function lG(i,s){return!Array.isArray(i)||i.length!==1?!1:i[0]?.data?.[s]===!0}var js=class{_console=console;handleError(s){this._console.error("ERROR",s)}},Lse=new be("",{providedIn:"root",factory:()=>{let i=fe(Jn),s=fe(js);return a=>i.runOutsideAngular(()=>s.handleError(a))}});function IB(i,s){return oH(i,s)}function xse(i){return oH(iH,i)}var hG=(IB.required=xse,IB);function Use(){return H_(Di(),un())}function H_(i,s){return new Xc(ps(i,s))}var Xc=(()=>{class i{nativeElement;constructor(a){this.nativeElement=a}static __NG_ELEMENT_ID__=Use}return i})();function Fse(i){return typeof i=="function"&&i[yi]!==void 0}function al(i,s){let a=gj(i),u=a[yi];return s?.equal&&(u.equal=s.equal),a.set=p=>TE(u,p),a.update=p=>Ej(u,p),a.asReadonly=Vse.bind(a),a}function Vse(){let i=this[yi];if(i.readonlyFn===void 0){let s=()=>this();s[yi]=i,i.readonlyFn=s}return i.readonlyFn}function pG(i){return Fse(i)&&typeof i.set=="function"}var jse="ngSkipHydration",Bse="ngskiphydration";function fG(i){let s=i.mergedAttrs;if(s===null)return!1;for(let a=0;a<s.length;a+=2){let u=s[a];if(typeof u=="number")return!1;if(typeof u=="string"&&u.toLowerCase()===Bse)return!0}return!1}function mG(i){return i.hasAttribute(jse)}function T_(i){return(i.flags&128)===128}function Hse(i){if(T_(i))return!0;let s=i.parent;for(;s;){if(T_(i)||fG(s))return!0;s=s.parent}return!1}var gG=function(i){return i[i.OnPush=0]="OnPush",i[i.Default=1]="Default",i}(gG||{}),EG=new Map,Gse=0;function Wse(){return Gse++}function Kse(i){EG.set(i[F_],i)}function Ew(i){EG.delete(i[F_])}var RB="__ngContext__";function Np(i,s){Oo(s)?(i[RB]=s[F_],Kse(s)):i[RB]=s}function _G(i){return yG(i[mp])}function vG(i){return yG(i[Do])}function yG(i){for(;i!==null&&!hs(i);)i=i[Do];return i}var _w;function TG(i){_w=i}function G_(){if(_w!==void 0)return _w;if(typeof document<"u")return document;throw new De(210,!1)}var Wc=new be("",{providedIn:"root",factory:()=>qse}),qse="ng",sb=new be(""),Jc=new be("",{providedIn:"platform",factory:()=>"unknown"});var ab=new be("",{providedIn:"root",factory:()=>G_().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function zse(){let i=new cl;return fe(Jc)==="browser"&&(i.store=Yse(G_(),fe(Wc))),i}var cl=(()=>{class i{static \u0275prov=Ge({token:i,providedIn:"root",factory:zse});store={};onSerializeCallbacks={};get(a,u){return this.store[a]!==void 0?this.store[a]:u}set(a,u){this.store[a]=u}remove(a){delete this.store[a]}hasKey(a){return this.store.hasOwnProperty(a)}get isEmpty(){return Object.keys(this.store).length===0}onSerialize(a,u){this.onSerializeCallbacks[a]=u}toJson(){for(let a in this.onSerializeCallbacks)if(this.onSerializeCallbacks.hasOwnProperty(a))try{this.store[a]=this.onSerializeCallbacks[a]()}catch(u){console.warn("Exception in onSerialize callback: ",u)}return JSON.stringify(this.store).replace(/</g,"\\u003C")}}return i})();function Yse(i,s){let a=i.getElementById(s+"-state");if(a?.textContent)try{return JSON.parse(a.textContent)}catch(u){console.warn("Exception while restoring TransferState for app "+s,u)}return{}}var SG="h",CG="b",$se="f",Xse="n",Jse="e",Qse="t",cb="c",IG="x",S_="r",Zse="i",eae="n",RG="d";var tae="di",nae="s",rae="p";var JE=new be(""),wG=!1,bG=new be("",{providedIn:"root",factory:()=>wG});var AG=new be(""),iae=!1,oae=new be(""),wB=new be("",{providedIn:"root",factory:()=>new Map}),db=function(i){return i[i.CHANGE_DETECTION=0]="CHANGE_DETECTION",i[i.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",i}(db||{}),dl=new be(""),bB=new Set;function Gs(i){bB.has(i)||(bB.add(i),performance?.mark?.("mark_feature_usage",{detail:{feature:i}}))}var DG=(()=>{class i{view;node;constructor(a,u){this.view=a,this.node=u}static __NG_ELEMENT_ID__=sae}return i})();function sae(){return new DG(un(),Di())}var ju=function(i){return i[i.EarlyRead=0]="EarlyRead",i[i.Write=1]="Write",i[i.MixedReadWrite=2]="MixedReadWrite",i[i.Read=3]="Read",i}(ju||{}),OG=(()=>{class i{impl=null;execute(){this.impl?.execute()}static \u0275prov=Ge({token:i,providedIn:"root",factory:()=>new i})}return i})(),aae=[ju.EarlyRead,ju.Write,ju.MixedReadWrite,ju.Read],cae=(()=>{class i{ngZone=fe(Jn);scheduler=fe(Zu);errorHandler=fe(js,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){fe(dl,{optional:!0})}execute(){let a=this.sequences.size>0;a&&qt(16),this.executing=!0;for(let u of aae)for(let p of this.sequences)if(!(p.erroredOrDestroyed||!p.hooks[u]))try{p.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>{let g=p.hooks[u];return g(p.pipelinedValue)},p.snapshot))}catch(g){p.erroredOrDestroyed=!0,this.errorHandler?.handleError(g)}this.executing=!1;for(let u of this.sequences)u.afterRun(),u.once&&(this.sequences.delete(u),u.destroy());for(let u of this.deferredRegistrations)this.sequences.add(u);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),a&&qt(17)}register(a){let{view:u}=a;u!==void 0?((u[Wu]??=[]).push(a),wp(u),u[et]|=8192):this.executing?this.deferredRegistrations.add(a):this.addSequence(a)}addSequence(a){this.sequences.add(a),this.scheduler.notify(7)}unregister(a){this.executing&&this.sequences.has(a)?(a.erroredOrDestroyed=!0,a.pipelinedValue=void 0,a.once=!0):(this.sequences.delete(a),this.deferredRegistrations.delete(a))}maybeTrace(a,u){return u?u.run(db.AFTER_NEXT_RENDER,a):a()}static \u0275prov=Ge({token:i,providedIn:"root",factory:()=>new i})}return i})(),vw=class{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(s,a,u,p,g,y=null){this.impl=s,this.hooks=a,this.view=u,this.once=p,this.snapshot=y,this.unregisterOnDestroy=g?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();let s=this.view?.[Wu];s&&(this.view[Wu]=s.filter(a=>a!==this))}};function ub(i,s){!s?.injector&&CH(ub);let a=s?.injector??fe(jr);return Gs("NgAfterNextRender"),uae(i,a,s,!0)}function dae(i,s){if(i instanceof Function){let a=[void 0,void 0,void 0,void 0];return a[s]=i,a}else return[i.earlyRead,i.write,i.mixedReadWrite,i.read]}function uae(i,s,a,u){let p=s.get(OG);p.impl??=s.get(cae);let g=s.get(dl,null,{optional:!0}),y=a?.phase??ju.MixedReadWrite,R=a?.manualCleanup!==!0?s.get(Op):null,w=s.get(DG,null,{optional:!0}),L=new vw(p.impl,dae(i,y),w?.view,u,R,g?.snapshot(null));return p.impl.register(L),L}var Ci=function(i){return i[i.NOT_STARTED=0]="NOT_STARTED",i[i.IN_PROGRESS=1]="IN_PROGRESS",i[i.COMPLETE=2]="COMPLETE",i[i.FAILED=3]="FAILED",i}(Ci||{}),AB=0,lae=1,Xn=function(i){return i[i.Placeholder=0]="Placeholder",i[i.Loading=1]="Loading",i[i.Complete=2]="Complete",i[i.Error=3]="Error",i}(Xn||{});var hae=0,W_=1;var pae=4,fae=5;var mae=7,zu=8,gae=9,NG=function(i){return i[i.Manual=0]="Manual",i[i.Playthrough=1]="Playthrough",i}(NG||{});function r_(i,s){let a=_ae(i),u=s[a];if(u!==null){for(let p of u)p();s[a]=null}}function Eae(i){r_(1,i),r_(0,i),r_(2,i)}function _ae(i){let s=pae;return i===1?s=fae:i===2&&(s=gae),s}function PG(i){return i+1}function Pp(i,s){let a=i[tt],u=PG(s.index);return i[u]}function K_(i,s){let a=PG(s.index);return i.data[a]}function vae(i,s,a){let u=s[tt],p=K_(u,a);switch(i){case Xn.Complete:return p.primaryTmplIndex;case Xn.Loading:return p.loadingTmplIndex;case Xn.Error:return p.errorTmplIndex;case Xn.Placeholder:return p.placeholderTmplIndex;default:return null}}function DB(i,s){return s===Xn.Placeholder?i.placeholderBlockConfig?.[AB]??null:s===Xn.Loading?i.loadingBlockConfig?.[AB]??null:null}function yae(i){return i.loadingBlockConfig?.[lae]??null}function OB(i,s){if(!i||i.length===0)return s;let a=new Set(i);for(let u of s)a.add(u);return i.length===a.size?i:Array.from(a)}function Tae(i,s){let a=s.primaryTmplIndex+Qn;return Rp(i,a)}var q_="ngb";var Sae=(i,s,a)=>{let u=i,p=u.__jsaction_fns??new Map,g=p.get(s)??[];g.push(a),p.set(s,g),u.__jsaction_fns=p},Cae=(i,s)=>{let a=i.getAttribute(q_)??"",u=i,p=s.get(a)??new Set;p.has(u)||p.add(u),s.set(a,p)};var Iae=i=>{i.removeAttribute(PR.JSACTION),i.removeAttribute(q_),i.__jsaction_fns=void 0},Rae=new be("",{providedIn:"root",factory:()=>({})});function MG(i,s){let a=s?.__jsaction_fns?.get(i.type);if(a)for(let u of a)u(i)}var kG=new be("");var wae="__nghData__",LG=wae,bae="__nghDeferData__",Aae=bae,WR="ngh",Dae="nghm",xG=()=>null;function Oae(i,s,a=!1){let u=i.getAttribute(WR);if(u==null)return null;let[p,g]=u.split("|");if(u=a?g:p,!u)return null;let y=g?`|${g}`:"",R=a?p:y,w={};if(u!==""){let V=s.get(cl,null,{optional:!0});V!==null&&(w=V.get(LG,[])[Number(u)])}let L={data:w,firstChild:i.firstChild??null};return a&&(L.firstChild=i,z_(L,0,i.nextSibling)),R?i.setAttribute(WR,R):i.removeAttribute(WR),L}function Nae(){xG=Oae}function UG(i,s,a=!1){return xG(i,s,a)}function Pae(i){let s=i._lView;return s[tt].type===2?null:(gp(s)&&(s=s[Qn]),s)}function Mae(i){return i.textContent?.replace(/\s/gm,"")}function kae(i){let s=G_(),a=s.createNodeIterator(i,NodeFilter.SHOW_COMMENT,{acceptNode(g){let y=Mae(g);return y==="ngetn"||y==="ngtns"?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),u,p=[];for(;u=a.nextNode();)p.push(u);for(let g of p)g.textContent==="ngetn"?g.replaceWith(s.createTextNode("")):g.remove()}function z_(i,s,a){i.segmentHeads??={},i.segmentHeads[s]=a}function yw(i,s){return i.segmentHeads?.[s]??null}function Lae(i){return i.get(oae,!1,{optional:!0})}function xae(i,s){let a=i.data,u=a[Jse]?.[s]??null;return u===null&&a[cb]?.[s]&&(u=lb(i,s)),u}function FG(i,s){return i.data[cb]?.[s]??null}function lb(i,s){let a=FG(i,s)??[],u=0;for(let p of a)u+=p[S_]*(p[IG]??1);return u}function Uae(i){if(typeof i.disconnectedNodes>"u"){let s=i.data[RG];i.disconnectedNodes=s?new Set(s):null}return i.disconnectedNodes}function Mp(i,s){if(typeof i.disconnectedNodes>"u"){let a=i.data[RG];i.disconnectedNodes=a?new Set(a):null}return!!Uae(i)?.has(s)}function Fae(i,s){let a=s.get(kG),p=s.get(cl).get(Aae,{}),g=!1,y=i,R=null,w=[];for(;!g&&y;){g=a.has(y);let L=a.hydrating.get(y);if(R===null&&L!=null){R=L.promise;break}w.unshift(y),y=p[y][rae]}return{parentBlockPromise:R,hydrationQueue:w}}function VG(i,s){let a=i.contentQueries;if(a!==null){let u=St(null);try{for(let p=0;p<a.length;p+=2){let g=a[p],y=a[p+1];if(y!==-1){let R=i.data[y];jH(g),R.contentQueries(2,s[y],y)}}}finally{St(u)}}}function Tw(i,s,a){jH(0);let u=St(null);try{s(i,a)}finally{St(u)}}function jG(i,s,a){if(wH(s)){let u=St(null);try{let p=s.directiveStart,g=s.directiveEnd;for(let y=p;y<g;y++){let R=i.data[y];if(R.contentQueries){let w=a[y];R.contentQueries(1,w,y)}}}finally{St(u)}}}var ls=function(i){return i[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",i}(ls||{});var Sw=class{changingThisBreaksApplicationSecurity;constructor(s){this.changingThisBreaksApplicationSecurity=s}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Zie})`}};function hb(i){return i instanceof Sw?i.changingThisBreaksApplicationSecurity:i}var Vae=/^>|^->|<!--|-->|--!>|<!-$/g,jae=/(<|>)/g,Bae="\u200B$1\u200B";function Hae(i){return i.replace(Vae,s=>s.replace(jae,Bae))}function Gae(i){return i.ownerDocument.body}function BG(i){return i instanceof Function?i():i}function Wae(i,s,a){let u=i.length;for(;;){let p=i.indexOf(s,a);if(p===-1)return p;if(p===0||i.charCodeAt(p-1)<=32){let g=s.length;if(p+g===u||i.charCodeAt(p+g)<=32)return p}a=p+1}}var HG="ng-template";function Kae(i,s,a,u){let p=0;if(u){for(;p<s.length&&typeof s[p]=="string";p+=2)if(s[p]==="class"&&Wae(s[p+1].toLowerCase(),a,0)!==-1)return!0}else if(pb(i))return!1;if(p=s.indexOf(1,p),p>-1){let g;for(;++p<s.length&&typeof(g=s[p])=="string";)if(g.toLowerCase()===a)return!0}return!1}function pb(i){return i.type===4&&i.value!==HG}function qae(i,s,a){let u=i.type===4&&!a?HG:i.value;return s===u}function zae(i,s,a){let u=4,p=i.attrs,g=p!==null?Xae(p):0,y=!1;for(let R=0;R<s.length;R++){let w=s[R];if(typeof w=="number"){if(!y&&!Ao(u)&&!Ao(w))return!1;if(y&&Ao(w))continue;y=!1,u=w|u&1;continue}if(!y)if(u&4){if(u=2|u&1,w!==""&&!qae(i,w,a)||w===""&&s.length===1){if(Ao(u))return!1;y=!0}}else if(u&8){if(p===null||!Kae(i,p,w,a)){if(Ao(u))return!1;y=!0}}else{let L=s[++R],V=Yae(w,p,pb(i),a);if(V===-1){if(Ao(u))return!1;y=!0;continue}if(L!==""){let q;if(V>g?q="":q=p[V+1].toLowerCase(),u&2&&L!==q){if(Ao(u))return!1;y=!0}}}}return Ao(u)||y}function Ao(i){return(i&1)===0}function Yae(i,s,a,u){if(s===null)return-1;let p=0;if(u||!a){let g=!1;for(;p<s.length;){let y=s[p];if(y===i)return p;if(y===3||y===6)g=!0;else if(y===1||y===2){let R=s[++p];for(;typeof R=="string";)R=s[++p];continue}else{if(y===4)break;if(y===0){p+=4;continue}}p+=g?1:2}return-1}else return Jae(s,i)}function $ae(i,s,a=!1){for(let u=0;u<s.length;u++)if(zae(i,s[u],a))return!0;return!1}function Xae(i){for(let s=0;s<i.length;s++){let a=i[s];if(gse(a))return s}return i.length}function Jae(i,s){let a=i.indexOf(4);if(a>-1)for(a++;a<i.length;){let u=i[a];if(typeof u=="number")return-1;if(u===s)return a;a++}return-1}function NB(i,s){return i?":not("+s.trim()+")":s}function Qae(i){let s=i[0],a=1,u=2,p="",g=!1;for(;a<i.length;){let y=i[a];if(typeof y=="string")if(u&2){let R=i[++a];p+="["+y+(R.length>0?'="'+R+'"':"")+"]"}else u&8?p+="."+y:u&4&&(p+=" "+y);else p!==""&&!Ao(y)&&(s+=NB(g,p),p=""),u=y,g=g||!Ao(u);a++}return p!==""&&(s+=NB(g,p)),s}function Zae(i){return i.map(Qae).join(",")}function ece(i){let s=[],a=[],u=1,p=2;for(;u<i.length;){let g=i[u];if(typeof g=="string")p===2?g!==""&&s.push(g,i[++u]):p===8&&a.push(g);else{if(!Ao(p))break;p=g}u++}return a.length&&s.push(1,...a),s}var ul={};function GG(i,s){return i.createText(s)}function tce(i,s,a){i.setValue(s,a)}function WG(i,s){return i.createComment(Hae(s))}function fb(i,s,a){return i.createElement(s,a)}function C_(i,s,a,u,p){i.insertBefore(s,a,u,p)}function KG(i,s,a){i.appendChild(s,a)}function PB(i,s,a,u,p){u!==null?C_(i,s,a,u,p):KG(i,s,a)}function mb(i,s,a){i.removeChild(null,s,a)}function qG(i){i.textContent=""}function nce(i,s,a){i.setAttribute(s,"style",a)}function rce(i,s,a){a===""?i.removeAttribute(s,"class"):i.setAttribute(s,"class",a)}function zG(i,s,a){let{mergedAttrs:u,classes:p,styles:g}=a;u!==null&&mse(i,s,u),p!==null&&rce(i,s,p),g!==null&&nce(i,s,g)}function gb(i,s,a,u,p,g,y,R,w,L,V){let q=Qn+u,Z=q+p,$=ice(q,Z),pe=typeof L=="function"?L():L;return $[tt]={type:i,blueprint:$,template:a,queries:null,viewQuery:R,declTNode:s,data:$.slice().fill(null,q),bindingStartIndex:q,expandoStartIndex:Z,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof g=="function"?g():g,pipeRegistry:typeof y=="function"?y():y,firstChild:null,schemas:w,consts:pe,incompleteFirstPass:!1,ssrId:V}}function ice(i,s){let a=[];for(let u=0;u<s;u++)a.push(u<i?null:ul);return a}function oce(i){let s=i.tView;return s===null||s.incompleteFirstPass?i.tView=gb(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts,i.id):s}function Eb(i,s,a,u,p,g,y,R,w,L,V){let q=s.blueprint.slice();return q[wi]=p,q[et]=u|4|128|8|64|1024,(L!==null||i&&i[et]&2048)&&(q[et]|=2048),PH(q),q[lr]=q[ol]=i,q[ur]=a,q[Ua]=y||i&&i[Ua],q[vn]=R||i&&i[vn],q[xa]=w||i&&i[xa]||null,q[Mo]=g,q[F_]=Wse(),q[No]=V,q[IH]=L,q[bi]=s.type==2?i[bi]:q,q}function sce(i,s,a){let u=ps(s,i),p=oce(a),g=i[Ua].rendererFactory,y=_b(i,Eb(i,p,null,YG(a),u,s,null,g.createRenderer(u,a),null,null,null));return i[s.index]=y}function YG(i){let s=16;return i.signals?s=4096:i.onPush&&(s=64),s}function $G(i,s,a,u){if(a===0)return-1;let p=s.length;for(let g=0;g<a;g++)s.push(u),i.blueprint.push(u),i.data.push(null);return p}function _b(i,s){return i[mp]?i[hB][Do]=s:i[mp]=s,i[hB]=s,s}function io(i=1){XG(Ai(),un(),$c()+i,!1)}function XG(i,s,a,u){if(!u)if((s[et]&3)===3){let g=i.preOrderCheckHooks;g!==null&&t_(s,g,a)}else{let g=i.preOrderHooks;g!==null&&n_(s,g,0,a)}Hc(a)}var Y_=function(i){return i[i.None=0]="None",i[i.SignalBased=1]="SignalBased",i[i.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",i}(Y_||{});function Cw(i,s,a,u){let p=St(null);try{let[g,y,R]=i.inputs[a],w=null;(y&Y_.SignalBased)!==0&&(w=s[g][yi]),w!==null&&w.transformFn!==void 0?u=w.transformFn(u):R!==null&&(u=R.call(s,u)),i.setInput!==null?i.setInput(s,w,u,a,g):bH(s,w,g,u)}finally{St(p)}}function JG(i,s,a,u,p){let g=$c(),y=u&2;try{Hc(-1),y&&s.length>Qn&&XG(i,s,Qn,!1),qt(y?2:0,p),a(u,p)}finally{Hc(g),qt(y?3:1,p)}}function vb(i,s,a){pce(i,s,a),(a.flags&64)===64&&fce(i,s,a)}function QG(i,s,a=ps){let u=s.localNames;if(u!==null){let p=s.index+1;for(let g=0;g<u.length;g+=2){let y=u[g+1],R=y===-1?a(s,i):i[y];i[p++]=R}}}function ace(i,s,a,u){let g=u.get(bG,wG)||a===ls.ShadowDom,y=i.selectRootElement(s,g);return cce(y),y}function cce(i){ZG(i)}var ZG=()=>null;function dce(i){mG(i)?qG(i):kae(i)}function uce(){ZG=dce}function lce(i){return i==="class"?"className":i==="for"?"htmlFor":i==="formaction"?"formAction":i==="innerHtml"?"innerHTML":i==="readonly"?"readOnly":i==="tabindex"?"tabIndex":i}function e3(i,s,a,u,p,g,y,R){if(!R&&yb(s,i,a,u,p)){Yc(s)&&hce(a,s.index);return}if(s.type&3){let w=ps(s,a);u=lce(u),p=y!=null?y(p,s.value||"",u):p,g.setProperty(w,u,p)}else s.type&12}function hce(i,s){let a=us(s,i);a[et]&16||(a[et]|=64)}function pce(i,s,a){let u=a.directiveStart,p=a.directiveEnd;Yc(a)&&sce(s,a,i.data[u+a.componentOffset]),i.firstCreatePass||E_(a,s);let g=a.initialInputs;for(let y=u;y<p;y++){let R=i.data[y],w=__(s,i,y,a);if(Np(w,s),g!==null&&gce(s,y-u,w,R,a,g),ds(R)){let L=us(a.index,s);L[ur]=__(s,i,y,a)}}}function fce(i,s,a){let u=a.directiveStart,p=a.directiveEnd,g=a.index,y=sse();try{Hc(g);for(let R=u;R<p;R++){let w=i.data[R],L=s[R];dw(R),(w.hostBindings!==null||w.hostVars!==0||w.hostAttrs!==null)&&mce(w,L)}}finally{Hc(-1),dw(y)}}function mce(i,s){i.hostBindings!==null&&i.hostBindings(1,s)}function t3(i,s){let a=i.directiveRegistry,u=null;if(a)for(let p=0;p<a.length;p++){let g=a[p];$ae(s,g.selectors,!1)&&(u??=[],ds(g)?u.unshift(g):u.push(g))}return u}function gce(i,s,a,u,p,g){let y=g[s];if(y!==null)for(let R=0;R<y.length;R+=2){let w=y[R],L=y[R+1];Cw(u,a,w,L)}}function $_(i,s){let a=i[xa],u=a?a.get(js,null):null;u&&u.handleError(s)}function yb(i,s,a,u,p){let g=i.inputs?.[u],y=i.hostDirectiveInputs?.[u],R=!1;if(y)for(let w=0;w<y.length;w+=2){let L=y[w],V=y[w+1],q=s.data[L];Cw(q,a[L],V,p),R=!0}if(g)for(let w of g){let L=a[w],V=s.data[w];Cw(V,L,u,p),R=!0}return R}function Ece(i,s){let a=us(s,i),u=a[tt];_ce(u,a);let p=a[wi];p!==null&&a[No]===null&&(a[No]=UG(p,a[xa])),qt(18),Tb(u,a,a[ur]),qt(19,a[ur])}function _ce(i,s){for(let a=s.length;a<i.blueprint.length;a++)s.push(i.blueprint[a])}function Tb(i,s,a){eb(s);try{let u=i.viewQuery;u!==null&&Tw(1,u,a);let p=i.template;p!==null&&JG(i,s,p,1,a),i.firstCreatePass&&(i.firstCreatePass=!1),s[Ju]?.finishViewCreation(i),i.staticContentQueries&&VG(i,s),i.staticViewQueries&&Tw(2,i.viewQuery,a);let g=i.components;g!==null&&vce(s,g)}catch(u){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),u}finally{s[et]&=-5,tb()}}function vce(i,s){for(let a=0;a<s.length;a++)Ece(i,s[a])}function X_(i,s,a,u){let p=St(null);try{let g=s.tView,R=i[et]&4096?4096:16,w=Eb(i,g,a,R,null,s,null,null,u?.injector??null,u?.embeddedViewInjector??null,u?.dehydratedView??null),L=i[s.index];w[Xu]=L;let V=i[Ju];return V!==null&&(w[Ju]=V.createEmbeddedView(g)),Tb(g,w,a),w}finally{St(p)}}function _p(i,s){return!s||s.firstChild===null||T_(i)}var yce;function Sb(i,s){return yce(i,s)}var Bs=function(i){return i[i.Important=1]="Important",i[i.DashCase=2]="DashCase",i}(Bs||{});function ll(i){return(i.flags&32)===32}function Bu(i,s,a,u,p){if(u!=null){let g,y=!1;hs(u)?g=u:Oo(u)&&(y=!0,u=u[wi]);let R=Po(u);i===0&&a!==null?p==null?KG(s,a,R):C_(s,a,R,p||null,!0):i===1&&a!==null?C_(s,a,R,p||null,!0):i===2?mb(s,R,y):i===3&&s.destroyNode(R),g!=null&&Pce(s,i,g,a,p)}}function Tce(i,s){n3(i,s),s[wi]=null,s[Mo]=null}function Sce(i,s,a,u,p,g){u[wi]=p,u[Mo]=s,Q_(i,u,a,1,p,g)}function n3(i,s){s[Ua].changeDetectionScheduler?.notify(9),Q_(i,s,s[vn],2,null,null)}function Cce(i){let s=i[mp];if(!s)return KR(i[tt],i);for(;s;){let a=null;if(Oo(s))a=s[mp];else{let u=s[Nr];u&&(a=u)}if(!a){for(;s&&!s[Do]&&s!==i;)Oo(s)&&KR(s[tt],s),s=s[lr];s===null&&(s=i),Oo(s)&&KR(s[tt],s),a=s&&s[Do]}s=a}}function Cb(i,s){let a=i[f_],u=a.indexOf(s);a.splice(u,1)}function J_(i,s){if(sl(s))return;let a=s[vn];a.destroyNode&&Q_(i,s,a,3,null,null),Cce(s)}function KR(i,s){if(sl(s))return;let a=St(null);try{s[et]&=-129,s[et]|=256,s[Ii]&&uR(s[Ii]),Rce(i,s),Ice(i,s),s[tt].type===1&&s[vn].destroy();let u=s[Xu];if(u!==null&&hs(s[lr])){u!==s[lr]&&Cb(u,s);let p=s[Ju];p!==null&&p.detachView(i)}Ew(s)}finally{St(a)}}function Ice(i,s){let a=i.cleanup,u=s[l_];if(a!==null)for(let y=0;y<a.length-1;y+=2)if(typeof a[y]=="string"){let R=a[y+3];R>=0?u[R]():u[-R].unsubscribe(),y+=2}else{let R=u[a[y+1]];a[y].call(R)}u!==null&&(s[l_]=null);let p=s[Ma];if(p!==null){s[Ma]=null;for(let y=0;y<p.length;y++){let R=p[y];R()}}let g=s[h_];if(g!==null){s[h_]=null;for(let y of g)y.destroy()}}function Rce(i,s){let a;if(i!=null&&(a=i.destroyHooks)!=null)for(let u=0;u<a.length;u+=2){let p=s[a[u]];if(!(p instanceof Gc)){let g=a[u+1];if(Array.isArray(g))for(let y=0;y<g.length;y+=2){let R=p[g[y]],w=g[y+1];qt(4,R,w);try{w.call(R)}finally{qt(5,R,w)}}else{qt(4,p,g);try{g.call(p)}finally{qt(5,p,g)}}}}}function wce(i,s,a){return bce(i,s.parent,a)}function bce(i,s,a){let u=s;for(;u!==null&&u.type&168;)s=u,u=s.parent;if(u===null)return a[wi];if(Yc(u)){let{encapsulation:p}=i.data[u.directiveStart+u.componentOffset];if(p===ls.None||p===ls.Emulated)return null}return ps(u,a)}function Ace(i,s,a){return Oce(i,s,a)}function Dce(i,s,a){return i.type&40?ps(i,a):null}var Oce=Dce,MB;function Ib(i,s,a,u){let p=wce(i,u,s),g=s[vn],y=u.parent||s[Mo],R=Ace(y,u,s);if(p!=null)if(Array.isArray(a))for(let w=0;w<a.length;w++)PB(g,p,a[w],R,!1);else PB(g,p,a,R,!1);MB!==void 0&&MB(g,u,s,a,p)}function lp(i,s){if(s!==null){let a=s.type;if(a&3)return ps(s,i);if(a&4)return Iw(-1,i[s.index]);if(a&8){let u=s.child;if(u!==null)return lp(i,u);{let p=i[s.index];return hs(p)?Iw(-1,p):Po(p)}}else{if(a&128)return lp(i,s.next);if(a&32)return Sb(s,i)()||Po(i[s.index]);{let u=r3(i,s);if(u!==null){if(Array.isArray(u))return u[0];let p=Bc(i[bi]);return lp(p,u)}else return lp(i,s.next)}}}return null}function r3(i,s){if(s!==null){let u=i[bi][Mo],p=s.projection;return u.projection[p]}return null}function Iw(i,s){let a=Nr+i+1;if(a<s.length){let u=s[a],p=u[tt].firstChild;if(p!==null)return lp(u,p)}return s[Vs]}function Rb(i,s,a,u,p,g,y){for(;a!=null;){if(a.type===128){a=a.next;continue}let R=u[a.index],w=a.type;if(y&&s===0&&(R&&Np(Po(R),u),a.flags|=2),!ll(a))if(w&8)Rb(i,s,a.child,u,p,g,!1),Bu(s,i,p,R,g);else if(w&32){let L=Sb(a,u),V;for(;V=L();)Bu(s,i,p,V,g);Bu(s,i,p,R,g)}else w&16?Nce(i,s,u,a,p,g):Bu(s,i,p,R,g);a=y?a.projectionNext:a.next}}function Q_(i,s,a,u,p,g){Rb(a,u,i.firstChild,s,p,g,!1)}function Nce(i,s,a,u,p,g){let y=a[bi],w=y[Mo].projection[u.projection];if(Array.isArray(w))for(let L=0;L<w.length;L++){let V=w[L];Bu(s,i,p,V,g)}else{let L=w,V=y[lr];T_(u)&&(L.flags|=128),Rb(i,s,L,V,p,g,!0)}}function Pce(i,s,a,u,p){let g=a[Vs],y=Po(a);g!==y&&Bu(s,i,u,g,p);for(let R=Nr;R<a.length;R++){let w=a[R];Q_(w[tt],w,i,s,u,g)}}function Mce(i,s,a,u,p){if(s)p?i.addClass(a,u):i.removeClass(a,u);else{let g=u.indexOf("-")===-1?void 0:Bs.DashCase;p==null?i.removeStyle(a,u,g):(typeof p=="string"&&p.endsWith("!important")&&(p=p.slice(0,-10),g|=Bs.Important),i.setStyle(a,u,p,g))}}function I_(i,s,a,u,p=!1){for(;a!==null;){if(a.type===128){a=p?a.projectionNext:a.next;continue}let g=s[a.index];g!==null&&u.push(Po(g)),hs(g)&&kce(g,u);let y=a.type;if(y&8)I_(i,s,a.child,u);else if(y&32){let R=Sb(a,s),w;for(;w=R();)u.push(w)}else if(y&16){let R=r3(s,a);if(Array.isArray(R))u.push(...R);else{let w=Bc(s[bi]);I_(w[tt],w,R,u,!0)}}a=p?a.projectionNext:a.next}return u}function kce(i,s){for(let a=Nr;a<i.length;a++){let u=i[a],p=u[tt].firstChild;p!==null&&I_(u[tt],u,p,s)}i[Vs]!==i[wi]&&s.push(i[Vs])}function i3(i){if(i[Wu]!==null){for(let s of i[Wu])s.impl.addSequence(s);i[Wu].length=0}}var o3=[];function Lce(i){return i[Ii]??xce(i)}function xce(i){let s=o3.pop()??Object.create(Fce);return s.lView=i,s}function Uce(i){i.lView[Ii]!==i&&(i.lView=null,o3.push(i))}var Fce=At(Se({},sp),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:i=>{wp(i.lView)},consumerOnSignalRead(){this.lView[Ii]=this}});function Vce(i){let s=i[Ii]??Object.create(jce);return s.lView=i,s}var jce=At(Se({},sp),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:i=>{let s=Bc(i.lView);for(;s&&!s3(s[tt]);)s=Bc(s);s&&Zw(s)},consumerOnSignalRead(){this.lView[Ii]=this}});function s3(i){return i.type!==2}function a3(i){if(i[h_]===null)return;let s=!0;for(;s;){let a=!1;for(let u of i[h_])u.dirty&&(a=!0,u.zone===null||Zone.current===u.zone?u.run():u.zone.run(()=>u.run()));s=a&&!!(i[et]&8192)}}var Bce=100;function c3(i,s=!0,a=0){let p=i[Ua].rendererFactory,g=!1;g||p.begin?.();try{Hce(i,a)}catch(y){throw s&&$_(i,y),y}finally{g||p.end?.()}}function Hce(i,s){let a=VH();try{fB(!0),Rw(i,s);let u=0;for(;V_(i);){if(u===Bce)throw new De(103,!1);u++,Rw(i,1)}}finally{fB(a)}}function Gce(i,s,a,u){if(sl(s))return;let p=s[et],g=!1,y=!1;eb(s);let R=!0,w=null,L=null;g||(s3(i)?(L=Lce(s),w=_E(L)):oj()===null?(R=!1,L=Vce(s),w=_E(L)):s[Ii]&&(uR(s[Ii]),s[Ii]=null));try{PH(s),nse(i.bindingStartIndex),a!==null&&JG(i,s,a,2,u);let V=(p&3)===3;if(!g)if(V){let $=i.preOrderCheckHooks;$!==null&&t_(s,$,null)}else{let $=i.preOrderHooks;$!==null&&n_(s,$,0,null),BR(s,0)}if(y||Wce(s),a3(s),d3(s,0),i.contentQueries!==null&&VG(i,s),!g)if(V){let $=i.contentCheckHooks;$!==null&&t_(s,$)}else{let $=i.contentHooks;$!==null&&n_(s,$,1),BR(s,1)}qce(i,s);let q=i.components;q!==null&&l3(s,q,0);let Z=i.viewQuery;if(Z!==null&&Tw(2,Z,u),!g)if(V){let $=i.viewCheckHooks;$!==null&&t_(s,$)}else{let $=i.viewHooks;$!==null&&n_(s,$,2),BR(s,2)}if(i.firstUpdatePass===!0&&(i.firstUpdatePass=!1),s[jR]){for(let $ of s[jR])$();s[jR]=null}g||(i3(s),s[et]&=-73)}catch(V){throw g||wp(s),V}finally{L!==null&&(cR(L,w),R&&Uce(L)),tb()}}function d3(i,s){for(let a=_G(i);a!==null;a=vG(a))for(let u=Nr;u<a.length;u++){let p=a[u];u3(p,s)}}function Wce(i){for(let s=_G(i);s!==null;s=vG(s)){if(!(s[et]&2))continue;let a=s[f_];for(let u=0;u<a.length;u++){let p=a[u];Zw(p)}}}function Kce(i,s,a){qt(18);let u=us(s,i);u3(u,a),qt(19,u[ur])}function u3(i,s){Qw(i)&&Rw(i,s)}function Rw(i,s){let u=i[tt],p=i[et],g=i[Ii],y=!!(s===0&&p&16);if(y||=!!(p&64&&s===0),y||=!!(p&1024),y||=!!(g?.dirty&&dR(g)),y||=!1,g&&(g.dirty=!1),i[et]&=-9217,y)Gce(u,i,u.template,i[ur]);else if(p&8192){a3(i),d3(i,1);let R=u.components;R!==null&&l3(i,R,1),i3(i)}}function l3(i,s,a){for(let u=0;u<s.length;u++)Kce(i,s[u],a)}function qce(i,s){let a=i.hostBindingOpCodes;if(a!==null)try{for(let u=0;u<a.length;u++){let p=a[u];if(p<0)Hc(~p);else{let g=p,y=a[++u],R=a[++u];ose(y,g);let w=s[g];qt(24,w),R(2,w),qt(25,w)}}}finally{Hc(-1)}}function Z_(i,s){let a=VH()?64:1088;for(i[Ua].changeDetectionScheduler?.notify(s);i;){i[et]|=a;let u=Bc(i);if(gp(i)&&!u)return i;i=u}return null}function h3(i,s,a,u){return[i,!0,0,s,null,u,null,a,null,null]}function zce(i,s){let a=Nr+s;if(a<i.length)return i[a]}function ev(i,s,a,u=!0){let p=s[tt];if(Yce(p,s,i,a),u){let y=Iw(a,i),R=s[vn],w=R.parentNode(i[Vs]);w!==null&&Sce(p,i[Mo],R,s,w,y)}let g=s[No];g!==null&&g.firstChild!==null&&(g.firstChild=null)}function p3(i,s){let a=vp(i,s);return a!==void 0&&J_(a[tt],a),a}function vp(i,s){if(i.length<=Nr)return;let a=Nr+s,u=i[a];if(u){let p=u[Xu];p!==null&&p!==i&&Cb(p,u),s>0&&(i[a-1][Do]=u[Do]);let g=d_(i,Nr+s);Tce(u[tt],u);let y=g[Ju];y!==null&&y.detachView(g[tt]),u[lr]=null,u[Do]=null,u[et]&=-129}return u}function Yce(i,s,a,u){let p=Nr+u,g=a.length;u>0&&(a[p-1][Do]=s),u<g-Nr?(s[Do]=a[p],fH(a,Nr+u,s)):(a.push(s),s[Do]=null),s[lr]=a;let y=s[Xu];y!==null&&a!==y&&f3(y,s);let R=s[Ju];R!==null&&R.insertView(i),aw(s),s[et]|=128}function f3(i,s){let a=i[f_],u=s[lr];if(Oo(u))i[et]|=2;else{let p=u[lr][bi];s[bi]!==p&&(i[et]|=2)}a===null?i[f_]=[s]:a.push(s)}var Kc=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let s=this._lView,a=s[tt];return I_(a,s,a.firstChild,[])}constructor(s,a,u=!0){this._lView=s,this._cdRefInjectingView=a,this.notifyErrorHandler=u}get context(){return this._lView[ur]}get dirty(){return!!(this._lView[et]&9280)||!!this._lView[Ii]?.dirty}set context(s){this._lView[ur]=s}get destroyed(){return sl(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let s=this._lView[lr];if(hs(s)){let a=s[p_],u=a?a.indexOf(this):-1;u>-1&&(vp(s,u),d_(a,u))}this._attachedToViewContainer=!1}J_(this._lView[tt],this._lView)}onDestroy(s){MH(this._lView,s)}markForCheck(){Z_(this._cdRefInjectingView||this._lView,4)}markForRefresh(){Zw(this._cdRefInjectingView||this._lView)}detach(){this._lView[et]&=-129}reattach(){aw(this._lView),this._lView[et]|=128}detectChanges(){this._lView[et]|=1024,c3(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new De(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let s=gp(this._lView),a=this._lView[Xu];a!==null&&!s&&Cb(a,this._lView),n3(this._lView[tt],this._lView)}attachToAppRef(s){if(this._attachedToViewContainer)throw new De(902,!1);this._appRef=s;let a=gp(this._lView),u=this._lView[Xu];u!==null&&!a&&f3(u,this._lView),aw(this._lView)}},wb=(()=>{class i{static __NG_ELEMENT_ID__=Jce}return i})(),$ce=wb,Xce=class extends $ce{_declarationLView;_declarationTContainer;elementRef;constructor(s,a,u){super(),this._declarationLView=s,this._declarationTContainer=a,this.elementRef=u}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(s,a){return this.createEmbeddedViewImpl(s,a)}createEmbeddedViewImpl(s,a,u){let p=X_(this._declarationLView,this._declarationTContainer,s,{embeddedViewInjector:a,dehydratedView:u});return new Kc(p)}};function Jce(){return m3(Di(),un())}function m3(i,s){return i.type&4?new Xce(s,i,H_(i,s)):null}function bb(i,s,a,u,p){let g=i.data[s];if(g===null)g=Qce(i,s,a,u,p),ise()&&(g.flags|=32);else if(g.type&64){g.type=a,g.value=u,g.attrs=p;let y=Zoe();g.injectorIndex=y===null?-1:y.injectorIndex}return Ap(g,!0),g}function Qce(i,s,a,u,p){let g=UH(),y=FH(),R=y?g:g&&g.parent,w=i.data[s]=ede(i,R,a,s,u,p);return Zce(i,w,g,y),w}function Zce(i,s,a,u){i.firstChild===null&&(i.firstChild=s),a!==null&&(u?a.child==null&&s.parent!==null&&(a.child=s):a.next===null&&(a.next=s,s.prev=a))}function ede(i,s,a,u,p,g){let y=s?s.injectorIndex:-1,R=0;return bp()&&(R|=128),{type:a,index:u,insertBeforeIndex:null,injectorIndex:y,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:R,providerIndexes:0,value:p,attrs:g,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:s,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var tde=new RegExp(`^(\\d+)*(${CG}|${SG})*(.*)`);function nde(i){let s=i.match(tde),[a,u,p,g]=s,y=u?parseInt(u,10):p,R=[];for(let[w,L,V]of g.matchAll(/(f|n)(\d*)/g)){let q=parseInt(V,10)||1;R.push(L,q)}return[y,...R]}function rde(i){return!i.prev&&i.parent?.type===8}function qR(i){return i.index-Qn}function ide(i,s){let a=i.i18nNodes;if(a)return a.get(s)}function tv(i,s,a,u){let p=qR(u),g=ide(i,p);if(g===void 0){let y=i.data[eae];if(y?.[p])g=sde(y[p],a);else if(s.firstChild===u)g=i.firstChild;else{let R=u.prev===null,w=u.prev??u.parent;if(rde(u)){let L=qR(u.parent);g=yw(i,L)}else{let L=ps(w,a);if(R)g=L.firstChild;else{let V=qR(w),q=yw(i,V);if(w.type===2&&q){let $=lb(i,V)+1;g=nv($,q)}else g=L.nextSibling}}}}return g}function nv(i,s){let a=s;for(let u=0;u<i;u++)a=a.nextSibling;return a}function ode(i,s){let a=i;for(let u=0;u<s.length;u+=2){let p=s[u],g=s[u+1];for(let y=0;y<g;y++)switch(p){case $se:a=a.firstChild;break;case Xse:a=a.nextSibling;break}}return a}function sde(i,s){let[a,...u]=nde(i),p;if(a===SG)p=s[bi][wi];else if(a===CG)p=Gae(s[bi][wi]);else{let g=Number(a);p=Po(s[g+Qn])}return ode(p,u)}var ade=!1;function cde(i){ade=i}function dde(i){let s=i[No];if(s){let{i18nNodes:a,dehydratedIcuData:u}=s;if(a&&u){let p=i[vn];for(let g of u.values())ude(p,a,g)}s.i18nNodes=void 0,s.dehydratedIcuData=void 0}}function ude(i,s,a){for(let u of a.node.cases[a.case]){let p=s.get(u.index-Qn);p&&mb(i,p,!1)}}function g3(i){let s=i[Fs]??[],u=i[lr][vn],p=[];for(let g of s)g.data[tae]!==void 0?p.push(g):E3(g,u);i[Fs]=p}function lde(i){let{lContainer:s}=i,a=s[Fs];if(a===null)return;let p=s[lr][vn];for(let g of a)E3(g,p)}function E3(i,s){let a=0,u=i.firstChild;if(u){let p=i.data[S_];for(;a<p;){let g=u.nextSibling;mb(s,u,!1),u=g,a++}}}function rv(i){g3(i);let s=i[wi];Oo(s)&&R_(s);for(let a=Nr;a<i.length;a++)R_(i[a])}function R_(i){dde(i);let s=i[tt];for(let a=Qn;a<s.bindingStartIndex;a++)if(hs(i[a])){let u=i[a];rv(u)}else Oo(i[a])&&R_(i[a])}function _3(i){let s=i._views;for(let a of s){let u=Pae(a);u!==null&&u[wi]!==null&&(Oo(u)?R_(u):rv(u))}}function hde(i,s,a,u){i!==null&&(a.cleanup(s),rv(i.lContainer),_3(u))}function pde(i,s){let a=[];for(let u of s)for(let p=0;p<(u[IG]??1);p++){let g={data:u,firstChild:null};u[S_]>0&&(g.firstChild=i,i=nv(u[S_],i)),a.push(g)}return[i,a]}var v3=()=>null;function fde(i,s){let a=i[Fs];return!s||a===null||a.length===0?null:a[0].data[Zse]===s?a.shift():(g3(i),null)}function mde(){v3=fde}function w_(i,s){return v3(i,s)}var ww=class{},b_=class{},bw=class{resolveComponentFactory(s){throw Error(`No component factory found for ${Vr(s)}.`)}},el=class{static NULL=new bw},tl=class{},hl=(()=>{class i{destroyNode=null;static __NG_ELEMENT_ID__=()=>gde()}return i})();function gde(){let i=un(),s=Di(),a=us(s.index,i);return(Oo(a)?a:i)[vn]}var Ede=(()=>{class i{static \u0275prov=Ge({token:i,providedIn:"root",factory:()=>null})}return i})();function kB(i,s,a){let u=a?i.styles:null,p=a?i.classes:null,g=0;if(s!==null)for(let y=0;y<s.length;y++){let R=s[y];if(typeof R=="number")g=R;else if(g==1)p=sB(p,R);else if(g==2){let w=R,L=s[++y];u=sB(u,w+": "+L+";")}}a?i.styles=u:i.stylesWithoutHost=u,a?i.classes=p:i.classesWithoutHost=p}function zt(i,s=gt.Default){let a=un();if(a===null)return It(i,s);let u=Di();return rG(u,a,Fr(i),s)}function y3(i,s,a,u,p){let g=u===null?null:{"":-1},y=p(i,a);if(y!==null){let R,w=null,L=null,V=vde(y);V===null?R=y:[R,w,L]=V,Sde(i,s,a,R,g,w,L)}g!==null&&u!==null&&_de(a,u,g)}function _de(i,s,a){let u=i.localNames=[];for(let p=0;p<s.length;p+=2){let g=a[s[p+1]];if(g==null)throw new De(-301,!1);u.push(s[p],g)}}function vde(i){let s=null,a=!1;for(let y=0;y<i.length;y++){let R=i[y];if(y===0&&ds(R)&&(s=R),R.findHostDirectiveDefs!==null){a=!0;break}}if(!a)return null;let u=null,p=null,g=null;for(let y of i)y.findHostDirectiveDefs!==null&&(u??=[],p??=new Map,g??=new Map,yde(y,u,g,p)),y===s&&(u??=[],u.push(y));return u!==null?(u.push(...s===null?i:i.slice(1)),[u,p,g]):null}function yde(i,s,a,u){let p=s.length;i.findHostDirectiveDefs(i,s,u),a.set(i,[p,s.length-1])}function Tde(i,s,a){s.componentOffset=a,(i.components??=[]).push(s.index)}function Sde(i,s,a,u,p,g,y){let R=u.length,w=!1;for(let Z=0;Z<R;Z++){let $=u[Z];!w&&ds($)&&(w=!0,Tde(i,a,Z)),lw(E_(a,s),i,$.type)}Ade(a,i.data.length,R);for(let Z=0;Z<R;Z++){let $=u[Z];$.providersResolver&&$.providersResolver($)}let L=!1,V=!1,q=$G(i,s,R,null);R>0&&(a.directiveToIndex=new Map);for(let Z=0;Z<R;Z++){let $=u[Z];if(a.mergedAttrs=Ep(a.mergedAttrs,$.hostAttrs),Ide(i,a,s,q,$),bde(q,$,p),y!==null&&y.has($)){let[Ie,ct]=y.get($);a.directiveToIndex.set($.type,[q,Ie+a.directiveStart,ct+a.directiveStart])}else(g===null||!g.has($))&&a.directiveToIndex.set($.type,q);$.contentQueries!==null&&(a.flags|=4),($.hostBindings!==null||$.hostAttrs!==null||$.hostVars!==0)&&(a.flags|=64);let pe=$.type.prototype;!L&&(pe.ngOnChanges||pe.ngOnInit||pe.ngDoCheck)&&((i.preOrderHooks??=[]).push(a.index),L=!0),!V&&(pe.ngOnChanges||pe.ngDoCheck)&&((i.preOrderCheckHooks??=[]).push(a.index),V=!0),q++}Cde(i,a,g)}function Cde(i,s,a){for(let u=s.directiveStart;u<s.directiveEnd;u++){let p=i.data[u];if(a===null||!a.has(p))LB(0,s,p,u),LB(1,s,p,u),UB(s,u,!1);else{let g=a.get(p);xB(0,s,g,u),xB(1,s,g,u),UB(s,u,!0)}}}function LB(i,s,a,u){let p=i===0?a.inputs:a.outputs;for(let g in p)if(p.hasOwnProperty(g)){let y;i===0?y=s.inputs??={}:y=s.outputs??={},y[g]??=[],y[g].push(u),T3(s,g)}}function xB(i,s,a,u){let p=i===0?a.inputs:a.outputs;for(let g in p)if(p.hasOwnProperty(g)){let y=p[g],R;i===0?R=s.hostDirectiveInputs??={}:R=s.hostDirectiveOutputs??={},R[y]??=[],R[y].push(u,g),T3(s,y)}}function T3(i,s){s==="class"?i.flags|=8:s==="style"&&(i.flags|=16)}function UB(i,s,a){let{attrs:u,inputs:p,hostDirectiveInputs:g}=i;if(u===null||!a&&p===null||a&&g===null||pb(i)){i.initialInputs??=[],i.initialInputs.push(null);return}let y=null,R=0;for(;R<u.length;){let w=u[R];if(w===0){R+=4;continue}else if(w===5){R+=2;continue}else if(typeof w=="number")break;if(!a&&p.hasOwnProperty(w)){let L=p[w];for(let V of L)if(V===s){y??=[],y.push(w,u[R+1]);break}}else if(a&&g.hasOwnProperty(w)){let L=g[w];for(let V=0;V<L.length;V+=2)if(L[V]===s){y??=[],y.push(L[V+1],u[R+1]);break}}R+=2}i.initialInputs??=[],i.initialInputs.push(y)}function Ide(i,s,a,u,p){i.data[u]=p;let g=p.factory||(p.factory=Yu(p.type,!0)),y=new Gc(g,ds(p),zt);i.blueprint[u]=y,a[u]=y,Rde(i,s,u,$G(i,a,p.hostVars,ul),p)}function Rde(i,s,a,u,p){let g=p.hostBindings;if(g){let y=i.hostBindingOpCodes;y===null&&(y=i.hostBindingOpCodes=[]);let R=~s.index;wde(y)!=R&&y.push(R),y.push(a,u,g)}}function wde(i){let s=i.length;for(;s>0;){let a=i[--s];if(typeof a=="number"&&a<0)return a}return 0}function bde(i,s,a){if(a){if(s.exportAs)for(let u=0;u<s.exportAs.length;u++)a[s.exportAs[u]]=i;ds(s)&&(a[""]=i)}}function Ade(i,s,a){i.flags|=1,i.directiveStart=s,i.directiveEnd=s+a,i.providerIndexes=s}function S3(i,s,a,u,p,g,y,R){let w=s.consts,L=Qu(w,y),V=bb(s,i,2,u,L);return g&&y3(s,a,V,Qu(w,R),p),V.mergedAttrs=Ep(V.mergedAttrs,V.attrs),V.attrs!==null&&kB(V,V.attrs,!1),V.mergedAttrs!==null&&kB(V,V.mergedAttrs,!0),s.queries!==null&&s.queries.elementStart(s,V),V}function C3(i,s){$H(i,s),wH(s)&&i.queries.elementEnd(s)}var A_=class extends el{ngModule;constructor(s){super(),this.ngModule=s}resolveComponentFactory(s){let a=La(s);return new yp(a,this.ngModule)}};function Dde(i){return Object.keys(i).map(s=>{let[a,u,p]=i[s],g={propName:a,templateName:s,isSignal:(u&Y_.SignalBased)!==0};return p&&(g.transform=p),g})}function Ode(i){return Object.keys(i).map(s=>({propName:i[s],templateName:s}))}function Nde(i,s,a){let u=s instanceof Ri?s:s?.injector;return u&&i.getStandaloneInjector!==null&&(u=i.getStandaloneInjector(u)||u),u?new qu(a,u):a}function Pde(i){let s=i.get(tl,null);if(s===null)throw new De(407,!1);let a=i.get(Ede,null),u=i.get(Zu,null);return{rendererFactory:s,sanitizer:a,changeDetectionScheduler:u}}function Mde(i,s){let a=(i.selectors[0][0]||"div").toLowerCase();return fb(s,a,a==="svg"?Voe:a==="math"?joe:null)}var yp=class extends b_{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;get inputs(){return Dde(this.componentDef.inputs)}get outputs(){return Ode(this.componentDef.outputs)}constructor(s,a){super(),this.componentDef=s,this.ngModule=a,this.componentType=s.type,this.selector=Zae(s.selectors),this.ngContentSelectors=s.ngContentSelectors??[],this.isBoundToModule=!!a}create(s,a,u,p){qt(22);let g=St(null);try{let y=this.componentDef,R=u?["ng-version","19.2.0"]:ece(this.componentDef.selectors[0]),w=gb(0,null,null,1,0,null,null,null,null,[R],null),L=Nde(y,p||this.ngModule,s),V=Pde(L),q=V.rendererFactory.createRenderer(null,y),Z=u?ace(q,u,y.encapsulation,L):Mde(y,q),$=Eb(null,w,null,512|YG(y),null,null,V,q,L,null,UG(Z,L,!0));$[Qn]=Z,eb($);let pe=null;try{let Ie=S3(Qn,w,$,"#host",()=>[this.componentDef],!0,0);Z&&(zG(q,Z,Ie),Np(Z,$)),vb(w,$,Ie),jG(w,Ie,$),C3(w,Ie),a!==void 0&&kde(Ie,this.ngContentSelectors,a),pe=us(Ie.index,$),$[ur]=pe[ur],Tb(w,$,null)}catch(Ie){throw pe!==null&&Ew(pe),Ew($),Ie}finally{qt(23),tb()}return new Aw(this.componentType,$)}finally{St(g)}}},Aw=class extends ww{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(s,a){super(),this._rootLView=a,this._tNode=Rp(a[tt],Qn),this.location=H_(this._tNode,a),this.instance=us(this._tNode.index,a)[ur],this.hostView=this.changeDetectorRef=new Kc(a,void 0,!1),this.componentType=s}setInput(s,a){let u=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(s)&&Object.is(this.previousInputValues.get(s),a))return;let p=this._rootLView,g=yb(u,p[tt],p,s,a);this.previousInputValues.set(s,a);let y=us(u.index,p);Z_(y,1)}get injector(){return new Vc(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(s){this.hostView.onDestroy(s)}};function kde(i,s,a){let u=i.projection=[];for(let p=0;p<s.length;p++){let g=a[p];u.push(g!=null&&g.length?Array.from(g):null)}}var kp=(()=>{class i{static __NG_ELEMENT_ID__=Lde}return i})();function Lde(){let i=Di();return Ude(i,un())}var xde=kp,I3=class extends xde{_lContainer;_hostTNode;_hostLView;constructor(s,a,u){super(),this._lContainer=s,this._hostTNode=a,this._hostLView=u}get element(){return H_(this._hostTNode,this._hostLView)}get injector(){return new Vc(this._hostTNode,this._hostLView)}get parentInjector(){let s=rb(this._hostTNode,this._hostLView);if(JH(s)){let a=g_(s,this._hostLView),u=m_(s),p=a[tt].data[u+8];return new Vc(p,a)}else return new Vc(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(s){let a=FB(this._lContainer);return a!==null&&a[s]||null}get length(){return this._lContainer.length-Nr}createEmbeddedView(s,a,u){let p,g;typeof u=="number"?p=u:u!=null&&(p=u.index,g=u.injector);let y=w_(this._lContainer,s.ssrId),R=s.createEmbeddedViewImpl(a||{},g,y);return this.insertImpl(R,p,_p(this._hostTNode,y)),R}createComponent(s,a,u,p,g){let y=s&&!Loe(s),R;if(y)R=a;else{let pe=a||{};R=pe.index,u=pe.injector,p=pe.projectableNodes,g=pe.environmentInjector||pe.ngModuleRef}let w=y?s:new yp(La(s)),L=u||this.parentInjector;if(!g&&w.ngModule==null){let Ie=(y?L:this.parentInjector).get(Ri,null);Ie&&(g=Ie)}let V=La(w.componentType??{}),q=w_(this._lContainer,V?.id??null),Z=q?.firstChild??null,$=w.create(L,p,Z,g);return this.insertImpl($.hostView,R,_p(this._hostTNode,q)),$}insert(s,a){return this.insertImpl(s,a,!0)}insertImpl(s,a,u){let p=s._lView;if(Hoe(p)){let R=this.indexOf(s);if(R!==-1)this.detach(R);else{let w=p[lr],L=new I3(w,w[Mo],w[lr]);L.detach(L.indexOf(s))}}let g=this._adjustIndex(a),y=this._lContainer;return ev(y,p,g,u),s.attachToViewContainerRef(),fH(zR(y),g,s),s}move(s,a){return this.insert(s,a)}indexOf(s){let a=FB(this._lContainer);return a!==null?a.indexOf(s):-1}remove(s){let a=this._adjustIndex(s,-1),u=vp(this._lContainer,a);u&&(d_(zR(this._lContainer),a),J_(u[tt],u))}detach(s){let a=this._adjustIndex(s,-1),u=vp(this._lContainer,a);return u&&d_(zR(this._lContainer),a)!=null?new Kc(u):null}_adjustIndex(s,a=0){return s??this.length+a}};function FB(i){return i[p_]}function zR(i){return i[p_]||(i[p_]=[])}function Ude(i,s){let a,u=s[i.index];return hs(u)?a=u:(a=h3(u,s,null,i),s[i.index]=a,_b(s,a)),R3(a,s,i,u),new I3(a,i,s)}function Fde(i,s){let a=i[vn],u=a.createComment(""),p=ps(s,i),g=a.parentNode(p);return C_(a,g,u,a.nextSibling(p),!1),u}var R3=w3,Ab=()=>!1;function Vde(i,s,a){return Ab(i,s,a)}function w3(i,s,a,u){if(i[Vs])return;let p;a.type&8?p=Po(u):p=Fde(s,a),i[Vs]=p}function jde(i,s,a){if(i[Vs]&&i[Fs])return!0;let u=a[No],p=s.index-Qn;if(!u||Hse(s)||Mp(u,p))return!1;let y=yw(u,p),R=u.data[cb]?.[p],[w,L]=pde(y,R);return i[Vs]=w,i[Fs]=L,!0}function Bde(i,s,a,u){Ab(i,a,s)||w3(i,s,a,u)}function Hde(){R3=Bde,Ab=jde}var Fa=class{},Tp=class{};var Dw=class extends Fa{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new A_(this);constructor(s,a,u,p=!0){super(),this.ngModuleType=s,this._parent=a;let g=EH(s);this._bootstrapComponents=BG(g.bootstrap),this._r3Injector=sG(s,a,[{provide:Fa,useValue:this},{provide:el,useValue:this.componentFactoryResolver},...u],Vr(s),new Set(["environment"])),p&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let s=this._r3Injector;!s.destroyed&&s.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(s){this.destroyCbs.push(s)}},Ow=class extends Tp{moduleType;constructor(s){super(),this.moduleType=s}create(s){return new Dw(this.moduleType,s,[])}};var D_=class extends Fa{injector;componentFactoryResolver=new A_(this);instance=null;constructor(s){super();let a=new fp([...s.providers,{provide:Fa,useValue:this},{provide:el,useValue:this.componentFactoryResolver}],s.parent||Xw(),s.debugName,new Set(["environment"]));this.injector=a,s.runEnvironmentInitializers&&a.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(s){this.injector.onDestroy(s)}};function iv(i,s,a=null){return new D_({providers:i,parent:s,debugName:a,runEnvironmentInitializers:!0}).injector}var Gde=(()=>{class i{_injector;cachedInjectors=new Map;constructor(a){this._injector=a}getOrCreateStandaloneInjector(a){if(!a.standalone)return null;if(!this.cachedInjectors.has(a)){let u=Yw(!1,a.type),p=u.length>0?iv([u],this._injector,`Standalone[${a.type.name}]`):null;this.cachedInjectors.set(a,p)}return this.cachedInjectors.get(a)}ngOnDestroy(){try{for(let a of this.cachedInjectors.values())a!==null&&a.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Ge({token:i,providedIn:"environment",factory:()=>new i(It(Ri))})}return i})();function si(i){return k_(()=>{let s=b3(i),a=At(Se({},s),{decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===gG.OnPush,directiveDefs:null,pipeDefs:null,dependencies:s.standalone&&i.dependencies||null,getStandaloneInjector:s.standalone?p=>p.get(Gde).getOrCreateStandaloneInjector(a):null,getExternalStyles:null,signals:i.signals??!1,data:i.data||{},encapsulation:i.encapsulation||ls.Emulated,styles:i.styles||no,_:null,schemas:i.schemas||null,tView:null,id:""});s.standalone&&Gs("NgStandalone"),A3(a);let u=i.dependencies;return a.directiveDefs=VB(u,!1),a.pipeDefs=VB(u,!0),a.id=Yde(a),a})}function Wde(i){return La(i)||qw(i)}function Kde(i){return i!==null}function pl(i){return k_(()=>({type:i.type,bootstrap:i.bootstrap||no,declarations:i.declarations||no,imports:i.imports||no,exports:i.exports||no,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function qde(i,s){if(i==null)return jc;let a={};for(let u in i)if(i.hasOwnProperty(u)){let p=i[u],g,y,R,w;Array.isArray(p)?(R=p[0],g=p[1],y=p[2]??g,w=p[3]||null):(g=p,y=p,R=Y_.None,w=null),a[g]=[u,R,w],s[g]=y}return a}function zde(i){if(i==null)return jc;let s={};for(let a in i)i.hasOwnProperty(a)&&(s[i[a]]=a);return s}function Oi(i){return k_(()=>{let s=b3(i);return A3(s),s})}function b3(i){let s={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:s,inputConfig:i.inputs||jc,exportAs:i.exportAs||null,standalone:i.standalone??!0,signals:i.signals===!0,selectors:i.selectors||no,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:qde(i.inputs,s),outputs:zde(i.outputs),debugInfo:null}}function A3(i){i.features?.forEach(s=>s(i))}function VB(i,s){if(!i)return null;let a=s?zw:Wde;return()=>(typeof i=="function"?i():i).map(u=>a(u)).filter(Kde)}function Yde(i){let s=0,a=typeof i.consts=="function"?"":i.consts,u=[i.selectors,i.ngContentSelectors,i.hostVars,i.hostAttrs,a,i.vars,i.decls,i.encapsulation,i.standalone,i.signals,i.exportAs,JSON.stringify(i.inputs),JSON.stringify(i.outputs),Object.getOwnPropertyNames(i.type.prototype),!!i.contentQueries,!!i.viewQuery];for(let g of u.join("|"))s=Math.imul(31,s)+g.charCodeAt(0)<<0;return s+=2147483648,"c"+s}function $de(i){return Object.getPrototypeOf(i.prototype).constructor}function ja(i){let s=$de(i.type),a=!0,u=[i];for(;s;){let p;if(ds(i))p=s.\u0275cmp||s.\u0275dir;else{if(s.\u0275cmp)throw new De(903,!1);p=s.\u0275dir}if(p){if(a){u.push(p);let y=i;y.inputs=YR(i.inputs),y.declaredInputs=YR(i.declaredInputs),y.outputs=YR(i.outputs);let R=p.hostBindings;R&&eue(i,R);let w=p.viewQuery,L=p.contentQueries;if(w&&Qde(i,w),L&&Zde(i,L),Xde(i,p),toe(i.outputs,p.outputs),ds(p)&&p.data.animation){let V=i.data;V.animation=(V.animation||[]).concat(p.data.animation)}}let g=p.features;if(g)for(let y=0;y<g.length;y++){let R=g[y];R&&R.ngInherit&&R(i),R===ja&&(a=!1)}}s=Object.getPrototypeOf(s)}Jde(u)}function Xde(i,s){for(let a in s.inputs){if(!s.inputs.hasOwnProperty(a)||i.inputs.hasOwnProperty(a))continue;let u=s.inputs[a];u!==void 0&&(i.inputs[a]=u,i.declaredInputs[a]=s.declaredInputs[a])}}function Jde(i){let s=0,a=null;for(let u=i.length-1;u>=0;u--){let p=i[u];p.hostVars=s+=p.hostVars,p.hostAttrs=Ep(p.hostAttrs,a=Ep(a,p.hostAttrs))}}function YR(i){return i===jc?{}:i===no?[]:i}function Qde(i,s){let a=i.viewQuery;a?i.viewQuery=(u,p)=>{s(u,p),a(u,p)}:i.viewQuery=s}function Zde(i,s){let a=i.contentQueries;a?i.contentQueries=(u,p,g)=>{s(u,p,g),a(u,p,g)}:i.contentQueries=s}function eue(i,s){let a=i.hostBindings;a?i.hostBindings=(u,p)=>{s(u,p),a(u,p)}:i.hostBindings=s}function Lp(i,s,a){let u=i[s];return Object.is(u,a)?!1:(i[s]=a,!0)}function tue(i,s,a,u,p,g,y,R,w){let L=s.consts,V=bb(s,i,4,y||null,R||null);kH()&&y3(s,a,V,Qu(L,w),t3),V.mergedAttrs=Ep(V.mergedAttrs,V.attrs),$H(s,V);let q=V.tView=gb(2,V,u,p,g,s.directiveRegistry,s.pipeRegistry,null,s.schemas,L,null);return s.queries!==null&&(s.queries.template(s,V),q.queries=s.queries.embeddedTView(V)),V}function Nw(i,s,a,u,p,g,y,R,w,L){let V=a+Qn,q=s.firstCreatePass?tue(V,s,i,u,p,g,y,R,w):s.data[V];Ap(q,!1);let Z=D3(s,i,q,a);nb()&&Ib(s,i,Z,q),Np(Z,i);let $=h3(Z,i,Z,q);return i[V]=$,_b(i,$),Vde($,q,i),Jw(q)&&vb(s,i,q),w!=null&&QG(i,q,L),q}function ov(i,s,a,u,p,g,y,R){let w=un(),L=Ai(),V=Qu(L.consts,g);return Nw(w,L,i,s,a,u,p,V,y,R),ov}var D3=O3;function O3(i,s,a,u){return Va(!0),s[vn].createComment("")}function nue(i,s,a,u){let p=s[No],g=!p||bp()||ll(a)||Mp(p,u);if(Va(g),g)return O3(i,s,a,u);let y=p.data[Qse]?.[u]??null;y!==null&&a.tView!==null&&a.tView.ssrId===null&&(a.tView.ssrId=y);let R=tv(p,i,s,a);z_(p,u,R);let w=lb(p,u);return nv(w,R)}function rue(){D3=nue}var iue=(()=>{class i{cachedInjectors=new Map;getOrCreateInjector(a,u,p,g){if(!this.cachedInjectors.has(a)){let y=p.length>0?iv(p,u,g):null;this.cachedInjectors.set(a,y)}return this.cachedInjectors.get(a)}ngOnDestroy(){try{for(let a of this.cachedInjectors.values())a!==null&&a.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Ge({token:i,providedIn:"environment",factory:()=>new i})}return i})();var oue=new be("");function $R(i,s,a){return i.get(iue).getOrCreateInjector(s,i,a,"")}function sue(i,s,a){if(i instanceof qu){let p=i.injector,g=i.parentInjector,y=$R(g,s,a);return new qu(p,y)}let u=i.get(Ri);if(u!==i){let p=$R(u,s,a);return new qu(i,p)}return $R(i,s,a)}function Hu(i,s,a,u=!1){let p=a[lr],g=p[tt];if(sl(p))return;let y=Pp(p,s),R=y[W_],w=y[mae];if(!(w!==null&&i<w)&&jB(R,i)&&jB(y[hae]??-1,i)){let L=K_(g,s),q=!u&&!0&&(yae(L)!==null||DB(L,Xn.Loading)!==null||DB(L,Xn.Placeholder))?due:cue;try{q(i,y,a,s,p)}catch(Z){$_(p,Z)}}}function aue(i,s){let a=i[Fs]?.findIndex(p=>p.data[nae]===s[W_])??-1;return{dehydratedView:a>-1?i[Fs][a]:null,dehydratedViewIx:a}}function cue(i,s,a,u,p){qt(20);let g=vae(i,p,u);if(g!==null){s[W_]=i;let y=p[tt],R=g+Qn,w=Rp(y,R),L=0;p3(a,L);let V;if(i===Xn.Complete){let pe=K_(y,u),Ie=pe.providers;Ie&&Ie.length>0&&(V=sue(p[xa],pe,Ie))}let{dehydratedView:q,dehydratedViewIx:Z}=aue(a,s),$=X_(p,w,null,{injector:V,dehydratedView:q});if(ev(a,$,L,_p(w,q)),Z_($,2),Z>-1&&a[Fs]?.splice(Z,1),(i===Xn.Complete||i===Xn.Error)&&Array.isArray(s[zu])){for(let pe of s[zu])pe();s[zu]=null}}qt(21)}function jB(i,s){return i<s}function BB(i,s,a){i.loadingPromise.then(()=>{i.loadingState===Ci.COMPLETE?Hu(Xn.Complete,s,a):i.loadingState===Ci.FAILED&&Hu(Xn.Error,s,a)})}var due=null;var Db=(()=>{class i{log(a){console.log(a)}warn(a){console.warn(a)}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"platform"})}return i})();var N3=new be("");var uue=(()=>{class i{static \u0275prov=Ge({token:i,providedIn:"root",factory:()=>new Pw})}return i})(),Pw=class{queuedEffectCount=0;queues=new Map;schedule(s){this.enqueue(s)}remove(s){let a=s.zone,u=this.queues.get(a);u.has(s)&&(u.delete(s),this.queuedEffectCount--)}enqueue(s){let a=s.zone;this.queues.has(a)||this.queues.set(a,new Set);let u=this.queues.get(a);u.has(s)||(this.queuedEffectCount++,u.add(s))}flush(){for(;this.queuedEffectCount>0;)for(let[s,a]of this.queues)s===null?this.flushQueue(a):s.run(()=>this.flushQueue(a))}flushQueue(s){for(let a of s)s.delete(a),this.queuedEffectCount--,a.run()}};function Qc(i){return!!i&&typeof i.then=="function"}function P3(i){return!!i&&typeof i.subscribe=="function"}var M3=new be("");var k3=(()=>{class i{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((a,u)=>{this.resolve=a,this.reject=u});appInits=fe(M3,{optional:!0})??[];injector=fe(jr);constructor(){}runInitializers(){if(this.initialized)return;let a=[];for(let p of this.appInits){let g=ro(this.injector,p);if(Qc(g))a.push(g);else if(P3(g)){let y=new Promise((R,w)=>{g.subscribe({complete:R,error:w})});a.push(y)}}let u=()=>{this.done=!0,this.resolve()};Promise.all(a).then(()=>{u()}).catch(p=>{this.reject(p)}),a.length===0&&u(),this.initialized=!0}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Zc=new be("");function lue(){mj(()=>{throw new De(600,!1)})}function hue(i){return i.isBoundToModule}var pue=10;var oi=(()=>{class i{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=fe(Lse);afterRenderManager=fe(OG);zonelessEnabled=fe(B_);rootEffectScheduler=fe(uue);dirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new cr;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=fe(Hs).hasPendingTasks.pipe(yt(a=>!a));constructor(){fe(dl,{optional:!0})}whenStable(){let a;return new Promise(u=>{a=this.isStable.subscribe({next:p=>{p&&u()}})}).finally(()=>{a.unsubscribe()})}_injector=fe(Ri);_rendererFactory=null;get injector(){return this._injector}bootstrap(a,u){qt(10);let p=a instanceof b_;if(!this._injector.get(k3).done){let Z=!p&&_H(a),$=!1;throw new De(405,$)}let y;p?y=a:y=this._injector.get(el).resolveComponentFactory(a),this.componentTypes.push(y.componentType);let R=hue(y)?void 0:this._injector.get(Fa),w=u||y.selector,L=y.create(jr.NULL,[],w,R),V=L.location.nativeElement,q=L.injector.get(N3,null);return q?.registerApplication(V),L.onDestroy(()=>{this.detachView(L.hostView),i_(this.components,L),q?.unregisterApplication(V)}),this._loadComponent(L),qt(11,L),L}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){qt(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(db.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new De(101,!1);let a=St(null);try{this._runningTick=!0,this.synchronize()}catch(u){this.internalErrorHandler(u)}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,St(a),this.afterTick.next(),qt(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(tl,null,{optional:!0}));let a=0;for(;this.dirtyFlags!==0&&a++<pue;)qt(14),this.synchronizeOnce(),qt(15)}synchronizeOnce(){if(this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let a=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:u,notifyErrorHandler:p}of this.allViews)fue(u,p,a,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:a})=>V_(a))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(a){let u=a;this._views.push(u),u.attachToAppRef(this)}detachView(a){let u=a;i_(this._views,u),u.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a),this._injector.get(Zc,[]).forEach(p=>p(a))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(a=>a()),this._views.slice().forEach(a=>a.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(a){return this._destroyListeners.push(a),()=>i_(this._destroyListeners,a)}destroy(){if(this._destroyed)throw new De(406,!1);let a=this._injector;a.destroy&&!a.destroyed&&a.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function i_(i,s){let a=i.indexOf(s);a>-1&&i.splice(a,1)}function fue(i,s,a,u){if(!a&&!V_(i))return;c3(i,s,a&&!u?0:1)}function mue(i,s,a){let u=s[xa],p=s[tt];if(i.loadingState!==Ci.NOT_STARTED)return i.loadingPromise??Promise.resolve();let g=Pp(s,a),y=Tae(p,i);i.loadingState=Ci.IN_PROGRESS,r_(1,g);let R=i.dependencyResolverFn,w=u.get(Hs),L=w.add();return R?(i.loadingPromise=Promise.allSettled(R()).then(V=>{let q=!1,Z=[],$=[];for(let pe of V)if(pe.status==="fulfilled"){let Ie=pe.value,ct=La(Ie)||qw(Ie);if(ct)Z.push(ct);else{let We=zw(Ie);We&&$.push(We)}}else{q=!0;break}if(i.loadingPromise=null,w.remove(L),q){if(i.loadingState=Ci.FAILED,i.errorTmplIndex===null){let pe="",Ie=new De(-750,!1);$_(s,Ie)}}else{i.loadingState=Ci.COMPLETE;let pe=y.tView;if(Z.length>0){pe.directiveRegistry=OB(pe.directiveRegistry,Z);let Ie=Z.map(We=>We.type),ct=Yw(!1,...Ie);i.providers=ct}$.length>0&&(pe.pipeRegistry=OB(pe.pipeRegistry,$))}}),i.loadingPromise):(i.loadingPromise=Promise.resolve().then(()=>{i.loadingPromise=null,i.loadingState=Ci.COMPLETE,w.remove(L)}),i.loadingPromise)}function gue(i,s){return s[xa].get(oue,null,{optional:!0})?.behavior!==NG.Manual}function Eue(i,s,a){let u=s[tt],p=s[a.index];if(!gue(i,s))return;let g=Pp(s,a),y=K_(u,a);switch(Eae(g),y.loadingState){case Ci.NOT_STARTED:Hu(Xn.Loading,a,p),mue(y,s,a),y.loadingState===Ci.IN_PROGRESS&&BB(y,a,p);break;case Ci.IN_PROGRESS:Hu(Xn.Loading,a,p),BB(y,a,p);break;case Ci.COMPLETE:Hu(Xn.Complete,a,p);break;case Ci.FAILED:Hu(Xn.Error,a,p);break;default:}}function _ue(i,s,a){return P(this,null,function*(){let u=i.get(kG),p=u.hydrating;if(p.has(s))return;let{parentBlockPromise:g,hydrationQueue:y}=Fae(s,i);Tue(u,y);let R=i.get(Hs),w=R.add();g!==null&&(yield g);for(let L=0;L<y.length;L++){let V=y[L],q=u.get(V);if(q!=null){if(yield Cue(q),yield Sue(i),vue(q)){lde(q),HB(y.slice(L),u);break}p.get(V).resolve()}else{yue(L,y,u),HB(y.slice(L),u);break}}yield p.get(s)?.promise,R.remove(w),a&&a(y),hde(u.get(s),y,u,i.get(oi))})}function vue(i){return Pp(i.lView,i.tNode)[W_]===Xn.Error}function yue(i,s,a){let u=i-1,p=u>-1?a.get(s[u]):null;p&&rv(p.lContainer)}function HB(i,s){let a=s.hydrating;for(let u in i)a.get(u)?.reject();s.cleanup(i)}function Tue(i,s){for(let a of s)i.hydrating.set(a,Promise.withResolvers())}function Sue(i){return new Promise(s=>ub(s,{injector:i}))}function Cue(i){return P(this,null,function*(){let{tNode:s,lView:a}=i,u=Pp(a,s);return new Promise(p=>{Iue(u,p),Eue(2,a,s)})})}function Iue(i,s){Array.isArray(i[zu])||(i[zu]=[]),i[zu].push(s)}function Rue(i,s,a,u){return Lp(i,j_(),a)?s+lH(a)+u:ul}function QE(i,s){return i<<17|s<<2}function qc(i){return i>>17&32767}function wue(i){return(i&2)==2}function bue(i,s){return i&131071|s<<17}function Mw(i){return i|2}function nl(i){return(i&131068)>>2}function XR(i,s){return i&-131069|s<<2}function Aue(i){return(i&1)===1}function kw(i){return i|1}function Due(i,s,a,u,p,g){let y=g?s.classBindings:s.styleBindings,R=qc(y),w=nl(y);i[u]=a;let L=!1,V;if(Array.isArray(a)){let q=a;V=q[1],(V===null||Cp(q,V)>0)&&(L=!0)}else V=a;if(p)if(w!==0){let Z=qc(i[R+1]);i[u+1]=QE(Z,R),Z!==0&&(i[Z+1]=XR(i[Z+1],u)),i[R+1]=bue(i[R+1],u)}else i[u+1]=QE(R,0),R!==0&&(i[R+1]=XR(i[R+1],u)),R=u;else i[u+1]=QE(w,0),R===0?R=u:i[w+1]=XR(i[w+1],u),w=u;L&&(i[u+1]=Mw(i[u+1])),GB(i,V,u,!0),GB(i,V,u,!1),Oue(s,V,i,u,g),y=QE(R,w),g?s.classBindings=y:s.styleBindings=y}function Oue(i,s,a,u,p){let g=p?i.residualClasses:i.residualStyles;g!=null&&typeof s=="string"&&Cp(g,s)>=0&&(a[u+1]=kw(a[u+1]))}function GB(i,s,a,u){let p=i[a+1],g=s===null,y=u?qc(p):nl(p),R=!1;for(;y!==0&&(R===!1||g);){let w=i[y],L=i[y+1];Nue(w,s)&&(R=!0,i[y+1]=u?kw(L):Mw(L)),y=u?qc(L):nl(L)}R&&(i[a+1]=u?Mw(p):kw(p))}function Nue(i,s){return i===null||s==null||(Array.isArray(i)?i[1]:i)===s?!0:Array.isArray(i)&&typeof s=="string"?Cp(i,s)>=0:!1}function Ba(i,s,a){let u=un(),p=j_();if(Lp(u,p,s)){let g=Ai(),y=qH();e3(g,y,u,i,s,u[vn],a,!1)}return Ba}function WB(i,s,a,u,p){yb(s,i,a,p?"class":"style",u)}function sv(i,s){return Pue(i,s,null,!0),sv}function Pue(i,s,a,u){let p=un(),g=Ai(),y=rse(2);if(g.firstUpdatePass&&kue(g,i,y,u),s!==ul&&Lp(p,y,s)){let R=g.data[$c()];Vue(g,R,p,p[vn],i,p[y+1]=jue(s,a),u,y)}}function Mue(i,s){return s>=i.expandoStartIndex}function kue(i,s,a,u){let p=i.data;if(p[a+1]===null){let g=p[$c()],y=Mue(i,a);Bue(g,u)&&s===null&&!y&&(s=!1),s=Lue(p,g,s,u),Due(p,g,s,a,y,u)}}function Lue(i,s,a,u){let p=ase(i),g=u?s.residualClasses:s.residualStyles;if(p===null)(u?s.classBindings:s.styleBindings)===0&&(a=JR(null,i,s,a,u),a=Sp(a,s.attrs,u),g=null);else{let y=s.directiveStylingLast;if(y===-1||i[y]!==p)if(a=JR(p,i,s,a,u),g===null){let w=xue(i,s,u);w!==void 0&&Array.isArray(w)&&(w=JR(null,i,s,w[1],u),w=Sp(w,s.attrs,u),Uue(i,s,u,w))}else g=Fue(i,s,u)}return g!==void 0&&(u?s.residualClasses=g:s.residualStyles=g),a}function xue(i,s,a){let u=a?s.classBindings:s.styleBindings;if(nl(u)!==0)return i[qc(u)]}function Uue(i,s,a,u){let p=a?s.classBindings:s.styleBindings;i[qc(p)]=u}function Fue(i,s,a){let u,p=s.directiveEnd;for(let g=1+s.directiveStylingLast;g<p;g++){let y=i[g].hostAttrs;u=Sp(u,y,a)}return Sp(u,s.attrs,a)}function JR(i,s,a,u,p){let g=null,y=a.directiveEnd,R=a.directiveStylingLast;for(R===-1?R=a.directiveStart:R++;R<y&&(g=s[R],u=Sp(u,g.hostAttrs,p),g!==i);)R++;return i!==null&&(a.directiveStylingLast=R),u}function Sp(i,s,a){let u=a?1:2,p=-1;if(s!==null)for(let g=0;g<s.length;g++){let y=s[g];typeof y=="number"?p=y:p===u&&(Array.isArray(i)||(i=i===void 0?[]:["",i]),Soe(i,y,a?!0:s[++g]))}return i===void 0?null:i}function Vue(i,s,a,u,p,g,y,R){if(!(s.type&3))return;let w=i.data,L=w[R+1],V=Aue(L)?KB(w,s,a,p,nl(L),y):void 0;if(!O_(V)){O_(g)||wue(L)&&(g=KB(w,null,a,p,R,y));let q=NH($c(),a);Mce(u,y,q,p,g)}}function KB(i,s,a,u,p,g){let y=s===null,R;for(;p>0;){let w=i[p],L=Array.isArray(w),V=L?w[1]:w,q=V===null,Z=a[p+1];Z===ul&&(Z=q?no:void 0);let $=q?FR(Z,u):V===u?Z:void 0;if(L&&!O_($)&&($=FR(w,u)),O_($)&&(R=$,y))return R;let pe=i[p+1];p=y?qc(pe):nl(pe)}if(s!==null){let w=g?s.residualClasses:s.residualStyles;w!=null&&(R=FR(w,u))}return R}function O_(i){return i!==void 0}function jue(i,s){return i==null||i===""||(typeof s=="string"?i=i+s:typeof i=="object"&&(i=Vr(hb(i)))),i}function Bue(i,s){return(i.flags&(s?8:16))!==0}var Lw=class{destroy(s){}updateValue(s,a){}swap(s,a){let u=Math.min(s,a),p=Math.max(s,a),g=this.detach(p);if(p-u>1){let y=this.detach(u);this.attach(u,g),this.attach(p,y)}else this.attach(u,g)}move(s,a){this.attach(a,this.detach(s))}};function QR(i,s,a,u,p){return i===a&&Object.is(s,u)?1:Object.is(p(i,s),p(a,u))?-1:0}function Hue(i,s,a){let u,p,g=0,y=i.length-1,R=void 0;if(Array.isArray(s)){let w=s.length-1;for(;g<=y&&g<=w;){let L=i.at(g),V=s[g],q=QR(g,L,g,V,a);if(q!==0){q<0&&i.updateValue(g,V),g++;continue}let Z=i.at(y),$=s[w],pe=QR(y,Z,w,$,a);if(pe!==0){pe<0&&i.updateValue(y,$),y--,w--;continue}let Ie=a(g,L),ct=a(y,Z),We=a(g,V);if(Object.is(We,ct)){let er=a(w,$);Object.is(er,Ie)?(i.swap(g,y),i.updateValue(y,$),w--,y--):i.move(y,g),i.updateValue(g,V),g++;continue}if(u??=new N_,p??=zB(i,g,y,a),xw(i,u,g,We))i.updateValue(g,V),g++,y++;else if(p.has(We))u.set(Ie,i.detach(g)),y--;else{let er=i.create(g,s[g]);i.attach(g,er),g++,y++}}for(;g<=w;)qB(i,u,a,g,s[g]),g++}else if(s!=null){let w=s[Symbol.iterator](),L=w.next();for(;!L.done&&g<=y;){let V=i.at(g),q=L.value,Z=QR(g,V,g,q,a);if(Z!==0)Z<0&&i.updateValue(g,q),g++,L=w.next();else{u??=new N_,p??=zB(i,g,y,a);let $=a(g,q);if(xw(i,u,g,$))i.updateValue(g,q),g++,y++,L=w.next();else if(!p.has($))i.attach(g,i.create(g,q)),g++,y++,L=w.next();else{let pe=a(g,V);u.set(pe,i.detach(g)),y--}}}for(;!L.done;)qB(i,u,a,i.length,L.value),L=w.next()}for(;g<=y;)i.destroy(i.detach(y--));u?.forEach(w=>{i.destroy(w)})}function xw(i,s,a,u){return s!==void 0&&s.has(u)?(i.attach(a,s.get(u)),s.delete(u),!0):!1}function qB(i,s,a,u,p){if(xw(i,s,u,a(u,p)))i.updateValue(u,p);else{let g=i.create(u,p);i.attach(u,g)}}function zB(i,s,a,u){let p=new Set;for(let g=s;g<=a;g++)p.add(u(g,i.at(g)));return p}var N_=class{kvMap=new Map;_vMap=void 0;has(s){return this.kvMap.has(s)}delete(s){if(!this.has(s))return!1;let a=this.kvMap.get(s);return this._vMap!==void 0&&this._vMap.has(a)?(this.kvMap.set(s,this._vMap.get(a)),this._vMap.delete(a)):this.kvMap.delete(s),!0}get(s){return this.kvMap.get(s)}set(s,a){if(this.kvMap.has(s)){let u=this.kvMap.get(s);this._vMap===void 0&&(this._vMap=new Map);let p=this._vMap;for(;p.has(u);)u=p.get(u);p.set(u,a)}else this.kvMap.set(s,a)}forEach(s){for(let[a,u]of this.kvMap)if(s(u,a),this._vMap!==void 0){let p=this._vMap;for(;p.has(u);)u=p.get(u),s(u,a)}}};var Uw=class{lContainer;$implicit;$index;constructor(s,a,u){this.lContainer=s,this.$implicit=a,this.$index=u}get $count(){return this.lContainer.length-Nr}};function L3(i,s){return s}var Fw=class{hasEmptyBlock;trackByFn;liveCollection;constructor(s,a,u){this.hasEmptyBlock=s,this.trackByFn=a,this.liveCollection=u}};function x3(i,s,a,u,p,g,y,R,w,L,V,q,Z){Gs("NgControlFlow");let $=un(),pe=Ai(),Ie=w!==void 0,ct=un(),We=R?y.bind(ct[bi][ur]):y,er=new Fw(Ie,We);ct[Qn+i]=er,Nw($,pe,i+1,s,a,u,p,Qu(pe.consts,g)),Ie&&Nw($,pe,i+2,w,L,V,q,Qu(pe.consts,Z))}var Vw=class extends Lw{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(s,a,u){super(),this.lContainer=s,this.hostLView=a,this.templateTNode=u}get length(){return this.lContainer.length-Nr}at(s){return this.getLView(s)[ur].$implicit}attach(s,a){let u=a[No];this.needsIndexUpdate||=s!==this.length,ev(this.lContainer,a,s,_p(this.templateTNode,u))}detach(s){return this.needsIndexUpdate||=s!==this.length-1,Gue(this.lContainer,s)}create(s,a){let u=w_(this.lContainer,this.templateTNode.tView.ssrId),p=X_(this.hostLView,this.templateTNode,new Uw(this.lContainer,a,s),{dehydratedView:u});return this.operationsCounter?.recordCreate(),p}destroy(s){J_(s[tt],s),this.operationsCounter?.recordDestroy()}updateValue(s,a){this.getLView(s)[ur].$implicit=a}reset(){this.needsIndexUpdate=!1,this.operationsCounter?.reset()}updateIndexes(){if(this.needsIndexUpdate)for(let s=0;s<this.length;s++)this.getLView(s)[ur].$index=s}getLView(s){return Wue(this.lContainer,s)}};function U3(i){let s=St(null),a=$c();try{let u=un(),p=u[tt],g=u[a],y=a+1,R=YB(u,y);if(g.liveCollection===void 0){let L=$B(p,y);g.liveCollection=new Vw(R,u,L)}else g.liveCollection.reset();let w=g.liveCollection;if(Hue(w,i,g.trackByFn),w.updateIndexes(),g.hasEmptyBlock){let L=j_(),V=w.length===0;if(Lp(u,L,V)){let q=a+2,Z=YB(u,q);if(V){let $=$B(p,q),pe=w_(Z,$.tView.ssrId),Ie=X_(u,$,void 0,{dehydratedView:pe});ev(Z,Ie,0,_p($,pe))}else p3(Z,0)}}}finally{St(s)}}function YB(i,s){return i[s]}function Gue(i,s){return vp(i,s)}function Wue(i,s){return zce(i,s)}function $B(i,s){return Rp(i,s)}function Un(i,s,a,u){let p=un(),g=Ai(),y=Qn+i,R=p[vn],w=g.firstCreatePass?S3(y,g,p,s,t3,kH(),a,u):g.data[y],L=F3(g,p,w,R,s,i);p[y]=L;let V=Jw(w);return Ap(w,!0),zG(R,L,w),!ll(w)&&nb()&&Ib(g,p,L,w),(zoe()===0||V)&&Np(L,p),Yoe(),V&&(vb(g,p,w),jG(g,w,p)),u!==null&&QG(p,w),Un}function Zn(){let i=Di();FH()?ese():(i=i.parent,Ap(i,!1));let s=i;Xoe(s)&&Qoe(),$oe();let a=Ai();return a.firstCreatePass&&C3(a,s),s.classesWithoutHost!=null&&pse(s)&&WB(a,s,un(),s.classesWithoutHost,!0),s.stylesWithoutHost!=null&&fse(s)&&WB(a,s,un(),s.stylesWithoutHost,!1),Zn}function Br(i,s,a,u){return Un(i,s,a,u),Zn(),Br}var F3=(i,s,a,u,p,g)=>(Va(!0),fb(u,p,zH()));function Kue(i,s,a,u,p,g){let y=s[No],R=!y||bp()||ll(a)||Mp(y,g);if(Va(R),R)return fb(u,p,zH());let w=tv(y,i,s,a);return FG(y,g)&&z_(y,g,w.nextSibling),y&&(fG(a)||mG(w))&&Yc(a)&&(Joe(a),qG(w)),w}function que(){F3=Kue}var zue=(i,s,a,u)=>(Va(!0),WG(s[vn],""));function Yue(i,s,a,u){let p,g=s[No],y=!g||bp()||Mp(g,u)||ll(a);if(Va(y),y)return WG(s[vn],"");let R=tv(g,i,s,a),w=xae(g,u);return z_(g,u,R),p=nv(w,R),p}function $ue(){zue=Yue}function V3(){return un()}var P_="en-US";var Xue=P_;function Jue(i){typeof i=="string"&&(Xue=i.toLowerCase().replace(/_/g,"-"))}var j3=(i,s,a)=>{};function XB(i){j3=i}function ko(i,s,a,u){let p=un(),g=Ai(),y=Di();return B3(g,p,p[vn],y,i,s,u),ko}function Que(i,s,a,u){let p=i.cleanup;if(p!=null)for(let g=0;g<p.length-1;g+=2){let y=p[g];if(y===a&&p[g+1]===u){let R=s[l_],w=p[g+2];return R.length>w?R[w]:null}typeof y=="string"&&(g+=2)}return null}function B3(i,s,a,u,p,g,y){let R=Jw(u),L=i.firstCreatePass?qoe(i):null,V=s[ur],q=Koe(s),Z=!0;if(u.type&3||y){let $=ps(u,s),pe=y?y($):$,Ie=q.length,ct=y?er=>y(Po(er[u.index])):u.index,We=null;if(!y&&R&&(We=Que(i,s,p,u.index)),We!==null){let er=We.__ngLastListenerFn__||We;er.__ngNextListenerFn__=g,We.__ngLastListenerFn__=g,Z=!1}else{g=ZB(u,s,V,g),j3($,p,g);let er=a.listen(pe,p,g);q.push(g,er),L&&L.push(p,ct,Ie,Ie+1)}}else g=ZB(u,s,V,g);if(Z){let $=u.outputs?.[p],pe=u.hostDirectiveOutputs?.[p];if(pe&&pe.length)for(let Ie=0;Ie<pe.length;Ie+=2){let ct=pe[Ie],We=pe[Ie+1];JB(u,i,s,ct,We,p,g,q,L)}if($&&$.length)for(let Ie of $)JB(u,i,s,Ie,p,p,g,q,L)}}function JB(i,s,a,u,p,g,y,R,w){let L=a[u],q=s.data[u].outputs[p],$=L[q].subscribe(y),pe=R.length;R.push(y,$),w&&w.push(g,i.index,pe,-(pe+1))}function QB(i,s,a,u){let p=St(null);try{return qt(6,s,a),a(u)!==!1}catch(g){return $_(i,g),!1}finally{qt(7,s,a),St(p)}}function ZB(i,s,a,u){return function p(g){if(g===Function)return u;let y=Yc(i)?us(i.index,s):s;Z_(y,5);let R=QB(s,a,u,g),w=p.__ngNextListenerFn__;for(;w;)R=QB(s,a,w,g)&&R,w=w.__ngNextListenerFn__;return R}}function Ob(i=1){return dse(i)}function Nb(i){let s=tse();return Boe(s,Qn+i)}function Lo(i,s=""){let a=un(),u=Ai(),p=i+Qn,g=u.firstCreatePass?bb(u,p,1,s,null):u.data[p],y=H3(u,a,g,s,i);a[p]=y,nb()&&Ib(u,a,y,g),Ap(g,!1)}var H3=(i,s,a,u,p)=>(Va(!0),GG(s[vn],u));function Zue(i,s,a,u,p){let g=s[No],y=!g||bp()||ll(a)||Mp(g,p);return Va(y),y?GG(s[vn],u):tv(g,i,s,a)}function ele(){H3=Zue}function xp(i,s,a){let u=un(),p=Rue(u,i,s,a);return p!==ul&&tle(u,$c(),p),xp}function tle(i,s,a){let u=NH(s,i);tce(i[vn],u,a)}function Pb(i,s,a){pG(s)&&(s=s());let u=un(),p=j_();if(Lp(u,p,s)){let g=Ai(),y=qH();e3(g,y,u,i,s,u[vn],a,!1)}return Pb}function G3(i,s){let a=pG(i);return a&&i.set(s),a}function Mb(i,s){let a=un(),u=Ai(),p=Di();return B3(u,a,a[vn],p,i,s),Mb}function nle(i,s,a){let u=Ai();if(u.firstCreatePass){let p=ds(i);jw(a,u.data,u.blueprint,p,!0),jw(s,u.data,u.blueprint,p,!1)}}function jw(i,s,a,u,p){if(i=Fr(i),Array.isArray(i))for(let g=0;g<i.length;g++)jw(i[g],s,a,u,p);else{let g=Ai(),y=un(),R=Di(),w=$u(i)?i:Fr(i.provide),L=TH(i),V=R.providerIndexes&1048575,q=R.directiveStart,Z=R.providerIndexes>>20;if($u(i)||!i.multi){let $=new Gc(L,p,zt),pe=ew(w,s,p?V:V+Z,q);pe===-1?(lw(E_(R,y),g,w),ZR(g,i,s.length),s.push(w),R.directiveStart++,R.directiveEnd++,p&&(R.providerIndexes+=1048576),a.push($),y.push($)):(a[pe]=$,y[pe]=$)}else{let $=ew(w,s,V+Z,q),pe=ew(w,s,V,V+Z),Ie=$>=0&&a[$],ct=pe>=0&&a[pe];if(p&&!ct||!p&&!Ie){lw(E_(R,y),g,w);let We=ole(p?ile:rle,a.length,p,u,L);!p&&ct&&(a[pe].providerFactory=We),ZR(g,i,s.length,0),s.push(w),R.directiveStart++,R.directiveEnd++,p&&(R.providerIndexes+=1048576),a.push(We),y.push(We)}else{let We=W3(a[p?pe:$],L,!p&&u);ZR(g,i,$>-1?$:pe,We)}!p&&u&&ct&&a[pe].componentProviders++}}}function ZR(i,s,a,u){let p=$u(s),g=Aoe(s);if(p||g){let w=(g?Fr(s.useClass):s).prototype.ngOnDestroy;if(w){let L=i.destroyHooks||(i.destroyHooks=[]);if(!p&&s.multi){let V=L.indexOf(a);V===-1?L.push(a,[u,w]):L[V+1].push(u,w)}else L.push(a,w)}}}function W3(i,s,a){return a&&i.componentProviders++,i.multi.push(s)-1}function ew(i,s,a,u){for(let p=a;p<u;p++)if(s[p]===i)return p;return-1}function rle(i,s,a,u){return Bw(this.multi,[])}function ile(i,s,a,u){let p=this.multi,g;if(this.providerFactory){let y=this.providerFactory.componentProviders,R=__(a,a[tt],this.providerFactory.index,u);g=R.slice(0,y),Bw(p,g);for(let w=y;w<R.length;w++)g.push(R[w])}else g=[],Bw(p,g);return g}function Bw(i,s){for(let a=0;a<i.length;a++){let u=i[a];s.push(u())}return s}function ole(i,s,a,u,p){let g=new Gc(i,a,zt);return g.multi=[],g.index=s,g.componentProviders=0,W3(g,p,u&&!a),g}function fl(i,s=[]){return a=>{a.providersResolver=(u,p)=>nle(u,p?p(i):i,s)}}function kb(i,s){return m3(i,s)}var Hw=class{ngModuleFactory;componentFactories;constructor(s,a){this.ngModuleFactory=s,this.componentFactories=a}},Lb=(()=>{class i{compileModuleSync(a){return new Ow(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){let u=this.compileModuleSync(a),p=EH(a),g=BG(p.declarations).reduce((y,R)=>{let w=La(R);return w&&y.push(new yp(w)),y},[]);return new Hw(u,g)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var sle=(()=>{class i{zone=fe(Jn);changeDetectionScheduler=fe(Zu);applicationRef=fe(oi);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),ale=new be("",{factory:()=>!1});function K3({ngZoneFactory:i,ignoreChangesOutsideZone:s,scheduleInRootZone:a}){return i??=()=>new Jn(At(Se({},z3()),{scheduleInRootZone:a})),[{provide:Jn,useFactory:i},{provide:ka,multi:!0,useFactory:()=>{let u=fe(sle,{optional:!0});return()=>u.initialize()}},{provide:ka,multi:!0,useFactory:()=>{let u=fe(cle);return()=>{u.initialize()}}},s===!0?{provide:cG,useValue:!0}:[],{provide:dG,useValue:a??aG}]}function q3(i){let s=i?.ignoreChangesOutsideZone,a=i?.scheduleInRootZone,u=K3({ngZoneFactory:()=>{let p=z3(i);return p.scheduleInRootZone=a,p.shouldCoalesceEventChangeDetection&&Gs("NgZone_CoalesceEvent"),new Jn(p)},ignoreChangesOutsideZone:s,scheduleInRootZone:a});return zc([{provide:ale,useValue:!0},{provide:B_,useValue:!1},u])}function z3(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:i?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:i?.runCoalescing??!1}}var cle=(()=>{class i{subscription=new jn;initialized=!1;zone=fe(Jn);pendingTasks=fe(Hs);initialize(){if(this.initialized)return;this.initialized=!0;let a=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(a=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Jn.assertNotInAngularZone(),queueMicrotask(()=>{a!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(a),a=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Jn.assertInAngularZone(),a??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var dle=(()=>{class i{appRef=fe(oi);taskService=fe(Hs);ngZone=fe(Jn);zonelessEnabled=fe(B_);tracing=fe(dl,{optional:!0});disableScheduling=fe(cG,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new jn;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(y_):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(fe(dG,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof gw||!this.zoneIsDefined)}notify(a){if(!this.zonelessEnabled&&a===5)return;let u=!1;switch(a){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,u=!0;break}case 12:{this.appRef.dirtyFlags|=16,u=!0;break}case 13:{this.appRef.dirtyFlags|=2,u=!0;break}case 11:{u=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(u))return;let p=this.useMicrotaskScheduler?TB:uG;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>p(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>p(()=>this.tick()))}shouldScheduleTick(a){return!(this.disableScheduling&&!a||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(y_+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let a=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(u){throw this.taskService.remove(a),u}finally{this.cleanup()}this.useMicrotaskScheduler=!0,TB(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(a)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let a=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(a)}}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function ule(){return typeof $localize<"u"&&$localize.locale||P_}var xb=new be("",{providedIn:"root",factory:()=>fe(xb,gt.Optional|gt.SkipSelf)||ule()});var Gw=new be(""),lle=new be("");function dp(i){return!i.moduleRef}function hle(i){let s=dp(i)?i.r3Injector:i.moduleRef.injector,a=s.get(Jn);return a.run(()=>{dp(i)?i.r3Injector.resolveInjectorInitializers():i.moduleRef.resolveInjectorInitializers();let u=s.get(js,null),p;if(a.runOutsideAngular(()=>{p=a.onError.subscribe({next:g=>{u.handleError(g)}})}),dp(i)){let g=()=>s.destroy(),y=i.platformInjector.get(Gw);y.add(g),s.onDestroy(()=>{p.unsubscribe(),y.delete(g)})}else{let g=()=>i.moduleRef.destroy(),y=i.platformInjector.get(Gw);y.add(g),i.moduleRef.onDestroy(()=>{i_(i.allPlatformModules,i.moduleRef),p.unsubscribe(),y.delete(g)})}return fle(u,a,()=>{let g=s.get(k3);return g.runInitializers(),g.donePromise.then(()=>{let y=s.get(xb,P_);if(Jue(y||P_),!s.get(lle,!0))return dp(i)?s.get(oi):(i.allPlatformModules.push(i.moduleRef),i.moduleRef);if(dp(i)){let w=s.get(oi);return i.rootComponent!==void 0&&w.bootstrap(i.rootComponent),w}else return ple(i.moduleRef,i.allPlatformModules),i.moduleRef})})})}function ple(i,s){let a=i.injector.get(oi);if(i._bootstrapComponents.length>0)i._bootstrapComponents.forEach(u=>a.bootstrap(u));else if(i.instance.ngDoBootstrap)i.instance.ngDoBootstrap(a);else throw new De(-403,!1);s.push(i)}function fle(i,s,a){try{let u=a();return Qc(u)?u.catch(p=>{throw s.runOutsideAngular(()=>i.handleError(p)),p}):u}catch(u){throw s.runOutsideAngular(()=>i.handleError(u)),u}}var o_=null;function mle(i=[],s){return jr.create({name:s,providers:[{provide:U_,useValue:"platform"},{provide:Gw,useValue:new Set([()=>o_=null])},...i]})}function gle(i=[]){if(o_)return o_;let s=mle(i);return o_=s,lue(),Ele(s),s}function Ele(i){let s=i.get(sb,null);ro(i,()=>{s?.forEach(a=>a())})}var ed=(()=>{class i{static __NG_ELEMENT_ID__=_le}return i})();function _le(i){return vle(Di(),un(),(i&16)===16)}function vle(i,s,a){if(Yc(i)&&!a){let u=us(i.index,s);return new Kc(u,u)}else if(i.type&175){let u=s[bi];return new Kc(u,s)}return null}function Y3(i){qt(8);try{let{rootComponent:s,appProviders:a,platformProviders:u}=i,p=gle(u),g=[K3({}),{provide:Zu,useExisting:dle},...a||[]],y=new D_({providers:g,parent:p,debugName:"",runEnvironmentInitializers:!1});return hle({r3Injector:y.injector,platformInjector:p,rootComponent:s})}catch(s){return Promise.reject(s)}finally{qt(9)}}var ZE=new WeakSet,eH="",s_=[];function tH(i){return i.get(AG,iae)}function $3(){let i=[{provide:AG,useFactory:()=>{let s=!0;{let a=fe(Wc);s=!!window._ejsas?.[a]}return s&&Gs("NgEventReplay"),s}}];return i.push({provide:ka,useValue:()=>{let s=fe(jr),a=s.get(oi);if(!ZE.has(a)){let u=fe(wB);tH(s)&&XB((p,g,y)=>{Sae(p,g,y),Cae(p,u)})}},multi:!0},{provide:Zc,useFactory:()=>{let s=fe(Wc),a=fe(jr),u=fe(oi);return()=>{!tH(a)||ZE.has(u)||(ZE.add(u),u.onDestroy(()=>{ZE.delete(u),UR(s),XB(()=>{})}),u.whenStable().then(()=>{let p=a.get(Rae);yle(p,a);let g=a.get(wB);g.get(eH)?.forEach(Iae),g.delete(eH);let y=p.instance;Lae(a)?u.onDestroy(()=>y.cleanUp()):y.cleanUp()}))}},multi:!0}),i}var yle=(i,s)=>{let a=s.get(Wc),u=window._ejsas[a],p=i.instance=new iB(new $E(u.c));for(let R of u.et)p.addEvent(R);for(let R of u.etc)p.addEvent(R);let g=oB(a);p.replayEarlyEventInfos(g),UR(a);let y=new XE(R=>{Tle(s,R,R.currentTarget)});rB(p,y)};function Tle(i,s,a){let u=(a&&a.getAttribute(q_))??"";/d\d+/.test(u)?Sle(u,i,s,a):s.eventPhase===xR.REPLAY&&MG(s,a)}function Sle(i,s,a,u){s_.push({event:a,currentTarget:u}),_ue(s,i,Cle)}function Cle(i){let s=[...s_],a=new Set(i);s_=[];for(let{event:u,currentTarget:p}of s){let g=p.getAttribute(q_);a.has(g)?MG(u,p):s_.push({event:u,currentTarget:p})}}var nH=!1;function Ile(){nH||(nH=!0,Nae(),que(),ele(),$ue(),rue(),Hde(),mde(),uce())}function Rle(i){return i.whenStable()}function X3(){let i=[{provide:JE,useFactory:()=>{let s=!0;return s=!!fe(cl,{optional:!0})?.get(LG,null),s&&Gs("NgHydration"),s}},{provide:ka,useValue:()=>{cde(!1),fe(JE)&&(wle(),Ile())},multi:!0}];return i.push({provide:bG,useFactory:()=>fe(JE)},{provide:Zc,useFactory:()=>{if(fe(JE)){let s=fe(oi);return()=>{Rle(s).then(()=>{s.destroyed||_3(s)})}}return()=>{}},multi:!0}),zc(i)}function wle(){let i=G_(),s;for(let a of i.body.childNodes)if(a.nodeType===Node.COMMENT_NODE&&a.textContent?.trim()===Dae){s=a;break}if(!s)throw new De(-507,!1)}function av(i){return typeof i=="boolean"?i:i!=null&&i!=="false"}function Ws(i){let s=St(null);try{return i()}finally{St(s)}}function ml(i,s){let a=hj(i);return s?.equal&&(a[yi].equal=s.equal),a}var rH=class{[yi];constructor(s){this[yi]=s}destroy(){this[yi].destroy()}};var eW=null;function Ks(){return eW}function tW(i){eW??=i}var cv=class{};var so=new be(""),nW=(()=>{class i{historyGo(a){throw new Error("")}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:()=>fe(Ale),providedIn:"platform"})}return i})();var Ale=(()=>{class i extends nW{_location;_history;_doc=fe(so);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ks().getBaseHref(this._doc)}onPopState(a){let u=Ks().getGlobalEventTarget(this._doc,"window");return u.addEventListener("popstate",a,!1),()=>u.removeEventListener("popstate",a)}onHashChange(a){let u=Ks().getGlobalEventTarget(this._doc,"window");return u.addEventListener("hashchange",a,!1),()=>u.removeEventListener("hashchange",a)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(a){this._location.pathname=a}pushState(a,u,p){this._history.pushState(a,u,p)}replaceState(a,u,p){this._history.replaceState(a,u,p)}forward(){this._history.forward()}back(){this._history.back()}historyGo(a=0){this._history.go(a)}getState(){return this._history.state}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:()=>new i,providedIn:"platform"})}return i})();function rW(i,s){return i?s?i.endsWith("/")?s.startsWith("/")?i+s.slice(1):i+s:s.startsWith("/")?i+s:`${i}/${s}`:i:s}function J3(i){let s=i.search(/#|\?|$/);return i[s-1]==="/"?i.slice(0,s-1)+i.slice(s):i}function td(i){return i&&i[0]!=="?"?`?${i}`:i}var uv=(()=>{class i{historyGo(a){throw new Error("")}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:()=>fe(iW),providedIn:"root"})}return i})(),Dle=new be(""),iW=(()=>{class i extends uv{_platformLocation;_baseHref;_removeListenerFns=[];constructor(a,u){super(),this._platformLocation=a,this._baseHref=u??this._platformLocation.getBaseHrefFromDOM()??fe(so).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(a){this._removeListenerFns.push(this._platformLocation.onPopState(a),this._platformLocation.onHashChange(a))}getBaseHref(){return this._baseHref}prepareExternalUrl(a){return rW(this._baseHref,a)}path(a=!1){let u=this._platformLocation.pathname+td(this._platformLocation.search),p=this._platformLocation.hash;return p&&a?`${u}${p}`:u}pushState(a,u,p,g){let y=this.prepareExternalUrl(p+td(g));this._platformLocation.pushState(a,u,y)}replaceState(a,u,p,g){let y=this.prepareExternalUrl(p+td(g));this._platformLocation.replaceState(a,u,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(a=0){this._platformLocation.historyGo?.(a)}static \u0275fac=function(u){return new(u||i)(It(nW),It(Dle,8))};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Up=(()=>{class i{_subject=new cr;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(a){this._locationStrategy=a;let u=this._locationStrategy.getBaseHref();this._basePath=Ple(J3(Q3(u))),this._locationStrategy.onPopState(p=>{this._subject.next({url:this.path(!0),pop:!0,state:p.state,type:p.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(a=!1){return this.normalize(this._locationStrategy.path(a))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(a,u=""){return this.path()==this.normalize(a+td(u))}normalize(a){return i.stripTrailingSlash(Nle(this._basePath,Q3(a)))}prepareExternalUrl(a){return a&&a[0]!=="/"&&(a="/"+a),this._locationStrategy.prepareExternalUrl(a)}go(a,u="",p=null){this._locationStrategy.pushState(p,"",a,u),this._notifyUrlChangeListeners(this.prepareExternalUrl(a+td(u)),p)}replaceState(a,u="",p=null){this._locationStrategy.replaceState(p,"",a,u),this._notifyUrlChangeListeners(this.prepareExternalUrl(a+td(u)),p)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(a=0){this._locationStrategy.historyGo?.(a)}onUrlChange(a){return this._urlChangeListeners.push(a),this._urlChangeSubscription??=this.subscribe(u=>{this._notifyUrlChangeListeners(u.url,u.state)}),()=>{let u=this._urlChangeListeners.indexOf(a);this._urlChangeListeners.splice(u,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(a="",u){this._urlChangeListeners.forEach(p=>p(a,u))}subscribe(a,u,p){return this._subject.subscribe({next:a,error:u??void 0,complete:p??void 0})}static normalizeQueryParams=td;static joinWithSlash=rW;static stripTrailingSlash=J3;static \u0275fac=function(u){return new(u||i)(It(uv))};static \u0275prov=Ge({token:i,factory:()=>Ole(),providedIn:"root"})}return i})();function Ole(){return new Up(It(uv))}function Nle(i,s){if(!i||!s.startsWith(i))return s;let a=s.substring(i.length);return a===""||["/",";","?","#"].includes(a[0])?a:s}function Q3(i){return i.replace(/\/index.html$/,"")}function Ple(i){if(new RegExp("^(https?:)?//").test(i)){let[,a]=i.split(/\/\/[^\/]+/);return a}return i}function oW(i,s){s=encodeURIComponent(s);for(let a of i.split(";")){let u=a.indexOf("="),[p,g]=u==-1?[a,""]:[a.slice(0,u),a.slice(u+1)];if(p.trim()===s)return decodeURIComponent(g)}return null}var sW=(()=>{class i{_viewContainer;_context=new Ub;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(a,u){this._viewContainer=a,this._thenTemplateRef=u}set ngIf(a){this._context.$implicit=this._context.ngIf=a,this._updateView()}set ngIfThen(a){Z3("ngIfThen",a),this._thenTemplateRef=a,this._thenViewRef=null,this._updateView()}set ngIfElse(a){Z3("ngIfElse",a),this._elseTemplateRef=a,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(a,u){return!0}static \u0275fac=function(u){return new(u||i)(zt(kp),zt(wb))};static \u0275dir=Oi({type:i,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return i})(),Ub=class{$implicit=null;ngIf=null};function Z3(i,s){if(!!!(!s||s.createEmbeddedView))throw new Error(`${i} must be a TemplateRef, but received '${Vr(s)}'.`)}var aW="browser",Mle="server";function Vb(i){return i===Mle}var dv=class{};var lv=class i{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(s){s?typeof s=="string"?this.lazyInit=()=>{this.headers=new Map,s.split(`
`).forEach(a=>{let u=a.indexOf(":");if(u>0){let p=a.slice(0,u),g=a.slice(u+1).trim();this.addHeaderEntry(p,g)}})}:typeof Headers<"u"&&s instanceof Headers?(this.headers=new Map,s.forEach((a,u)=>{this.addHeaderEntry(u,a)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(s).forEach(([a,u])=>{this.setHeaderEntries(a,u)})}:this.headers=new Map}has(s){return this.init(),this.headers.has(s.toLowerCase())}get(s){this.init();let a=this.headers.get(s.toLowerCase());return a&&a.length>0?a[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(s){return this.init(),this.headers.get(s.toLowerCase())||null}append(s,a){return this.clone({name:s,value:a,op:"a"})}set(s,a){return this.clone({name:s,value:a,op:"s"})}delete(s,a){return this.clone({name:s,value:a,op:"d"})}maybeSetNormalizedName(s,a){this.normalizedNames.has(a)||this.normalizedNames.set(a,s)}init(){this.lazyInit&&(this.lazyInit instanceof i?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(s=>this.applyUpdate(s)),this.lazyUpdate=null))}copyFrom(s){s.init(),Array.from(s.headers.keys()).forEach(a=>{this.headers.set(a,s.headers.get(a)),this.normalizedNames.set(a,s.normalizedNames.get(a))})}clone(s){let a=new i;return a.lazyInit=this.lazyInit&&this.lazyInit instanceof i?this.lazyInit:this,a.lazyUpdate=(this.lazyUpdate||[]).concat([s]),a}applyUpdate(s){let a=s.name.toLowerCase();switch(s.op){case"a":case"s":let u=s.value;if(typeof u=="string"&&(u=[u]),u.length===0)return;this.maybeSetNormalizedName(s.name,a);let p=(s.op==="a"?this.headers.get(a):void 0)||[];p.push(...u),this.headers.set(a,p);break;case"d":let g=s.value;if(!g)this.headers.delete(a),this.normalizedNames.delete(a);else{let y=this.headers.get(a);if(!y)return;y=y.filter(R=>g.indexOf(R)===-1),y.length===0?(this.headers.delete(a),this.normalizedNames.delete(a)):this.headers.set(a,y)}break}}addHeaderEntry(s,a){let u=s.toLowerCase();this.maybeSetNormalizedName(s,u),this.headers.has(u)?this.headers.get(u).push(a):this.headers.set(u,[a])}setHeaderEntries(s,a){let u=(Array.isArray(a)?a:[a]).map(g=>g.toString()),p=s.toLowerCase();this.headers.set(p,u),this.maybeSetNormalizedName(s,p)}forEach(s){this.init(),Array.from(this.normalizedNames.keys()).forEach(a=>s(this.normalizedNames.get(a),this.headers.get(a)))}};var kle="X-Request-URL",Lle="text/plain",xle="application/json",UTe=`${xle}, ${Lle}, */*`;var dW=function(i){return i[i.Sent=0]="Sent",i[i.UploadProgress=1]="UploadProgress",i[i.ResponseHeader=2]="ResponseHeader",i[i.DownloadProgress=3]="DownloadProgress",i[i.Response=4]="Response",i[i.User=5]="User",i}(dW||{}),jb=class{headers;status;statusText;url;ok;type;constructor(s,a=200,u="OK"){this.headers=s.headers||new lv,this.status=s.status!==void 0?s.status:a,this.statusText=s.statusText||u,this.url=s.url||null,this.ok=this.status>=200&&this.status<300}};var hv=class i extends jb{body;constructor(s={}){super(s),this.body=s.body!==void 0?s.body:null}type=dW.Response;clone(s={}){return new i({body:s.body!==void 0?s.body:this.body,headers:s.headers||this.headers,status:s.status!==void 0?s.status:this.status,statusText:s.statusText||this.statusText,url:s.url||this.url||void 0})}};var Ule=new be("");var FTe=RegExp(`^${kle}:`,"m");var Fle=new be(""),Vle="b",jle="h",Ble="s",Hle="st",Gle="u",Wle="rt",Bb=new be(""),Kle=["GET","HEAD"];function qle(i,s){let Z=fe(Bb),{isCacheActive:a}=Z,u=nj(Z,["isCacheActive"]),{transferCache:p,method:g}=i;if(!a||p===!1||g==="POST"&&!u.includePostRequests&&!p||g!=="POST"&&!Kle.includes(g)||!u.includeRequestsWithAuthHeaders&&zle(i)||u.filter?.(i)===!1)return s(i);let y=fe(cl);if(fe(Fle,{optional:!0}))throw new De(2803,!1);let w=i.url,L=Yle(i,w),V=y.get(L,null),q=u.includeHeaders;if(typeof p=="object"&&p.includeHeaders&&(q=p.includeHeaders),V){let{[Vle]:$,[Wle]:pe,[jle]:Ie,[Ble]:ct,[Hle]:We,[Gle]:er}=V,Uo=$;switch(pe){case"arraybuffer":Uo=new TextEncoder().encode($).buffer;break;case"blob":Uo=new Blob([$]);break}let Kv=new lv(Ie);return Ze(new hv({body:Uo,headers:Kv,status:ct,statusText:We,url:er}))}return s(i).pipe($n($=>{$ instanceof hv}))}function zle(i){return i.headers.has("authorization")||i.headers.has("proxy-authorization")}function cW(i){return[...i.keys()].sort().map(s=>`${s}=${i.getAll(s)}`).join("&")}function Yle(i,s){let{params:a,method:u,responseType:p}=i,g=cW(a),y=i.serializeBody();y instanceof URLSearchParams?y=cW(y):typeof y!="string"&&(y="");let R=[u,p,s,y,g].join("|"),w=$le(R);return w}function $le(i){let s=0;for(let a of i)s=Math.imul(31,s)+a.charCodeAt(0)<<0;return s+=2147483648,s.toString()}function uW(i){return[{provide:Bb,useFactory:()=>(Gs("NgHttpTransferCache"),Se({isCacheActive:!0},i))},{provide:Ule,useValue:qle,multi:!0},{provide:Zc,multi:!0,useFactory:()=>{let s=fe(oi),a=fe(Bb);return()=>{s.whenStable().then(()=>{a.isCacheActive=!1})}}}]}var Gb=class extends cv{supportsDOMEvents=!0},Wb=class i extends Gb{static makeCurrent(){tW(new i)}onAndCancel(s,a,u,p){return s.addEventListener(a,u,p),()=>{s.removeEventListener(a,u,p)}}dispatchEvent(s,a){s.dispatchEvent(a)}remove(s){s.remove()}createElement(s,a){return a=a||this.getDefaultDocument(),a.createElement(s)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(s){return s.nodeType===Node.ELEMENT_NODE}isShadowRoot(s){return s instanceof DocumentFragment}getGlobalEventTarget(s,a){return a==="window"?window:a==="document"?s:a==="body"?s.body:null}getBaseHref(s){let a=Xle();return a==null?null:Jle(a)}resetBaseElement(){Fp=null}getUserAgent(){return window.navigator.userAgent}getCookie(s){return oW(document.cookie,s)}},Fp=null;function Xle(){return Fp=Fp||document.querySelector("base"),Fp?Fp.getAttribute("href"):null}function Jle(i){return new URL(i,document.baseURI).pathname}var Qle=(()=>{class i{build(){return new XMLHttpRequest}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac})}return i})(),Kb=new be(""),gW=(()=>{class i{_zone;_plugins;_eventNameToPlugin=new Map;constructor(a,u){this._zone=u,a.forEach(p=>{p.manager=this}),this._plugins=a.slice().reverse()}addEventListener(a,u,p,g){return this._findPluginFor(u).addEventListener(a,u,p,g)}getZone(){return this._zone}_findPluginFor(a){let u=this._eventNameToPlugin.get(a);if(u)return u;if(u=this._plugins.find(g=>g.supports(a)),!u)throw new De(5101,!1);return this._eventNameToPlugin.set(a,u),u}static \u0275fac=function(u){return new(u||i)(It(Kb),It(Jn))};static \u0275prov=Ge({token:i,factory:i.\u0275fac})}return i})(),fv=class{_doc;constructor(s){this._doc=s}manager},pv="ng-app-id";function lW(i){for(let s of i)s.remove()}function hW(i,s){let a=s.createElement("style");return a.textContent=i,a}function Zle(i,s,a,u){let p=i.head?.querySelectorAll(`style[${pv}="${s}"],link[${pv}="${s}"]`);if(p)for(let g of p)g.removeAttribute(pv),g instanceof HTMLLinkElement?u.set(g.href.slice(g.href.lastIndexOf("/")+1),{usage:0,elements:[g]}):g.textContent&&a.set(g.textContent,{usage:0,elements:[g]})}function qb(i,s){let a=s.createElement("link");return a.setAttribute("rel","stylesheet"),a.setAttribute("href",i),a}var EW=(()=>{class i{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(a,u,p,g={}){this.doc=a,this.appId=u,this.nonce=p,this.isServer=Vb(g),Zle(a,u,this.inline,this.external),this.hosts.add(a.head)}addStyles(a,u){for(let p of a)this.addUsage(p,this.inline,hW);u?.forEach(p=>this.addUsage(p,this.external,qb))}removeStyles(a,u){for(let p of a)this.removeUsage(p,this.inline);u?.forEach(p=>this.removeUsage(p,this.external))}addUsage(a,u,p){let g=u.get(a);g?g.usage++:u.set(a,{usage:1,elements:[...this.hosts].map(y=>this.addElement(y,p(a,this.doc)))})}removeUsage(a,u){let p=u.get(a);p&&(p.usage--,p.usage<=0&&(lW(p.elements),u.delete(a)))}ngOnDestroy(){for(let[,{elements:a}]of[...this.inline,...this.external])lW(a);this.hosts.clear()}addHost(a){this.hosts.add(a);for(let[u,{elements:p}]of this.inline)p.push(this.addElement(a,hW(u,this.doc)));for(let[u,{elements:p}]of this.external)p.push(this.addElement(a,qb(u,this.doc)))}removeHost(a){this.hosts.delete(a)}addElement(a,u){return this.nonce&&u.setAttribute("nonce",this.nonce),this.isServer&&u.setAttribute(pv,this.appId),a.appendChild(u)}static \u0275fac=function(u){return new(u||i)(It(so),It(Wc),It(ab,8),It(Jc))};static \u0275prov=Ge({token:i,factory:i.\u0275fac})}return i})(),Hb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},Yb=/%COMP%/g;var _W="%COMP%",ehe=`_nghost-${_W}`,the=`_ngcontent-${_W}`,nhe=!0,rhe=new be("",{providedIn:"root",factory:()=>nhe});function ihe(i){return the.replace(Yb,i)}function ohe(i){return ehe.replace(Yb,i)}function vW(i,s){return s.map(a=>a.replace(Yb,i))}var pW=(()=>{class i{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(a,u,p,g,y,R,w,L=null,V=null){this.eventManager=a,this.sharedStylesHost=u,this.appId=p,this.removeStylesOnCompDestroy=g,this.doc=y,this.platformId=R,this.ngZone=w,this.nonce=L,this.tracingService=V,this.platformIsServer=Vb(R),this.defaultRenderer=new Vp(a,y,w,this.platformIsServer,this.tracingService)}createRenderer(a,u){if(!a||!u)return this.defaultRenderer;this.platformIsServer&&u.encapsulation===ls.ShadowDom&&(u=At(Se({},u),{encapsulation:ls.Emulated}));let p=this.getOrCreateRenderer(a,u);return p instanceof mv?p.applyToHost(a):p instanceof jp&&p.applyStyles(),p}getOrCreateRenderer(a,u){let p=this.rendererByCompId,g=p.get(u.id);if(!g){let y=this.doc,R=this.ngZone,w=this.eventManager,L=this.sharedStylesHost,V=this.removeStylesOnCompDestroy,q=this.platformIsServer,Z=this.tracingService;switch(u.encapsulation){case ls.Emulated:g=new mv(w,L,u,this.appId,V,y,R,q,Z);break;case ls.ShadowDom:return new zb(w,L,a,u,y,R,this.nonce,q,Z);default:g=new jp(w,L,u,V,y,R,q,Z);break}p.set(u.id,g)}return g}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(a){this.rendererByCompId.delete(a)}static \u0275fac=function(u){return new(u||i)(It(gW),It(EW),It(Wc),It(rhe),It(so),It(Jc),It(Jn),It(ab),It(dl,8))};static \u0275prov=Ge({token:i,factory:i.\u0275fac})}return i})(),Vp=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(s,a,u,p,g){this.eventManager=s,this.doc=a,this.ngZone=u,this.platformIsServer=p,this.tracingService=g}destroy(){}destroyNode=null;createElement(s,a){return a?this.doc.createElementNS(Hb[a]||a,s):this.doc.createElement(s)}createComment(s){return this.doc.createComment(s)}createText(s){return this.doc.createTextNode(s)}appendChild(s,a){(fW(s)?s.content:s).appendChild(a)}insertBefore(s,a,u){s&&(fW(s)?s.content:s).insertBefore(a,u)}removeChild(s,a){a.remove()}selectRootElement(s,a){let u=typeof s=="string"?this.doc.querySelector(s):s;if(!u)throw new De(-5104,!1);return a||(u.textContent=""),u}parentNode(s){return s.parentNode}nextSibling(s){return s.nextSibling}setAttribute(s,a,u,p){if(p){a=p+":"+a;let g=Hb[p];g?s.setAttributeNS(g,a,u):s.setAttribute(a,u)}else s.setAttribute(a,u)}removeAttribute(s,a,u){if(u){let p=Hb[u];p?s.removeAttributeNS(p,a):s.removeAttribute(`${u}:${a}`)}else s.removeAttribute(a)}addClass(s,a){s.classList.add(a)}removeClass(s,a){s.classList.remove(a)}setStyle(s,a,u,p){p&(Bs.DashCase|Bs.Important)?s.style.setProperty(a,u,p&Bs.Important?"important":""):s.style[a]=u}removeStyle(s,a,u){u&Bs.DashCase?s.style.removeProperty(a):s.style[a]=""}setProperty(s,a,u){s!=null&&(s[a]=u)}setValue(s,a){s.nodeValue=a}listen(s,a,u,p){if(typeof s=="string"&&(s=Ks().getGlobalEventTarget(this.doc,s),!s))throw new Error(`Unsupported event target ${s} for event ${a}`);let g=this.decoratePreventDefault(u);return this.tracingService!==null&&this.tracingService.wrapEventListener&&(g=this.tracingService.wrapEventListener(s,a,g)),this.eventManager.addEventListener(s,a,g,p)}decoratePreventDefault(s){return a=>{if(a==="__ngUnwrap__")return s;(this.platformIsServer?this.ngZone.runGuarded(()=>s(a)):s(a))===!1&&a.preventDefault()}}};function fW(i){return i.tagName==="TEMPLATE"&&i.content!==void 0}var zb=class extends Vp{sharedStylesHost;hostEl;shadowRoot;constructor(s,a,u,p,g,y,R,w,L){super(s,g,y,w,L),this.sharedStylesHost=a,this.hostEl=u,this.shadowRoot=u.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let V=p.styles;V=vW(p.id,V);for(let Z of V){let $=document.createElement("style");R&&$.setAttribute("nonce",R),$.textContent=Z,this.shadowRoot.appendChild($)}let q=p.getExternalStyles?.();if(q)for(let Z of q){let $=qb(Z,g);R&&$.setAttribute("nonce",R),this.shadowRoot.appendChild($)}}nodeOrShadowRoot(s){return s===this.hostEl?this.shadowRoot:s}appendChild(s,a){return super.appendChild(this.nodeOrShadowRoot(s),a)}insertBefore(s,a,u){return super.insertBefore(this.nodeOrShadowRoot(s),a,u)}removeChild(s,a){return super.removeChild(null,a)}parentNode(s){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(s)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},jp=class extends Vp{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(s,a,u,p,g,y,R,w,L){super(s,g,y,R,w),this.sharedStylesHost=a,this.removeStylesOnCompDestroy=p;let V=u.styles;this.styles=L?vW(L,V):V,this.styleUrls=u.getExternalStyles?.(L)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},mv=class extends jp{contentAttr;hostAttr;constructor(s,a,u,p,g,y,R,w,L){let V=p+"-"+u.id;super(s,a,u,g,y,R,w,L,V),this.contentAttr=ihe(V),this.hostAttr=ohe(V)}applyToHost(s){this.applyStyles(),this.setAttribute(s,this.hostAttr,"")}createElement(s,a){let u=super.createElement(s,a);return super.setAttribute(u,this.contentAttr,""),u}},she=(()=>{class i extends fv{constructor(a){super(a)}supports(a){return!0}addEventListener(a,u,p,g){return a.addEventListener(u,p,g),()=>this.removeEventListener(a,u,p,g)}removeEventListener(a,u,p,g){return a.removeEventListener(u,p,g)}static \u0275fac=function(u){return new(u||i)(It(so))};static \u0275prov=Ge({token:i,factory:i.\u0275fac})}return i})(),mW=["alt","control","meta","shift"],ahe={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},che={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey},dhe=(()=>{class i extends fv{constructor(a){super(a)}supports(a){return i.parseEventName(a)!=null}addEventListener(a,u,p,g){let y=i.parseEventName(u),R=i.eventCallback(y.fullKey,p,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ks().onAndCancel(a,y.domEventName,R,g))}static parseEventName(a){let u=a.toLowerCase().split("."),p=u.shift();if(u.length===0||!(p==="keydown"||p==="keyup"))return null;let g=i._normalizeKey(u.pop()),y="",R=u.indexOf("code");if(R>-1&&(u.splice(R,1),y="code."),mW.forEach(L=>{let V=u.indexOf(L);V>-1&&(u.splice(V,1),y+=L+".")}),y+=g,u.length!=0||g.length===0)return null;let w={};return w.domEventName=p,w.fullKey=y,w}static matchEventFullKeyCode(a,u){let p=ahe[a.key]||a.key,g="";return u.indexOf("code.")>-1&&(p=a.code,g="code."),p==null||!p?!1:(p=p.toLowerCase(),p===" "?p="space":p==="."&&(p="dot"),mW.forEach(y=>{if(y!==p){let R=che[y];R(a)&&(g+=y+".")}}),g+=p,g===u)}static eventCallback(a,u,p){return g=>{i.matchEventFullKeyCode(g,a)&&p.runGuarded(()=>u(g))}}static _normalizeKey(a){return a==="esc"?"escape":a}static \u0275fac=function(u){return new(u||i)(It(so))};static \u0275prov=Ge({token:i,factory:i.\u0275fac})}return i})();function yW(i,s){return Y3(Se({rootComponent:i},uhe(s)))}function uhe(i){return{appProviders:[...mhe,...i?.providers??[]],platformProviders:fhe}}function lhe(){Wb.makeCurrent()}function hhe(){return new js}function phe(){return TG(document),document}var fhe=[{provide:Jc,useValue:aW},{provide:sb,useValue:lhe,multi:!0},{provide:so,useFactory:phe,deps:[]}];var mhe=[{provide:U_,useValue:"root"},{provide:js,useFactory:hhe,deps:[]},{provide:Kb,useClass:she,multi:!0,deps:[so]},{provide:Kb,useClass:dhe,multi:!0,deps:[so]},pW,EW,gW,{provide:tl,useExisting:pW},{provide:dv,useClass:Qle,deps:[]},[]];var TW=(()=>{class i{_doc;constructor(a){this._doc=a}getTitle(){return this._doc.title}setTitle(a){this._doc.title=a||""}static \u0275fac=function(u){return new(u||i)(It(so))};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var gv=function(i){return i[i.NoHttpTransferCache=0]="NoHttpTransferCache",i[i.HttpTransferCacheOptions=1]="HttpTransferCacheOptions",i[i.I18nSupport=2]="I18nSupport",i[i.EventReplay=3]="EventReplay",i[i.IncrementalHydration=4]="IncrementalHydration",i}(gv||{});function ghe(i,s=[],a={}){return{\u0275kind:i,\u0275providers:s}}function SW(){return ghe(gv.EventReplay,$3())}function CW(...i){let s=[],a=new Set,u=a.has(gv.HttpTransferCacheOptions);for(let{\u0275providers:p,\u0275kind:g}of i)a.add(g),p.length&&s.push(p);return zc([[],X3(),a.has(gv.NoHttpTransferCache)||u?[]:uW({}),s])}var ut="primary",nf=Symbol("RouteTitle"),Zb=class{params;constructor(s){this.params=s||{}}has(s){return Object.prototype.hasOwnProperty.call(this.params,s)}get(s){if(this.has(s)){let a=this.params[s];return Array.isArray(a)?a[0]:a}return null}getAll(s){if(this.has(s)){let a=this.params[s];return Array.isArray(a)?a:[a]}return[]}get keys(){return Object.keys(this.params)}};function Tl(i){return new Zb(i)}function vhe(i,s,a){let u=a.path.split("/");if(u.length>i.length||a.pathMatch==="full"&&(s.hasChildren()||u.length<i.length))return null;let p={};for(let g=0;g<u.length;g++){let y=u[g],R=i[g];if(y[0]===":")p[y.substring(1)]=R;else if(y!==R.path)return null}return{consumed:i.slice(0,u.length),posParams:p}}function yhe(i,s){if(i.length!==s.length)return!1;for(let a=0;a<i.length;++a)if(!fs(i[a],s[a]))return!1;return!0}function fs(i,s){let a=i?eA(i):void 0,u=s?eA(s):void 0;if(!a||!u||a.length!=u.length)return!1;let p;for(let g=0;g<a.length;g++)if(p=a[g],!NW(i[p],s[p]))return!1;return!0}function eA(i){return[...Object.keys(i),...Object.getOwnPropertySymbols(i)]}function NW(i,s){if(Array.isArray(i)&&Array.isArray(s)){if(i.length!==s.length)return!1;let a=[...i].sort(),u=[...s].sort();return a.every((p,g)=>u[g]===p)}else return i===s}function PW(i){return i.length>0?i[i.length-1]:null}function Ha(i){return TR(i)?i:Qc(i)?Nn(Promise.resolve(i)):Ze(i)}var The={exact:kW,subset:LW},MW={exact:She,subset:Che,ignored:()=>!0};function IW(i,s,a){return The[a.paths](i.root,s.root,a.matrixParams)&&MW[a.queryParams](i.queryParams,s.queryParams)&&!(a.fragment==="exact"&&i.fragment!==s.fragment)}function She(i,s){return fs(i,s)}function kW(i,s,a){if(!rd(i.segments,s.segments)||!vv(i.segments,s.segments,a)||i.numberOfChildren!==s.numberOfChildren)return!1;for(let u in s.children)if(!i.children[u]||!kW(i.children[u],s.children[u],a))return!1;return!0}function Che(i,s){return Object.keys(s).length<=Object.keys(i).length&&Object.keys(s).every(a=>NW(i[a],s[a]))}function LW(i,s,a){return xW(i,s,s.segments,a)}function xW(i,s,a,u){if(i.segments.length>a.length){let p=i.segments.slice(0,a.length);return!(!rd(p,a)||s.hasChildren()||!vv(p,a,u))}else if(i.segments.length===a.length){if(!rd(i.segments,a)||!vv(i.segments,a,u))return!1;for(let p in s.children)if(!i.children[p]||!LW(i.children[p],s.children[p],u))return!1;return!0}else{let p=a.slice(0,i.segments.length),g=a.slice(i.segments.length);return!rd(i.segments,p)||!vv(i.segments,p,u)||!i.children[ut]?!1:xW(i.children[ut],s,g,u)}}function vv(i,s,a){return s.every((u,p)=>MW[a](i[p].parameters,u.parameters))}var zs=class{root;queryParams;fragment;_queryParamMap;constructor(s=new Yt([],{}),a={},u=null){this.root=s,this.queryParams=a,this.fragment=u}get queryParamMap(){return this._queryParamMap??=Tl(this.queryParams),this._queryParamMap}toString(){return whe.serialize(this)}},Yt=class{segments;children;parent=null;constructor(s,a){this.segments=s,this.children=a,Object.values(a).forEach(u=>u.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return yv(this)}},nd=class{path;parameters;_parameterMap;constructor(s,a){this.path=s,this.parameters=a}get parameterMap(){return this._parameterMap??=Tl(this.parameters),this._parameterMap}toString(){return FW(this)}};function Ihe(i,s){return rd(i,s)&&i.every((a,u)=>fs(a.parameters,s[u].parameters))}function rd(i,s){return i.length!==s.length?!1:i.every((a,u)=>a.path===s[u].path)}function Rhe(i,s){let a=[];return Object.entries(i.children).forEach(([u,p])=>{u===ut&&(a=a.concat(s(p,u)))}),Object.entries(i.children).forEach(([u,p])=>{u!==ut&&(a=a.concat(s(p,u)))}),a}var wA=(()=>{class i{static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:()=>new qp,providedIn:"root"})}return i})(),qp=class{parse(s){let a=new nA(s);return new zs(a.parseRootSegment(),a.parseQueryParams(),a.parseFragment())}serialize(s){let a=`/${Bp(s.root,!0)}`,u=Dhe(s.queryParams),p=typeof s.fragment=="string"?`#${bhe(s.fragment)}`:"";return`${a}${u}${p}`}},whe=new qp;function yv(i){return i.segments.map(s=>FW(s)).join("/")}function Bp(i,s){if(!i.hasChildren())return yv(i);if(s){let a=i.children[ut]?Bp(i.children[ut],!1):"",u=[];return Object.entries(i.children).forEach(([p,g])=>{p!==ut&&u.push(`${p}:${Bp(g,!1)}`)}),u.length>0?`${a}(${u.join("//")})`:a}else{let a=Rhe(i,(u,p)=>p===ut?[Bp(i.children[ut],!1)]:[`${p}:${Bp(u,!1)}`]);return Object.keys(i.children).length===1&&i.children[ut]!=null?`${yv(i)}/${a[0]}`:`${yv(i)}/(${a.join("//")})`}}function UW(i){return encodeURIComponent(i).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ev(i){return UW(i).replace(/%3B/gi,";")}function bhe(i){return encodeURI(i)}function tA(i){return UW(i).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Tv(i){return decodeURIComponent(i)}function RW(i){return Tv(i.replace(/\+/g,"%20"))}function FW(i){return`${tA(i.path)}${Ahe(i.parameters)}`}function Ahe(i){return Object.entries(i).map(([s,a])=>`;${tA(s)}=${tA(a)}`).join("")}function Dhe(i){let s=Object.entries(i).map(([a,u])=>Array.isArray(u)?u.map(p=>`${Ev(a)}=${Ev(p)}`).join("&"):`${Ev(a)}=${Ev(u)}`).filter(a=>a);return s.length?`?${s.join("&")}`:""}var Ohe=/^[^\/()?;#]+/;function $b(i){let s=i.match(Ohe);return s?s[0]:""}var Nhe=/^[^\/()?;=#]+/;function Phe(i){let s=i.match(Nhe);return s?s[0]:""}var Mhe=/^[^=?&#]+/;function khe(i){let s=i.match(Mhe);return s?s[0]:""}var Lhe=/^[^&#]+/;function xhe(i){let s=i.match(Lhe);return s?s[0]:""}var nA=class{url;remaining;constructor(s){this.url=s,this.remaining=s}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Yt([],{}):new Yt([],this.parseChildren())}parseQueryParams(){let s={};if(this.consumeOptional("?"))do this.parseQueryParam(s);while(this.consumeOptional("&"));return s}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let s=[];for(this.peekStartsWith("(")||s.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),s.push(this.parseSegment());let a={};this.peekStartsWith("/(")&&(this.capture("/"),a=this.parseParens(!0));let u={};return this.peekStartsWith("(")&&(u=this.parseParens(!1)),(s.length>0||Object.keys(a).length>0)&&(u[ut]=new Yt(s,a)),u}parseSegment(){let s=$b(this.remaining);if(s===""&&this.peekStartsWith(";"))throw new De(4009,!1);return this.capture(s),new nd(Tv(s),this.parseMatrixParams())}parseMatrixParams(){let s={};for(;this.consumeOptional(";");)this.parseParam(s);return s}parseParam(s){let a=Phe(this.remaining);if(!a)return;this.capture(a);let u="";if(this.consumeOptional("=")){let p=$b(this.remaining);p&&(u=p,this.capture(u))}s[Tv(a)]=Tv(u)}parseQueryParam(s){let a=khe(this.remaining);if(!a)return;this.capture(a);let u="";if(this.consumeOptional("=")){let y=xhe(this.remaining);y&&(u=y,this.capture(u))}let p=RW(a),g=RW(u);if(s.hasOwnProperty(p)){let y=s[p];Array.isArray(y)||(y=[y],s[p]=y),y.push(g)}else s[p]=g}parseParens(s){let a={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let u=$b(this.remaining),p=this.remaining[u.length];if(p!=="/"&&p!==")"&&p!==";")throw new De(4010,!1);let g;u.indexOf(":")>-1?(g=u.slice(0,u.indexOf(":")),this.capture(g),this.capture(":")):s&&(g=ut);let y=this.parseChildren();a[g]=Object.keys(y).length===1?y[ut]:new Yt([],y),this.consumeOptional("//")}return a}peekStartsWith(s){return this.remaining.startsWith(s)}consumeOptional(s){return this.peekStartsWith(s)?(this.remaining=this.remaining.substring(s.length),!0):!1}capture(s){if(!this.consumeOptional(s))throw new De(4011,!1)}};function VW(i){return i.segments.length>0?new Yt([],{[ut]:i}):i}function jW(i){let s={};for(let[u,p]of Object.entries(i.children)){let g=jW(p);if(u===ut&&g.segments.length===0&&g.hasChildren())for(let[y,R]of Object.entries(g.children))s[y]=R;else(g.segments.length>0||g.hasChildren())&&(s[u]=g)}let a=new Yt(i.segments,s);return Uhe(a)}function Uhe(i){if(i.numberOfChildren===1&&i.children[ut]){let s=i.children[ut];return new Yt(i.segments.concat(s.segments),s.children)}return i}function zp(i){return i instanceof zs}function Fhe(i,s,a=null,u=null){let p=BW(i);return HW(p,s,a,u)}function BW(i){let s;function a(g){let y={};for(let w of g.children){let L=a(w);y[w.outlet]=L}let R=new Yt(g.url,y);return g===i&&(s=R),R}let u=a(i.root),p=VW(u);return s??p}function HW(i,s,a,u){let p=i;for(;p.parent;)p=p.parent;if(s.length===0)return Xb(p,p,p,a,u);let g=Vhe(s);if(g.toRoot())return Xb(p,p,new Yt([],{}),a,u);let y=jhe(g,p,i),R=y.processChildren?Gp(y.segmentGroup,y.index,g.commands):WW(y.segmentGroup,y.index,g.commands);return Xb(p,y.segmentGroup,R,a,u)}function Sv(i){return typeof i=="object"&&i!=null&&!i.outlets&&!i.segmentPath}function Yp(i){return typeof i=="object"&&i!=null&&i.outlets}function Xb(i,s,a,u,p){let g={};u&&Object.entries(u).forEach(([w,L])=>{g[w]=Array.isArray(L)?L.map(V=>`${V}`):`${L}`});let y;i===s?y=a:y=GW(i,s,a);let R=VW(jW(y));return new zs(R,g,p)}function GW(i,s,a){let u={};return Object.entries(i.children).forEach(([p,g])=>{g===s?u[p]=a:u[p]=GW(g,s,a)}),new Yt(i.segments,u)}var Cv=class{isAbsolute;numberOfDoubleDots;commands;constructor(s,a,u){if(this.isAbsolute=s,this.numberOfDoubleDots=a,this.commands=u,s&&u.length>0&&Sv(u[0]))throw new De(4003,!1);let p=u.find(Yp);if(p&&p!==PW(u))throw new De(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function Vhe(i){if(typeof i[0]=="string"&&i.length===1&&i[0]==="/")return new Cv(!0,0,i);let s=0,a=!1,u=i.reduce((p,g,y)=>{if(typeof g=="object"&&g!=null){if(g.outlets){let R={};return Object.entries(g.outlets).forEach(([w,L])=>{R[w]=typeof L=="string"?L.split("/"):L}),[...p,{outlets:R}]}if(g.segmentPath)return[...p,g.segmentPath]}return typeof g!="string"?[...p,g]:y===0?(g.split("/").forEach((R,w)=>{w==0&&R==="."||(w==0&&R===""?a=!0:R===".."?s++:R!=""&&p.push(R))}),p):[...p,g]},[]);return new Cv(a,s,u)}var _l=class{segmentGroup;processChildren;index;constructor(s,a,u){this.segmentGroup=s,this.processChildren=a,this.index=u}};function jhe(i,s,a){if(i.isAbsolute)return new _l(s,!0,0);if(!a)return new _l(s,!1,NaN);if(a.parent===null)return new _l(a,!0,0);let u=Sv(i.commands[0])?0:1,p=a.segments.length-1+u;return Bhe(a,p,i.numberOfDoubleDots)}function Bhe(i,s,a){let u=i,p=s,g=a;for(;g>p;){if(g-=p,u=u.parent,!u)throw new De(4005,!1);p=u.segments.length}return new _l(u,!1,p-g)}function Hhe(i){return Yp(i[0])?i[0].outlets:{[ut]:i}}function WW(i,s,a){if(i??=new Yt([],{}),i.segments.length===0&&i.hasChildren())return Gp(i,s,a);let u=Ghe(i,s,a),p=a.slice(u.commandIndex);if(u.match&&u.pathIndex<i.segments.length){let g=new Yt(i.segments.slice(0,u.pathIndex),{});return g.children[ut]=new Yt(i.segments.slice(u.pathIndex),i.children),Gp(g,0,p)}else return u.match&&p.length===0?new Yt(i.segments,{}):u.match&&!i.hasChildren()?rA(i,s,a):u.match?Gp(i,0,p):rA(i,s,a)}function Gp(i,s,a){if(a.length===0)return new Yt(i.segments,{});{let u=Hhe(a),p={};if(Object.keys(u).some(g=>g!==ut)&&i.children[ut]&&i.numberOfChildren===1&&i.children[ut].segments.length===0){let g=Gp(i.children[ut],s,a);return new Yt(i.segments,g.children)}return Object.entries(u).forEach(([g,y])=>{typeof y=="string"&&(y=[y]),y!==null&&(p[g]=WW(i.children[g],s,y))}),Object.entries(i.children).forEach(([g,y])=>{u[g]===void 0&&(p[g]=y)}),new Yt(i.segments,p)}}function Ghe(i,s,a){let u=0,p=s,g={match:!1,pathIndex:0,commandIndex:0};for(;p<i.segments.length;){if(u>=a.length)return g;let y=i.segments[p],R=a[u];if(Yp(R))break;let w=`${R}`,L=u<a.length-1?a[u+1]:null;if(p>0&&w===void 0)break;if(w&&L&&typeof L=="object"&&L.outlets===void 0){if(!bW(w,L,y))return g;u+=2}else{if(!bW(w,{},y))return g;u++}p++}return{match:!0,pathIndex:p,commandIndex:u}}function rA(i,s,a){let u=i.segments.slice(0,s),p=0;for(;p<a.length;){let g=a[p];if(Yp(g)){let w=Whe(g.outlets);return new Yt(u,w)}if(p===0&&Sv(a[0])){let w=i.segments[s];u.push(new nd(w.path,wW(a[0]))),p++;continue}let y=Yp(g)?g.outlets[ut]:`${g}`,R=p<a.length-1?a[p+1]:null;y&&R&&Sv(R)?(u.push(new nd(y,wW(R))),p+=2):(u.push(new nd(y,{})),p++)}return new Yt(u,{})}function Whe(i){let s={};return Object.entries(i).forEach(([a,u])=>{typeof u=="string"&&(u=[u]),u!==null&&(s[a]=rA(new Yt([],{}),0,u))}),s}function wW(i){let s={};return Object.entries(i).forEach(([a,u])=>s[a]=`${u}`),s}function bW(i,s,a){return i==a.path&&fs(s,a.parameters)}var Wp="imperative",yr=function(i){return i[i.NavigationStart=0]="NavigationStart",i[i.NavigationEnd=1]="NavigationEnd",i[i.NavigationCancel=2]="NavigationCancel",i[i.NavigationError=3]="NavigationError",i[i.RoutesRecognized=4]="RoutesRecognized",i[i.ResolveStart=5]="ResolveStart",i[i.ResolveEnd=6]="ResolveEnd",i[i.GuardsCheckStart=7]="GuardsCheckStart",i[i.GuardsCheckEnd=8]="GuardsCheckEnd",i[i.RouteConfigLoadStart=9]="RouteConfigLoadStart",i[i.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",i[i.ChildActivationStart=11]="ChildActivationStart",i[i.ChildActivationEnd=12]="ChildActivationEnd",i[i.ActivationStart=13]="ActivationStart",i[i.ActivationEnd=14]="ActivationEnd",i[i.Scroll=15]="Scroll",i[i.NavigationSkipped=16]="NavigationSkipped",i}(yr||{}),ao=class{id;url;constructor(s,a){this.id=s,this.url=a}},$p=class extends ao{type=yr.NavigationStart;navigationTrigger;restoredState;constructor(s,a,u="imperative",p=null){super(s,a),this.navigationTrigger=u,this.restoredState=p}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},id=class extends ao{urlAfterRedirects;type=yr.NavigationEnd;constructor(s,a,u){super(s,a),this.urlAfterRedirects=u}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Pi=function(i){return i[i.Redirect=0]="Redirect",i[i.SupersededByNewNavigation=1]="SupersededByNewNavigation",i[i.NoDataFromResolver=2]="NoDataFromResolver",i[i.GuardRejected=3]="GuardRejected",i}(Pi||{}),iA=function(i){return i[i.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",i[i.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",i}(iA||{}),qs=class extends ao{reason;code;type=yr.NavigationCancel;constructor(s,a,u,p){super(s,a),this.reason=u,this.code=p}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},od=class extends ao{reason;code;type=yr.NavigationSkipped;constructor(s,a,u,p){super(s,a),this.reason=u,this.code=p}},Xp=class extends ao{error;target;type=yr.NavigationError;constructor(s,a,u,p){super(s,a),this.error=u,this.target=p}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Iv=class extends ao{urlAfterRedirects;state;type=yr.RoutesRecognized;constructor(s,a,u,p){super(s,a),this.urlAfterRedirects=u,this.state=p}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},oA=class extends ao{urlAfterRedirects;state;type=yr.GuardsCheckStart;constructor(s,a,u,p){super(s,a),this.urlAfterRedirects=u,this.state=p}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},sA=class extends ao{urlAfterRedirects;state;shouldActivate;type=yr.GuardsCheckEnd;constructor(s,a,u,p,g){super(s,a),this.urlAfterRedirects=u,this.state=p,this.shouldActivate=g}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},aA=class extends ao{urlAfterRedirects;state;type=yr.ResolveStart;constructor(s,a,u,p){super(s,a),this.urlAfterRedirects=u,this.state=p}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},cA=class extends ao{urlAfterRedirects;state;type=yr.ResolveEnd;constructor(s,a,u,p){super(s,a),this.urlAfterRedirects=u,this.state=p}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},dA=class{route;type=yr.RouteConfigLoadStart;constructor(s){this.route=s}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},uA=class{route;type=yr.RouteConfigLoadEnd;constructor(s){this.route=s}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},lA=class{snapshot;type=yr.ChildActivationStart;constructor(s){this.snapshot=s}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},hA=class{snapshot;type=yr.ChildActivationEnd;constructor(s){this.snapshot=s}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},pA=class{snapshot;type=yr.ActivationStart;constructor(s){this.snapshot=s}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},fA=class{snapshot;type=yr.ActivationEnd;constructor(s){this.snapshot=s}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Jp=class{},Sl=class{url;navigationBehaviorOptions;constructor(s,a){this.url=s,this.navigationBehaviorOptions=a}};function Khe(i,s){return i.providers&&!i._injector&&(i._injector=iv(i.providers,s,`Route: ${i.path}`)),i._injector??s}function xo(i){return i.outlet||ut}function qhe(i,s){let a=i.filter(u=>xo(u)===s);return a.push(...i.filter(u=>xo(u)!==s)),a}function rf(i){if(!i)return null;if(i.routeConfig?._injector)return i.routeConfig._injector;for(let s=i.parent;s;s=s.parent){let a=s.routeConfig;if(a?._loadedInjector)return a._loadedInjector;if(a?._injector)return a._injector}return null}var mA=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return rf(this.route?.snapshot)??this.rootInjector}constructor(s){this.rootInjector=s,this.children=new Nv(this.rootInjector)}},Nv=(()=>{class i{rootInjector;contexts=new Map;constructor(a){this.rootInjector=a}onChildOutletCreated(a,u){let p=this.getOrCreateContext(a);p.outlet=u,this.contexts.set(a,p)}onChildOutletDestroyed(a){let u=this.getContext(a);u&&(u.outlet=null,u.attachRef=null)}onOutletDeactivated(){let a=this.contexts;return this.contexts=new Map,a}onOutletReAttached(a){this.contexts=a}getOrCreateContext(a){let u=this.getContext(a);return u||(u=new mA(this.rootInjector),this.contexts.set(a,u)),u}getContext(a){return this.contexts.get(a)||null}static \u0275fac=function(u){return new(u||i)(It(Ri))};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Rv=class{_root;constructor(s){this._root=s}get root(){return this._root.value}parent(s){let a=this.pathFromRoot(s);return a.length>1?a[a.length-2]:null}children(s){let a=gA(s,this._root);return a?a.children.map(u=>u.value):[]}firstChild(s){let a=gA(s,this._root);return a&&a.children.length>0?a.children[0].value:null}siblings(s){let a=EA(s,this._root);return a.length<2?[]:a[a.length-2].children.map(p=>p.value).filter(p=>p!==s)}pathFromRoot(s){return EA(s,this._root).map(a=>a.value)}};function gA(i,s){if(i===s.value)return s;for(let a of s.children){let u=gA(i,a);if(u)return u}return null}function EA(i,s){if(i===s.value)return[s];for(let a of s.children){let u=EA(i,a);if(u.length)return u.unshift(s),u}return[]}var Ni=class{value;children;constructor(s,a){this.value=s,this.children=a}toString(){return`TreeNode(${this.value})`}};function El(i){let s={};return i&&i.children.forEach(a=>s[a.value.outlet]=a),s}var wv=class extends Rv{snapshot;constructor(s,a){super(s),this.snapshot=a,bA(this,s)}toString(){return this.snapshot.toString()}};function KW(i){let s=zhe(i),a=new vr([new nd("",{})]),u=new vr({}),p=new vr({}),g=new vr({}),y=new vr(""),R=new Cl(a,u,g,y,p,ut,i,s.root);return R.snapshot=s.root,new wv(new Ni(R,[]),s)}function zhe(i){let s={},a={},u={},p="",g=new vl([],s,u,p,a,ut,i,null,{});return new Av("",new Ni(g,[]))}var Cl=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(s,a,u,p,g,y,R,w){this.urlSubject=s,this.paramsSubject=a,this.queryParamsSubject=u,this.fragmentSubject=p,this.dataSubject=g,this.outlet=y,this.component=R,this._futureSnapshot=w,this.title=this.dataSubject?.pipe(yt(L=>L[nf]))??Ze(void 0),this.url=s,this.params=a,this.queryParams=u,this.fragment=p,this.data=g}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(yt(s=>Tl(s))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(yt(s=>Tl(s))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function bv(i,s,a="emptyOnly"){let u,{routeConfig:p}=i;return s!==null&&(a==="always"||p?.path===""||!s.component&&!s.routeConfig?.loadComponent)?u={params:Se(Se({},s.params),i.params),data:Se(Se({},s.data),i.data),resolve:Se(Se(Se(Se({},i.data),s.data),p?.data),i._resolvedData)}:u={params:Se({},i.params),data:Se({},i.data),resolve:Se(Se({},i.data),i._resolvedData??{})},p&&zW(p)&&(u.resolve[nf]=p.title),u}var vl=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[nf]}constructor(s,a,u,p,g,y,R,w,L){this.url=s,this.params=a,this.queryParams=u,this.fragment=p,this.data=g,this.outlet=y,this.component=R,this.routeConfig=w,this._resolve=L}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Tl(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Tl(this.queryParams),this._queryParamMap}toString(){let s=this.url.map(u=>u.toString()).join("/"),a=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${s}', path:'${a}')`}},Av=class extends Rv{url;constructor(s,a){super(a),this.url=s,bA(this,a)}toString(){return qW(this._root)}};function bA(i,s){s.value._routerState=i,s.children.forEach(a=>bA(i,a))}function qW(i){let s=i.children.length>0?` { ${i.children.map(qW).join(", ")} } `:"";return`${i.value}${s}`}function Jb(i){if(i.snapshot){let s=i.snapshot,a=i._futureSnapshot;i.snapshot=a,fs(s.queryParams,a.queryParams)||i.queryParamsSubject.next(a.queryParams),s.fragment!==a.fragment&&i.fragmentSubject.next(a.fragment),fs(s.params,a.params)||i.paramsSubject.next(a.params),yhe(s.url,a.url)||i.urlSubject.next(a.url),fs(s.data,a.data)||i.dataSubject.next(a.data)}else i.snapshot=i._futureSnapshot,i.dataSubject.next(i._futureSnapshot.data)}function _A(i,s){let a=fs(i.params,s.params)&&Ihe(i.url,s.url),u=!i.parent!=!s.parent;return a&&!u&&(!i.parent||_A(i.parent,s.parent))}function zW(i){return typeof i.title=="string"||i.title===null}var Yhe=new be(""),AA=(()=>{class i{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=ut;activateEvents=new dr;deactivateEvents=new dr;attachEvents=new dr;detachEvents=new dr;routerOutletData=hG(void 0);parentContexts=fe(Nv);location=fe(kp);changeDetector=fe(ed);inputBinder=fe(DA,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(a){if(a.name){let{firstChange:u,previousValue:p}=a.name;if(u)return;this.isTrackedInParentContexts(p)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(p)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(a){return this.parentContexts.getContext(a)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let a=this.parentContexts.getContext(this.name);a?.route&&(a.attachRef?this.attach(a.attachRef,a.route):this.activateWith(a.route,a.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new De(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new De(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new De(4012,!1);this.location.detach();let a=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(a.instance),a}attach(a,u){this.activated=a,this._activatedRoute=u,this.location.insert(a.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(a.instance)}deactivate(){if(this.activated){let a=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(a)}}activateWith(a,u){if(this.isActivated)throw new De(4013,!1);this._activatedRoute=a;let p=this.location,y=a.snapshot.component,R=this.parentContexts.getOrCreateContext(this.name).children,w=new vA(a,R,p.injector,this.routerOutletData);this.activated=p.createComponent(y,{index:p.length,injector:w,environmentInjector:u}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(u){return new(u||i)};static \u0275dir=Oi({type:i,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Ip]})}return i})(),vA=class i{route;childContexts;parent;outletData;__ngOutletInjector(s){return new i(this.route,this.childContexts,s,this.outletData)}constructor(s,a,u,p){this.route=s,this.childContexts=a,this.parent=u,this.outletData=p}get(s,a){return s===Cl?this.route:s===Nv?this.childContexts:s===Yhe?this.outletData:this.parent.get(s,a)}},DA=new be("");function $he(i,s,a){let u=Qp(i,s._root,a?a._root:void 0);return new wv(u,s)}function Qp(i,s,a){if(a&&i.shouldReuseRoute(s.value,a.value.snapshot)){let u=a.value;u._futureSnapshot=s.value;let p=Xhe(i,s,a);return new Ni(u,p)}else{if(i.shouldAttach(s.value)){let g=i.retrieve(s.value);if(g!==null){let y=g.route;return y.value._futureSnapshot=s.value,y.children=s.children.map(R=>Qp(i,R)),y}}let u=Jhe(s.value),p=s.children.map(g=>Qp(i,g));return new Ni(u,p)}}function Xhe(i,s,a){return s.children.map(u=>{for(let p of a.children)if(i.shouldReuseRoute(u.value,p.value.snapshot))return Qp(i,u,p);return Qp(i,u)})}function Jhe(i){return new Cl(new vr(i.url),new vr(i.params),new vr(i.queryParams),new vr(i.fragment),new vr(i.data),i.outlet,i.component,i)}var Zp=class{redirectTo;navigationBehaviorOptions;constructor(s,a){this.redirectTo=s,this.navigationBehaviorOptions=a}},YW="ngNavigationCancelingError";function Dv(i,s){let{redirectTo:a,navigationBehaviorOptions:u}=zp(s)?{redirectTo:s,navigationBehaviorOptions:void 0}:s,p=$W(!1,Pi.Redirect);return p.url=a,p.navigationBehaviorOptions=u,p}function $W(i,s){let a=new Error(`NavigationCancelingError: ${i||""}`);return a[YW]=!0,a.cancellationCode=s,a}function Qhe(i){return XW(i)&&zp(i.url)}function XW(i){return!!i&&i[YW]}var Zhe=(i,s,a,u)=>yt(p=>(new yA(s,p.targetRouterState,p.currentRouterState,a,u).activate(i),p)),yA=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(s,a,u,p,g){this.routeReuseStrategy=s,this.futureState=a,this.currState=u,this.forwardEvent=p,this.inputBindingEnabled=g}activate(s){let a=this.futureState._root,u=this.currState?this.currState._root:null;this.deactivateChildRoutes(a,u,s),Jb(this.futureState.root),this.activateChildRoutes(a,u,s)}deactivateChildRoutes(s,a,u){let p=El(a);s.children.forEach(g=>{let y=g.value.outlet;this.deactivateRoutes(g,p[y],u),delete p[y]}),Object.values(p).forEach(g=>{this.deactivateRouteAndItsChildren(g,u)})}deactivateRoutes(s,a,u){let p=s.value,g=a?a.value:null;if(p===g)if(p.component){let y=u.getContext(p.outlet);y&&this.deactivateChildRoutes(s,a,y.children)}else this.deactivateChildRoutes(s,a,u);else g&&this.deactivateRouteAndItsChildren(a,u)}deactivateRouteAndItsChildren(s,a){s.value.component&&this.routeReuseStrategy.shouldDetach(s.value.snapshot)?this.detachAndStoreRouteSubtree(s,a):this.deactivateRouteAndOutlet(s,a)}detachAndStoreRouteSubtree(s,a){let u=a.getContext(s.value.outlet),p=u&&s.value.component?u.children:a,g=El(s);for(let y of Object.values(g))this.deactivateRouteAndItsChildren(y,p);if(u&&u.outlet){let y=u.outlet.detach(),R=u.children.onOutletDeactivated();this.routeReuseStrategy.store(s.value.snapshot,{componentRef:y,route:s,contexts:R})}}deactivateRouteAndOutlet(s,a){let u=a.getContext(s.value.outlet),p=u&&s.value.component?u.children:a,g=El(s);for(let y of Object.values(g))this.deactivateRouteAndItsChildren(y,p);u&&(u.outlet&&(u.outlet.deactivate(),u.children.onOutletDeactivated()),u.attachRef=null,u.route=null)}activateChildRoutes(s,a,u){let p=El(a);s.children.forEach(g=>{this.activateRoutes(g,p[g.value.outlet],u),this.forwardEvent(new fA(g.value.snapshot))}),s.children.length&&this.forwardEvent(new hA(s.value.snapshot))}activateRoutes(s,a,u){let p=s.value,g=a?a.value:null;if(Jb(p),p===g)if(p.component){let y=u.getOrCreateContext(p.outlet);this.activateChildRoutes(s,a,y.children)}else this.activateChildRoutes(s,a,u);else if(p.component){let y=u.getOrCreateContext(p.outlet);if(this.routeReuseStrategy.shouldAttach(p.snapshot)){let R=this.routeReuseStrategy.retrieve(p.snapshot);this.routeReuseStrategy.store(p.snapshot,null),y.children.onOutletReAttached(R.contexts),y.attachRef=R.componentRef,y.route=R.route.value,y.outlet&&y.outlet.attach(R.componentRef,R.route.value),Jb(R.route.value),this.activateChildRoutes(s,null,y.children)}else y.attachRef=null,y.route=p,y.outlet&&y.outlet.activateWith(p,y.injector),this.activateChildRoutes(s,null,y.children)}else this.activateChildRoutes(s,null,u)}},Ov=class{path;route;constructor(s){this.path=s,this.route=this.path[this.path.length-1]}},yl=class{component;route;constructor(s,a){this.component=s,this.route=a}};function epe(i,s,a){let u=i._root,p=s?s._root:null;return Hp(u,p,a,[u.value])}function tpe(i){let s=i.routeConfig?i.routeConfig.canActivateChild:null;return!s||s.length===0?null:{node:i,guards:s}}function Rl(i,s){let a=Symbol(),u=s.get(i,a);return u===a?typeof i=="function"&&!aH(i)?i:s.get(i):u}function Hp(i,s,a,u,p={canDeactivateChecks:[],canActivateChecks:[]}){let g=El(s);return i.children.forEach(y=>{npe(y,g[y.value.outlet],a,u.concat([y.value]),p),delete g[y.value.outlet]}),Object.entries(g).forEach(([y,R])=>Kp(R,a.getContext(y),p)),p}function npe(i,s,a,u,p={canDeactivateChecks:[],canActivateChecks:[]}){let g=i.value,y=s?s.value:null,R=a?a.getContext(i.value.outlet):null;if(y&&g.routeConfig===y.routeConfig){let w=rpe(y,g,g.routeConfig.runGuardsAndResolvers);w?p.canActivateChecks.push(new Ov(u)):(g.data=y.data,g._resolvedData=y._resolvedData),g.component?Hp(i,s,R?R.children:null,u,p):Hp(i,s,a,u,p),w&&R&&R.outlet&&R.outlet.isActivated&&p.canDeactivateChecks.push(new yl(R.outlet.component,y))}else y&&Kp(s,R,p),p.canActivateChecks.push(new Ov(u)),g.component?Hp(i,null,R?R.children:null,u,p):Hp(i,null,a,u,p);return p}function rpe(i,s,a){if(typeof a=="function")return a(i,s);switch(a){case"pathParamsChange":return!rd(i.url,s.url);case"pathParamsOrQueryParamsChange":return!rd(i.url,s.url)||!fs(i.queryParams,s.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!_A(i,s)||!fs(i.queryParams,s.queryParams);case"paramsChange":default:return!_A(i,s)}}function Kp(i,s,a){let u=El(i),p=i.value;Object.entries(u).forEach(([g,y])=>{p.component?s?Kp(y,s.children.getContext(g),a):Kp(y,null,a):Kp(y,s,a)}),p.component?s&&s.outlet&&s.outlet.isActivated?a.canDeactivateChecks.push(new yl(s.outlet.component,p)):a.canDeactivateChecks.push(new yl(null,p)):a.canDeactivateChecks.push(new yl(null,p))}function of(i){return typeof i=="function"}function ipe(i){return typeof i=="boolean"}function ope(i){return i&&of(i.canLoad)}function spe(i){return i&&of(i.canActivate)}function ape(i){return i&&of(i.canActivateChild)}function cpe(i){return i&&of(i.canDeactivate)}function dpe(i){return i&&of(i.canMatch)}function JW(i){return i instanceof Ls||i?.name==="EmptyError"}var _v=Symbol("INITIAL_VALUE");function Il(){return eo(i=>GE(i.map(s=>s.pipe(xs(1),wR(_v)))).pipe(yt(s=>{for(let a of s)if(a!==!0){if(a===_v)return _v;if(a===!1||upe(a))return a}return!0}),Zi(s=>s!==_v),xs(1)))}function upe(i){return zp(i)||i instanceof Zp}function lpe(i,s){return Yn(a=>{let{targetSnapshot:u,currentSnapshot:p,guards:{canActivateChecks:g,canDeactivateChecks:y}}=a;return y.length===0&&g.length===0?Ze(At(Se({},a),{guardsResult:!0})):hpe(y,u,p,i).pipe(Yn(R=>R&&ipe(R)?ppe(u,g,i,s):Ze(R)),yt(R=>At(Se({},a),{guardsResult:R})))})}function hpe(i,s,a,u){return Nn(i).pipe(Yn(p=>_pe(p.component,p.route,a,s,u)),Us(p=>p!==!0,!0))}function ppe(i,s,a,u){return Nn(s).pipe(Uc(p=>Lu(mpe(p.route.parent,u),fpe(p.route,u),Epe(i,p.path,a),gpe(i,p.route,a))),Us(p=>p!==!0,!0))}function fpe(i,s){return i!==null&&s&&s(new pA(i)),Ze(!0)}function mpe(i,s){return i!==null&&s&&s(new lA(i)),Ze(!0)}function gpe(i,s,a){let u=s.routeConfig?s.routeConfig.canActivate:null;if(!u||u.length===0)return Ze(!0);let p=u.map(g=>WE(()=>{let y=rf(s)??a,R=Rl(g,y),w=spe(R)?R.canActivate(s,i):ro(y,()=>R(s,i));return Ha(w).pipe(Us())}));return Ze(p).pipe(Il())}function Epe(i,s,a){let u=s[s.length-1],g=s.slice(0,s.length-1).reverse().map(y=>tpe(y)).filter(y=>y!==null).map(y=>WE(()=>{let R=y.guards.map(w=>{let L=rf(y.node)??a,V=Rl(w,L),q=ape(V)?V.canActivateChild(u,i):ro(L,()=>V(u,i));return Ha(q).pipe(Us())});return Ze(R).pipe(Il())}));return Ze(g).pipe(Il())}function _pe(i,s,a,u,p){let g=s&&s.routeConfig?s.routeConfig.canDeactivate:null;if(!g||g.length===0)return Ze(!0);let y=g.map(R=>{let w=rf(s)??p,L=Rl(R,w),V=cpe(L)?L.canDeactivate(i,s,a,u):ro(w,()=>L(i,s,a,u));return Ha(V).pipe(Us())});return Ze(y).pipe(Il())}function vpe(i,s,a,u){let p=s.canLoad;if(p===void 0||p.length===0)return Ze(!0);let g=p.map(y=>{let R=Rl(y,i),w=ope(R)?R.canLoad(s,a):ro(i,()=>R(s,a));return Ha(w)});return Ze(g).pipe(Il(),QW(u))}function QW(i){return ER($n(s=>{if(typeof s!="boolean")throw Dv(i,s)}),yt(s=>s===!0))}function ype(i,s,a,u){let p=s.canMatch;if(!p||p.length===0)return Ze(!0);let g=p.map(y=>{let R=Rl(y,i),w=dpe(R)?R.canMatch(s,a):ro(i,()=>R(s,a));return Ha(w)});return Ze(g).pipe(Il(),QW(u))}var ef=class{segmentGroup;constructor(s){this.segmentGroup=s||null}},tf=class extends Error{urlTree;constructor(s){super(),this.urlTree=s}};function gl(i){return ku(new ef(i))}function Tpe(i){return ku(new De(4e3,!1))}function Spe(i){return ku($W(!1,Pi.GuardRejected))}var TA=class{urlSerializer;urlTree;constructor(s,a){this.urlSerializer=s,this.urlTree=a}lineralizeSegments(s,a){let u=[],p=a.root;for(;;){if(u=u.concat(p.segments),p.numberOfChildren===0)return Ze(u);if(p.numberOfChildren>1||!p.children[ut])return Tpe(`${s.redirectTo}`);p=p.children[ut]}}applyRedirectCommands(s,a,u,p,g){if(typeof a!="string"){let R=a,{queryParams:w,fragment:L,routeConfig:V,url:q,outlet:Z,params:$,data:pe,title:Ie}=p,ct=ro(g,()=>R({params:$,data:pe,queryParams:w,fragment:L,routeConfig:V,url:q,outlet:Z,title:Ie}));if(ct instanceof zs)throw new tf(ct);a=ct}let y=this.applyRedirectCreateUrlTree(a,this.urlSerializer.parse(a),s,u);if(a[0]==="/")throw new tf(y);return y}applyRedirectCreateUrlTree(s,a,u,p){let g=this.createSegmentGroup(s,a.root,u,p);return new zs(g,this.createQueryParams(a.queryParams,this.urlTree.queryParams),a.fragment)}createQueryParams(s,a){let u={};return Object.entries(s).forEach(([p,g])=>{if(typeof g=="string"&&g[0]===":"){let R=g.substring(1);u[p]=a[R]}else u[p]=g}),u}createSegmentGroup(s,a,u,p){let g=this.createSegments(s,a.segments,u,p),y={};return Object.entries(a.children).forEach(([R,w])=>{y[R]=this.createSegmentGroup(s,w,u,p)}),new Yt(g,y)}createSegments(s,a,u,p){return a.map(g=>g.path[0]===":"?this.findPosParam(s,g,p):this.findOrReturn(g,u))}findPosParam(s,a,u){let p=u[a.path.substring(1)];if(!p)throw new De(4001,!1);return p}findOrReturn(s,a){let u=0;for(let p of a){if(p.path===s.path)return a.splice(u),p;u++}return s}},SA={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Cpe(i,s,a,u,p){let g=ZW(i,s,a);return g.matched?(u=Khe(s,u),ype(u,s,a,p).pipe(yt(y=>y===!0?g:Se({},SA)))):Ze(g)}function ZW(i,s,a){if(s.path==="**")return Ipe(a);if(s.path==="")return s.pathMatch==="full"&&(i.hasChildren()||a.length>0)?Se({},SA):{matched:!0,consumedSegments:[],remainingSegments:a,parameters:{},positionalParamSegments:{}};let p=(s.matcher||vhe)(a,i,s);if(!p)return Se({},SA);let g={};Object.entries(p.posParams??{}).forEach(([R,w])=>{g[R]=w.path});let y=p.consumed.length>0?Se(Se({},g),p.consumed[p.consumed.length-1].parameters):g;return{matched:!0,consumedSegments:p.consumed,remainingSegments:a.slice(p.consumed.length),parameters:y,positionalParamSegments:p.posParams??{}}}function Ipe(i){return{matched:!0,parameters:i.length>0?PW(i).parameters:{},consumedSegments:i,remainingSegments:[],positionalParamSegments:{}}}function AW(i,s,a,u){return a.length>0&&bpe(i,a,u)?{segmentGroup:new Yt(s,wpe(u,new Yt(a,i.children))),slicedSegments:[]}:a.length===0&&Ape(i,a,u)?{segmentGroup:new Yt(i.segments,Rpe(i,a,u,i.children)),slicedSegments:a}:{segmentGroup:new Yt(i.segments,i.children),slicedSegments:a}}function Rpe(i,s,a,u){let p={};for(let g of a)if(Pv(i,s,g)&&!u[xo(g)]){let y=new Yt([],{});p[xo(g)]=y}return Se(Se({},u),p)}function wpe(i,s){let a={};a[ut]=s;for(let u of i)if(u.path===""&&xo(u)!==ut){let p=new Yt([],{});a[xo(u)]=p}return a}function bpe(i,s,a){return a.some(u=>Pv(i,s,u)&&xo(u)!==ut)}function Ape(i,s,a){return a.some(u=>Pv(i,s,u))}function Pv(i,s,a){return(i.hasChildren()||s.length>0)&&a.pathMatch==="full"?!1:a.path===""}function Dpe(i,s,a){return s.length===0&&!i.children[a]}var CA=class{};function Ope(i,s,a,u,p,g,y="emptyOnly"){return new IA(i,s,a,u,p,y,g).recognize()}var Npe=31,IA=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(s,a,u,p,g,y,R){this.injector=s,this.configLoader=a,this.rootComponentType=u,this.config=p,this.urlTree=g,this.paramsInheritanceStrategy=y,this.urlSerializer=R,this.applyRedirects=new TA(this.urlSerializer,this.urlTree)}noMatchError(s){return new De(4002,`'${s.segmentGroup}'`)}recognize(){let s=AW(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(s).pipe(yt(({children:a,rootSnapshot:u})=>{let p=new Ni(u,a),g=new Av("",p),y=Fhe(u,[],this.urlTree.queryParams,this.urlTree.fragment);return y.queryParams=this.urlTree.queryParams,g.url=this.urlSerializer.serialize(y),{state:g,tree:y}}))}match(s){let a=new vl([],Object.freeze({}),Object.freeze(Se({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),ut,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,s,ut,a).pipe(yt(u=>({children:u,rootSnapshot:a})),Da(u=>{if(u instanceof tf)return this.urlTree=u.urlTree,this.match(u.urlTree.root);throw u instanceof ef?this.noMatchError(u):u}))}processSegmentGroup(s,a,u,p,g){return u.segments.length===0&&u.hasChildren()?this.processChildren(s,a,u,g):this.processSegment(s,a,u,u.segments,p,!0,g).pipe(yt(y=>y instanceof Ni?[y]:[]))}processChildren(s,a,u,p){let g=[];for(let y of Object.keys(u.children))y==="primary"?g.unshift(y):g.push(y);return Nn(g).pipe(Uc(y=>{let R=u.children[y],w=qhe(a,y);return this.processSegmentGroup(s,w,R,y,p)}),RR((y,R)=>(y.push(...R),y)),Oa(null),IR(),Yn(y=>{if(y===null)return gl(u);let R=e4(y);return Ppe(R),Ze(R)}))}processSegment(s,a,u,p,g,y,R){return Nn(a).pipe(Uc(w=>this.processSegmentAgainstRoute(w._injector??s,a,w,u,p,g,y,R).pipe(Da(L=>{if(L instanceof ef)return Ze(null);throw L}))),Us(w=>!!w),Da(w=>{if(JW(w))return Dpe(u,p,g)?Ze(new CA):gl(u);throw w}))}processSegmentAgainstRoute(s,a,u,p,g,y,R,w){return xo(u)!==y&&(y===ut||!Pv(p,g,u))?gl(p):u.redirectTo===void 0?this.matchSegmentAgainstRoute(s,p,u,g,y,w):this.allowRedirects&&R?this.expandSegmentAgainstRouteUsingRedirect(s,p,a,u,g,y,w):gl(p)}expandSegmentAgainstRouteUsingRedirect(s,a,u,p,g,y,R){let{matched:w,parameters:L,consumedSegments:V,positionalParamSegments:q,remainingSegments:Z}=ZW(a,p,g);if(!w)return gl(a);typeof p.redirectTo=="string"&&p.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Npe&&(this.allowRedirects=!1));let $=new vl(g,L,Object.freeze(Se({},this.urlTree.queryParams)),this.urlTree.fragment,DW(p),xo(p),p.component??p._loadedComponent??null,p,OW(p)),pe=bv($,R,this.paramsInheritanceStrategy);$.params=Object.freeze(pe.params),$.data=Object.freeze(pe.data);let Ie=this.applyRedirects.applyRedirectCommands(V,p.redirectTo,q,$,s);return this.applyRedirects.lineralizeSegments(p,Ie).pipe(Yn(ct=>this.processSegment(s,u,a,ct.concat(Z),y,!1,R)))}matchSegmentAgainstRoute(s,a,u,p,g,y){let R=Cpe(a,u,p,s,this.urlSerializer);return u.path==="**"&&(a.children={}),R.pipe(eo(w=>w.matched?(s=u._injector??s,this.getChildConfig(s,u,p).pipe(eo(({routes:L})=>{let V=u._loadedInjector??s,{parameters:q,consumedSegments:Z,remainingSegments:$}=w,pe=new vl(Z,q,Object.freeze(Se({},this.urlTree.queryParams)),this.urlTree.fragment,DW(u),xo(u),u.component??u._loadedComponent??null,u,OW(u)),Ie=bv(pe,y,this.paramsInheritanceStrategy);pe.params=Object.freeze(Ie.params),pe.data=Object.freeze(Ie.data);let{segmentGroup:ct,slicedSegments:We}=AW(a,Z,$,L);if(We.length===0&&ct.hasChildren())return this.processChildren(V,L,ct,pe).pipe(yt(Uo=>new Ni(pe,Uo)));if(L.length===0&&We.length===0)return Ze(new Ni(pe,[]));let er=xo(u)===g;return this.processSegment(V,L,ct,We,er?ut:g,!0,pe).pipe(yt(Uo=>new Ni(pe,Uo instanceof Ni?[Uo]:[])))}))):gl(a)))}getChildConfig(s,a,u){return a.children?Ze({routes:a.children,injector:s}):a.loadChildren?a._loadedRoutes!==void 0?Ze({routes:a._loadedRoutes,injector:a._loadedInjector}):vpe(s,a,u,this.urlSerializer).pipe(Yn(p=>p?this.configLoader.loadChildren(s,a).pipe($n(g=>{a._loadedRoutes=g.routes,a._loadedInjector=g.injector})):Spe(a))):Ze({routes:[],injector:s})}};function Ppe(i){i.sort((s,a)=>s.value.outlet===ut?-1:a.value.outlet===ut?1:s.value.outlet.localeCompare(a.value.outlet))}function Mpe(i){let s=i.value.routeConfig;return s&&s.path===""}function e4(i){let s=[],a=new Set;for(let u of i){if(!Mpe(u)){s.push(u);continue}let p=s.find(g=>u.value.routeConfig===g.value.routeConfig);p!==void 0?(p.children.push(...u.children),a.add(p)):s.push(u)}for(let u of a){let p=e4(u.children);s.push(new Ni(u.value,p))}return s.filter(u=>!a.has(u))}function DW(i){return i.data||{}}function OW(i){return i.resolve||{}}function kpe(i,s,a,u,p,g){return Yn(y=>Ope(i,s,a,u,y.extractedUrl,p,g).pipe(yt(({state:R,tree:w})=>At(Se({},y),{targetSnapshot:R,urlAfterRedirects:w}))))}function Lpe(i,s){return Yn(a=>{let{targetSnapshot:u,guards:{canActivateChecks:p}}=a;if(!p.length)return Ze(a);let g=new Set(p.map(w=>w.route)),y=new Set;for(let w of g)if(!y.has(w))for(let L of t4(w))y.add(L);let R=0;return Nn(y).pipe(Uc(w=>g.has(w)?xpe(w,u,i,s):(w.data=bv(w,w.parent,i).resolve,Ze(void 0))),$n(()=>R++),Uu(1),Yn(w=>R===y.size?Ze(a):ri))})}function t4(i){let s=i.children.map(a=>t4(a)).flat();return[i,...s]}function xpe(i,s,a,u){let p=i.routeConfig,g=i._resolve;return p?.title!==void 0&&!zW(p)&&(g[nf]=p.title),Upe(g,i,s,u).pipe(yt(y=>(i._resolvedData=y,i.data=bv(i,i.parent,a).resolve,null)))}function Upe(i,s,a,u){let p=eA(i);if(p.length===0)return Ze({});let g={};return Nn(p).pipe(Yn(y=>Fpe(i[y],s,a,u).pipe(Us(),$n(R=>{if(R instanceof Zp)throw Dv(new qp,R);g[y]=R}))),Uu(1),yt(()=>g),Da(y=>JW(y)?ri:ku(y)))}function Fpe(i,s,a,u){let p=rf(s)??u,g=Rl(i,p),y=g.resolve?g.resolve(s,a):ro(p,()=>g(s,a));return Ha(y)}function Qb(i){return eo(s=>{let a=i(s);return a?Nn(a).pipe(yt(()=>s)):Ze(s)})}var n4=(()=>{class i{buildTitle(a){let u,p=a.root;for(;p!==void 0;)u=this.getResolvedTitleForRoute(p)??u,p=p.children.find(g=>g.outlet===ut);return u}getResolvedTitleForRoute(a){return a.data[nf]}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:()=>fe(Vpe),providedIn:"root"})}return i})(),Vpe=(()=>{class i extends n4{title;constructor(a){super(),this.title=a}updateTitle(a){let u=this.buildTitle(a);u!==void 0&&this.title.setTitle(u)}static \u0275fac=function(u){return new(u||i)(It(TW))};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),OA=new be("",{providedIn:"root",factory:()=>({})}),jpe=(()=>{class i{static \u0275fac=function(u){return new(u||i)};static \u0275cmp=si({type:i,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(u,p){u&1&&Br(0,"router-outlet")},dependencies:[AA],encapsulation:2})}return i})();function NA(i){let s=i.children&&i.children.map(NA),a=s?At(Se({},i),{children:s}):Se({},i);return!a.component&&!a.loadComponent&&(s||a.loadChildren)&&a.outlet&&a.outlet!==ut&&(a.component=jpe),a}var PA=new be(""),Bpe=(()=>{class i{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=fe(Lb);loadComponent(a){if(this.componentLoaders.get(a))return this.componentLoaders.get(a);if(a._loadedComponent)return Ze(a._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(a);let u=Ha(a.loadComponent()).pipe(yt(r4),$n(g=>{this.onLoadEndListener&&this.onLoadEndListener(a),a._loadedComponent=g}),xu(()=>{this.componentLoaders.delete(a)})),p=new Mu(u,()=>new cr).pipe(Pu());return this.componentLoaders.set(a,p),p}loadChildren(a,u){if(this.childrenLoaders.get(u))return this.childrenLoaders.get(u);if(u._loadedRoutes)return Ze({routes:u._loadedRoutes,injector:u._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(u);let g=Hpe(u,this.compiler,a,this.onLoadEndListener).pipe(xu(()=>{this.childrenLoaders.delete(u)})),y=new Mu(g,()=>new cr).pipe(Pu());return this.childrenLoaders.set(u,y),y}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function Hpe(i,s,a,u){return Ha(i.loadChildren()).pipe(yt(r4),Yn(p=>p instanceof Tp||Array.isArray(p)?Ze(p):Nn(s.compileModuleAsync(p))),yt(p=>{u&&u(i);let g,y,R=!1;return Array.isArray(p)?(y=p,R=!0):(g=p.create(a).injector,y=g.get(PA,[],{optional:!0,self:!0}).flat()),{routes:y.map(NA),injector:g}}))}function Gpe(i){return i&&typeof i=="object"&&"default"in i}function r4(i){return Gpe(i)?i.default:i}var MA=(()=>{class i{static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:()=>fe(Wpe),providedIn:"root"})}return i})(),Wpe=(()=>{class i{shouldProcessUrl(a){return!0}extract(a){return a}merge(a,u){return a}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),Kpe=new be("");var qpe=new be(""),zpe=(()=>{class i{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new cr;transitionAbortSubject=new cr;configLoader=fe(Bpe);environmentInjector=fe(Ri);destroyRef=fe(Op);urlSerializer=fe(wA);rootContexts=fe(Nv);location=fe(Up);inputBindingEnabled=fe(DA,{optional:!0})!==null;titleStrategy=fe(n4);options=fe(OA,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=fe(MA);createViewTransition=fe(Kpe,{optional:!0});navigationErrorHandler=fe(qpe,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Ze(void 0);rootComponentType=null;destroyed=!1;constructor(){let a=p=>this.events.next(new dA(p)),u=p=>this.events.next(new uA(p));this.configLoader.onLoadEndListener=u,this.configLoader.onLoadStartListener=a,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(a){let u=++this.navigationId;this.transitions?.next(At(Se(Se({},this.transitions.value),a),{id:u}))}setupNavigations(a,u,p){return this.transitions=new vr({id:0,currentUrlTree:u,currentRawUrl:u,extractedUrl:this.urlHandlingStrategy.extract(u),urlAfterRedirects:this.urlHandlingStrategy.extract(u),rawUrl:u,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Wp,restoredState:null,currentSnapshot:p.snapshot,targetSnapshot:null,currentRouterState:p,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Zi(g=>g.id!==0),yt(g=>At(Se({},g),{extractedUrl:this.urlHandlingStrategy.extract(g.rawUrl)})),eo(g=>{let y=!1,R=!1;return Ze(g).pipe(eo(w=>{if(this.navigationId>g.id)return this.cancelNavigationTransition(g,"",Pi.SupersededByNewNavigation),ri;this.currentTransition=g,this.currentNavigation={id:w.id,initialUrl:w.rawUrl,extractedUrl:w.extractedUrl,targetBrowserUrl:typeof w.extras.browserUrl=="string"?this.urlSerializer.parse(w.extras.browserUrl):w.extras.browserUrl,trigger:w.source,extras:w.extras,previousNavigation:this.lastSuccessfulNavigation?At(Se({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let L=!a.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),V=w.extras.onSameUrlNavigation??a.onSameUrlNavigation;if(!L&&V!=="reload"){let q="";return this.events.next(new od(w.id,this.urlSerializer.serialize(w.rawUrl),q,iA.IgnoredSameUrlNavigation)),w.resolve(!1),ri}if(this.urlHandlingStrategy.shouldProcessUrl(w.rawUrl))return Ze(w).pipe(eo(q=>{let Z=this.transitions?.getValue();return this.events.next(new $p(q.id,this.urlSerializer.serialize(q.extractedUrl),q.source,q.restoredState)),Z!==this.transitions?.getValue()?ri:Promise.resolve(q)}),kpe(this.environmentInjector,this.configLoader,this.rootComponentType,a.config,this.urlSerializer,this.paramsInheritanceStrategy),$n(q=>{g.targetSnapshot=q.targetSnapshot,g.urlAfterRedirects=q.urlAfterRedirects,this.currentNavigation=At(Se({},this.currentNavigation),{finalUrl:q.urlAfterRedirects});let Z=new Iv(q.id,this.urlSerializer.serialize(q.extractedUrl),this.urlSerializer.serialize(q.urlAfterRedirects),q.targetSnapshot);this.events.next(Z)}));if(L&&this.urlHandlingStrategy.shouldProcessUrl(w.currentRawUrl)){let{id:q,extractedUrl:Z,source:$,restoredState:pe,extras:Ie}=w,ct=new $p(q,this.urlSerializer.serialize(Z),$,pe);this.events.next(ct);let We=KW(this.rootComponentType).snapshot;return this.currentTransition=g=At(Se({},w),{targetSnapshot:We,urlAfterRedirects:Z,extras:At(Se({},Ie),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=Z,Ze(g)}else{let q="";return this.events.next(new od(w.id,this.urlSerializer.serialize(w.extractedUrl),q,iA.IgnoredByUrlHandlingStrategy)),w.resolve(!1),ri}}),$n(w=>{let L=new oA(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot);this.events.next(L)}),yt(w=>(this.currentTransition=g=At(Se({},w),{guards:epe(w.targetSnapshot,w.currentSnapshot,this.rootContexts)}),g)),lpe(this.environmentInjector,w=>this.events.next(w)),$n(w=>{if(g.guardsResult=w.guardsResult,w.guardsResult&&typeof w.guardsResult!="boolean")throw Dv(this.urlSerializer,w.guardsResult);let L=new sA(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot,!!w.guardsResult);this.events.next(L)}),Zi(w=>w.guardsResult?!0:(this.cancelNavigationTransition(w,"",Pi.GuardRejected),!1)),Qb(w=>{if(w.guards.canActivateChecks.length)return Ze(w).pipe($n(L=>{let V=new aA(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot);this.events.next(V)}),eo(L=>{let V=!1;return Ze(L).pipe(Lpe(this.paramsInheritanceStrategy,this.environmentInjector),$n({next:()=>V=!0,complete:()=>{V||this.cancelNavigationTransition(L,"",Pi.NoDataFromResolver)}}))}),$n(L=>{let V=new cA(L.id,this.urlSerializer.serialize(L.extractedUrl),this.urlSerializer.serialize(L.urlAfterRedirects),L.targetSnapshot);this.events.next(V)}))}),Qb(w=>{let L=V=>{let q=[];V.routeConfig?.loadComponent&&!V.routeConfig._loadedComponent&&q.push(this.configLoader.loadComponent(V.routeConfig).pipe($n(Z=>{V.component=Z}),yt(()=>{})));for(let Z of V.children)q.push(...L(Z));return q};return GE(L(w.targetSnapshot.root)).pipe(Oa(null),xs(1))}),Qb(()=>this.afterPreactivation()),eo(()=>{let{currentSnapshot:w,targetSnapshot:L}=g,V=this.createViewTransition?.(this.environmentInjector,w.root,L.root);return V?Nn(V).pipe(yt(()=>g)):Ze(g)}),yt(w=>{let L=$he(a.routeReuseStrategy,w.targetSnapshot,w.currentRouterState);return this.currentTransition=g=At(Se({},w),{targetRouterState:L}),this.currentNavigation.targetRouterState=L,g}),$n(()=>{this.events.next(new Jp)}),Zhe(this.rootContexts,a.routeReuseStrategy,w=>this.events.next(w),this.inputBindingEnabled),xs(1),$n({next:w=>{y=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new id(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects))),this.titleStrategy?.updateTitle(w.targetRouterState.snapshot),w.resolve(!0)},complete:()=>{y=!0}}),bR(this.transitionAbortSubject.pipe($n(w=>{throw w}))),xu(()=>{!y&&!R&&this.cancelNavigationTransition(g,"",Pi.SupersededByNewNavigation),this.currentTransition?.id===g.id&&(this.currentNavigation=null,this.currentTransition=null)}),Da(w=>{if(this.destroyed)return g.resolve(!1),ri;if(R=!0,XW(w))this.events.next(new qs(g.id,this.urlSerializer.serialize(g.extractedUrl),w.message,w.cancellationCode)),Qhe(w)?this.events.next(new Sl(w.url,w.navigationBehaviorOptions)):g.resolve(!1);else{let L=new Xp(g.id,this.urlSerializer.serialize(g.extractedUrl),w,g.targetSnapshot??void 0);try{let V=ro(this.environmentInjector,()=>this.navigationErrorHandler?.(L));if(V instanceof Zp){let{message:q,cancellationCode:Z}=Dv(this.urlSerializer,V);this.events.next(new qs(g.id,this.urlSerializer.serialize(g.extractedUrl),q,Z)),this.events.next(new Sl(V.redirectTo,V.navigationBehaviorOptions))}else throw this.events.next(L),w}catch(V){this.options.resolveNavigationPromiseOnError?g.resolve(!1):g.reject(V)}}return ri}))}))}cancelNavigationTransition(a,u,p){let g=new qs(a.id,this.urlSerializer.serialize(a.extractedUrl),u,p);this.events.next(g),a.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let a=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),u=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return a.toString()!==u?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function Ype(i){return i!==Wp}var $pe=(()=>{class i{static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:()=>fe(Xpe),providedIn:"root"})}return i})(),RA=class{shouldDetach(s){return!1}store(s,a){}shouldAttach(s){return!1}retrieve(s){return null}shouldReuseRoute(s,a){return s.routeConfig===a.routeConfig}},Xpe=(()=>{class i extends RA{static \u0275fac=(()=>{let a;return function(p){return(a||(a=Dp(i)))(p||i)}})();static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),i4=(()=>{class i{static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:()=>fe(Jpe),providedIn:"root"})}return i})(),Jpe=(()=>{class i extends i4{location=fe(Up);urlSerializer=fe(wA);options=fe(OA,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=fe(MA);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new zs;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=KW(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(a){return this.location.subscribe(u=>{u.type==="popstate"&&a(u.url,u.state)})}handleRouterEvent(a,u){if(a instanceof $p)this.stateMemento=this.createStateMemento();else if(a instanceof od)this.rawUrlTree=u.initialUrl;else if(a instanceof Iv){if(this.urlUpdateStrategy==="eager"&&!u.extras.skipLocationChange){let p=this.urlHandlingStrategy.merge(u.finalUrl,u.initialUrl);this.setBrowserUrl(u.targetBrowserUrl??p,u)}}else a instanceof Jp?(this.currentUrlTree=u.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(u.finalUrl,u.initialUrl),this.routerState=u.targetRouterState,this.urlUpdateStrategy==="deferred"&&!u.extras.skipLocationChange&&this.setBrowserUrl(u.targetBrowserUrl??this.rawUrlTree,u)):a instanceof qs&&(a.code===Pi.GuardRejected||a.code===Pi.NoDataFromResolver)?this.restoreHistory(u):a instanceof Xp?this.restoreHistory(u,!0):a instanceof id&&(this.lastSuccessfulId=a.id,this.currentPageId=this.browserPageId)}setBrowserUrl(a,u){let p=a instanceof zs?this.urlSerializer.serialize(a):a;if(this.location.isCurrentPathEqualTo(p)||u.extras.replaceUrl){let g=this.browserPageId,y=Se(Se({},u.extras.state),this.generateNgRouterState(u.id,g));this.location.replaceState(p,"",y)}else{let g=Se(Se({},u.extras.state),this.generateNgRouterState(u.id,this.browserPageId+1));this.location.go(p,"",g)}}restoreHistory(a,u=!1){if(this.canceledNavigationResolution==="computed"){let p=this.browserPageId,g=this.currentPageId-p;g!==0?this.location.historyGo(g):this.currentUrlTree===a.finalUrl&&g===0&&(this.resetState(a),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(u&&this.resetState(a),this.resetUrlToCurrentUrlTree())}resetState(a){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,a.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(a,u){return this.canceledNavigationResolution==="computed"?{navigationId:a,\u0275routerPageId:u}:{navigationId:a}}static \u0275fac=(()=>{let a;return function(p){return(a||(a=Dp(i)))(p||i)}})();static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function Qpe(i,s){i.events.pipe(Zi(a=>a instanceof id||a instanceof qs||a instanceof Xp||a instanceof od),yt(a=>a instanceof id||a instanceof od?0:(a instanceof qs?a.code===Pi.Redirect||a.code===Pi.SupersededByNewNavigation:!1)?2:1),Zi(a=>a!==2),xs(1)).subscribe(()=>{s()})}var Zpe={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},efe={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Ga=(()=>{class i{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=fe(Db);stateManager=fe(i4);options=fe(OA,{optional:!0})||{};pendingTasks=fe(Hs);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=fe(zpe);urlSerializer=fe(wA);location=fe(Up);urlHandlingStrategy=fe(MA);_events=new cr;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=fe($pe);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=fe(PA,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!fe(DA,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:a=>{this.console.warn(a)}}),this.subscribeToNavigationEvents()}eventsSubscription=new jn;subscribeToNavigationEvents(){let a=this.navigationTransitions.events.subscribe(u=>{try{let p=this.navigationTransitions.currentTransition,g=this.navigationTransitions.currentNavigation;if(p!==null&&g!==null){if(this.stateManager.handleRouterEvent(u,g),u instanceof qs&&u.code!==Pi.Redirect&&u.code!==Pi.SupersededByNewNavigation)this.navigated=!0;else if(u instanceof id)this.navigated=!0;else if(u instanceof Sl){let y=u.navigationBehaviorOptions,R=this.urlHandlingStrategy.merge(u.url,p.currentRawUrl),w=Se({browserUrl:p.extras.browserUrl,info:p.extras.info,skipLocationChange:p.extras.skipLocationChange,replaceUrl:p.extras.replaceUrl||this.urlUpdateStrategy==="eager"||Ype(p.source)},y);this.scheduleNavigation(R,Wp,null,w,{resolve:p.resolve,reject:p.reject,promise:p.promise})}}nfe(u)&&this._events.next(u)}catch(p){this.navigationTransitions.transitionAbortSubject.next(p)}});this.eventsSubscription.add(a)}resetRootComponentType(a){this.routerState.root.component=a,this.navigationTransitions.rootComponentType=a}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Wp,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((a,u)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(a,"popstate",u)},0)})}navigateToSyncWithBrowser(a,u,p){let g={replaceUrl:!0},y=p?.navigationId?p:null;if(p){let w=Se({},p);delete w.navigationId,delete w.\u0275routerPageId,Object.keys(w).length!==0&&(g.state=w)}let R=this.parseUrl(a);this.scheduleNavigation(R,u,y,g)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(a){this.config=a.map(NA),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(a,u={}){let{relativeTo:p,queryParams:g,fragment:y,queryParamsHandling:R,preserveFragment:w}=u,L=w?this.currentUrlTree.fragment:y,V=null;switch(R??this.options.defaultQueryParamsHandling){case"merge":V=Se(Se({},this.currentUrlTree.queryParams),g);break;case"preserve":V=this.currentUrlTree.queryParams;break;default:V=g||null}V!==null&&(V=this.removeEmptyProps(V));let q;try{let Z=p?p.snapshot:this.routerState.snapshot.root;q=BW(Z)}catch{(typeof a[0]!="string"||a[0][0]!=="/")&&(a=[]),q=this.currentUrlTree.root}return HW(q,a,V,L??null)}navigateByUrl(a,u={skipLocationChange:!1}){let p=zp(a)?a:this.parseUrl(a),g=this.urlHandlingStrategy.merge(p,this.rawUrlTree);return this.scheduleNavigation(g,Wp,null,u)}navigate(a,u={skipLocationChange:!1}){return tfe(a),this.navigateByUrl(this.createUrlTree(a,u),u)}serializeUrl(a){return this.urlSerializer.serialize(a)}parseUrl(a){try{return this.urlSerializer.parse(a)}catch{return this.urlSerializer.parse("/")}}isActive(a,u){let p;if(u===!0?p=Se({},Zpe):u===!1?p=Se({},efe):p=u,zp(a))return IW(this.currentUrlTree,a,p);let g=this.parseUrl(a);return IW(this.currentUrlTree,g,p)}removeEmptyProps(a){return Object.entries(a).reduce((u,[p,g])=>(g!=null&&(u[p]=g),u),{})}scheduleNavigation(a,u,p,g,y){if(this.disposed)return Promise.resolve(!1);let R,w,L;y?(R=y.resolve,w=y.reject,L=y.promise):L=new Promise((q,Z)=>{R=q,w=Z});let V=this.pendingTasks.add();return Qpe(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(V))}),this.navigationTransitions.handleNavigationRequest({source:u,restoredState:p,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:a,extras:g,resolve:R,reject:w,promise:L,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),L.catch(q=>Promise.reject(q))}static \u0275fac=function(u){return new(u||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function tfe(i){for(let s=0;s<i.length;s++)if(i[s]==null)throw new De(4008,!1)}function nfe(i){return!(i instanceof Jp)&&!(i instanceof Sl)}var rfe=new be("");function o4(i,...s){return zc([{provide:PA,multi:!0,useValue:i},[],{provide:Cl,useFactory:ife,deps:[Ga]},{provide:Zc,multi:!0,useFactory:ofe},s.map(a=>a.\u0275providers)])}function ife(i){return i.routerState.root}function ofe(){let i=fe(jr);return s=>{let a=i.get(oi);if(s!==a.components[0])return;let u=i.get(Ga),p=i.get(sfe);i.get(afe)===1&&u.initialNavigation(),i.get(cfe,null,gt.Optional)?.setUpPreloading(),i.get(rfe,null,gt.Optional)?.init(),u.resetRootComponentType(a.componentTypes[0]),p.closed||(p.next(),p.complete(),p.unsubscribe())}}var sfe=new be("",{factory:()=>new cr}),afe=new be("",{providedIn:"root",factory:()=>1});var cfe=new be("");var Mv=class i{title="BGSG Audio";static \u0275fac=function(a){return new(a||i)};static \u0275cmp=si({type:i,selectors:[["app-header"]],inputs:{title:"title"},decls:4,vars:1,consts:[["id","header_image","src","/bgsgLogoIcon.png","alt","BGSG Logo"],["id","header_title"]],template:function(a,u){a&1&&(Un(0,"header"),Br(1,"img",0),Un(2,"h1",1),Lo(3),Zn()()),a&2&&(io(3),xp(" ",u.title," "))},styles:["header[_ngcontent-%COMP%]{background-color:#202020;margin:0;padding:10px;display:flex;align-items:center;column-gap:1rem}#header_title[_ngcontent-%COMP%]{color:#fff;font-weight:500;font-family:Oswald;font-size:2.3rem;margin:0;order:1}#header_image[_ngcontent-%COMP%]{margin-left:2rem;height:4.5rem;order:0}"]})};var kv=class i{static \u0275fac=function(a){return new(a||i)};static \u0275cmp=si({type:i,selectors:[["app-footer"]],decls:6,vars:0,consts:[[1,"container"],[1,"row"],[1,"col-md-12"],[1,"text-center"]],template:function(a,u){a&1&&(Un(0,"footer")(1,"div",0)(2,"div",1)(3,"div",2)(4,"p",3),Lo(5," \xA9 2025 BGSG Audio "),Zn()()()()())},styles:["footer[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#858585;margin:0}"]})};var UA=Hre(c4());var sd=class i{static channelStateFunctiins=[];static selctedStateFunc;static setChannelStateFunction(s,a){this.channelStateFunctiins.push({channelName:s,stateFunc:a})}static selectChannel(s){return this.channelStateFunctiins.forEach(a=>{a.channelName!==s?a.stateFunc(!1):this.selctedStateFunc=a.stateFunc}),!0}static streamStartSuccess(){this.selctedStateFunc(!0)}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})};var Wa=class i{static client;static localAudioTrack;static appId="13728741fdae45f09c44ba5e2f9c3ce4";static appCertificate="f19b6b57de9f4f26b8e17dfa63af517c";static token="";static uid="";static init(){this.client=UA.default.createClient({mode:"live",codec:"vp8",role:"host"}),this.setupEventListeners()}static setupEventListeners(){this.client.on("connection-state-change",s=>{s==="CONNECTED"&&sd.streamStartSuccess()})}static generateToken(s){return P(this,null,function*(){this.uid=this.generateUid();let a="http://212.227.183.175/token/generate",u=new URLSearchParams({appId:this.appId,appCertificate:this.appCertificate,channelName:s,uid:this.uid}),p=yield fetch(`${a}?${u.toString()}`);if(!p.ok)throw new Error(`HTTP error! Status: ${p.status}`);let g=yield p.json();return this.token=g.token,this.token})}static generateUid(){return Math.floor(Math.random()*1e7).toString()}static createLocalMediaTracks(){return P(this,null,function*(){this.localAudioTrack=yield UA.default.createMicrophoneAudioTrack(),yield this.client.publish([this.localAudioTrack])})}static startStream(s){return P(this,null,function*(){yield this.generateToken(s),yield this.client.join(this.appId,s,this.token,this.uid);let a={level:1};this.client.setClientRole("host",a),yield this.createLocalMediaTracks()})}static stopStream(){return P(this,null,function*(){this.localAudioTrack&&(this.localAudioTrack.close(),this.localAudioTrack=void 0),yield this.client.leave()})}static \u0275fac=function(a){return new(a||i)};static \u0275prov=Ge({token:i,factory:i.\u0275fac,providedIn:"root"})};var bl=class i{constructor(s){this.router=s;Wa.init()}checkLogin(){if(typeof window<"u"){var s=localStorage.getItem("loggedIn");s==="true"?this.router.navigate(["/admin"]):this.router.navigate(["/login"])}}ngOnInit(){this.checkLogin()}static \u0275fac=function(a){return new(a||i)(zt(Ga))};static \u0275cmp=si({type:i,selectors:[["app-root"]],decls:4,vars:1,consts:[[3,"title"]],template:function(a,u){a&1&&(Un(0,"div"),Br(1,"app-header",0)(2,"router-outlet")(3,"app-footer"),Zn()),a&2&&(io(),Ba("title","BGSG Audio - Admin"))},dependencies:[AA,Mv,kv],encapsulation:2})};var g4=(()=>{class i{_renderer;_elementRef;onChange=a=>{};onTouched=()=>{};constructor(a,u){this._renderer=a,this._elementRef=u}setProperty(a,u){this._renderer.setProperty(this._elementRef.nativeElement,a,u)}registerOnTouched(a){this.onTouched=a}registerOnChange(a){this.onChange=a}setDisabledState(a){this.setProperty("disabled",a)}static \u0275fac=function(u){return new(u||i)(zt(hl),zt(Xc))};static \u0275dir=Oi({type:i})}return i})(),dfe=(()=>{class i extends g4{static \u0275fac=(()=>{let a;return function(p){return(a||(a=Dp(i)))(p||i)}})();static \u0275dir=Oi({type:i,features:[ja]})}return i})(),E4=new be("");var ufe={provide:E4,useExisting:rl(()=>Hv),multi:!0};function lfe(){let i=Ks()?Ks().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}var hfe=new be(""),Hv=(()=>{class i extends g4{_compositionMode;_composing=!1;constructor(a,u,p){super(a,u),this._compositionMode=p,this._compositionMode==null&&(this._compositionMode=!lfe())}writeValue(a){let u=a??"";this.setProperty("value",u)}_handleInput(a){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(a)}_compositionStart(){this._composing=!0}_compositionEnd(a){this._composing=!1,this._compositionMode&&this.onChange(a)}static \u0275fac=function(u){return new(u||i)(zt(hl),zt(Xc),zt(hfe,8))};static \u0275dir=Oi({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(u,p){u&1&&ko("input",function(y){return p._handleInput(y.target.value)})("blur",function(){return p.onTouched()})("compositionstart",function(){return p._compositionStart()})("compositionend",function(y){return p._compositionEnd(y.target.value)})},standalone:!1,features:[fl([ufe]),ja]})}return i})();var _4=new be(""),v4=new be("");function y4(i){return i!=null}function T4(i){return Qc(i)?Nn(i):i}function S4(i){let s={};return i.forEach(a=>{s=a!=null?Se(Se({},s),a):s}),Object.keys(s).length===0?null:s}function C4(i,s){return s.map(a=>a(i))}function pfe(i){return!i.validate}function I4(i){return i.map(s=>pfe(s)?s:a=>s.validate(a))}function ffe(i){if(!i)return null;let s=i.filter(y4);return s.length==0?null:function(a){return S4(C4(a,s))}}function VA(i){return i!=null?ffe(I4(i)):null}function mfe(i){if(!i)return null;let s=i.filter(y4);return s.length==0?null:function(a){let u=C4(a,s).map(T4);return CR(u).pipe(yt(S4))}}function jA(i){return i!=null?mfe(I4(i)):null}function d4(i,s){return i===null?[s]:Array.isArray(i)?[...i,s]:[i,s]}function gfe(i){return i._rawValidators}function Efe(i){return i._rawAsyncValidators}function FA(i){return i?Array.isArray(i)?i:[i]:[]}function xv(i,s){return Array.isArray(i)?i.includes(s):i===s}function u4(i,s){let a=FA(s);return FA(i).forEach(p=>{xv(a,p)||a.push(p)}),a}function l4(i,s){return FA(s).filter(a=>!xv(i,a))}var Uv=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(s){this._rawValidators=s||[],this._composedValidatorFn=VA(this._rawValidators)}_setAsyncValidators(s){this._rawAsyncValidators=s||[],this._composedAsyncValidatorFn=jA(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(s){this._onDestroyCallbacks.push(s)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(s=>s()),this._onDestroyCallbacks=[]}reset(s=void 0){this.control&&this.control.reset(s)}hasError(s,a){return this.control?this.control.hasError(s,a):!1}getError(s,a){return this.control?this.control.getError(s,a):null}},Ol=class extends Uv{name;get formDirective(){return null}get path(){return null}},ff=class extends Uv{_parent=null;name=null;valueAccessor=null},Fv=class{_cd;constructor(s){this._cd=s}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},_fe={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},ZCe=At(Se({},_fe),{"[class.ng-submitted]":"isSubmitted"}),R4=(()=>{class i extends Fv{constructor(a){super(a)}static \u0275fac=function(u){return new(u||i)(zt(ff,2))};static \u0275dir=Oi({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(u,p){u&2&&sv("ng-untouched",p.isUntouched)("ng-touched",p.isTouched)("ng-pristine",p.isPristine)("ng-dirty",p.isDirty)("ng-valid",p.isValid)("ng-invalid",p.isInvalid)("ng-pending",p.isPending)},standalone:!1,features:[ja]})}return i})(),w4=(()=>{class i extends Fv{constructor(a){super(a)}static \u0275fac=function(u){return new(u||i)(zt(Ol,10))};static \u0275dir=Oi({type:i,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(u,p){u&2&&sv("ng-untouched",p.isUntouched)("ng-touched",p.isTouched)("ng-pristine",p.isPristine)("ng-dirty",p.isDirty)("ng-valid",p.isValid)("ng-invalid",p.isInvalid)("ng-pending",p.isPending)("ng-submitted",p.isSubmitted)},standalone:!1,features:[ja]})}return i})();var df="VALID",Lv="INVALID",Al="PENDING",uf="DISABLED",Nl=class{},Vv=class extends Nl{value;source;constructor(s,a){super(),this.value=s,this.source=a}},hf=class extends Nl{pristine;source;constructor(s,a){super(),this.pristine=s,this.source=a}},pf=class extends Nl{touched;source;constructor(s,a){super(),this.touched=s,this.source=a}},Dl=class extends Nl{status;source;constructor(s,a){super(),this.status=s,this.source=a}};function b4(i){return(Gv(i)?i.validators:i)||null}function vfe(i){return Array.isArray(i)?VA(i):i||null}function A4(i,s){return(Gv(s)?s.asyncValidators:i)||null}function yfe(i){return Array.isArray(i)?jA(i):i||null}function Gv(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}function Tfe(i,s,a){let u=i.controls;if(!(s?Object.keys(u):u).length)throw new De(1e3,"");if(!u[a])throw new De(1001,"")}function Sfe(i,s,a){i._forEachChild((u,p)=>{if(a[p]===void 0)throw new De(1002,"")})}var jv=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(s,a){this._assignValidators(s),this._assignAsyncValidators(a)}get validator(){return this._composedValidatorFn}set validator(s){this._rawValidators=this._composedValidatorFn=s}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(s){this._rawAsyncValidators=this._composedAsyncValidatorFn=s}get parent(){return this._parent}get status(){return Ws(this.statusReactive)}set status(s){Ws(()=>this.statusReactive.set(s))}_status=ml(()=>this.statusReactive());statusReactive=al(void 0);get valid(){return this.status===df}get invalid(){return this.status===Lv}get pending(){return this.status==Al}get disabled(){return this.status===uf}get enabled(){return this.status!==uf}errors;get pristine(){return Ws(this.pristineReactive)}set pristine(s){Ws(()=>this.pristineReactive.set(s))}_pristine=ml(()=>this.pristineReactive());pristineReactive=al(!0);get dirty(){return!this.pristine}get touched(){return Ws(this.touchedReactive)}set touched(s){Ws(()=>this.touchedReactive.set(s))}_touched=ml(()=>this.touchedReactive());touchedReactive=al(!1);get untouched(){return!this.touched}_events=new cr;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(s){this._assignValidators(s)}setAsyncValidators(s){this._assignAsyncValidators(s)}addValidators(s){this.setValidators(u4(s,this._rawValidators))}addAsyncValidators(s){this.setAsyncValidators(u4(s,this._rawAsyncValidators))}removeValidators(s){this.setValidators(l4(s,this._rawValidators))}removeAsyncValidators(s){this.setAsyncValidators(l4(s,this._rawAsyncValidators))}hasValidator(s){return xv(this._rawValidators,s)}hasAsyncValidator(s){return xv(this._rawAsyncValidators,s)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(s={}){let a=this.touched===!1;this.touched=!0;let u=s.sourceControl??this;this._parent&&!s.onlySelf&&this._parent.markAsTouched(At(Se({},s),{sourceControl:u})),a&&s.emitEvent!==!1&&this._events.next(new pf(!0,u))}markAllAsTouched(s={}){this.markAsTouched({onlySelf:!0,emitEvent:s.emitEvent,sourceControl:this}),this._forEachChild(a=>a.markAllAsTouched(s))}markAsUntouched(s={}){let a=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let u=s.sourceControl??this;this._forEachChild(p=>{p.markAsUntouched({onlySelf:!0,emitEvent:s.emitEvent,sourceControl:u})}),this._parent&&!s.onlySelf&&this._parent._updateTouched(s,u),a&&s.emitEvent!==!1&&this._events.next(new pf(!1,u))}markAsDirty(s={}){let a=this.pristine===!0;this.pristine=!1;let u=s.sourceControl??this;this._parent&&!s.onlySelf&&this._parent.markAsDirty(At(Se({},s),{sourceControl:u})),a&&s.emitEvent!==!1&&this._events.next(new hf(!1,u))}markAsPristine(s={}){let a=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let u=s.sourceControl??this;this._forEachChild(p=>{p.markAsPristine({onlySelf:!0,emitEvent:s.emitEvent})}),this._parent&&!s.onlySelf&&this._parent._updatePristine(s,u),a&&s.emitEvent!==!1&&this._events.next(new hf(!0,u))}markAsPending(s={}){this.status=Al;let a=s.sourceControl??this;s.emitEvent!==!1&&(this._events.next(new Dl(this.status,a)),this.statusChanges.emit(this.status)),this._parent&&!s.onlySelf&&this._parent.markAsPending(At(Se({},s),{sourceControl:a}))}disable(s={}){let a=this._parentMarkedDirty(s.onlySelf);this.status=uf,this.errors=null,this._forEachChild(p=>{p.disable(At(Se({},s),{onlySelf:!0}))}),this._updateValue();let u=s.sourceControl??this;s.emitEvent!==!1&&(this._events.next(new Vv(this.value,u)),this._events.next(new Dl(this.status,u)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(At(Se({},s),{skipPristineCheck:a}),this),this._onDisabledChange.forEach(p=>p(!0))}enable(s={}){let a=this._parentMarkedDirty(s.onlySelf);this.status=df,this._forEachChild(u=>{u.enable(At(Se({},s),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:s.emitEvent}),this._updateAncestors(At(Se({},s),{skipPristineCheck:a}),this),this._onDisabledChange.forEach(u=>u(!1))}_updateAncestors(s,a){this._parent&&!s.onlySelf&&(this._parent.updateValueAndValidity(s),s.skipPristineCheck||this._parent._updatePristine({},a),this._parent._updateTouched({},a))}setParent(s){this._parent=s}getRawValue(){return this.value}updateValueAndValidity(s={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let u=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===df||this.status===Al)&&this._runAsyncValidator(u,s.emitEvent)}let a=s.sourceControl??this;s.emitEvent!==!1&&(this._events.next(new Vv(this.value,a)),this._events.next(new Dl(this.status,a)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!s.onlySelf&&this._parent.updateValueAndValidity(At(Se({},s),{sourceControl:a}))}_updateTreeValidity(s={emitEvent:!0}){this._forEachChild(a=>a._updateTreeValidity(s)),this.updateValueAndValidity({onlySelf:!0,emitEvent:s.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?uf:df}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(s,a){if(this.asyncValidator){this.status=Al,this._hasOwnPendingAsyncValidator={emitEvent:a!==!1};let u=T4(this.asyncValidator(this));this._asyncValidationSubscription=u.subscribe(p=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(p,{emitEvent:a,shouldHaveEmitted:s})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let s=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,s}return!1}setErrors(s,a={}){this.errors=s,this._updateControlsErrors(a.emitEvent!==!1,this,a.shouldHaveEmitted)}get(s){let a=s;return a==null||(Array.isArray(a)||(a=a.split(".")),a.length===0)?null:a.reduce((u,p)=>u&&u._find(p),this)}getError(s,a){let u=a?this.get(a):this;return u&&u.errors?u.errors[s]:null}hasError(s,a){return!!this.getError(s,a)}get root(){let s=this;for(;s._parent;)s=s._parent;return s}_updateControlsErrors(s,a,u){this.status=this._calculateStatus(),s&&this.statusChanges.emit(this.status),(s||u)&&this._events.next(new Dl(this.status,a)),this._parent&&this._parent._updateControlsErrors(s,a,u)}_initObservables(){this.valueChanges=new dr,this.statusChanges=new dr}_calculateStatus(){return this._allControlsDisabled()?uf:this.errors?Lv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Al)?Al:this._anyControlsHaveStatus(Lv)?Lv:df}_anyControlsHaveStatus(s){return this._anyControls(a=>a.status===s)}_anyControlsDirty(){return this._anyControls(s=>s.dirty)}_anyControlsTouched(){return this._anyControls(s=>s.touched)}_updatePristine(s,a){let u=!this._anyControlsDirty(),p=this.pristine!==u;this.pristine=u,this._parent&&!s.onlySelf&&this._parent._updatePristine(s,a),p&&this._events.next(new hf(this.pristine,a))}_updateTouched(s={},a){this.touched=this._anyControlsTouched(),this._events.next(new pf(this.touched,a)),this._parent&&!s.onlySelf&&this._parent._updateTouched(s,a)}_onDisabledChange=[];_registerOnCollectionChange(s){this._onCollectionChange=s}_setUpdateStrategy(s){Gv(s)&&s.updateOn!=null&&(this._updateOn=s.updateOn)}_parentMarkedDirty(s){let a=this._parent&&this._parent.dirty;return!s&&!!a&&!this._parent._anyControlsDirty()}_find(s){return null}_assignValidators(s){this._rawValidators=Array.isArray(s)?s.slice():s,this._composedValidatorFn=vfe(this._rawValidators)}_assignAsyncValidators(s){this._rawAsyncValidators=Array.isArray(s)?s.slice():s,this._composedAsyncValidatorFn=yfe(this._rawAsyncValidators)}},Bv=class extends jv{constructor(s,a,u){super(b4(a),A4(u,a)),this.controls=s,this._initObservables(),this._setUpdateStrategy(a),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(s,a){return this.controls[s]?this.controls[s]:(this.controls[s]=a,a.setParent(this),a._registerOnCollectionChange(this._onCollectionChange),a)}addControl(s,a,u={}){this.registerControl(s,a),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}removeControl(s,a={}){this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),delete this.controls[s],this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}setControl(s,a,u={}){this.controls[s]&&this.controls[s]._registerOnCollectionChange(()=>{}),delete this.controls[s],a&&this.registerControl(s,a),this.updateValueAndValidity({emitEvent:u.emitEvent}),this._onCollectionChange()}contains(s){return this.controls.hasOwnProperty(s)&&this.controls[s].enabled}setValue(s,a={}){Sfe(this,!0,s),Object.keys(s).forEach(u=>{Tfe(this,!0,u),this.controls[u].setValue(s[u],{onlySelf:!0,emitEvent:a.emitEvent})}),this.updateValueAndValidity(a)}patchValue(s,a={}){s!=null&&(Object.keys(s).forEach(u=>{let p=this.controls[u];p&&p.patchValue(s[u],{onlySelf:!0,emitEvent:a.emitEvent})}),this.updateValueAndValidity(a))}reset(s={},a={}){this._forEachChild((u,p)=>{u.reset(s?s[p]:null,{onlySelf:!0,emitEvent:a.emitEvent})}),this._updatePristine(a,this),this._updateTouched(a,this),this.updateValueAndValidity(a)}getRawValue(){return this._reduceChildren({},(s,a,u)=>(s[u]=a.getRawValue(),s))}_syncPendingControls(){let s=this._reduceChildren(!1,(a,u)=>u._syncPendingControls()?!0:a);return s&&this.updateValueAndValidity({onlySelf:!0}),s}_forEachChild(s){Object.keys(this.controls).forEach(a=>{let u=this.controls[a];u&&s(u,a)})}_setUpControls(){this._forEachChild(s=>{s.setParent(this),s._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(s){for(let[a,u]of Object.entries(this.controls))if(this.contains(a)&&s(u))return!0;return!1}_reduceValue(){let s={};return this._reduceChildren(s,(a,u,p)=>((u.enabled||this.disabled)&&(a[p]=u.value),a))}_reduceChildren(s,a){let u=s;return this._forEachChild((p,g)=>{u=a(u,p,g)}),u}_allControlsDisabled(){for(let s of Object.keys(this.controls))if(this.controls[s].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(s){return this.controls.hasOwnProperty(s)?this.controls[s]:null}};var BA=new be("",{providedIn:"root",factory:()=>HA}),HA="always";function Cfe(i,s){return[...s.path,i]}function D4(i,s,a=HA){O4(i,s),s.valueAccessor.writeValue(i.value),(i.disabled||a==="always")&&s.valueAccessor.setDisabledState?.(i.disabled),Rfe(i,s),bfe(i,s),wfe(i,s),Ife(i,s)}function h4(i,s){i.forEach(a=>{a.registerOnValidatorChange&&a.registerOnValidatorChange(s)})}function Ife(i,s){if(s.valueAccessor.setDisabledState){let a=u=>{s.valueAccessor.setDisabledState(u)};i.registerOnDisabledChange(a),s._registerOnDestroy(()=>{i._unregisterOnDisabledChange(a)})}}function O4(i,s){let a=gfe(i);s.validator!==null?i.setValidators(d4(a,s.validator)):typeof a=="function"&&i.setValidators([a]);let u=Efe(i);s.asyncValidator!==null?i.setAsyncValidators(d4(u,s.asyncValidator)):typeof u=="function"&&i.setAsyncValidators([u]);let p=()=>i.updateValueAndValidity();h4(s._rawValidators,p),h4(s._rawAsyncValidators,p)}function Rfe(i,s){s.valueAccessor.registerOnChange(a=>{i._pendingValue=a,i._pendingChange=!0,i._pendingDirty=!0,i.updateOn==="change"&&N4(i,s)})}function wfe(i,s){s.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,i.updateOn==="blur"&&i._pendingChange&&N4(i,s),i.updateOn!=="submit"&&i.markAsTouched()})}function N4(i,s){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),s.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function bfe(i,s){let a=(u,p)=>{s.valueAccessor.writeValue(u),p&&s.viewToModelUpdate(u)};i.registerOnChange(a),s._registerOnDestroy(()=>{i._unregisterOnChange(a)})}function Afe(i,s){i==null,O4(i,s)}function Dfe(i,s){if(!i.hasOwnProperty("model"))return!1;let a=i.model;return a.isFirstChange()?!0:!Object.is(s,a.currentValue)}function Ofe(i){return Object.getPrototypeOf(i.constructor)===dfe}function Nfe(i,s){i._syncPendingControls(),s.forEach(a=>{let u=a.control;u.updateOn==="submit"&&u._pendingChange&&(a.viewToModelUpdate(u._pendingValue),u._pendingChange=!1)})}function Pfe(i,s){if(!s)return null;Array.isArray(s);let a,u,p;return s.forEach(g=>{g.constructor===Hv?a=g:Ofe(g)?u=g:p=g}),p||u||a||null}var Mfe={provide:Ol,useExisting:rl(()=>GA)},lf=Promise.resolve(),GA=(()=>{class i extends Ol{callSetDisabledState;get submitted(){return Ws(this.submittedReactive)}_submitted=ml(()=>this.submittedReactive());submittedReactive=al(!1);_directives=new Set;form;ngSubmit=new dr;options;constructor(a,u,p){super(),this.callSetDisabledState=p,this.form=new Bv({},VA(a),jA(u))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(a){lf.then(()=>{let u=this._findContainer(a.path);a.control=u.registerControl(a.name,a.control),D4(a.control,a,this.callSetDisabledState),a.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(a)})}getControl(a){return this.form.get(a.path)}removeControl(a){lf.then(()=>{let u=this._findContainer(a.path);u&&u.removeControl(a.name),this._directives.delete(a)})}addFormGroup(a){lf.then(()=>{let u=this._findContainer(a.path),p=new Bv({});Afe(p,a),u.registerControl(a.name,p),p.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(a){lf.then(()=>{let u=this._findContainer(a.path);u&&u.removeControl(a.name)})}getFormGroup(a){return this.form.get(a.path)}updateModel(a,u){lf.then(()=>{this.form.get(a.path).setValue(u)})}setValue(a){this.control.setValue(a)}onSubmit(a){return this.submittedReactive.set(!0),Nfe(this.form,this._directives),this.ngSubmit.emit(a),a?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(a=void 0){this.form.reset(a),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(a){return a.pop(),a.length?this.form.get(a):this.form}static \u0275fac=function(u){return new(u||i)(zt(_4,10),zt(v4,10),zt(BA,8))};static \u0275dir=Oi({type:i,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(u,p){u&1&&ko("submit",function(y){return p.onSubmit(y)})("reset",function(){return p.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[fl([Mfe]),ja]})}return i})();function p4(i,s){let a=i.indexOf(s);a>-1&&i.splice(a,1)}function f4(i){return typeof i=="object"&&i!==null&&Object.keys(i).length===2&&"value"in i&&"disabled"in i}var kfe=class extends jv{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(s=null,a,u){super(b4(a),A4(u,a)),this._applyFormState(s),this._setUpdateStrategy(a),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Gv(a)&&(a.nonNullable||a.initialValueIsDefault)&&(f4(s)?this.defaultValue=s.value:this.defaultValue=s)}setValue(s,a={}){this.value=this._pendingValue=s,this._onChange.length&&a.emitModelToViewChange!==!1&&this._onChange.forEach(u=>u(this.value,a.emitViewToModelChange!==!1)),this.updateValueAndValidity(a)}patchValue(s,a={}){this.setValue(s,a)}reset(s=this.defaultValue,a={}){this._applyFormState(s),this.markAsPristine(a),this.markAsUntouched(a),this.setValue(this.value,a),this._pendingChange=!1}_updateValue(){}_anyControls(s){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(s){this._onChange.push(s)}_unregisterOnChange(s){p4(this._onChange,s)}registerOnDisabledChange(s){this._onDisabledChange.push(s)}_unregisterOnDisabledChange(s){p4(this._onDisabledChange,s)}_forEachChild(s){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(s){f4(s)?(this.value=this._pendingValue=s.value,s.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=s}};var Lfe={provide:ff,useExisting:rl(()=>WA)},m4=Promise.resolve(),WA=(()=>{class i extends ff{_changeDetectorRef;callSetDisabledState;control=new kfe;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new dr;constructor(a,u,p,g,y,R){super(),this._changeDetectorRef=y,this.callSetDisabledState=R,this._parent=a,this._setValidators(u),this._setAsyncValidators(p),this.valueAccessor=Pfe(this,g)}ngOnChanges(a){if(this._checkForErrors(),!this._registered||"name"in a){if(this._registered&&(this._checkName(),this.formDirective)){let u=a.name.previousValue;this.formDirective.removeControl({name:u,path:this._getPath(u)})}this._setUpControl()}"isDisabled"in a&&this._updateDisabled(a),Dfe(a,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(a){this.viewModel=a,this.update.emit(a)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){D4(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(a){m4.then(()=>{this.control.setValue(a,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(a){let u=a.isDisabled.currentValue,p=u!==0&&av(u);m4.then(()=>{p&&!this.control.disabled?this.control.disable():!p&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(a){return this._parent?Cfe(a,this._parent):[a]}static \u0275fac=function(u){return new(u||i)(zt(Ol,9),zt(_4,10),zt(v4,10),zt(E4,10),zt(ed,8),zt(BA,8))};static \u0275dir=Oi({type:i,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[fl([Lfe]),ja,Ip]})}return i})();var P4=(()=>{class i{static \u0275fac=function(u){return new(u||i)};static \u0275dir=Oi({type:i,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return i})();var xfe=(()=>{class i{static \u0275fac=function(u){return new(u||i)};static \u0275mod=pl({type:i});static \u0275inj=il({})}return i})();var M4=(()=>{class i{static withConfig(a){return{ngModule:i,providers:[{provide:BA,useValue:a.callSetDisabledState??HA}]}}static \u0275fac=function(u){return new(u||i)};static \u0275mod=pl({type:i});static \u0275inj=il({imports:[xfe]})}return i})();var mf=class i{constructor(s){this.router=s}password="";login(){this.password==="technik1"&&(this.router.navigate(["/admin"]),localStorage.setItem("loggedIn","true"))}static \u0275fac=function(a){return new(a||i)(zt(Ga))};static \u0275cmp=si({type:i,selectors:[["app-login"]],decls:9,vars:1,consts:[[1,"login-form-container"],[1,"row","justify-content-center"],[1,"row","input-form"],[1,"input-group","justify-content-center"],[1,"col-4"],["type","password","name","password","placeholder","Password",1,"form-control",3,"ngModelChange","ngModel"],["type","button",1,"btn","btn-dark","col-1",3,"click"],[1,"fa-solid","fa-arrow-right"]],template:function(a,u){a&1&&(Un(0,"div",0)(1,"h1",1),Lo(2," Login "),Zn(),Un(3,"form",2)(4,"div",3)(5,"div",4)(6,"input",5),Mb("ngModelChange",function(g){return G3(u.password,g)||(u.password=g),g}),Zn()(),Un(7,"button",6),ko("click",function(){return u.login()}),Br(8,"i",7),Zn()()()()),a&2&&(io(6),Pb("ngModel",u.password))},dependencies:[M4,P4,Hv,R4,w4,WA,GA],styles:[".login-form-container[_ngcontent-%COMP%]{width:50%;margin-left:auto;margin-right:auto;margin-top:10%}.login-form-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:2.5rem}.save-password-checkbox[_ngcontent-%COMP%]{margin-top:1rem}"]})};function Ffe(i,s){i&1&&Br(0,"i",9)}function Vfe(i,s){i&1&&Br(0,"i",10)}function jfe(i,s){if(i&1){let a=V3();Un(0,"div",6)(1,"button",7),ko("click",function(){LH(a);let p=Ob();return xH(p.buttonPressed())}),ov(2,Ffe,1,0,"i",8)(3,Vfe,1,0,"ng-template",null,1,kb),Zn()()}if(i&2){let a=Nb(4),u=Ob();io(2),Ba("ngIf",u.isPlaying==!1)("ngIfElse",a)}}function Bfe(i,s){i&1&&Br(0,"div",11)}var Wv=class i{title="";channelName="";isPlaying=!1;isLoading=!1;ngOnInit(){sd.setChannelStateFunction(this.channelName,this.setChannelState.bind(this))}listener(s){this.isPlaying=s,this.isLoading=!1}buttonPressed(){this.isPlaying?(this.isPlaying=!1,Wa.stopStream()):this.startStream()}startStream(){sd.selectChannel(this.channelName),Wa.startStream(this.channelName),this.isLoading=!0}setChannelState(s){console.log(this.channelName,s),this.isPlaying=s,this.isLoading=!1,s||Wa.stopStream()}static \u0275fac=function(a){return new(a||i)};static \u0275cmp=si({type:i,selectors:[["app-channel"]],inputs:{title:"title",channelName:"channelName"},features:[fl([])],decls:9,vars:3,consts:[["loadingIndicator",""],["pauseIcon",""],[1,"channelCard"],[1,"cardContent"],["class","startStreamButton",4,"ngIf","ngIfElse"],[1,""],[1,"startStreamButton"],[1,"btn","btn-dark",3,"click"],["class","fa-solid fa-play",4,"ngIf","ngIfElse"],[1,"fa-solid","fa-play"],[1,"fas","fa-pause"],[1,"loader"]],template:function(a,u){if(a&1&&(Un(0,"div",2)(1,"h3"),Lo(2),Zn(),Un(3,"div",3),ov(4,jfe,5,2,"div",4)(5,Bfe,1,0,"ng-template",null,0,kb),Un(7,"p",5),Lo(8," Stream starten "),Zn()()()),a&2){let p=Nb(6);io(2),xp(" ",u.title," "),io(2),Ba("ngIf",u.isLoading==!1)("ngIfElse",p)}},dependencies:[sW],styles:[".channelCard[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-evenly;padding:1rem;border-radius:10px;border-color:#000;border-width:1px;border-style:solid;box-shadow:0 0 10px #0000004d;background-color:#fff;margin:1rem;width:350px;min-height:180px}.cardContent[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-evenly;align-items:center}.startStreamButton[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{padding:4px 13px;font-size:1.5rem}.cardContent[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{order:1;margin:0;margin-left:1rem;font-size:1.5rem;font-weight:300}h3[_ngcontent-%COMP%]{font-weight:600}.loader[_ngcontent-%COMP%]{border:7px solid #f3f3f3;border-top:7px solid #202020;border-radius:50%;width:35px;height:35px;animation:_ngcontent-%COMP%_spin 2s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]})};function Hfe(i,s){if(i&1&&Br(0,"app-channel",3),i&2){let a=s.$implicit;Ba("title",a.title)("channelName",a.channelName)}}var gf=class i{constructor(s){this.router=s}channels=[{title:"Russische \xDCbersetzung",channelName:"Russisch"},{title:"Deutsche \xDCbertragung",channelName:"Deutsch"}];logout(){console.log("Logging out"),localStorage.setItem("loggedIn","false"),this.router.navigate(["/login"])}static \u0275fac=function(a){return new(a||i)(zt(Ga))};static \u0275cmp=si({type:i,selectors:[["app-admin-page"]],decls:7,vars:0,consts:[[1,"row","justify-content-end","m-3"],[1,"btn","btn-outline-danger","ml-auto","col-auto",3,"click"],[1,"channelContainer"],[3,"title","channelName"]],template:function(a,u){a&1&&(Un(0,"div")(1,"div",0)(2,"button",1),ko("click",function(){return u.logout()}),Lo(3," Abmelden "),Zn()(),Un(4,"div",2),x3(5,Hfe,1,2,"app-channel",3,L3),Zn()()),a&2&&(io(5),U3(u.channels))},dependencies:[Wv],styles:[".channelContainer[_ngcontent-%COMP%]{display:flex;justify-content:center;column-gap:40px}"]})};var k4=[{path:"",component:bl},{path:"login",component:mf},{path:"admin",component:gf}];var L4={providers:[q3({eventCoalescing:!0}),o4(k4),CW(SW())]};yW(bl,L4).catch(i=>console.error(i));
